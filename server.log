2025-02-27 16:54:32,557 - INFO - Incoming request: {"timestamp": "2025-02-27T13:54:32.557661", "method": "GET", "path": "/", "query_params": "", "client": "192.168.23.31"}
2025-02-27 16:54:32,558 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-02-27 16:54:49,722 - INFO - Incoming request: {"timestamp": "2025-02-27T13:54:49.722657", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.23.31"}
2025-02-27 16:54:49,724 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.009}
2025-02-27 16:54:49,914 - INFO - Incoming request: {"timestamp": "2025-02-27T13:54:49.913509", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.23.31"}
2025-02-27 16:54:50,244 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 331.062}
2025-03-01 14:55:52,190 - INFO - Incoming request: {"timestamp": "2025-03-01T11:55:52.190438", "method": "GET", "path": "/", "query_params": "", "client": "192.168.195.233"}
2025-03-01 14:55:52,191 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-01 14:56:16,749 - INFO - Incoming request: {"timestamp": "2025-03-01T11:56:16.748270", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.195.233"}
2025-03-01 14:56:16,762 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.003}
2025-03-01 14:56:16,964 - INFO - Incoming request: {"timestamp": "2025-03-01T11:56:16.964326", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.195.233"}
2025-03-01 14:56:17,226 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 261.944}
2025-03-01 14:56:17,456 - INFO - Incoming request: {"timestamp": "2025-03-01T11:56:17.456025", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMxOTc3fQ.DlHjdQgv2qn_uT2-Kc7F9YtRQJfBi1TrY2XEu5FLPu0", "client": "192.168.195.233"}
2025-03-01 14:56:17,457 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-01 14:56:17,904 - INFO - Incoming request: {"timestamp": "2025-03-01T11:56:17.904093", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.195.233"}
2025-03-01 14:56:17,905 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-01 15:06:25,227 - INFO - Incoming request: {"timestamp": "2025-03-01T12:06:25.227186", "method": "GET", "path": "/", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:06:25,227 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-01 15:06:25,646 - INFO - Incoming request: {"timestamp": "2025-03-01T12:06:25.646488", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:06:25,652 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-01 15:06:25,715 - INFO - Incoming request: {"timestamp": "2025-03-01T12:06:25.715449", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMyNTg1fQ.XXKsIsVYpRyndcLGgwUrvbsA6czUURrFRCz75jq5BmM", "client": "192.168.195.233"}
2025-03-01 15:06:25,716 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.9990000000000001}
2025-03-01 15:22:29,694 - INFO - Incoming request: {"timestamp": "2025-03-01T12:22:29.693576", "method": "GET", "path": "/", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:22:29,694 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-01 15:22:54,039 - INFO - Incoming request: {"timestamp": "2025-03-01T12:22:54.039973", "method": "GET", "path": "/", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:22:54,039 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-01 15:23:04,638 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:04.637603", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:04,640 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.99}
2025-03-01 15:23:04,871 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:04.871145", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:05,115 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 244.055}
2025-03-01 15:23:05,231 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:05.231290", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:05,231 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:05,978 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:05.977187", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:05,979 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.9220000000000002}
2025-03-01 15:23:06,719 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:06.719336", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:06,719 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:10,254 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:10.254581", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:10,254 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:11,785 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:11.785470", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:11,785 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:12,221 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:12.221518", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:12,221 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:14,386 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:14.386912", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:14,387 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-01 15:23:14,482 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:14.482082", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:14,482 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:15,284 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:15.284252", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:15,284 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:16,799 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:16.799652", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:16,799 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:20,311 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:20.311674", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:20,311 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:21,666 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:21.666373", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.195.233"}
2025-03-01 15:23:21,677 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.991000000000001}
2025-03-01 15:23:21,709 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:21.709443", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNjAxfQ.JsWDXQNWg2qPfNlKIt0PtU7zjtCcAvDlc5rxt06fSNs", "client": "192.168.195.233"}
2025-03-01 15:23:21,709 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-01 15:23:21,810 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:21.810703", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:21,811 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-01 15:23:26,721 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:26.721863", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNjAxfQ.JsWDXQNWg2qPfNlKIt0PtU7zjtCcAvDlc5rxt06fSNs", "client": "192.168.195.233"}
2025-03-01 15:23:26,722 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-01 15:23:26,843 - INFO - Incoming request: {"timestamp": "2025-03-01T12:23:26.842998", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwiZXhwIjoxNzQwODMzNTg1fQ.eIE2ob43p1kBaMh8bvCswC1SZ_UjIG2PETwVXDAl4KM", "client": "192.168.195.233"}
2025-03-01 15:23:26,843 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.001}
2025-03-09 15:14:48,741 - main - INFO - Starting YuMSG Server...
2025-03-09 15:15:05,312 - main - INFO - Starting YuMSG Server...
2025-03-09 15:16:27,890 - main - INFO - Starting YuMSG Server...
2025-03-09 15:22:23,129 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:22:24,008 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:22:24,040 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:22:24,070 - app.main - INFO - Starting YuMSG Server...
2025-03-09 15:22:24,070 - app.database - INFO - Initializing database at: postgresql://postgres:postpass@localhost:5432/chatdb
2025-03-09 15:22:24,125 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-09 15:22:24,125 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:22:24,126 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-09 15:22:24,126 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:22:24,127 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-09 15:22:24,127 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:22:24,130 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:22:24,130 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:22:24,130 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:22:24,134 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:22:24,134 - app.database - INFO - Existing tables before creation: []
2025-03-09 15:22:24,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:22:24,136 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:22:24,136 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:22:24,136 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:22:24,136 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007753s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:22:24,137 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id SERIAL NOT NULL, 
	email VARCHAR NOT NULL, 
	username VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	is_active BOOLEAN, 
	created_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	updated_at TIMESTAMP WITH TIME ZONE, 
	has_avatar BOOLEAN, 
	avatar_path VARCHAR, 
	last_seen TIMESTAMP WITH TIME ZONE, 
	PRIMARY KEY (id)
)


2025-03-09 15:22:24,137 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] {}
2025-03-09 15:22:24,168 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-03-09 15:22:24,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] {}
2025-03-09 15:22:24,171 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-03-09 15:22:24,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] {}
2025-03-09 15:22:24,174 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_username ON users (username)
2025-03-09 15:22:24,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] {}
2025-03-09 15:22:24,178 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE user_devices (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	device_id VARCHAR NOT NULL, 
	refresh_token VARCHAR, 
	last_login TIMESTAMP WITH TIME ZONE, 
	created_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-03-09 15:22:24,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] {}
2025-03-09 15:22:24,193 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_user_devices_id ON user_devices (id)
2025-03-09 15:22:24,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] {}
2025-03-09 15:22:24,196 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:22:24,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:22:24,198 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:22:24,198 - sqlalchemy.engine.Engine - INFO - [cached since 0.06841s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:22:24,199 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:22:24,199 - app.database - INFO - Tables after creation: ['users', 'user_devices']
2025-03-09 15:22:24,199 - app.database - INFO - Database tables created successfully
2025-03-09 15:22:24,200 - app.main - INFO - Database initialized
2025-03-09 15:22:24,233 - app.core.crypto - INFO - Server keypair generated successfully
2025-03-09 15:22:24,233 - app.main - INFO - Server keypair generated
2025-03-09 15:22:24,234 - app.services.online_status_service - INFO - Online status cleanup task started
2025-03-09 15:22:24,234 - app.services.message_buffer - INFO - Message buffer cleanup task started
2025-03-09 15:22:24,234 - app.main - INFO - Services started
2025-03-09 15:24:53,399 - INFO - Incoming request: {"timestamp": "2025-03-09T12:24:53.398937", "method": "GET", "path": "/", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:24:53,399 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:24:53.398937", "method": "GET", "path": "/", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:24:53,399 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-09 15:24:53,399 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-09 15:25:10,367 - INFO - Incoming request: {"timestamp": "2025-03-09T12:25:10.367237", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:25:10,367 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:25:10.367237", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:25:10,367 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:25:10,367 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:29:31,313 - app.main - INFO - Shutting down YuMSG Server...
2025-03-09 15:29:31,313 - app.services.online_status_service - INFO - Online status cleanup task stopped
2025-03-09 15:29:31,313 - app.services.message_buffer - INFO - Message buffer cleanup task stopped
2025-03-09 15:29:31,313 - app.main - INFO - Services stopped
2025-03-09 15:29:32,335 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:29:43,464 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:29:48,631 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:30:35,709 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:30:36,595 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:30:36,628 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:30:36,660 - app.main - INFO - Starting YuMSG Server...
2025-03-09 15:30:36,660 - app.database - INFO - Initializing database at: postgresql://postgres:postpass@localhost:5432/chatdb
2025-03-09 15:30:36,698 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-09 15:30:36,698 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:30:36,699 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-09 15:30:36,699 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:30:36,699 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-09 15:30:36,699 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:30:36,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:30:36,702 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:30:36,703 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:30:36,704 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:30:36,705 - app.database - INFO - Existing tables before creation: ['users', 'user_devices']
2025-03-09 15:30:36,705 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:30:36,706 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:30:36,706 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:30:36,706 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:30:36,707 - sqlalchemy.engine.Engine - INFO - [cached since 0.000775s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:30:36,707 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:30:36,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:30:36,708 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:30:36,708 - sqlalchemy.engine.Engine - INFO - [cached since 0.005565s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:30:36,709 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:30:36,709 - app.database - INFO - Tables after creation: ['users', 'user_devices']
2025-03-09 15:30:36,709 - app.database - INFO - Database tables created successfully
2025-03-09 15:30:36,709 - app.main - INFO - Database initialized
2025-03-09 15:30:36,762 - app.core.crypto - INFO - Server keypair generated successfully
2025-03-09 15:30:36,762 - app.main - INFO - Server keypair generated
2025-03-09 15:30:36,763 - app.services.online_status_service - INFO - Online status cleanup task started
2025-03-09 15:30:36,763 - app.services.message_buffer - INFO - Message buffer cleanup task started
2025-03-09 15:30:36,763 - app.main - INFO - Services started
2025-03-09 15:30:43,272 - INFO - Incoming request: {"timestamp": "2025-03-09T12:30:43.272277", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:30:43,272 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:30:43.272277", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:30:43,273 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:30:43,273 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:30:48,904 - INFO - Incoming request: {"timestamp": "2025-03-09T12:30:48.904896", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:30:48,904 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:30:48.904896", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:30:48,905 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:30:48,905 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:32:34,671 - app.main - INFO - Shutting down YuMSG Server...
2025-03-09 15:32:34,671 - app.services.online_status_service - INFO - Online status cleanup task stopped
2025-03-09 15:32:34,671 - app.services.message_buffer - INFO - Message buffer cleanup task stopped
2025-03-09 15:32:34,671 - app.main - INFO - Services stopped
2025-03-09 15:32:35,676 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:32:35,706 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:32:35,735 - app.main - INFO - Starting YuMSG Server...
2025-03-09 15:32:35,735 - app.database - INFO - Initializing database at: postgresql://postgres:postpass@localhost:5432/chatdb
2025-03-09 15:32:35,773 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-09 15:32:35,773 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:32:35,774 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-09 15:32:35,774 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:32:35,774 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-09 15:32:35,774 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:32:35,777 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:35,777 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:35,777 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:35,779 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:32:35,779 - app.database - INFO - Existing tables before creation: ['users', 'user_devices']
2025-03-09 15:32:35,779 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:35,780 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:35,780 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:35,781 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:35,781 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007033s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:35,781 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:32:35,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:35,782 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:35,782 - sqlalchemy.engine.Engine - INFO - [cached since 0.005056s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:35,783 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:32:35,783 - app.database - INFO - Tables after creation: ['users', 'user_devices']
2025-03-09 15:32:35,783 - app.database - INFO - Database tables created successfully
2025-03-09 15:32:35,783 - app.main - INFO - Database initialized
2025-03-09 15:32:35,794 - app.core.crypto - INFO - Server keypair generated successfully
2025-03-09 15:32:35,794 - app.main - INFO - Server keypair generated
2025-03-09 15:32:35,795 - app.services.online_status_service - INFO - Online status cleanup task started
2025-03-09 15:32:35,795 - app.services.message_buffer - INFO - Message buffer cleanup task started
2025-03-09 15:32:35,795 - app.main - INFO - Services started
2025-03-09 15:32:41,728 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:32:42,606 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:32:42,635 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:32:42,664 - app.main - INFO - Starting YuMSG Server...
2025-03-09 15:32:42,665 - app.database - INFO - Initializing database at: postgresql://postgres:postpass@localhost:5432/chatdb
2025-03-09 15:32:42,702 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-09 15:32:42,702 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:32:42,703 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-09 15:32:42,703 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:32:42,703 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-09 15:32:42,703 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:32:42,707 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:42,707 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:42,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:42,709 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:32:42,709 - app.database - INFO - Existing tables before creation: ['users', 'user_devices']
2025-03-09 15:32:42,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:42,710 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:42,710 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:42,710 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:42,711 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007627s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:42,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:32:42,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:42,712 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:32:42,712 - sqlalchemy.engine.Engine - INFO - [cached since 0.005282s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:32:42,712 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:32:42,713 - app.database - INFO - Tables after creation: ['users', 'user_devices']
2025-03-09 15:32:42,713 - app.database - INFO - Database tables created successfully
2025-03-09 15:32:42,713 - app.main - INFO - Database initialized
2025-03-09 15:32:42,741 - app.core.crypto - INFO - Server keypair generated successfully
2025-03-09 15:32:42,741 - app.main - INFO - Server keypair generated
2025-03-09 15:32:42,742 - app.services.online_status_service - INFO - Online status cleanup task started
2025-03-09 15:32:42,742 - app.services.message_buffer - INFO - Message buffer cleanup task started
2025-03-09 15:32:42,742 - app.main - INFO - Services started
2025-03-09 15:32:45,369 - INFO - Incoming request: {"timestamp": "2025-03-09T12:32:45.369903", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:32:45,369 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:32:45.369903", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:32:45,378 - app.services.secure_channel_service - INFO - Creating secure channel with ID: 68e15186-88aa-46ee-ad9f-20cacaa51263
2025-03-09 15:32:45,378 - app.services.secure_channel_service - INFO - Channel created and stored. Total channels: 1
2025-03-09 15:32:45,387 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 18.006999999999998}
2025-03-09 15:32:45,387 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 18.006999999999998}
2025-03-09 15:32:45,543 - INFO - Incoming request: {"timestamp": "2025-03-09T12:32:45.543945", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:32:45,543 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:32:45.543945", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:32:45,552 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:45,554 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-09 15:32:45,554 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'email_1': 'eodumme@gmail.com', 'param_1': 1}
2025-03-09 15:32:45,556 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-03-09 15:32:45,788 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, username, hashed_password, is_active, updated_at, has_avatar, avatar_path, last_seen) VALUES (%(email)s, %(username)s, %(hashed_password)s, %(is_active)s, %(updated_at)s, %(has_avatar)s, %(avatar_path)s, %(last_seen)s) RETURNING users.id, users.created_at
2025-03-09 15:32:45,789 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] {'email': 'eodumme@gmail.com', 'username': 'Eodumme', 'hashed_password': '$2b$12$GG2ztuCvTEfR81WWveb73.NVxyyGppBoejj5gttPHgWwAnA3u03Li', 'is_active': True, 'updated_at': None, 'has_avatar': False, 'avatar_path': None, 'last_seen': None}
2025-03-09 15:32:45,799 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, now()) RETURNING user_devices.id, user_devices.created_at
2025-03-09 15:32:45,799 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] {'user_id': 1, 'device_id': '066a3308-d182-4c59-ad00-424b6eeab41b', 'refresh_token': None}
2025-03-09 15:32:45,801 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:32:45,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:32:45,804 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-09 15:32:45,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'pk_1': 1}
2025-03-09 15:32:45,804 - app.services.secure_channel_service - INFO - Channel 68e15186-88aa-46ee-ad9f-20cacaa51263 removed
2025-03-09 15:32:45,805 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:32:45,805 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 261.355}
2025-03-09 15:32:45,805 - chat_server - INFO - Response sent: {"status_code": 400, "processing_time_ms": 261.355}
2025-03-09 15:38:27,241 - app.main - INFO - Shutting down YuMSG Server...
2025-03-09 15:38:27,241 - app.services.online_status_service - INFO - Online status cleanup task stopped
2025-03-09 15:38:27,241 - app.services.message_buffer - INFO - Message buffer cleanup task stopped
2025-03-09 15:38:27,241 - app.main - INFO - Services stopped
2025-03-09 15:38:32,365 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:38:33,251 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:38:33,282 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:38:33,289 - app.main - INFO - Starting YuMSG Server...
2025-03-09 15:38:33,289 - app.database - INFO - Initializing database at: postgresql://postgres:postpass@localhost:5432/chatdb
2025-03-09 15:38:33,327 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-09 15:38:33,328 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:38:33,328 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-09 15:38:33,328 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:38:33,329 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-09 15:38:33,329 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:38:33,358 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:33,358 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:38:33,359 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:38:33,360 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:38:33,361 - app.database - INFO - Existing tables before creation: ['users', 'user_devices']
2025-03-09 15:38:33,361 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:33,362 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:38:33,362 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:38:33,362 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:38:33,363 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007776s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:38:33,363 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:38:33,364 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:33,364 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:38:33,364 - sqlalchemy.engine.Engine - INFO - [cached since 0.005862s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:38:33,365 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:38:33,365 - app.database - INFO - Tables after creation: ['users', 'user_devices']
2025-03-09 15:38:33,365 - app.database - INFO - Database tables created successfully
2025-03-09 15:38:33,365 - app.main - INFO - Database initialized
2025-03-09 15:38:33,458 - app.core.crypto - INFO - Server keypair generated successfully
2025-03-09 15:38:33,458 - app.main - INFO - Server keypair generated
2025-03-09 15:38:33,459 - app.services.online_status_service - INFO - Online status cleanup task started
2025-03-09 15:38:33,459 - app.services.message_buffer - INFO - Message buffer cleanup task started
2025-03-09 15:38:33,459 - app.main - INFO - Services started
2025-03-09 15:38:38,021 - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:38.021050", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:38,021 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:38.021050", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:38,023 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: a0c07346-b512-4d8b-b5c6-f81b5edeebc3
2025-03-09 15:38:38,023 - app.services.secure_channel_service - INFO - Creating secure channel with ID: a0c07346-b512-4d8b-b5c6-f81b5edeebc3
2025-03-09 15:38:38,023 - app.services.secure_channel_service - INFO - Channel created and stored. Total channels: 1
2025-03-09 15:38:38,023 - app.api.v1.endpoints.auth - INFO - Secure channel initialized successfully
2025-03-09 15:38:38,024 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-09 15:38:38,024 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-09 15:38:38,105 - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:38.104069", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:38,105 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:38.104069", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:38,108 - app.api.v1.endpoints.auth - INFO - Registering user: eodumme@gmail.com
2025-03-09 15:38:38,111 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:38,113 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-09 15:38:38,113 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'email_1': 'eodumme@gmail.com', 'param_1': 1}
2025-03-09 15:38:38,115 - app.api.v1.endpoints.auth - WARNING - Email already registered: eodumme@gmail.com
2025-03-09 15:38:38,115 - app.services.secure_channel_service - INFO - Channel a0c07346-b512-4d8b-b5c6-f81b5edeebc3 removed
2025-03-09 15:38:38,115 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:38:38,115 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 11.003}
2025-03-09 15:38:38,115 - chat_server - INFO - Response sent: {"status_code": 400, "processing_time_ms": 11.003}
2025-03-09 15:38:59,226 - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:59.226392", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:59,226 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:59.226392", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:59,227 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: a4feb367-e913-48c6-b76b-cd38c95dca50
2025-03-09 15:38:59,227 - app.services.secure_channel_service - INFO - Creating secure channel with ID: a4feb367-e913-48c6-b76b-cd38c95dca50
2025-03-09 15:38:59,227 - app.services.secure_channel_service - INFO - Channel created and stored. Total channels: 1
2025-03-09 15:38:59,227 - app.api.v1.endpoints.auth - INFO - Secure channel initialized successfully
2025-03-09 15:38:59,227 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-09 15:38:59,227 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-09 15:38:59,271 - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:59.271402", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:59,271 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:59.271402", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:38:59,273 - app.api.v1.endpoints.auth - INFO - Registering user: mirai@gmail.com
2025-03-09 15:38:59,273 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:59,273 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-09 15:38:59,274 - sqlalchemy.engine.Engine - INFO - [cached since 21.16s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-09 15:38:59,274 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-03-09 15:38:59,499 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, username, hashed_password, is_active, updated_at, has_avatar, avatar_path, last_seen) VALUES (%(email)s, %(username)s, %(hashed_password)s, %(is_active)s, %(updated_at)s, %(has_avatar)s, %(avatar_path)s, %(last_seen)s) RETURNING users.id, users.created_at
2025-03-09 15:38:59,500 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] {'email': 'mirai@gmail.com', 'username': 'Mirai', 'hashed_password': '$2b$12$kJ7UCmxZu18NvqDmWDoXQu49bnkTCiFlaIssW98iD0PaoXqcfRyXe', 'is_active': True, 'updated_at': None, 'has_avatar': False, 'avatar_path': None, 'last_seen': None}
2025-03-09 15:38:59,502 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, now()) RETURNING user_devices.id, user_devices.created_at
2025-03-09 15:38:59,502 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] {'user_id': 2, 'device_id': '1b084815-6214-4752-b4b0-a77ca2454e2f', 'refresh_token': None}
2025-03-09 15:38:59,503 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:38:59,508 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:59,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-09 15:38:59,510 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'pk_1': 2}
2025-03-09 15:38:59,510 - app.api.v1.endpoints.auth - INFO - User registered successfully: 2
2025-03-09 15:38:59,521 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.id = %(pk_1)s
2025-03-09 15:38:59,521 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] {'pk_1': 2}
2025-03-09 15:38:59,523 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-09 15:38:59,523 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'refresh_token': 'duLEnBfXB5pAZuNl79CpfEExGdRJEYYBxEBCscfV9do', 'user_devices_id': 2}
2025-03-09 15:38:59,524 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:38:59,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:38:59,524 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-09 15:38:59,525 - sqlalchemy.engine.Engine - INFO - [cached since 0.01513s ago] {'pk_1': 2}
2025-03-09 15:38:59,525 - app.api.v1.endpoints.auth - INFO - Tokens generated for user: 2
2025-03-09 15:38:59,526 - app.services.secure_channel_service - INFO - Channel a4feb367-e913-48c6-b76b-cd38c95dca50 removed
2025-03-09 15:38:59,527 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:38:59,527 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 256.46200000000005}
2025-03-09 15:38:59,527 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 256.46200000000005}
2025-03-09 15:38:59,670 - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:59.670333", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:38:59,670 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:38:59.670333", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:38:59,671 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:38:59,671 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:00,516 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:00.516492", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:39:00,516 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:00.516492", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:39:00,549 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: d8cd21b5-3dbc-4af7-b5d6-07e860cc54c6
2025-03-09 15:39:00,549 - app.services.secure_channel_service - INFO - Creating secure channel with ID: d8cd21b5-3dbc-4af7-b5d6-07e860cc54c6
2025-03-09 15:39:00,549 - app.services.secure_channel_service - INFO - Channel created and stored. Total channels: 1
2025-03-09 15:39:00,549 - app.api.v1.endpoints.auth - INFO - Secure channel initialized successfully
2025-03-09 15:39:00,550 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 34.007999999999996}
2025-03-09 15:39:00,550 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 34.007999999999996}
2025-03-09 15:39:02,093 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:02.093847", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:02,093 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:02.093847", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:02,094 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:02,094 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:04,691 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:04.690448", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:04,691 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:04.690448", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:04,691 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:04,691 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:07,150 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:07.150422", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:07,150 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:07.150422", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:07,150 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:07,150 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:09,704 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:09.704217", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:09,704 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:09.704217", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:09,704 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:09,704 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:12,163 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:12.163675", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:12,163 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:12.163675", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:12,164 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:12,164 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:14,716 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:14.716192", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:14,716 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:14.716192", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:14,717 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:14,717 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:17,182 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:17.182655", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:17,182 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:17.182655", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:17,182 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:17,182 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:19,729 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:19.729212", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:19,729 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:19.729212", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:19,729 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:19,729 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:22,195 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:22.195589", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:22,195 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:22.195589", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:22,196 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:22,196 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:24,750 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:24.750105", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:24,750 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:24.750105", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:24,751 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.001}
2025-03-09 15:39:24,751 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.001}
2025-03-09 15:39:27,207 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:27.207889", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:27,207 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:27.207889", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:27,208 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:27,208 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:29,798 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:29.798612", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:29,798 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:29.798612", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:29,799 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0050000000000001}
2025-03-09 15:39:29,799 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0050000000000001}
2025-03-09 15:39:32,222 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:32.222929", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:32,222 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:32.222929", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:32,222 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:32,222 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:34,816 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:34.816913", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:34,816 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:34.816913", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:34,816 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:34,816 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-09 15:39:37,237 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:37.236232", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:37,237 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:37.236232", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:37,237 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:37,237 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:39,829 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:39.829483", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:39,829 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:39.829483", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:39,830 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:39,830 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:42,249 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:42.249261", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:42,249 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:42.249261", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:42,250 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:42,250 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:44,850 - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:44.850546", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:44,850 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:39:44.850546", "method": "GET", "path": "/ws", "query_params": "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidXNlcm5hbWUiOiJNaXJhaSIsImV4cCI6MTc0MTUyNTczOX0.8Tk5YGWRZhaFjLvknEZ3IUyJJUsK8eRSin150lBDkA4", "client": "192.168.147.92"}
2025-03-09 15:39:44,851 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:44,851 - chat_server - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.0}
2025-03-09 15:39:46,630 - app.main - INFO - Shutting down YuMSG Server...
2025-03-09 15:39:46,630 - app.services.online_status_service - INFO - Online status cleanup task stopped
2025-03-09 15:39:46,630 - app.services.message_buffer - INFO - Message buffer cleanup task stopped
2025-03-09 15:39:46,630 - app.main - INFO - Services stopped
2025-03-09 15:39:51,977 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:39:52,866 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:39:52,956 - app.core.crypto - INFO - CryptoService initialized
2025-03-09 15:39:52,962 - app.main - INFO - Starting YuMSG Server...
2025-03-09 15:39:52,962 - app.database - INFO - Initializing database at: postgresql://postgres:postpass@localhost:5432/chatdb
2025-03-09 15:39:52,999 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-09 15:39:53,000 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:39:53,000 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-09 15:39:53,001 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:39:53,001 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-09 15:39:53,001 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-09 15:39:53,004 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:39:53,004 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:39:53,004 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:39:53,006 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:39:53,006 - app.database - INFO - Existing tables before creation: ['users', 'user_devices']
2025-03-09 15:39:53,006 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:39:53,007 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:39:53,007 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:39:53,008 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:39:53,008 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007124s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-09 15:39:53,008 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-09 15:39:53,009 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-09 15:39:53,009 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-09 15:39:53,009 - sqlalchemy.engine.Engine - INFO - [cached since 0.005118s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-09 15:39:53,010 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-09 15:39:53,010 - app.database - INFO - Tables after creation: ['users', 'user_devices']
2025-03-09 15:39:53,010 - app.database - INFO - Database tables created successfully
2025-03-09 15:39:53,010 - app.main - INFO - Database initialized
2025-03-09 15:39:53,137 - app.core.crypto - INFO - Server keypair generated successfully
2025-03-09 15:39:53,138 - app.main - INFO - Server keypair generated
2025-03-09 15:39:53,138 - app.services.online_status_service - INFO - Online status cleanup task started
2025-03-09 15:39:53,138 - app.services.message_buffer - INFO - Message buffer cleanup task started
2025-03-09 15:39:53,138 - app.main - INFO - Services started
2025-03-09 15:39:54,321 - app.services.connection_manager - INFO - User 2 connected. Total connections: 1
2025-03-09 15:39:54,322 - app.services.online_status_service - ERROR - Error updating last_seen for user 2: __aenter__
2025-03-09 15:39:56,881 - app.services.connection_manager - INFO - User 2 connected. Total connections: 1
2025-03-09 15:39:56,881 - app.services.online_status_service - ERROR - Error updating last_seen for user 2: __aenter__
2025-03-09 15:40:17,124 - INFO - Incoming request: {"timestamp": "2025-03-09T12:40:17.123903", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:40:17,124 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:40:17.123903", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:40:17,127 - app.services.secure_channel_service - WARNING - Channel d8cd21b5-3dbc-4af7-b5d6-07e860cc54c6 not found
2025-03-09 15:40:17,128 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 5.001}
2025-03-09 15:40:17,128 - chat_server - INFO - Response sent: {"status_code": 400, "processing_time_ms": 5.001}
2025-03-09 15:40:17,278 - app.services.online_status_service - ERROR - Error updating last_seen for user 2: __aenter__
2025-03-09 15:40:19,484 - INFO - Incoming request: {"timestamp": "2025-03-09T12:40:19.484950", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:40:19,484 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:40:19.484950", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:40:19,485 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 1b7f0bbc-e667-424c-9d0e-d9f300a5bfde
2025-03-09 15:40:19,485 - app.services.secure_channel_service - INFO - Creating secure channel with ID: 1b7f0bbc-e667-424c-9d0e-d9f300a5bfde
2025-03-09 15:40:19,486 - app.services.secure_channel_service - INFO - Channel created and stored. Total channels: 1
2025-03-09 15:40:19,486 - app.api.v1.endpoints.auth - INFO - Secure channel initialized successfully
2025-03-09 15:40:19,486 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-09 15:40:19,486 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-09 15:40:19,523 - INFO - Incoming request: {"timestamp": "2025-03-09T12:40:19.523960", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:40:19,523 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-09T12:40:19.523960", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.147.92"}
2025-03-09 15:40:19,524 - app.services.secure_channel_service - WARNING - Channel 1b7f0bbc-e667-424c-9d0e-d9f300a5bfde not found
2025-03-09 15:40:19,524 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 1.0}
2025-03-09 15:40:19,524 - chat_server - INFO - Response sent: {"status_code": 400, "processing_time_ms": 1.0}
2025-03-09 15:40:19,870 - app.services.online_status_service - ERROR - Error updating last_seen for user 2: __aenter__
2025-03-09 15:40:36,529 - app.api.v1.endpoints.websocket - INFO - User 2 disconnected from WebSocket
2025-03-09 15:40:36,529 - app.services.connection_manager - INFO - User 2 disconnected. Remaining connections: 0
2025-03-09 15:40:36,530 - app.api.v1.endpoints.websocket - INFO - User 2 disconnected from WebSocket
2025-03-09 15:40:36,641 - app.main - INFO - Shutting down YuMSG Server...
2025-03-09 15:40:36,641 - app.services.online_status_service - INFO - Online status cleanup task stopped
2025-03-09 15:40:36,641 - app.services.message_buffer - INFO - Message buffer cleanup task stopped
2025-03-09 15:40:36,641 - app.main - INFO - Services stopped
2025-03-24 13:00:25,455 - INFO - Incoming request: {"timestamp": "2025-03-24T10:00:25.455400", "method": "GET", "path": "/", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:00:25,456 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-24 13:00:47,821 - INFO - Incoming request: {"timestamp": "2025-03-24T10:00:47.821681", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:00:47,822 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 1.001}
2025-03-24 13:01:11,583 - INFO - Incoming request: {"timestamp": "2025-03-24T10:01:11.583818", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:01:11,583 - INFO - Response sent: {"status_code": 404, "processing_time_ms": 0.0}
2025-03-24 13:02:33,006 - INFO - Incoming request: {"timestamp": "2025-03-24T10:02:33.006640", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:02:33,009 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-24 13:02:33,136 - INFO - Incoming request: {"timestamp": "2025-03-24T10:02:33.135669", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:02:33,415 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 280.063}
2025-03-24 13:05:34,319 - INFO - Incoming request: {"timestamp": "2025-03-24T10:05:34.319755", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:05:34,322 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-24 13:05:34,433 - INFO - Incoming request: {"timestamp": "2025-03-24T10:05:34.432781", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:05:34,469 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 37.008}
2025-03-24 13:06:52,708 - INFO - Incoming request: {"timestamp": "2025-03-24T10:06:52.708033", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:06:52,710 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-24 13:06:52,813 - INFO - Incoming request: {"timestamp": "2025-03-24T10:06:52.813057", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:06:53,078 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 265.34000000000003}
2025-03-24 13:09:41,120 - INFO - Incoming request: {"timestamp": "2025-03-24T10:09:41.120191", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:09:41,122 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-24 13:09:41,153 - INFO - Incoming request: {"timestamp": "2025-03-24T10:09:41.153199", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:09:41,481 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 328.073}
2025-03-24 13:11:22,659 - INFO - Incoming request: {"timestamp": "2025-03-24T10:11:22.659453", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:11:22,661 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-24 13:11:22,687 - INFO - Incoming request: {"timestamp": "2025-03-24T10:11:22.687459", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:11:22,943 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 256.06}
2025-03-24 13:14:01,668 - INFO - Incoming request: {"timestamp": "2025-03-24T10:14:01.668072", "method": "GET", "path": "/", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:14:01,669 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-24 13:14:18,251 - INFO - Incoming request: {"timestamp": "2025-03-24T10:14:18.251142", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:14:18,253 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-24 13:14:18,497 - INFO - Incoming request: {"timestamp": "2025-03-24T10:14:18.497204", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:14:18,754 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 257.058}
2025-03-24 13:16:33,784 - INFO - Incoming request: {"timestamp": "2025-03-24T10:16:33.784318", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:16:33,787 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-24 13:16:33,897 - INFO - Incoming request: {"timestamp": "2025-03-24T10:16:33.897344", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:16:34,167 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 270.325}
2025-03-24 13:16:35,565 - INFO - Incoming request: {"timestamp": "2025-03-24T10:16:35.565844", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:16:35,566 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-24 13:17:18,381 - INFO - Incoming request: {"timestamp": "2025-03-24T10:17:18.381542", "method": "GET", "path": "/", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:17:18,382 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-24 13:17:18,483 - INFO - Incoming request: {"timestamp": "2025-03-24T10:17:18.483565", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:17:18,494 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-03-24 13:17:20,048 - INFO - Incoming request: {"timestamp": "2025-03-24T10:17:20.048958", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:17:20,049 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-24 13:18:55,896 - INFO - Incoming request: {"timestamp": "2025-03-24T10:18:55.895956", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:18:55,899 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.001}
2025-03-24 13:18:57,665 - INFO - Incoming request: {"timestamp": "2025-03-24T10:18:57.665561", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:18:57,666 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-24 13:18:57,775 - INFO - Incoming request: {"timestamp": "2025-03-24T10:18:57.775518", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:18:57,778 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0010000000000003}
2025-03-24 13:19:18,071 - INFO - Incoming request: {"timestamp": "2025-03-24T10:19:18.071261", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:19:18,073 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-24 13:19:18,181 - INFO - Incoming request: {"timestamp": "2025-03-24T10:19:18.181286", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:19:18,185 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.0}
2025-03-24 13:19:36,923 - INFO - Incoming request: {"timestamp": "2025-03-24T10:19:36.923354", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:19:36,931 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-24 13:19:37,103 - INFO - Incoming request: {"timestamp": "2025-03-24T10:19:37.103395", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.87.253"}
2025-03-24 13:19:37,106 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0010000000000003}
2025-03-25 13:04:32,802 - INFO - Incoming request: {"timestamp": "2025-03-25T10:04:32.802732", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:04:32,804 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-25 13:04:43,006 - INFO - Incoming request: {"timestamp": "2025-03-25T10:04:43.006639", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:04:43,030 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 24.074}
2025-03-25 13:04:43,263 - INFO - Incoming request: {"timestamp": "2025-03-25T10:04:43.262413", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:04:43,574 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 311.927}
2025-03-25 13:04:44,752 - INFO - Incoming request: {"timestamp": "2025-03-25T10:04:44.752683", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:04:44,759 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.003}
2025-03-25 13:10:46,068 - INFO - Incoming request: {"timestamp": "2025-03-25T10:10:46.068929", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:10:46,069 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:11:07,728 - INFO - Incoming request: {"timestamp": "2025-03-25T10:11:07.728128", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:11:07,729 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-25 13:11:07,755 - INFO - Incoming request: {"timestamp": "2025-03-25T10:11:07.755135", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:11:07,756 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:11:29,595 - INFO - Incoming request: {"timestamp": "2025-03-25T10:11:29.595455", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:11:29,602 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-25 13:11:29,774 - INFO - Incoming request: {"timestamp": "2025-03-25T10:11:29.774502", "method": "POST", "path": "/auth/register", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:11:29,989 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.303}
2025-03-25 13:11:30,665 - INFO - Incoming request: {"timestamp": "2025-03-25T10:11:30.665926", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:11:30,666 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-25 13:12:22,220 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:22.220027", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:22,223 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0}
2025-03-25 13:12:24,511 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:24.511989", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:24,513 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-25 13:12:24,593 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:24.593010", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:24,597 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.001}
2025-03-25 13:12:50,375 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:50.375227", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:50,377 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.002}
2025-03-25 13:12:50,416 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:50.416238", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:50,419 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0010000000000003}
2025-03-25 13:12:52,363 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:52.363797", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:52,364 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:12:52,467 - INFO - Incoming request: {"timestamp": "2025-03-25T10:12:52.467820", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:12:52,471 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.001}
2025-03-25 13:14:34,288 - INFO - Incoming request: {"timestamp": "2025-03-25T10:14:34.288671", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:14:34,293 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-25 13:15:48,229 - INFO - Incoming request: {"timestamp": "2025-03-25T10:15:48.229334", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:15:48,239 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.99}
2025-03-25 13:15:58,630 - INFO - Incoming request: {"timestamp": "2025-03-25T10:15:58.630000", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:15:58,632 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-25 13:15:58,687 - INFO - Incoming request: {"timestamp": "2025-03-25T10:15:58.687014", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:15:58,690 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0}
2025-03-25 13:19:28,936 - INFO - Incoming request: {"timestamp": "2025-03-25T10:19:28.935982", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:19:28,940 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-03-25 13:19:36,185 - INFO - Incoming request: {"timestamp": "2025-03-25T10:19:36.185788", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:19:36,185 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-25 13:19:36,627 - INFO - Incoming request: {"timestamp": "2025-03-25T10:19:36.627602", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:19:36,637 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.405}
2025-03-25 13:19:38,609 - INFO - Incoming request: {"timestamp": "2025-03-25T10:19:38.609625", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:19:38,610 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:20:51,490 - INFO - Incoming request: {"timestamp": "2025-03-25T10:20:51.490518", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:20:51,495 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 5.001}
2025-03-25 13:21:09,589 - INFO - Incoming request: {"timestamp": "2025-03-25T10:21:09.589502", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:21:09,590 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.016}
2025-03-25 13:21:10,035 - INFO - Incoming request: {"timestamp": "2025-03-25T10:21:10.035349", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:21:10,046 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.001999999999999}
2025-03-25 13:21:11,312 - INFO - Incoming request: {"timestamp": "2025-03-25T10:21:11.312817", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:21:11,315 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-25 13:21:15,308 - INFO - Incoming request: {"timestamp": "2025-03-25T10:21:15.308501", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:21:15,311 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0010000000000003}
2025-03-25 13:22:06,550 - INFO - Incoming request: {"timestamp": "2025-03-25T10:22:06.550532", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:22:06,553 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-25 13:22:06,642 - INFO - Incoming request: {"timestamp": "2025-03-25T10:22:06.642777", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:22:06,647 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 5.001}
2025-03-25 13:22:07,250 - INFO - Incoming request: {"timestamp": "2025-03-25T10:22:07.250926", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:22:07,251 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-25 13:22:07,299 - INFO - Incoming request: {"timestamp": "2025-03-25T10:22:07.299938", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:22:07,303 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.001}
2025-03-25 13:23:55,133 - INFO - Incoming request: {"timestamp": "2025-03-25T10:23:55.133070", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:23:55,140 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-25 13:25:12,919 - INFO - Incoming request: {"timestamp": "2025-03-25T10:25:12.919133", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:25:12,923 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-25 13:26:15,767 - INFO - Incoming request: {"timestamp": "2025-03-25T10:26:15.767567", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:26:15,771 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-25 13:26:30,200 - INFO - Incoming request: {"timestamp": "2025-03-25T10:26:30.200901", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:26:30,205 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-25 13:28:29,865 - INFO - Incoming request: {"timestamp": "2025-03-25T10:28:29.865948", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:28:29,902 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 37.002}
2025-03-25 13:28:30,763 - INFO - Incoming request: {"timestamp": "2025-03-25T10:28:30.763793", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:28:30,771 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.99}
2025-03-25 13:28:41,094 - INFO - Incoming request: {"timestamp": "2025-03-25T10:28:41.094062", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:28:41,095 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.008}
2025-03-25 13:28:41,135 - INFO - Incoming request: {"timestamp": "2025-03-25T10:28:41.135074", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:28:41,138 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0}
2025-03-25 13:28:58,452 - INFO - Incoming request: {"timestamp": "2025-03-25T10:28:58.452600", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:28:58,453 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:28:58,880 - INFO - Incoming request: {"timestamp": "2025-03-25T10:28:58.880768", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:28:58,889 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.027999999999999}
2025-03-25 13:29:00,670 - INFO - Incoming request: {"timestamp": "2025-03-25T10:29:00.669263", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:29:00,671 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.9980000000000002}
2025-03-25 13:29:29,964 - INFO - Incoming request: {"timestamp": "2025-03-25T10:29:29.964287", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:29:29,967 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 3.0010000000000003}
2025-03-25 13:30:19,289 - INFO - Incoming request: {"timestamp": "2025-03-25T10:30:19.289820", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:30:19,290 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:30:19,439 - INFO - Incoming request: {"timestamp": "2025-03-25T10:30:19.439908", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:30:19,443 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.002000000000001}
2025-03-25 13:30:20,416 - INFO - Incoming request: {"timestamp": "2025-03-25T10:30:20.416582", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:30:20,417 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-25 13:30:26,564 - INFO - Incoming request: {"timestamp": "2025-03-25T10:30:26.564153", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:30:26,568 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.001}
2025-03-25 13:32:15,616 - INFO - Incoming request: {"timestamp": "2025-03-25T10:32:15.616892", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:32:15,659 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 43.001}
2025-03-25 13:32:16,875 - INFO - Incoming request: {"timestamp": "2025-03-25T10:32:16.875900", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:32:16,880 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-25 13:32:23,692 - INFO - Incoming request: {"timestamp": "2025-03-25T10:32:23.692065", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:32:23,695 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-25 13:32:23,792 - INFO - Incoming request: {"timestamp": "2025-03-25T10:32:23.792099", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:32:23,796 - INFO - Response sent: {"status_code": 400, "processing_time_ms": 4.001}
2025-03-25 13:47:07,906 - INFO - Incoming request: {"timestamp": "2025-03-25T10:47:07.906110", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:47:07,947 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 41.085}
2025-03-25 13:47:10,990 - INFO - Incoming request: {"timestamp": "2025-03-25T10:47:10.990813", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:47:10,998 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.989}
2025-03-25 13:47:19,377 - INFO - Incoming request: {"timestamp": "2025-03-25T10:47:19.375999", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:47:19,380 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-25 13:47:19,438 - INFO - Incoming request: {"timestamp": "2025-03-25T10:47:19.438039", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:47:19,469 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 31.022000000000002}
2025-03-25 13:47:59,260 - INFO - Incoming request: {"timestamp": "2025-03-25T10:47:59.260373", "method": "GET", "path": "/", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:47:59,261 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.012}
2025-03-25 13:47:59,685 - INFO - Incoming request: {"timestamp": "2025-03-25T10:47:59.685035", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:47:59,689 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9880000000000004}
2025-03-25 13:48:01,097 - INFO - Incoming request: {"timestamp": "2025-03-25T10:48:01.097848", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:48:01,104 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-25 13:48:06,515 - INFO - Incoming request: {"timestamp": "2025-03-25T10:48:06.514182", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:48:06,517 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-25 13:48:06,560 - INFO - Incoming request: {"timestamp": "2025-03-25T10:48:06.560192", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:48:06,566 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-25 13:48:36,113 - INFO - Incoming request: {"timestamp": "2025-03-25T10:48:36.113779", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:48:36,118 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-25 13:48:37,461 - INFO - Incoming request: {"timestamp": "2025-03-25T10:48:37.461543", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:48:37,463 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-25 13:48:37,521 - INFO - Incoming request: {"timestamp": "2025-03-25T10:48:37.521556", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:48:37,526 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-25 13:53:24,353 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:24.353485", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:53:24,398 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 45.009}
2025-03-25 13:53:25,393 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:25.393520", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:53:25,411 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 18.012}
2025-03-25 13:53:30,375 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:30.375918", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:53:30,378 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-25 13:53:30,421 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:30.421927", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:53:30,427 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-25 13:53:30,769 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:30.769048", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:53:30,774 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-25 13:53:36,609 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:36.609668", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:53:36,614 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-25 13:53:53,978 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:53.978002", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:53:53,980 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.9989999999999999}
2025-03-25 13:53:54,064 - INFO - Incoming request: {"timestamp": "2025-03-25T10:53:54.064020", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:53:54,069 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-03-25 13:58:38,767 - INFO - Incoming request: {"timestamp": "2025-03-25T10:58:38.767618", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.186"}
2025-03-25 13:58:38,771 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.002000000000001}
2025-03-25 13:58:41,244 - INFO - Incoming request: {"timestamp": "2025-03-25T10:58:41.244485", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:58:41,248 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-25 13:59:19,204 - INFO - Incoming request: {"timestamp": "2025-03-25T10:59:19.204938", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:59:19,206 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-25 13:59:19,250 - INFO - Incoming request: {"timestamp": "2025-03-25T10:59:19.250955", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.16.50"}
2025-03-25 13:59:19,255 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-27 13:39:03,716 - app.main - INFO - Starting up server...
2025-03-27 13:39:03,717 - app.main - INFO - Redis initialized
2025-03-27 13:39:03,767 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-27 13:39:03,767 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-27 13:39:03,768 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-27 13:39:03,768 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-27 13:39:03,769 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-27 13:39:03,769 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-27 13:39:03,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-27 13:39:03,773 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-27 13:39:03,773 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-27 13:39:03,776 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-27 13:39:03,776 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-27 13:39:03,777 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-27 13:39:03,777 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-27 13:39:03,778 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-27 13:39:03,778 - sqlalchemy.engine.Engine - INFO - [cached since 0.0009458s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-27 13:39:03,779 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-27 13:39:03,779 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-27 13:39:03,779 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-27 13:39:03,779 - sqlalchemy.engine.Engine - INFO - [cached since 0.007014s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-27 13:39:03,780 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-27 13:39:03,780 - app.main - INFO - Database initialized
2025-03-27 13:39:03,875 - app.main - INFO - Server key pair generated
2025-03-27 13:39:03,876 - app.main - INFO - Server startup completed successfully
2025-03-27 13:39:50,594 - INFO - Incoming request: {"timestamp": "2025-03-27T10:39:50.593811", "method": "GET", "path": "/", "query_params": "", "client": "192.168.4.105"}
2025-03-27 13:39:50,594 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-27T10:39:50.593811", "method": "GET", "path": "/", "query_params": "", "client": "192.168.4.105"}
2025-03-27 13:39:50,594 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-27 13:39:50,594 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-27 13:39:59,833 - INFO - Incoming request: {"timestamp": "2025-03-27T10:39:59.833031", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.4.105"}
2025-03-27 13:39:59,833 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-27T10:39:59.833031", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.4.105"}
2025-03-27 13:39:59,837 - ERROR - Request failed: 'SecureChannelService' object has no attribute '_channels'
Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\app\core\logging.py", line 53, in logging_middleware
    response = await call_next(request)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\app\api\v1\endpoints\auth.py", line 29, in initialize_secure_channel
    print(f"Current channels before init: {list(svc._channels.keys())}")
AttributeError: 'SecureChannelService' object has no attribute '_channels'. Did you mean: '_channel_ttl'?
2025-03-27 13:39:59,837 - chat_server - ERROR - Request failed: 'SecureChannelService' object has no attribute '_channels'
Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\base.py", line 148, in call_next
    message = await recv_stream.receive()
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\app\core\logging.py", line 53, in logging_middleware
    response = await call_next(request)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\base.py", line 154, in call_next
    raise app_exc
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\app\api\v1\endpoints\auth.py", line 29, in initialize_secure_channel
    print(f"Current channels before init: {list(svc._channels.keys())}")
AttributeError: 'SecureChannelService' object has no attribute '_channels'. Did you mean: '_channel_ttl'?
2025-03-27 13:43:11,446 - app.main - INFO - Shutting down server...
2025-03-27 13:43:11,446 - app.main - INFO - Redis connections closed
2025-03-27 13:43:11,446 - app.main - INFO - Server shutdown completed
2025-03-28 19:22:01,308 - app.main - INFO - Starting up server...
2025-03-28 19:22:01,308 - app.main - INFO - Redis initialized
2025-03-28 19:22:01,451 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-28 19:22:01,451 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-28 19:22:01,452 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-28 19:22:01,452 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-28 19:22:01,452 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-28 19:22:01,453 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-28 19:22:01,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:22:01,455 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-28 19:22:01,455 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-28 19:22:01,458 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-28 19:22:01,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:22:01,459 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-28 19:22:01,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-28 19:22:01,460 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-28 19:22:01,460 - sqlalchemy.engine.Engine - INFO - [cached since 0.0008957s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-28 19:22:01,460 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:22:01,461 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:22:01,461 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-28 19:22:01,461 - sqlalchemy.engine.Engine - INFO - [cached since 0.005736s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-28 19:22:01,462 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-28 19:22:01,462 - app.main - INFO - Database initialized
2025-03-28 19:22:01,485 - app.main - INFO - Server key pair generated
2025-03-28 19:22:01,485 - app.main - INFO - Server startup completed successfully
2025-03-28 19:22:37,148 - INFO - Incoming request: {"timestamp": "2025-03-28T16:22:37.148082", "method": "GET", "path": "/", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:22:37,148 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:22:37.148082", "method": "GET", "path": "/", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:22:37,148 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-28 19:22:37,148 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-28 19:22:37,297 - INFO - Incoming request: {"timestamp": "2025-03-28T16:22:37.297115", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:22:37,297 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:22:37.297115", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:22:37,303 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:22:37,304 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:22:37,304 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'device_id_1': '9fcd9e8e-8d61-43e9-a551-4dbb7bef67b8', 'refresh_token_1': '1W6iIz0HEDa59vckYDlqLniZt9P1eXa2vbI5Od0ZpTA', 'param_1': 1}
2025-03-28 19:22:37,307 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:22:37,307 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'p9yY5l3-a6YtqBUxqcx4q1bSQJ5awcYQ6b_RUcEKO-Y', 'user_devices_id': 7}
2025-03-28 19:22:37,308 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:22:37,314 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.006}
2025-03-28 19:22:37,314 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.006}
2025-03-28 19:22:37,408 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-28 19:22:37,412 - app.services.connection_manager - INFO - User 2 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:22:37,412 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-28 19:22:37,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:22:37,414 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:22:37,414 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '2', 'param_1': 1}
2025-03-28 19:22:37,416 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:22:37,416 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'last_seen': datetime.datetime(2025, 3, 28, 16, 22, 37, 415156), 'users_id': 2}
2025-03-28 19:22:37,417 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:22:37,417 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-28 19:22:38,380 - INFO - Incoming request: {"timestamp": "2025-03-28T16:22:38.380374", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:22:38,380 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:22:38.380374", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:22:38,381 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 1c624022-171d-48ab-b89f-9d60d9f1d48b
2025-03-28 19:22:38,381 - app.services.secure_channel_service - INFO - Creating channel with ID: 1c624022-171d-48ab-b89f-9d60d9f1d48b
2025-03-28 19:22:38,383 - app.services.secure_channel_service - INFO - Channel 1c624022-171d-48ab-b89f-9d60d9f1d48b saved to Redis with TTL 1800 seconds
2025-03-28 19:22:38,384 - app.api.v1.endpoints.auth - INFO - Channel 1c624022-171d-48ab-b89f-9d60d9f1d48b initialized successfully
2025-03-28 19:22:38,384 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-28 19:22:38,384 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-28 19:22:39,168 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-28 19:22:39,169 - app.services.connection_manager - INFO - User 2 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:22:39,169 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-28 19:22:39,169 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:22:39,169 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:22:39,169 - sqlalchemy.engine.Engine - INFO - [cached since 1.756s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:22:39,170 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:22:39,170 - sqlalchemy.engine.Engine - INFO - [cached since 1.755s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 22, 39, 170651), 'users_id': 2}
2025-03-28 19:22:39,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:22:39,176 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-28 19:23:07,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:07,391 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:07,391 - sqlalchemy.engine.Engine - INFO - [cached since 29.98s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:23:07,392 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:07,392 - sqlalchemy.engine.Engine - INFO - [cached since 29.98s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 7, 391141), 'users_id': 2}
2025-03-28 19:23:07,392 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:08,197 - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:08.197338", "method": "GET", "path": "/", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:08,197 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:08.197338", "method": "GET", "path": "/", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:08,197 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-28 19:23:08,197 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-28 19:23:08,542 - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:08.542419", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:08,542 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:08.542419", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:08,543 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:08,544 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:08,544 - sqlalchemy.engine.Engine - INFO - [cached since 31.24s ago] {'device_id_1': 'e348f9f2-38a5-4ec1-bff2-1d347efe165a', 'refresh_token_1': 'UFbhqMeQz1eu2-FIpVd_oVoHBxxCFpE6C6gp2EOidmg', 'param_1': 1}
2025-03-28 19:23:08,545 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:23:08,545 - sqlalchemy.engine.Engine - INFO - [cached since 31.24s ago] {'refresh_token': 'K9xxanv0LrnlCsMduiEPCyWv4OgkGczsRCTRTwe46_M', 'user_devices_id': 8}
2025-03-28 19:23:08,545 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:08,546 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-28 19:23:08,546 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-28 19:23:08,622 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-28 19:23:08,623 - app.services.connection_manager - INFO - User 3 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:23:08,623 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-28 19:23:08,624 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:08,624 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:08,624 - sqlalchemy.engine.Engine - INFO - [cached since 31.21s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:23:08,625 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:08,625 - sqlalchemy.engine.Engine - INFO - [cached since 31.21s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 8, 625436), 'users_id': 3}
2025-03-28 19:23:08,625 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:08,626 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-28 19:23:09,107 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:09,107 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:09,107 - sqlalchemy.engine.Engine - INFO - [cached since 31.69s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:23:09,108 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:09,108 - sqlalchemy.engine.Engine - INFO - [cached since 31.69s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 9, 108546), 'users_id': 2}
2025-03-28 19:23:09,108 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:09,778 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-28 19:23:09,779 - app.services.connection_manager - INFO - User 3 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:23:09,779 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-28 19:23:09,780 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:09,780 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:09,780 - sqlalchemy.engine.Engine - INFO - [cached since 32.37s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:23:09,781 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:09,781 - sqlalchemy.engine.Engine - INFO - [cached since 32.37s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 9, 781700), 'users_id': 3}
2025-03-28 19:23:09,781 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:09,782 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-28 19:23:09,855 - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:09.855716", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:09,855 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:09.855716", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:09,856 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 47ff3cb8-71f5-44f1-88ab-2a05f1461322
2025-03-28 19:23:09,856 - app.services.secure_channel_service - INFO - Creating channel with ID: 47ff3cb8-71f5-44f1-88ab-2a05f1461322
2025-03-28 19:23:09,857 - app.services.secure_channel_service - INFO - Channel 47ff3cb8-71f5-44f1-88ab-2a05f1461322 saved to Redis with TTL 1800 seconds
2025-03-28 19:23:09,858 - app.api.v1.endpoints.auth - INFO - Channel 47ff3cb8-71f5-44f1-88ab-2a05f1461322 initialized successfully
2025-03-28 19:23:09,858 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-28 19:23:09,858 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-28 19:23:22,210 - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:22.210468", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:22,210 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:22.210468", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:22,211 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:22,211 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:22,212 - sqlalchemy.engine.Engine - INFO - [cached since 44.91s ago] {'device_id_1': 'e348f9f2-38a5-4ec1-bff2-1d347efe165a', 'refresh_token_1': 'K9xxanv0LrnlCsMduiEPCyWv4OgkGczsRCTRTwe46_M', 'param_1': 1}
2025-03-28 19:23:22,213 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:23:22,213 - sqlalchemy.engine.Engine - INFO - [cached since 44.91s ago] {'refresh_token': 'Q9tblsUZZtoHLjPoHvSMTkRdIOdnsQkD7suuJVzmea4', 'user_devices_id': 8}
2025-03-28 19:23:22,213 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:22,214 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-28 19:23:22,214 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-28 19:23:22,250 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-28 19:23:22,251 - app.services.connection_manager - INFO - User 3 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:23:22,251 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-28 19:23:22,251 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:22,252 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:22,252 - sqlalchemy.engine.Engine - INFO - [cached since 44.84s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:23:22,252 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:22,253 - sqlalchemy.engine.Engine - INFO - [cached since 44.84s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 22, 252477), 'users_id': 3}
2025-03-28 19:23:22,253 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:22,253 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-28 19:23:37,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:37,379 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:37,379 - sqlalchemy.engine.Engine - INFO - [cached since 59.97s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:23:37,380 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:37,380 - sqlalchemy.engine.Engine - INFO - [cached since 59.96s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 37, 380579), 'users_id': 2}
2025-03-28 19:23:37,381 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:39,075 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:39,075 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:39,075 - sqlalchemy.engine.Engine - INFO - [cached since 61.66s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:23:39,076 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:39,076 - sqlalchemy.engine.Engine - INFO - [cached since 61.66s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 39, 76032), 'users_id': 2}
2025-03-28 19:23:39,077 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:39,760 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:39,760 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:39,760 - sqlalchemy.engine.Engine - INFO - [cached since 62.35s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:23:39,761 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:39,761 - sqlalchemy.engine.Engine - INFO - [cached since 62.35s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 39, 761191), 'users_id': 3}
2025-03-28 19:23:39,762 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:52,302 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:52,302 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:52,302 - sqlalchemy.engine.Engine - INFO - [cached since 74.89s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:23:52,303 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:52,303 - sqlalchemy.engine.Engine - INFO - [cached since 74.89s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 52, 303878), 'users_id': 3}
2025-03-28 19:23:52,304 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:52,955 - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:52.955025", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:23:52,955 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:52.955025", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:23:52,956 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:52,957 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:52,957 - sqlalchemy.engine.Engine - INFO - [cached since 75.65s ago] {'device_id_1': '9fcd9e8e-8d61-43e9-a551-4dbb7bef67b8', 'refresh_token_1': 'p9yY5l3-a6YtqBUxqcx4q1bSQJ5awcYQ6b_RUcEKO-Y', 'param_1': 1}
2025-03-28 19:23:52,958 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:23:52,958 - sqlalchemy.engine.Engine - INFO - [cached since 75.65s ago] {'refresh_token': 'd-_UsdrTirj5iRs24i0q6NOOnVmFlEQEXUEDCYxrepo', 'user_devices_id': 7}
2025-03-28 19:23:52,958 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:52,963 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.377}
2025-03-28 19:23:52,963 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.377}
2025-03-28 19:23:52,998 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-28 19:23:52,999 - app.services.connection_manager - INFO - User 2 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:23:52,999 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-28 19:23:52,999 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:53,000 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:53,000 - sqlalchemy.engine.Engine - INFO - [cached since 75.59s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:23:53,001 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:53,001 - sqlalchemy.engine.Engine - INFO - [cached since 75.58s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 53, 412), 'users_id': 2}
2025-03-28 19:23:53,001 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:53,001 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-28 19:23:58,767 - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:58.766126", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:58,767 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:23:58.766126", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:23:58,769 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:58,769 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:58,770 - sqlalchemy.engine.Engine - INFO - [cached since 81.47s ago] {'device_id_1': 'e348f9f2-38a5-4ec1-bff2-1d347efe165a', 'refresh_token_1': 'Q9tblsUZZtoHLjPoHvSMTkRdIOdnsQkD7suuJVzmea4', 'param_1': 1}
2025-03-28 19:23:58,771 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:23:58,771 - sqlalchemy.engine.Engine - INFO - [cached since 81.46s ago] {'refresh_token': 'WgiMO14fxxvfjXkk4UVv3my47xwzcYZM0iPKdQrIdsM', 'user_devices_id': 8}
2025-03-28 19:23:58,771 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:58,777 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.663}
2025-03-28 19:23:58,777 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.663}
2025-03-28 19:23:58,802 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-28 19:23:58,803 - app.services.connection_manager - INFO - User 3 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:23:58,803 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-28 19:23:58,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:23:58,803 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:23:58,804 - sqlalchemy.engine.Engine - INFO - [cached since 81.39s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:23:58,804 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:23:58,805 - sqlalchemy.engine.Engine - INFO - [cached since 81.39s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 23, 58, 804795), 'users_id': 3}
2025-03-28 19:23:58,805 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:23:58,806 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-28 19:24:03,466 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-28 19:24:03,466 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-28 19:24:03,467 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-28 19:24:03,469 - app.services.connection_manager - INFO - User 2 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:24:03,470 - app.services.connection_manager - INFO - User 2 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:24:03,470 - app.services.connection_manager - INFO - User 2 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:24:08,353 - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:08.353318", "method": "GET", "path": "/", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:24:08,353 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:08.353318", "method": "GET", "path": "/", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:24:08,353 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-28 19:24:08,353 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-28 19:24:08,771 - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:08.771754", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:24:08,771 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:08.771754", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:24:08,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:08,773 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:08,773 - sqlalchemy.engine.Engine - INFO - [cached since 91.47s ago] {'device_id_1': '9fcd9e8e-8d61-43e9-a551-4dbb7bef67b8', 'refresh_token_1': 'd-_UsdrTirj5iRs24i0q6NOOnVmFlEQEXUEDCYxrepo', 'param_1': 1}
2025-03-28 19:24:08,774 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:24:08,774 - sqlalchemy.engine.Engine - INFO - [cached since 91.47s ago] {'refresh_token': 'we5awWXWM0RM3023zXvsgDfHxvtjp42HwKpvrH4zucM', 'user_devices_id': 7}
2025-03-28 19:24:08,774 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:08,780 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.498999999999999}
2025-03-28 19:24:08,780 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.498999999999999}
2025-03-28 19:24:08,965 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-28 19:24:08,967 - app.services.connection_manager - INFO - User 2 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:24:08,967 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-28 19:24:08,967 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:08,968 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:08,968 - sqlalchemy.engine.Engine - INFO - [cached since 91.55s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:24:08,969 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:08,969 - sqlalchemy.engine.Engine - INFO - [cached since 91.55s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 8, 968297), 'users_id': 2}
2025-03-28 19:24:08,969 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:08,970 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-28 19:24:09,663 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:09,663 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:09,663 - sqlalchemy.engine.Engine - INFO - [cached since 92.25s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:09,664 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:09,664 - sqlalchemy.engine.Engine - INFO - [cached since 92.25s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 9, 664468), 'users_id': 3}
2025-03-28 19:24:09,665 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:10,445 - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:10.445646", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:24:10,445 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:10.445646", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:24:10,447 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 3d5c2138-6290-4241-a5bc-eb7e508f079a
2025-03-28 19:24:10,447 - app.services.secure_channel_service - INFO - Creating channel with ID: 3d5c2138-6290-4241-a5bc-eb7e508f079a
2025-03-28 19:24:10,448 - app.services.secure_channel_service - INFO - Channel 3d5c2138-6290-4241-a5bc-eb7e508f079a saved to Redis with TTL 1800 seconds
2025-03-28 19:24:10,448 - app.api.v1.endpoints.auth - INFO - Channel 3d5c2138-6290-4241-a5bc-eb7e508f079a initialized successfully
2025-03-28 19:24:10,448 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.999}
2025-03-28 19:24:10,448 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.999}
2025-03-28 19:24:10,805 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-28 19:24:10,806 - app.services.connection_manager - INFO - User 2 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:24:10,806 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-28 19:24:10,807 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:10,807 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:10,807 - sqlalchemy.engine.Engine - INFO - [cached since 93.39s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:24:10,808 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:10,808 - sqlalchemy.engine.Engine - INFO - [cached since 93.39s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 10, 808730), 'users_id': 2}
2025-03-28 19:24:10,809 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:10,812 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-28 19:24:16,250 - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:16.250024", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:24:16,250 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:24:16.250024", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:24:16,252 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:16,252 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:16,252 - sqlalchemy.engine.Engine - INFO - [cached since 98.84s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:16,254 - app.api.v1.endpoints.users - INFO - Search request received, channel: 47ff3cb8-71f5-44f1-88ab-2a05f1461322
2025-03-28 19:24:16,254 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743180838}
2025-03-28 19:24:16,255 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-28 19:24:16,255 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-28 19:24:16,255 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-28 19:24:16,256 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-28 19:24:16,256 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-28 19:24:16,257 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-28 19:24:16,257 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-28 19:24:16,258 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-28 19:24:16,258 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-28 19:24:16,258 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-28 19:24:19,924 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:19,924 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:19,925 - sqlalchemy.engine.Engine - INFO - [cached since 102.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:19,926 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:19,926 - sqlalchemy.engine.Engine - INFO - [cached since 102.5s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 19, 925575), 'users_id': 3}
2025-03-28 19:24:19,926 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:19,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:19,931 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:19,932 - sqlalchemy.engine.Engine - INFO - [cached since 102.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:24:19,932 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:19,933 - sqlalchemy.engine.Engine - INFO - [cached since 102.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:19,933 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-28 19:24:19,933 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 5ddd4205-9257-4bb7-a08c-3f499f4534a0 for users 3 and 2
2025-03-28 19:24:28,814 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:28,814 - sqlalchemy.engine.Engine - INFO - [cached since 111.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:28,816 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:28,816 - sqlalchemy.engine.Engine - INFO - [cached since 111.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 28, 815679), 'users_id': 3}
2025-03-28 19:24:28,816 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:38,875 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:38,875 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:38,875 - sqlalchemy.engine.Engine - INFO - [cached since 121.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:24:38,876 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:38,876 - sqlalchemy.engine.Engine - INFO - [cached since 121.5s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 38, 876949), 'users_id': 2}
2025-03-28 19:24:38,877 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:39,667 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:39,668 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:39,668 - sqlalchemy.engine.Engine - INFO - [cached since 122.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:39,669 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:39,669 - sqlalchemy.engine.Engine - INFO - [cached since 122.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 39, 668393), 'users_id': 3}
2025-03-28 19:24:39,669 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:40,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:40,721 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:40,721 - sqlalchemy.engine.Engine - INFO - [cached since 123.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:24:40,722 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:40,722 - sqlalchemy.engine.Engine - INFO - [cached since 123.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 40, 722691), 'users_id': 2}
2025-03-28 19:24:40,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:24:58,815 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:24:58,815 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:24:58,815 - sqlalchemy.engine.Engine - INFO - [cached since 141.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:24:58,816 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:24:58,816 - sqlalchemy.engine.Engine - INFO - [cached since 141.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 24, 58, 815744), 'users_id': 3}
2025-03-28 19:24:58,816 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:08,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:08,863 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:08,863 - sqlalchemy.engine.Engine - INFO - [cached since 151.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:25:08,864 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:08,864 - sqlalchemy.engine.Engine - INFO - [cached since 151.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 8, 864556), 'users_id': 2}
2025-03-28 19:25:08,864 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:09,058 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:09,058 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:09,058 - sqlalchemy.engine.Engine - INFO - [cached since 151.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:25:09,059 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:09,059 - sqlalchemy.engine.Engine - INFO - [cached since 151.6s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 9, 59601), 'users_id': 3}
2025-03-28 19:25:09,060 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:09,061 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:09,061 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:09,061 - sqlalchemy.engine.Engine - INFO - [cached since 151.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:25:09,061 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:09,062 - sqlalchemy.engine.Engine - INFO - [cached since 151.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:25:09,062 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-28 19:25:09,062 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 9f4d284f-0f0f-4d27-a570-ee8b91dc7814 for users 3 and 2
2025-03-28 19:25:09,697 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:09,697 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:09,697 - sqlalchemy.engine.Engine - INFO - [cached since 152.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:25:09,701 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:09,701 - sqlalchemy.engine.Engine - INFO - [cached since 152.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 9, 701745), 'users_id': 3}
2025-03-28 19:25:09,702 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:10,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:10,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 153.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:25:10,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:10,711 - sqlalchemy.engine.Engine - INFO - [cached since 153.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 10, 710029), 'users_id': 2}
2025-03-28 19:25:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:28,845 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:28,845 - sqlalchemy.engine.Engine - INFO - [cached since 171.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:25:28,846 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:28,846 - sqlalchemy.engine.Engine - INFO - [cached since 171.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 28, 846757), 'users_id': 3}
2025-03-28 19:25:28,847 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:38,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:38,863 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:38,863 - sqlalchemy.engine.Engine - INFO - [cached since 181.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:25:38,864 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:38,864 - sqlalchemy.engine.Engine - INFO - [cached since 181.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 38, 864256), 'users_id': 2}
2025-03-28 19:25:38,864 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:39,661 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:39,662 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:39,662 - sqlalchemy.engine.Engine - INFO - [cached since 182.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:25:39,663 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:39,663 - sqlalchemy.engine.Engine - INFO - [cached since 182.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 39, 662617), 'users_id': 3}
2025-03-28 19:25:39,664 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:40,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:40,708 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:40,708 - sqlalchemy.engine.Engine - INFO - [cached since 183.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:25:40,709 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:40,709 - sqlalchemy.engine.Engine - INFO - [cached since 183.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 40, 709855), 'users_id': 2}
2025-03-28 19:25:40,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:25:58,969 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:25:58,969 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:25:58,969 - sqlalchemy.engine.Engine - INFO - [cached since 201.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:25:58,970 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:25:58,970 - sqlalchemy.engine.Engine - INFO - [cached since 201.6s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 25, 58, 970558), 'users_id': 3}
2025-03-28 19:25:58,971 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:08,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:08,863 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:08,863 - sqlalchemy.engine.Engine - INFO - [cached since 211.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:26:08,864 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:08,865 - sqlalchemy.engine.Engine - INFO - [cached since 211.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 8, 864093), 'users_id': 2}
2025-03-28 19:26:08,865 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:09,657 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:09,657 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:09,657 - sqlalchemy.engine.Engine - INFO - [cached since 212.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:26:09,658 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:09,658 - sqlalchemy.engine.Engine - INFO - [cached since 212.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 9, 658273), 'users_id': 3}
2025-03-28 19:26:09,659 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:10,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 213.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:26:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 213.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 10, 709512), 'users_id': 2}
2025-03-28 19:26:10,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:25,118 - INFO - Incoming request: {"timestamp": "2025-03-28T16:26:25.118345", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:26:25,118 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:26:25.118345", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.122"}
2025-03-28 19:26:25,119 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:25,120 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:25,120 - sqlalchemy.engine.Engine - INFO - [cached since 227.8s ago] {'device_id_1': '9fcd9e8e-8d61-43e9-a551-4dbb7bef67b8', 'refresh_token_1': 'we5awWXWM0RM3023zXvsgDfHxvtjp42HwKpvrH4zucM', 'param_1': 1}
2025-03-28 19:26:25,121 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:26:25,121 - sqlalchemy.engine.Engine - INFO - [cached since 227.8s ago] {'refresh_token': 'B440GweZsdnAM1eODdj0oM-ra_0mJRKmMr6eV9rtH0I', 'user_devices_id': 7}
2025-03-28 19:26:25,122 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:25,127 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.004}
2025-03-28 19:26:25,127 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.004}
2025-03-28 19:26:25,161 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-28 19:26:25,162 - app.services.connection_manager - INFO - User 2 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:26:25,162 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-28 19:26:25,163 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:25,163 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:25,163 - sqlalchemy.engine.Engine - INFO - [cached since 227.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:26:25,164 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:25,164 - sqlalchemy.engine.Engine - INFO - [cached since 227.7s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 25, 164358), 'users_id': 2}
2025-03-28 19:26:25,164 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:25,165 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-28 19:26:28,870 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:28,870 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:28,870 - sqlalchemy.engine.Engine - INFO - [cached since 231.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:26:28,871 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:28,871 - sqlalchemy.engine.Engine - INFO - [cached since 231.5s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 28, 871261), 'users_id': 3}
2025-03-28 19:26:28,871 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:39,660 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:39,660 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:39,660 - sqlalchemy.engine.Engine - INFO - [cached since 242.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:26:39,661 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:39,661 - sqlalchemy.engine.Engine - INFO - [cached since 242.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 39, 661799), 'users_id': 3}
2025-03-28 19:26:39,662 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:40,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:40,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:40,709 - sqlalchemy.engine.Engine - INFO - [cached since 243.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:26:40,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 243.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 40, 710036), 'users_id': 2}
2025-03-28 19:26:40,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:55,188 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:55,188 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:55,188 - sqlalchemy.engine.Engine - INFO - [cached since 257.8s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:26:55,189 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:55,189 - sqlalchemy.engine.Engine - INFO - [cached since 257.8s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 55, 189680), 'users_id': 2}
2025-03-28 19:26:55,190 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:26:58,822 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:26:58,822 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:26:58,822 - sqlalchemy.engine.Engine - INFO - [cached since 261.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:26:58,823 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:26:58,823 - sqlalchemy.engine.Engine - INFO - [cached since 261.4s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 26, 58, 823313), 'users_id': 3}
2025-03-28 19:26:58,824 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:01,237 - INFO - Incoming request: {"timestamp": "2025-03-28T16:27:01.237593", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:27:01,237 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:27:01.237593", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:27:01,238 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:01,239 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:01,239 - sqlalchemy.engine.Engine - INFO - [cached since 263.9s ago] {'device_id_1': 'e348f9f2-38a5-4ec1-bff2-1d347efe165a', 'refresh_token_1': 'WgiMO14fxxvfjXkk4UVv3my47xwzcYZM0iPKdQrIdsM', 'param_1': 1}
2025-03-28 19:27:01,240 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:27:01,241 - sqlalchemy.engine.Engine - INFO - [cached since 263.9s ago] {'refresh_token': 'WeEyAQ5Tyu0DYWRQ2_NK7BnKTdLl7GOI_5yOs5m1R4g', 'user_devices_id': 8}
2025-03-28 19:27:01,241 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:01,246 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-28 19:27:01,246 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-28 19:27:01,580 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-28 19:27:01,581 - app.services.connection_manager - INFO - User 3 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:27:01,581 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-28 19:27:01,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:01,582 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:01,582 - sqlalchemy.engine.Engine - INFO - [cached since 264.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:27:01,583 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:01,583 - sqlalchemy.engine.Engine - INFO - [cached since 264.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 1, 582026), 'users_id': 3}
2025-03-28 19:27:01,583 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:01,584 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-28 19:27:09,719 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:09,719 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:09,719 - sqlalchemy.engine.Engine - INFO - [cached since 272.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:27:09,721 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:09,721 - sqlalchemy.engine.Engine - INFO - [cached since 272.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 9, 721194), 'users_id': 3}
2025-03-28 19:27:09,722 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:10,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 273.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:27:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 273.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 10, 710539), 'users_id': 2}
2025-03-28 19:27:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:25,158 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:25,158 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:25,159 - sqlalchemy.engine.Engine - INFO - [cached since 287.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:27:25,159 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:25,160 - sqlalchemy.engine.Engine - INFO - [cached since 287.7s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 25, 159459), 'users_id': 2}
2025-03-28 19:27:25,160 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:31,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:31,581 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:31,581 - sqlalchemy.engine.Engine - INFO - [cached since 294.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:27:31,582 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:31,582 - sqlalchemy.engine.Engine - INFO - [cached since 294.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 31, 582076), 'users_id': 3}
2025-03-28 19:27:31,583 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:39,742 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:39,742 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:39,742 - sqlalchemy.engine.Engine - INFO - [cached since 302.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:27:39,743 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:39,743 - sqlalchemy.engine.Engine - INFO - [cached since 302.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 39, 743458), 'users_id': 3}
2025-03-28 19:27:39,744 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:40,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:40,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 303.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:27:40,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:40,711 - sqlalchemy.engine.Engine - INFO - [cached since 303.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 40, 710128), 'users_id': 2}
2025-03-28 19:27:40,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:27:55,158 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:27:55,158 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:27:55,158 - sqlalchemy.engine.Engine - INFO - [cached since 317.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:27:55,159 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:27:55,159 - sqlalchemy.engine.Engine - INFO - [cached since 317.7s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 27, 55, 159590), 'users_id': 2}
2025-03-28 19:27:55,160 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:01,592 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:01,592 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:01,592 - sqlalchemy.engine.Engine - INFO - [cached since 324.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:28:01,593 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:01,593 - sqlalchemy.engine.Engine - INFO - [cached since 324.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 1, 593281), 'users_id': 3}
2025-03-28 19:28:01,594 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:09,745 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:09,745 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:09,746 - sqlalchemy.engine.Engine - INFO - [cached since 332.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:28:09,747 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:09,747 - sqlalchemy.engine.Engine - INFO - [cached since 332.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 9, 747906), 'users_id': 3}
2025-03-28 19:28:09,748 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:10,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 333.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:28:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 333.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 10, 710114), 'users_id': 2}
2025-03-28 19:28:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:25,157 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:25,158 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:25,158 - sqlalchemy.engine.Engine - INFO - [cached since 347.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:28:25,159 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:25,159 - sqlalchemy.engine.Engine - INFO - [cached since 347.7s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 25, 158982), 'users_id': 2}
2025-03-28 19:28:25,159 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:31,577 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:31,577 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:31,577 - sqlalchemy.engine.Engine - INFO - [cached since 354.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:28:31,578 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:31,578 - sqlalchemy.engine.Engine - INFO - [cached since 354.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 31, 578128), 'users_id': 3}
2025-03-28 19:28:31,578 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:39,669 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:39,669 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:39,669 - sqlalchemy.engine.Engine - INFO - [cached since 362.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:28:39,670 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:39,670 - sqlalchemy.engine.Engine - INFO - [cached since 362.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 39, 670416), 'users_id': 3}
2025-03-28 19:28:39,670 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:40,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:40,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:40,709 - sqlalchemy.engine.Engine - INFO - [cached since 363.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:28:40,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 363.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 40, 710664), 'users_id': 2}
2025-03-28 19:28:40,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:28:55,159 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:28:55,159 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:28:55,159 - sqlalchemy.engine.Engine - INFO - [cached since 377.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:28:55,160 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:28:55,160 - sqlalchemy.engine.Engine - INFO - [cached since 377.7s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 28, 55, 160128), 'users_id': 2}
2025-03-28 19:28:55,160 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:01,585 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:01,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:01,585 - sqlalchemy.engine.Engine - INFO - [cached since 384.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:29:01,586 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:01,586 - sqlalchemy.engine.Engine - INFO - [cached since 384.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 1, 586910), 'users_id': 3}
2025-03-28 19:29:01,587 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:09,668 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:09,668 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:09,668 - sqlalchemy.engine.Engine - INFO - [cached since 392.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:29:09,669 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:09,669 - sqlalchemy.engine.Engine - INFO - [cached since 392.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 9, 669750), 'users_id': 3}
2025-03-28 19:29:09,669 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:10,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 393.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:29:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 393.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 10, 710922), 'users_id': 2}
2025-03-28 19:29:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:25,158 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:25,158 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:25,158 - sqlalchemy.engine.Engine - INFO - [cached since 407.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:29:25,159 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:25,159 - sqlalchemy.engine.Engine - INFO - [cached since 407.7s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 25, 159735), 'users_id': 2}
2025-03-28 19:29:25,160 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:29,303 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-28 19:29:29,304 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-28 19:29:29,305 - app.services.connection_manager - INFO - User 2 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:29:29,305 - app.services.connection_manager - INFO - User 2 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:29:31,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:31,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:31,576 - sqlalchemy.engine.Engine - INFO - [cached since 414.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:29:31,577 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:31,577 - sqlalchemy.engine.Engine - INFO - [cached since 414.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 31, 576591), 'users_id': 3}
2025-03-28 19:29:31,577 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:39,664 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:39,664 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:39,665 - sqlalchemy.engine.Engine - INFO - [cached since 422.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:29:39,665 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:39,665 - sqlalchemy.engine.Engine - INFO - [cached since 422.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 39, 665595), 'users_id': 3}
2025-03-28 19:29:39,666 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:29:40,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:29:40,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:29:40,709 - sqlalchemy.engine.Engine - INFO - [cached since 423.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:29:40,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:29:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 423.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 29, 40, 710832), 'users_id': 2}
2025-03-28 19:29:40,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:01,655 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:01,656 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:01,656 - sqlalchemy.engine.Engine - INFO - [cached since 444.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:30:01,656 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:01,656 - sqlalchemy.engine.Engine - INFO - [cached since 444.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 1, 656087), 'users_id': 3}
2025-03-28 19:30:01,657 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:09,666 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:09,666 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:09,666 - sqlalchemy.engine.Engine - INFO - [cached since 452.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:30:09,667 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:09,667 - sqlalchemy.engine.Engine - INFO - [cached since 452.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 9, 667200), 'users_id': 3}
2025-03-28 19:30:09,668 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:10,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 453.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:30:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 453.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 10, 710435), 'users_id': 2}
2025-03-28 19:30:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:31,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:31,672 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:31,672 - sqlalchemy.engine.Engine - INFO - [cached since 474.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:30:31,673 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:31,673 - sqlalchemy.engine.Engine - INFO - [cached since 474.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 31, 672398), 'users_id': 3}
2025-03-28 19:30:31,673 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:39,659 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:39,659 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:39,659 - sqlalchemy.engine.Engine - INFO - [cached since 482.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:30:39,660 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:39,660 - sqlalchemy.engine.Engine - INFO - [cached since 482.2s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 39, 660480), 'users_id': 3}
2025-03-28 19:30:39,661 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:40,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:40,726 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:40,726 - sqlalchemy.engine.Engine - INFO - [cached since 483.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:30:40,727 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:40,727 - sqlalchemy.engine.Engine - INFO - [cached since 483.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 40, 726722), 'users_id': 2}
2025-03-28 19:30:40,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:44,281 - INFO - Incoming request: {"timestamp": "2025-03-28T16:30:44.281537", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:30:44,281 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-28T16:30:44.281537", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.185.186"}
2025-03-28 19:30:44,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:44,283 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:44,283 - sqlalchemy.engine.Engine - INFO - [cached since 487s ago] {'device_id_1': 'e348f9f2-38a5-4ec1-bff2-1d347efe165a', 'refresh_token_1': 'WeEyAQ5Tyu0DYWRQ2_NK7BnKTdLl7GOI_5yOs5m1R4g', 'param_1': 1}
2025-03-28 19:30:44,284 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-28 19:30:44,284 - sqlalchemy.engine.Engine - INFO - [cached since 487s ago] {'refresh_token': 'RJUmGC1zFBaSsjY2K8xyCKU6aPcu5XSJ-XbsGhEYsgo', 'user_devices_id': 8}
2025-03-28 19:30:44,285 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:44,290 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-28 19:30:44,290 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-28 19:30:44,339 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-28 19:30:44,340 - app.services.connection_manager - INFO - User 3 connected to server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:30:44,340 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-28 19:30:44,341 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:30:44,341 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:30:44,341 - sqlalchemy.engine.Engine - INFO - [cached since 486.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-28 19:30:44,342 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:30:44,342 - sqlalchemy.engine.Engine - INFO - [cached since 486.9s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 30, 44, 342550), 'users_id': 3}
2025-03-28 19:30:44,342 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:30:44,343 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-28 19:30:46,201 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-28 19:30:46,202 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-28 19:30:46,203 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-28 19:30:46,203 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-28 19:30:46,204 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-28 19:30:46,205 - app.services.connection_manager - INFO - User 3 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:30:46,206 - app.services.connection_manager - INFO - User 3 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:30:46,206 - app.services.connection_manager - INFO - User 3 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:30:46,207 - app.services.connection_manager - INFO - User 3 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:30:46,207 - app.services.connection_manager - INFO - User 3 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:31:10,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:31:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:31:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 513.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:31:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:31:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 513.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 31, 10, 710779), 'users_id': 2}
2025-03-28 19:31:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:31:12,943 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-28 19:31:12,945 - app.services.connection_manager - INFO - User 3 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-28 19:31:40,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:31:40,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:31:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 543.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:31:40,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:31:40,712 - sqlalchemy.engine.Engine - INFO - [cached since 543.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 31, 40, 711486), 'users_id': 2}
2025-03-28 19:31:40,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:32:10,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:32:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:32:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 573.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:32:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:32:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 573.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 32, 10, 709999), 'users_id': 2}
2025-03-28 19:32:10,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:32:40,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:32:40,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:32:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 603.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:32:40,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:32:40,711 - sqlalchemy.engine.Engine - INFO - [cached since 603.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 32, 40, 711105), 'users_id': 2}
2025-03-28 19:32:40,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:33:10,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:33:10,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:33:10,709 - sqlalchemy.engine.Engine - INFO - [cached since 633.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:33:10,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:33:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 633.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 33, 10, 710312), 'users_id': 2}
2025-03-28 19:33:10,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:33:40,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:33:40,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:33:40,710 - sqlalchemy.engine.Engine - INFO - [cached since 663.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:33:40,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:33:40,711 - sqlalchemy.engine.Engine - INFO - [cached since 663.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 33, 40, 711978), 'users_id': 2}
2025-03-28 19:33:40,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:34:10,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-28 19:34:10,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-28 19:34:10,710 - sqlalchemy.engine.Engine - INFO - [cached since 693.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-28 19:34:10,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-28 19:34:10,711 - sqlalchemy.engine.Engine - INFO - [cached since 693.3s ago] {'last_seen': datetime.datetime(2025, 3, 28, 16, 34, 10, 711542), 'users_id': 2}
2025-03-28 19:34:10,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-28 19:34:22,731 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-28 19:34:22,732 - app.services.connection_manager - INFO - User 2 disconnected from server 4b885771-dc1c-4ebc-a759-9e25f559c36e
2025-03-29 16:21:23,109 - app.main - INFO - Starting up server...
2025-03-29 16:21:23,110 - app.main - INFO - Redis initialized
2025-03-29 16:21:23,162 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-29 16:21:23,163 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 16:21:23,164 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-29 16:21:23,164 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 16:21:23,165 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-29 16:21:23,165 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 16:21:23,168 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:21:23,168 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 16:21:23,168 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 16:21:23,172 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:21:23,172 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:21:23,173 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 16:21:23,173 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 16:21:23,174 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 16:21:23,174 - sqlalchemy.engine.Engine - INFO - [cached since 0.0008142s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 16:21:23,174 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:21:23,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:21:23,175 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 16:21:23,175 - sqlalchemy.engine.Engine - INFO - [cached since 0.006858s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 16:21:23,176 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:21:23,176 - app.main - INFO - Database initialized
2025-03-29 16:21:23,236 - app.main - INFO - Server key pair generated
2025-03-29 16:21:23,236 - app.main - INFO - Server startup completed successfully
2025-03-29 16:22:34,356 - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:34.355820", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:34,356 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:34.355820", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:34,356 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 16:22:34,356 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 16:22:45,214 - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:45.214325", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:45,214 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:45.214325", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:45,217 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: fd28172b-3050-4fce-8f84-727fe506cff2
2025-03-29 16:22:45,217 - app.services.secure_channel_service - INFO - Creating channel with ID: fd28172b-3050-4fce-8f84-727fe506cff2
2025-03-29 16:22:45,229 - app.services.secure_channel_service - INFO - Channel fd28172b-3050-4fce-8f84-727fe506cff2 saved to Redis with TTL 1800 seconds
2025-03-29 16:22:45,230 - app.api.v1.endpoints.auth - INFO - Channel fd28172b-3050-4fce-8f84-727fe506cff2 initialized successfully
2025-03-29 16:22:45,231 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.003999999999998}
2025-03-29 16:22:45,231 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.003999999999998}
2025-03-29 16:22:45,409 - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:45.409390", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:45,409 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:45.409390", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:45,411 - app.api.v1.endpoints.auth - INFO - Login request using channel: fd28172b-3050-4fce-8f84-727fe506cff2
2025-03-29 16:22:45,413 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"22b5d08d-cad7-4c86-a460-dce2c09843bd"}
2025-03-29 16:22:45,413 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '22b5d08d-cad7-4c86-a460-dce2c09843bd'}
2025-03-29 16:22:45,416 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:22:45,417 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 16:22:45,418 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-29 16:22:45,650 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:22:45,650 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] {'user_id_1': 2, 'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'param_1': 1}
2025-03-29 16:22:45,665 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 16:22:45,665 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'users_id': 2}
2025-03-29 16:22:45,669 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 16:22:45,669 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'user_id': 2, 'device_id': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token': None, 'last_login': None}
2025-03-29 16:22:45,673 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-29 16:22:45,674 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:22:45,674 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] {'refresh_token': 'BEXkSaIzCyhOTWwbHH_91cxQdrL8Qj8kpRLk2fGzuBY', 'user_devices_id': 9}
2025-03-29 16:22:45,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:22:45,676 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 16:22:45,676 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 16:22:45,677 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 16:22:45,678 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 269.062}
2025-03-29 16:22:45,678 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 269.062}
2025-03-29 16:22:46,202 - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:46.202657", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:46,202 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:22:46.202657", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:22:46,203 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: f2a630cd-a7af-4905-9092-2503fe99e5a7
2025-03-29 16:22:46,203 - app.services.secure_channel_service - INFO - Creating channel with ID: f2a630cd-a7af-4905-9092-2503fe99e5a7
2025-03-29 16:22:46,204 - app.services.secure_channel_service - INFO - Channel f2a630cd-a7af-4905-9092-2503fe99e5a7 saved to Redis with TTL 1800 seconds
2025-03-29 16:22:46,204 - app.api.v1.endpoints.auth - INFO - Channel f2a630cd-a7af-4905-9092-2503fe99e5a7 initialized successfully
2025-03-29 16:22:46,204 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:22:46,204 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:22:46,208 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:22:46,209 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:22:46,209 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:22:46,218 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:22:46,219 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:22:46,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:22:46,220 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:22:46,220 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'id_1': '2', 'param_1': 1}
2025-03-29 16:22:46,221 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:22:46,221 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] {'last_seen': datetime.datetime(2025, 3, 29, 13, 22, 46, 220661), 'users_id': 2}
2025-03-29 16:22:46,224 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:22:46,224 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:22:47,601 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:22:47,601 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:22:47,602 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:22:47,602 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:22:47,602 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:22:47,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:22:47,603 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:22:47,603 - sqlalchemy.engine.Engine - INFO - [cached since 1.383s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:22:47,604 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:22:47,604 - sqlalchemy.engine.Engine - INFO - [cached since 1.383s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 22, 47, 604162), 'users_id': 2}
2025-03-29 16:22:47,605 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:22:47,605 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:23:16,241 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:23:16,241 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:23:16,241 - sqlalchemy.engine.Engine - INFO - [cached since 30.02s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:23:16,242 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:23:16,242 - sqlalchemy.engine.Engine - INFO - [cached since 30.02s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 23, 16, 242752), 'users_id': 2}
2025-03-29 16:23:16,243 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:23:17,568 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:23:17,569 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:23:17,569 - sqlalchemy.engine.Engine - INFO - [cached since 31.35s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:23:17,570 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:23:17,570 - sqlalchemy.engine.Engine - INFO - [cached since 31.35s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 23, 17, 569172), 'users_id': 2}
2025-03-29 16:23:17,570 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:23:46,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:23:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:23:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 59.98s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:23:46,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:23:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 59.98s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 23, 46, 204131), 'users_id': 2}
2025-03-29 16:23:46,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:23:47,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:23:47,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:23:47,538 - sqlalchemy.engine.Engine - INFO - [cached since 61.32s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:23:47,539 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:23:47,539 - sqlalchemy.engine.Engine - INFO - [cached since 61.32s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 23, 47, 539270), 'users_id': 2}
2025-03-29 16:23:47,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:23:52,852 - INFO - Incoming request: {"timestamp": "2025-03-29T13:23:52.852331", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:23:52,852 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:23:52.852331", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:23:52,853 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:23:52,853 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:24:03,457 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:03.457400", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:03,457 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:03.457400", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:03,458 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e67697f6-b39b-4cc9-874c-507b7bba40d1
2025-03-29 16:24:03,458 - app.services.secure_channel_service - INFO - Creating channel with ID: e67697f6-b39b-4cc9-874c-507b7bba40d1
2025-03-29 16:24:03,459 - app.services.secure_channel_service - INFO - Channel e67697f6-b39b-4cc9-874c-507b7bba40d1 saved to Redis with TTL 1800 seconds
2025-03-29 16:24:03,459 - app.api.v1.endpoints.auth - INFO - Channel e67697f6-b39b-4cc9-874c-507b7bba40d1 initialized successfully
2025-03-29 16:24:03,460 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:24:03,460 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:24:03,712 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:03.711457", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:03,712 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:03.711457", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:03,713 - app.api.v1.endpoints.auth - INFO - Login request using channel: e67697f6-b39b-4cc9-874c-507b7bba40d1
2025-03-29 16:24:03,714 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"dccd89c8-48ab-4ab3-aa20-fd4f6eae4381"}
2025-03-29 16:24:03,714 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381'}
2025-03-29 16:24:03,714 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:03,714 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:03,714 - sqlalchemy.engine.Engine - INFO - [cached since 78.3s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-29 16:24:03,914 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:03,914 - sqlalchemy.engine.Engine - INFO - [cached since 78.26s ago] {'user_id_1': 3, 'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'param_1': 1}
2025-03-29 16:24:03,915 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 16:24:03,915 - sqlalchemy.engine.Engine - INFO - [cached since 78.25s ago] {'users_id': 3}
2025-03-29 16:24:03,916 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 16:24:03,916 - sqlalchemy.engine.Engine - INFO - [cached since 78.25s ago] {'user_id': 3, 'device_id': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token': None, 'last_login': None}
2025-03-29 16:24:03,916 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-29 16:24:03,917 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:24:03,917 - sqlalchemy.engine.Engine - INFO - [cached since 78.24s ago] {'refresh_token': '3977r6DqOoXvlyiK3P4_xwZg5GzihSXgJJTb9i2BxRs', 'user_devices_id': 10}
2025-03-29 16:24:03,917 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:03,918 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 16:24:03,918 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 16:24:03,919 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 16:24:03,919 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 208.047}
2025-03-29 16:24:03,919 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 208.047}
2025-03-29 16:24:05,133 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:05.133420", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:05,133 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:05.133420", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:05,134 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615
2025-03-29 16:24:05,134 - app.services.secure_channel_service - INFO - Creating channel with ID: e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615
2025-03-29 16:24:05,135 - app.services.secure_channel_service - INFO - Channel e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615 saved to Redis with TTL 1800 seconds
2025-03-29 16:24:05,135 - app.api.v1.endpoints.auth - INFO - Channel e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615 initialized successfully
2025-03-29 16:24:05,135 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:24:05,135 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:24:05,139 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:24:05,139 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:24:05,139 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:24:05,140 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:24:05,140 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:24:05,140 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:05,140 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:05,141 - sqlalchemy.engine.Engine - INFO - [cached since 78.92s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:05,141 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:05,141 - sqlalchemy.engine.Engine - INFO - [cached since 78.92s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 5, 141422), 'users_id': 3}
2025-03-29 16:24:05,142 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:05,142 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:24:06,332 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:24:06,333 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:24:06,333 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:24:06,334 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:24:06,334 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:24:06,334 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:06,334 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:06,335 - sqlalchemy.engine.Engine - INFO - [cached since 80.11s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:06,335 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:06,335 - sqlalchemy.engine.Engine - INFO - [cached since 80.11s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 6, 335051), 'users_id': 3}
2025-03-29 16:24:06,336 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:06,336 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:24:14,524 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:14.524473", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:14,524 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:14.524473", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:14,526 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:14,526 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:14,526 - sqlalchemy.engine.Engine - INFO - [cached since 88.31s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:14,527 - app.api.v1.endpoints.users - INFO - Search request received, channel: e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615
2025-03-29 16:24:14,527 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743256443}
2025-03-29 16:24:14,528 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"ayi","limit":10}
2025-03-29 16:24:14,528 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'ayi', 'limit': 10}
2025-03-29 16:24:14,528 - app.api.v1.endpoints.users - INFO - Searching users with query 'ayi', excluding user 3
2025-03-29 16:24:14,530 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:24:14,530 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'id_1': '3', 'username_1': '%ayi%', 'email_1': '%ayi%', 'param_1': 10}
2025-03-29 16:24:14,531 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-03-29 16:24:14,531 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-03-29 16:24:14,532 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:24:14,533 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:24:14,533 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:24:15,009 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:15.009619", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:15,009 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:15.009619", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:15,011 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:15,011 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:15,011 - sqlalchemy.engine.Engine - INFO - [cached since 88.79s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:15,012 - app.api.v1.endpoints.users - INFO - Search request received, channel: e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615
2025-03-29 16:24:15,012 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743256443}
2025-03-29 16:24:15,013 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"a","limit":10}
2025-03-29 16:24:15,013 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'a', 'limit': 10}
2025-03-29 16:24:15,013 - app.api.v1.endpoints.users - INFO - Searching users with query 'a', excluding user 3
2025-03-29 16:24:15,014 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:24:15,014 - sqlalchemy.engine.Engine - INFO - [cached since 0.4843s ago] {'id_1': '3', 'username_1': '%a%', 'email_1': '%a%', 'param_1': 10}
2025-03-29 16:24:15,014 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:24:15,015 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:24:15,015 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:24:15,016 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 16:24:15,016 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 16:24:16,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:16,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 89.98s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:24:16,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:16,204 - sqlalchemy.engine.Engine - INFO - [cached since 89.98s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 16, 203092), 'users_id': 2}
2025-03-29 16:24:16,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:16,384 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:16.384151", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:16,384 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:16.384151", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:24:16,386 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:16,386 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:16,386 - sqlalchemy.engine.Engine - INFO - [cached since 90.17s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:16,387 - app.api.v1.endpoints.users - INFO - Search request received, channel: e8bbe3bd-9757-4cca-8cb5-b7f7fc3ac615
2025-03-29 16:24:16,387 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743256443}
2025-03-29 16:24:16,388 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"Yu","limit":10}
2025-03-29 16:24:16,388 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'Yu', 'limit': 10}
2025-03-29 16:24:16,388 - app.api.v1.endpoints.users - INFO - Searching users with query 'Yu', excluding user 3
2025-03-29 16:24:16,389 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:24:16,389 - sqlalchemy.engine.Engine - INFO - [cached since 1.859s ago] {'id_1': '3', 'username_1': '%Yu%', 'email_1': '%Yu%', 'param_1': 10}
2025-03-29 16:24:16,389 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:24:16,390 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:24:16,390 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:24:16,391 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 16:24:16,391 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 16:24:17,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:17,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:17,538 - sqlalchemy.engine.Engine - INFO - [cached since 91.32s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:24:17,539 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:17,539 - sqlalchemy.engine.Engine - INFO - [cached since 91.32s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 17, 538718), 'users_id': 2}
2025-03-29 16:24:17,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:20,350 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:20,350 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:20,350 - sqlalchemy.engine.Engine - INFO - [cached since 94.13s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:20,351 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:20,351 - sqlalchemy.engine.Engine - INFO - [cached since 94.13s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 20, 351609), 'users_id': 3}
2025-03-29 16:24:20,352 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:20,352 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:20,353 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:20,353 - sqlalchemy.engine.Engine - INFO - [cached since 94.13s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:24:20,353 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:20,353 - sqlalchemy.engine.Engine - INFO - [cached since 94.13s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:20,354 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 16:24:20,354 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 0465f0f4-85e1-47ca-acee-2f43523c7467 for users 3 and 2
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:24:20,354 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:24:35,136 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:35,137 - sqlalchemy.engine.Engine - INFO - [cached since 108.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:35,137 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:35,137 - sqlalchemy.engine.Engine - INFO - [cached since 108.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 35, 137007), 'users_id': 3}
2025-03-29 16:24:35,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:36,322 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:36,322 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:36,322 - sqlalchemy.engine.Engine - INFO - [cached since 110.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:24:36,323 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:36,323 - sqlalchemy.engine.Engine - INFO - [cached since 110.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 36, 323235), 'users_id': 3}
2025-03-29 16:24:36,324 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:46,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:46,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:46,202 - sqlalchemy.engine.Engine - INFO - [cached since 120s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:24:46,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 120s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 46, 203357), 'users_id': 2}
2025-03-29 16:24:46,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:47,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:47,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:47,538 - sqlalchemy.engine.Engine - INFO - [cached since 121.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:24:47,539 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:24:47,539 - sqlalchemy.engine.Engine - INFO - [cached since 121.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 24, 47, 539492), 'users_id': 2}
2025-03-29 16:24:47,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:24:59,827 - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:59.827142", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:24:59,827 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:24:59.827142", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:24:59,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:24:59,829 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:24:59,829 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:24:59,830 - app.api.v1.endpoints.users - INFO - Search request received, channel: f2a630cd-a7af-4905-9092-2503fe99e5a7
2025-03-29 16:24:59,830 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743256365}
2025-03-29 16:24:59,831 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"Morai","limit":10}
2025-03-29 16:24:59,831 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'Morai', 'limit': 10}
2025-03-29 16:24:59,831 - app.api.v1.endpoints.users - INFO - Searching users with query 'Morai', excluding user 2
2025-03-29 16:24:59,831 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:24:59,831 - sqlalchemy.engine.Engine - INFO - [cached since 45.3s ago] {'id_1': '2', 'username_1': '%Morai%', 'email_1': '%Morai%', 'param_1': 10}
2025-03-29 16:24:59,832 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-03-29 16:24:59,832 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-03-29 16:24:59,832 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:24:59,833 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-29 16:24:59,833 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-29 16:25:00,337 - INFO - Incoming request: {"timestamp": "2025-03-29T13:25:00.337629", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:25:00,337 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:25:00.337629", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:25:00,339 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:00,339 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:00,339 - sqlalchemy.engine.Engine - INFO - [cached since 134.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:00,340 - app.api.v1.endpoints.users - INFO - Search request received, channel: f2a630cd-a7af-4905-9092-2503fe99e5a7
2025-03-29 16:25:00,340 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743256365}
2025-03-29 16:25:00,341 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"Mirai ","limit":10}
2025-03-29 16:25:00,341 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'Mirai ', 'limit': 10}
2025-03-29 16:25:00,341 - app.api.v1.endpoints.users - INFO - Searching users with query 'Mirai ', excluding user 2
2025-03-29 16:25:00,342 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:25:00,342 - sqlalchemy.engine.Engine - INFO - [cached since 45.81s ago] {'id_1': '2', 'username_1': '%Mirai %', 'email_1': '%Mirai %', 'param_1': 10}
2025-03-29 16:25:00,342 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-03-29 16:25:00,342 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-03-29 16:25:00,343 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:25:00,344 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002999999999999}
2025-03-29 16:25:00,344 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002999999999999}
2025-03-29 16:25:04,686 - INFO - Incoming request: {"timestamp": "2025-03-29T13:25:04.686401", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:25:04,686 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:25:04.686401", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:25:04,688 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:04,688 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:04,688 - sqlalchemy.engine.Engine - INFO - [cached since 138.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:04,689 - app.api.v1.endpoints.users - INFO - Search request received, channel: f2a630cd-a7af-4905-9092-2503fe99e5a7
2025-03-29 16:25:04,690 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743256365}
2025-03-29 16:25:04,691 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"Mirai","limit":10}
2025-03-29 16:25:04,691 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'Mirai', 'limit': 10}
2025-03-29 16:25:04,691 - app.api.v1.endpoints.users - INFO - Searching users with query 'Mirai', excluding user 2
2025-03-29 16:25:04,691 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:25:04,691 - sqlalchemy.engine.Engine - INFO - [cached since 50.16s ago] {'id_1': '2', 'username_1': '%Mirai%', 'email_1': '%Mirai%', 'param_1': 10}
2025-03-29 16:25:04,692 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:25:04,692 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:25:04,693 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:25:04,693 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.989000000000001}
2025-03-29 16:25:04,693 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.989000000000001}
2025-03-29 16:25:05,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:05,135 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:05,135 - sqlalchemy.engine.Engine - INFO - [cached since 138.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:25:05,136 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:05,136 - sqlalchemy.engine.Engine - INFO - [cached since 138.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 5, 136976), 'users_id': 3}
2025-03-29 16:25:05,136 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:06,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:06,301 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:06,301 - sqlalchemy.engine.Engine - INFO - [cached since 140.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:25:06,302 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:06,302 - sqlalchemy.engine.Engine - INFO - [cached since 140.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 6, 302941), 'users_id': 3}
2025-03-29 16:25:06,302 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:16,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:16,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:16,202 - sqlalchemy.engine.Engine - INFO - [cached since 150s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:16,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 150s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 16, 203670), 'users_id': 2}
2025-03-29 16:25:16,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:17,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:17,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:17,537 - sqlalchemy.engine.Engine - INFO - [cached since 151.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:17,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:17,538 - sqlalchemy.engine.Engine - INFO - [cached since 151.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 17, 538896), 'users_id': 2}
2025-03-29 16:25:17,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:18,611 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:18,612 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:18,612 - sqlalchemy.engine.Engine - INFO - [cached since 152.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:18,613 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:18,613 - sqlalchemy.engine.Engine - INFO - [cached since 152.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 18, 613959), 'users_id': 2}
2025-03-29 16:25:18,613 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:18,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:18,618 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:18,618 - sqlalchemy.engine.Engine - INFO - [cached since 152.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:25:18,619 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:18,619 - sqlalchemy.engine.Engine - INFO - [cached since 152.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:18,619 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:25:18,619 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 229031a4-ca8b-495f-811e-58eb1a3311b4 for users 2 and 3
2025-03-29 16:25:18,619 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:25:18,620 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:25:35,161 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:35,161 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:35,161 - sqlalchemy.engine.Engine - INFO - [cached since 168.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:25:35,163 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:35,163 - sqlalchemy.engine.Engine - INFO - [cached since 168.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 35, 163180), 'users_id': 3}
2025-03-29 16:25:35,164 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:36,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:36,302 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:36,302 - sqlalchemy.engine.Engine - INFO - [cached since 170.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:25:36,303 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:36,303 - sqlalchemy.engine.Engine - INFO - [cached since 170.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 36, 302299), 'users_id': 3}
2025-03-29 16:25:36,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 180s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:46,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 180s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 46, 203662), 'users_id': 2}
2025-03-29 16:25:46,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:47,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:47,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:47,539 - sqlalchemy.engine.Engine - INFO - [cached since 181.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:47,540 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:47,540 - sqlalchemy.engine.Engine - INFO - [cached since 181.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 47, 540888), 'users_id': 2}
2025-03-29 16:25:47,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:50,113 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:50,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:50,114 - sqlalchemy.engine.Engine - INFO - [cached since 183.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:50,114 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:25:50,115 - sqlalchemy.engine.Engine - INFO - [cached since 183.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 25, 50, 114435), 'users_id': 2}
2025-03-29 16:25:50,115 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:25:50,116 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:25:50,116 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:50,116 - sqlalchemy.engine.Engine - INFO - [cached since 183.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:25:50,117 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:25:50,117 - sqlalchemy.engine.Engine - INFO - [cached since 183.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:25:50,117 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:25:50,117 - app.api.v1.endpoints.websocket - INFO - Generated chat_id b3d18776-8d35-47f2-a839-07317499eb02 for users 2 and 3
2025-03-29 16:25:50,117 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:25:50,117 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:25:50,118 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:26:05,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:05,136 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:05,136 - sqlalchemy.engine.Engine - INFO - [cached since 198.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:26:05,137 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:05,137 - sqlalchemy.engine.Engine - INFO - [cached since 198.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 5, 137268), 'users_id': 3}
2025-03-29 16:26:05,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:06,293 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:06,293 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:06,293 - sqlalchemy.engine.Engine - INFO - [cached since 200.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:26:06,294 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:06,294 - sqlalchemy.engine.Engine - INFO - [cached since 200.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 6, 294044), 'users_id': 3}
2025-03-29 16:26:06,295 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:16,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 210s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:26:16,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:16,204 - sqlalchemy.engine.Engine - INFO - [cached since 210s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 16, 204668), 'users_id': 2}
2025-03-29 16:26:16,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:17,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:17,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:17,538 - sqlalchemy.engine.Engine - INFO - [cached since 211.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:26:17,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:17,539 - sqlalchemy.engine.Engine - INFO - [cached since 211.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 17, 538873), 'users_id': 2}
2025-03-29 16:26:17,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:35,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:35,136 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:35,136 - sqlalchemy.engine.Engine - INFO - [cached since 228.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:26:35,137 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:35,137 - sqlalchemy.engine.Engine - INFO - [cached since 228.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 35, 137752), 'users_id': 3}
2025-03-29 16:26:35,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:36,289 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:36,289 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:36,289 - sqlalchemy.engine.Engine - INFO - [cached since 230.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:26:36,290 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:36,290 - sqlalchemy.engine.Engine - INFO - [cached since 230.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 36, 290147), 'users_id': 3}
2025-03-29 16:26:36,290 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:46,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:46,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:46,202 - sqlalchemy.engine.Engine - INFO - [cached since 240s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:26:46,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 240s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 46, 203809), 'users_id': 2}
2025-03-29 16:26:46,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:26:47,552 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:26:47,552 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:26:47,553 - sqlalchemy.engine.Engine - INFO - [cached since 241.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:26:47,553 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:26:47,553 - sqlalchemy.engine.Engine - INFO - [cached since 241.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 26, 47, 553371), 'users_id': 2}
2025-03-29 16:26:47,554 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:05,129 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:05,129 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:05,129 - sqlalchemy.engine.Engine - INFO - [cached since 258.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:27:05,130 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:05,130 - sqlalchemy.engine.Engine - INFO - [cached since 258.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 5, 130719), 'users_id': 3}
2025-03-29 16:27:05,131 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:06,289 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:06,289 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:06,289 - sqlalchemy.engine.Engine - INFO - [cached since 260.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:27:06,290 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:06,290 - sqlalchemy.engine.Engine - INFO - [cached since 260.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 6, 289217), 'users_id': 3}
2025-03-29 16:27:06,290 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:16,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:16,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 270s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:27:16,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:16,204 - sqlalchemy.engine.Engine - INFO - [cached since 270s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 16, 203407), 'users_id': 2}
2025-03-29 16:27:16,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:17,540 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:17,540 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:17,540 - sqlalchemy.engine.Engine - INFO - [cached since 271.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:27:17,541 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:17,541 - sqlalchemy.engine.Engine - INFO - [cached since 271.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 17, 541628), 'users_id': 2}
2025-03-29 16:27:17,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:35,137 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:35,137 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:35,137 - sqlalchemy.engine.Engine - INFO - [cached since 288.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:27:35,138 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:35,138 - sqlalchemy.engine.Engine - INFO - [cached since 288.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 35, 138477), 'users_id': 3}
2025-03-29 16:27:35,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:36,289 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:36,289 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:36,289 - sqlalchemy.engine.Engine - INFO - [cached since 290.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:27:36,290 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:36,290 - sqlalchemy.engine.Engine - INFO - [cached since 290.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 36, 290903), 'users_id': 3}
2025-03-29 16:27:36,291 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:46,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:46,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:46,202 - sqlalchemy.engine.Engine - INFO - [cached since 300s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:27:46,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 300s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 46, 203805), 'users_id': 2}
2025-03-29 16:27:46,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:27:47,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:27:47,540 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:27:47,540 - sqlalchemy.engine.Engine - INFO - [cached since 301.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:27:47,541 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:27:47,541 - sqlalchemy.engine.Engine - INFO - [cached since 301.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 27, 47, 540183), 'users_id': 2}
2025-03-29 16:27:47,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:05,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:05,135 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:05,135 - sqlalchemy.engine.Engine - INFO - [cached since 318.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:28:05,136 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:05,136 - sqlalchemy.engine.Engine - INFO - [cached since 318.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 5, 136831), 'users_id': 3}
2025-03-29 16:28:05,137 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:06,321 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:06,321 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:06,322 - sqlalchemy.engine.Engine - INFO - [cached since 320.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:28:06,322 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:06,322 - sqlalchemy.engine.Engine - INFO - [cached since 320.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 6, 322670), 'users_id': 3}
2025-03-29 16:28:06,323 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:16,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:16,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:16,202 - sqlalchemy.engine.Engine - INFO - [cached since 330s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:28:16,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 330s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 16, 203826), 'users_id': 2}
2025-03-29 16:28:16,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:17,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:17,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:17,538 - sqlalchemy.engine.Engine - INFO - [cached since 331.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:28:17,539 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:17,539 - sqlalchemy.engine.Engine - INFO - [cached since 331.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 17, 539900), 'users_id': 2}
2025-03-29 16:28:17,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:35,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:35,143 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:35,143 - sqlalchemy.engine.Engine - INFO - [cached since 348.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:28:35,144 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:35,144 - sqlalchemy.engine.Engine - INFO - [cached since 348.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 35, 144354), 'users_id': 3}
2025-03-29 16:28:35,145 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:36,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:36,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:36,300 - sqlalchemy.engine.Engine - INFO - [cached since 350.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:28:36,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:36,301 - sqlalchemy.engine.Engine - INFO - [cached since 350.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 36, 301045), 'users_id': 3}
2025-03-29 16:28:36,302 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:46,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 360s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:28:46,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 360s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 46, 204853), 'users_id': 2}
2025-03-29 16:28:46,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:28:47,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:28:47,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:28:47,538 - sqlalchemy.engine.Engine - INFO - [cached since 361.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:28:47,539 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:28:47,539 - sqlalchemy.engine.Engine - INFO - [cached since 361.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 28, 47, 539563), 'users_id': 2}
2025-03-29 16:28:47,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:05,161 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:05,161 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:05,161 - sqlalchemy.engine.Engine - INFO - [cached since 378.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:29:05,162 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:05,162 - sqlalchemy.engine.Engine - INFO - [cached since 378.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 5, 162248), 'users_id': 3}
2025-03-29 16:29:05,163 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:06,332 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:06,333 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:06,333 - sqlalchemy.engine.Engine - INFO - [cached since 380.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:29:06,334 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:06,334 - sqlalchemy.engine.Engine - INFO - [cached since 380.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 6, 333075), 'users_id': 3}
2025-03-29 16:29:06,334 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:16,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:16,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:16,202 - sqlalchemy.engine.Engine - INFO - [cached since 390s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:29:16,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 390s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 16, 203924), 'users_id': 2}
2025-03-29 16:29:16,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:17,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:17,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:17,538 - sqlalchemy.engine.Engine - INFO - [cached since 391.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:29:17,539 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:17,539 - sqlalchemy.engine.Engine - INFO - [cached since 391.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 17, 539974), 'users_id': 2}
2025-03-29 16:29:17,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:35,138 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:35,138 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:35,138 - sqlalchemy.engine.Engine - INFO - [cached since 408.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:29:35,139 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:35,140 - sqlalchemy.engine.Engine - INFO - [cached since 408.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 35, 139124), 'users_id': 3}
2025-03-29 16:29:35,140 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:36,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:36,301 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:36,301 - sqlalchemy.engine.Engine - INFO - [cached since 410.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:29:36,302 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:36,302 - sqlalchemy.engine.Engine - INFO - [cached since 410.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 36, 302387), 'users_id': 3}
2025-03-29 16:29:36,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:46,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 420s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:29:46,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 420s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 46, 204753), 'users_id': 2}
2025-03-29 16:29:46,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:29:47,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:29:47,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:29:47,538 - sqlalchemy.engine.Engine - INFO - [cached since 421.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:29:47,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:29:47,539 - sqlalchemy.engine.Engine - INFO - [cached since 421.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 29, 47, 538966), 'users_id': 2}
2025-03-29 16:29:47,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:05,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:05,136 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:05,136 - sqlalchemy.engine.Engine - INFO - [cached since 438.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:30:05,137 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:05,137 - sqlalchemy.engine.Engine - INFO - [cached since 438.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 5, 137645), 'users_id': 3}
2025-03-29 16:30:05,137 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:06,303 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:06,303 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:06,303 - sqlalchemy.engine.Engine - INFO - [cached since 440.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:30:06,304 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:06,304 - sqlalchemy.engine.Engine - INFO - [cached since 440.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 6, 304640), 'users_id': 3}
2025-03-29 16:30:06,304 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:16,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:16,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:16,202 - sqlalchemy.engine.Engine - INFO - [cached since 450s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:30:16,203 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 450s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 16, 203275), 'users_id': 2}
2025-03-29 16:30:16,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:17,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:17,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:17,539 - sqlalchemy.engine.Engine - INFO - [cached since 451.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:30:17,540 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:17,540 - sqlalchemy.engine.Engine - INFO - [cached since 451.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 17, 539024), 'users_id': 2}
2025-03-29 16:30:17,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:35,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:35,137 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:35,137 - sqlalchemy.engine.Engine - INFO - [cached since 468.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:30:35,138 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:35,138 - sqlalchemy.engine.Engine - INFO - [cached since 468.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 35, 137478), 'users_id': 3}
2025-03-29 16:30:35,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:36,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:36,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:36,300 - sqlalchemy.engine.Engine - INFO - [cached since 470.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:30:36,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:36,301 - sqlalchemy.engine.Engine - INFO - [cached since 470.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 36, 301832), 'users_id': 3}
2025-03-29 16:30:36,302 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:46,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 480s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:30:46,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 480s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 46, 204670), 'users_id': 2}
2025-03-29 16:30:46,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:30:47,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:30:47,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:30:47,539 - sqlalchemy.engine.Engine - INFO - [cached since 481.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:30:47,540 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:30:47,540 - sqlalchemy.engine.Engine - INFO - [cached since 481.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 30, 47, 540816), 'users_id': 2}
2025-03-29 16:30:47,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:05,138 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:05,139 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:05,139 - sqlalchemy.engine.Engine - INFO - [cached since 498.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:31:05,140 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:05,140 - sqlalchemy.engine.Engine - INFO - [cached since 498.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 5, 139626), 'users_id': 3}
2025-03-29 16:31:05,140 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:06,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:06,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:06,300 - sqlalchemy.engine.Engine - INFO - [cached since 500.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:31:06,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:06,302 - sqlalchemy.engine.Engine - INFO - [cached since 500.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 6, 301138), 'users_id': 3}
2025-03-29 16:31:06,302 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:16,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:16,204 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:16,204 - sqlalchemy.engine.Engine - INFO - [cached since 510s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:31:16,205 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:16,205 - sqlalchemy.engine.Engine - INFO - [cached since 510s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 16, 204914), 'users_id': 2}
2025-03-29 16:31:16,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:17,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:17,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:17,539 - sqlalchemy.engine.Engine - INFO - [cached since 511.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:31:17,540 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:17,540 - sqlalchemy.engine.Engine - INFO - [cached since 511.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 17, 540755), 'users_id': 2}
2025-03-29 16:31:17,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:35,212 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:35,213 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:35,213 - sqlalchemy.engine.Engine - INFO - [cached since 529s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:31:35,214 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:35,214 - sqlalchemy.engine.Engine - INFO - [cached since 529s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 35, 213990), 'users_id': 3}
2025-03-29 16:31:35,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:36,356 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:36,357 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:36,357 - sqlalchemy.engine.Engine - INFO - [cached since 530.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:31:36,358 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:36,358 - sqlalchemy.engine.Engine - INFO - [cached since 530.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 36, 358925), 'users_id': 3}
2025-03-29 16:31:36,359 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:45,224 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:31:45,224 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:31:45,224 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:31:45,225 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:31:45,226 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:31:45,226 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:31:45,226 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:31:45,227 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:31:46,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 540s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:31:46,204 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 540s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 46, 203217), 'users_id': 2}
2025-03-29 16:31:46,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:47,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:47,540 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:47,540 - sqlalchemy.engine.Engine - INFO - [cached since 541.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:31:47,541 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:47,541 - sqlalchemy.engine.Engine - INFO - [cached since 541.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 47, 540805), 'users_id': 2}
2025-03-29 16:31:47,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:56,877 - INFO - Incoming request: {"timestamp": "2025-03-29T13:31:56.877048", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:31:56,877 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:31:56.877048", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:31:56,877 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:31:56,877 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:31:56,958 - INFO - Incoming request: {"timestamp": "2025-03-29T13:31:56.958971", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:31:56,958 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:31:56.958971", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:31:56,960 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:56,961 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:56,961 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': '3977r6DqOoXvlyiK3P4_xwZg5GzihSXgJJTb9i2BxRs', 'param_1': 1}
2025-03-29 16:31:56,963 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:31:56,963 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'refresh_token': 'JT-QB3bZVp4CkF670bz6GIb2xDSJARnOAhvbqISIaoI', 'user_devices_id': 10}
2025-03-29 16:31:56,964 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:56,969 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-03-29 16:31:56,969 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-03-29 16:31:57,046 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:31:57,046 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:31:57,046 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:31:57,047 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:31:57,047 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:31:57,048 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:57,048 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:57,048 - sqlalchemy.engine.Engine - INFO - [cached since 550.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:31:57,049 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:57,049 - sqlalchemy.engine.Engine - INFO - [cached since 550.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 57, 49075), 'users_id': 3}
2025-03-29 16:31:57,049 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:57,050 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:31:58,043 - INFO - Incoming request: {"timestamp": "2025-03-29T13:31:58.043475", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:31:58,043 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:31:58.043475", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:31:58,044 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9d061447-3bd3-4f50-b9c8-00a9669bf23d
2025-03-29 16:31:58,044 - app.services.secure_channel_service - INFO - Creating channel with ID: 9d061447-3bd3-4f50-b9c8-00a9669bf23d
2025-03-29 16:31:58,045 - app.services.secure_channel_service - INFO - Channel 9d061447-3bd3-4f50-b9c8-00a9669bf23d saved to Redis with TTL 1800 seconds
2025-03-29 16:31:58,045 - app.api.v1.endpoints.auth - INFO - Channel 9d061447-3bd3-4f50-b9c8-00a9669bf23d initialized successfully
2025-03-29 16:31:58,046 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:31:58,046 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:31:58,130 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:31:58,130 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:31:58,130 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:31:58,131 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:31:58,131 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:31:58,131 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:31:58,132 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:31:58,132 - sqlalchemy.engine.Engine - INFO - [cached since 551.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:31:58,132 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:31:58,133 - sqlalchemy.engine.Engine - INFO - [cached since 551.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 31, 58, 132495), 'users_id': 3}
2025-03-29 16:31:58,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:31:58,133 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:32:16,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:16,201 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:16,201 - sqlalchemy.engine.Engine - INFO - [cached since 570s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:16,202 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:16,203 - sqlalchemy.engine.Engine - INFO - [cached since 570s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 16, 202120), 'users_id': 2}
2025-03-29 16:32:16,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:17,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:17,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:17,537 - sqlalchemy.engine.Engine - INFO - [cached since 571.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:17,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:17,538 - sqlalchemy.engine.Engine - INFO - [cached since 571.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 17, 538600), 'users_id': 2}
2025-03-29 16:32:17,538 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:19,254 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:32:19,254 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:32:19,255 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:32:19,255 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:32:19,255 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:32:19,255 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:32:19,257 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:32:19,258 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:32:27,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:27,044 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:27,044 - sqlalchemy.engine.Engine - INFO - [cached since 580.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:32:27,045 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:27,045 - sqlalchemy.engine.Engine - INFO - [cached since 580.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 27, 45353), 'users_id': 3}
2025-03-29 16:32:27,046 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:28,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:28,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:28,114 - sqlalchemy.engine.Engine - INFO - [cached since 581.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:32:28,115 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:28,115 - sqlalchemy.engine.Engine - INFO - [cached since 581.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 28, 115308), 'users_id': 3}
2025-03-29 16:32:28,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:35,331 - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:35.331079", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:35,331 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:35.331079", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:35,332 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 16:32:35,332 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 16:32:35,739 - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:35.739842", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:35,739 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:35.739842", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:35,741 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:35,741 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:35,742 - sqlalchemy.engine.Engine - INFO - [cached since 38.78s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'BEXkSaIzCyhOTWwbHH_91cxQdrL8Qj8kpRLk2fGzuBY', 'param_1': 1}
2025-03-29 16:32:35,743 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:32:35,743 - sqlalchemy.engine.Engine - INFO - [cached since 38.78s ago] {'refresh_token': 'UgBCzJ4b7gGqGHfsHxumMqnMcjd74ptTIiFz_SFh5lQ', 'user_devices_id': 9}
2025-03-29 16:32:35,744 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:35,745 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 16:32:35,745 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 16:32:35,810 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:32:35,810 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:32:35,810 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:32:35,811 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:32:35,811 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:32:35,811 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:35,812 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:35,812 - sqlalchemy.engine.Engine - INFO - [cached since 589.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:35,812 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:35,813 - sqlalchemy.engine.Engine - INFO - [cached since 589.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 35, 812858), 'users_id': 2}
2025-03-29 16:32:35,813 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:35,813 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:32:36,935 - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:36.935915", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:36,935 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:36.935915", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:36,936 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 47d7539d-b949-49eb-9ce9-08c9f2ba1476
2025-03-29 16:32:36,936 - app.services.secure_channel_service - INFO - Creating channel with ID: 47d7539d-b949-49eb-9ce9-08c9f2ba1476
2025-03-29 16:32:36,937 - app.services.secure_channel_service - INFO - Channel 47d7539d-b949-49eb-9ce9-08c9f2ba1476 saved to Redis with TTL 1800 seconds
2025-03-29 16:32:36,937 - app.api.v1.endpoints.auth - INFO - Channel 47d7539d-b949-49eb-9ce9-08c9f2ba1476 initialized successfully
2025-03-29 16:32:36,938 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:32:36,938 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:32:37,329 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:32:37,330 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:32:37,330 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:32:37,330 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:32:37,331 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:32:37,331 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:37,331 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:37,331 - sqlalchemy.engine.Engine - INFO - [cached since 591.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:37,332 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:37,332 - sqlalchemy.engine.Engine - INFO - [cached since 591.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 37, 332004), 'users_id': 2}
2025-03-29 16:32:37,333 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:37,338 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:32:40,120 - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:40.120201", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:40,120 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:32:40.120201", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:32:40,122 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:40,122 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:40,122 - sqlalchemy.engine.Engine - INFO - [cached since 593.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:40,123 - app.api.v1.endpoints.users - INFO - Search request received, channel: 47d7539d-b949-49eb-9ce9-08c9f2ba1476
2025-03-29 16:32:40,123 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743256955}
2025-03-29 16:32:40,125 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-29 16:32:40,125 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-29 16:32:40,125 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-29 16:32:40,125 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:32:40,125 - sqlalchemy.engine.Engine - INFO - [cached since 505.6s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-29 16:32:40,126 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:32:40,126 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:32:40,127 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:32:40,128 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:32:40,128 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:32:41,796 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:41,796 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:41,796 - sqlalchemy.engine.Engine - INFO - [cached since 595.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:41,797 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:41,797 - sqlalchemy.engine.Engine - INFO - [cached since 595.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 41, 797522), 'users_id': 2}
2025-03-29 16:32:41,798 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:41,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:41,803 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:41,803 - sqlalchemy.engine.Engine - INFO - [cached since 595.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:32:41,804 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:41,804 - sqlalchemy.engine.Engine - INFO - [cached since 595.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:32:41,804 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:32:41,805 - app.api.v1.endpoints.websocket - INFO - Generated chat_id d6ebfcae-90c2-4f3f-9cee-5b6f95e85252 for users 2 and 3
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:32:41,805 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:32:57,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:57,021 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:57,021 - sqlalchemy.engine.Engine - INFO - [cached since 610.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:32:57,022 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:57,022 - sqlalchemy.engine.Engine - INFO - [cached since 610.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 57, 22677), 'users_id': 3}
2025-03-29 16:32:57,023 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:32:58,056 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:32:58,056 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:32:58,056 - sqlalchemy.engine.Engine - INFO - [cached since 611.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:32:58,057 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:32:58,057 - sqlalchemy.engine.Engine - INFO - [cached since 611.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 32, 58, 57603), 'users_id': 3}
2025-03-29 16:32:58,058 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:01,164 - INFO - Incoming request: {"timestamp": "2025-03-29T13:33:01.164455", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:33:01,164 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:33:01.164455", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:33:01,167 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:01,167 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:01,167 - sqlalchemy.engine.Engine - INFO - [cached since 614.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:01,168 - app.api.v1.endpoints.users - INFO - Search request received, channel: 9d061447-3bd3-4f50-b9c8-00a9669bf23d
2025-03-29 16:33:01,168 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743256916}
2025-03-29 16:33:01,169 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 16:33:01,169 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 16:33:01,170 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 16:33:01,170 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:33:01,170 - sqlalchemy.engine.Engine - INFO - [cached since 526.6s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 16:33:01,171 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:33:01,171 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:33:01,172 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:33:01,172 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:33:01,172 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:33:03,480 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:03,481 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:03,481 - sqlalchemy.engine.Engine - INFO - [cached since 617.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:03,482 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:03,482 - sqlalchemy.engine.Engine - INFO - [cached since 617.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 3, 481403), 'users_id': 3}
2025-03-29 16:33:03,482 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:03,487 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:03,487 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:03,488 - sqlalchemy.engine.Engine - INFO - [cached since 617.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:33:03,488 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:03,488 - sqlalchemy.engine.Engine - INFO - [cached since 617.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:03,489 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 16:33:03,489 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 85848dc8-3070-44db-a718-f260e799e471 for users 3 and 2
2025-03-29 16:33:03,489 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:33:03,489 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:33:03,489 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:33:03,489 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:33:03,489 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:33:03,489 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:33:03,490 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:33:03,490 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:33:03,490 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:33:03,490 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:33:05,802 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:05,802 - sqlalchemy.engine.Engine - INFO - [cached since 619.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:33:05,803 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:05,803 - sqlalchemy.engine.Engine - INFO - [cached since 619.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 5, 803131), 'users_id': 2}
2025-03-29 16:33:05,804 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:07,256 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:07,256 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:07,256 - sqlalchemy.engine.Engine - INFO - [cached since 621s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:33:07,257 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:07,257 - sqlalchemy.engine.Engine - INFO - [cached since 621s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 7, 257062), 'users_id': 2}
2025-03-29 16:33:07,257 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:27,022 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:27,022 - sqlalchemy.engine.Engine - INFO - [cached since 640.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:27,023 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:27,023 - sqlalchemy.engine.Engine - INFO - [cached since 640.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 27, 23078), 'users_id': 3}
2025-03-29 16:33:27,023 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:28,077 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:28,078 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:28,078 - sqlalchemy.engine.Engine - INFO - [cached since 641.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:28,079 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:28,079 - sqlalchemy.engine.Engine - INFO - [cached since 641.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 28, 78316), 'users_id': 3}
2025-03-29 16:33:28,079 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:35,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:35,802 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:35,802 - sqlalchemy.engine.Engine - INFO - [cached since 649.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:33:35,803 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:35,803 - sqlalchemy.engine.Engine - INFO - [cached since 649.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 35, 802415), 'users_id': 2}
2025-03-29 16:33:35,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:37,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:37,244 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:37,244 - sqlalchemy.engine.Engine - INFO - [cached since 651s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:33:37,245 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:37,245 - sqlalchemy.engine.Engine - INFO - [cached since 651s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 37, 245786), 'users_id': 2}
2025-03-29 16:33:37,245 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:57,024 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:57,025 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:57,025 - sqlalchemy.engine.Engine - INFO - [cached since 670.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:57,026 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:57,026 - sqlalchemy.engine.Engine - INFO - [cached since 670.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 57, 25694), 'users_id': 3}
2025-03-29 16:33:57,026 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:33:58,094 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:33:58,095 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:33:58,095 - sqlalchemy.engine.Engine - INFO - [cached since 671.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:33:58,096 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:33:58,096 - sqlalchemy.engine.Engine - INFO - [cached since 671.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 33, 58, 96018), 'users_id': 3}
2025-03-29 16:33:58,096 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:05,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:05,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:05,801 - sqlalchemy.engine.Engine - INFO - [cached since 679.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:34:05,802 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:05,802 - sqlalchemy.engine.Engine - INFO - [cached since 679.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 5, 802564), 'users_id': 2}
2025-03-29 16:34:05,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:07,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:07,243 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:07,243 - sqlalchemy.engine.Engine - INFO - [cached since 681s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:34:07,244 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:07,244 - sqlalchemy.engine.Engine - INFO - [cached since 681s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 7, 244412), 'users_id': 2}
2025-03-29 16:34:07,245 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:12,685 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:12,685 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:12,686 - sqlalchemy.engine.Engine - INFO - [cached since 686.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:34:12,687 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:12,687 - sqlalchemy.engine.Engine - INFO - [cached since 686.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 12, 686041), 'users_id': 3}
2025-03-29 16:34:12,687 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:12,688 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:12,688 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:12,688 - sqlalchemy.engine.Engine - INFO - [cached since 686.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:34:12,689 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:12,689 - sqlalchemy.engine.Engine - INFO - [cached since 686.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:34:12,689 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 16:34:12,689 - app.api.v1.endpoints.websocket - INFO - Generated chat_id cc8106ce-2422-4335-a0b6-2d649302f360 for users 3 and 2
2025-03-29 16:34:12,689 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:34:12,690 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:34:27,019 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:27,019 - sqlalchemy.engine.Engine - INFO - [cached since 700.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:34:27,020 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:27,020 - sqlalchemy.engine.Engine - INFO - [cached since 700.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 27, 19414), 'users_id': 3}
2025-03-29 16:34:27,020 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:28,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:28,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:28,050 - sqlalchemy.engine.Engine - INFO - [cached since 701.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:34:28,051 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:28,051 - sqlalchemy.engine.Engine - INFO - [cached since 701.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 28, 51573), 'users_id': 3}
2025-03-29 16:34:28,052 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:35,802 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:35,802 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:35,802 - sqlalchemy.engine.Engine - INFO - [cached since 709.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:34:35,803 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:35,803 - sqlalchemy.engine.Engine - INFO - [cached since 709.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 35, 803360), 'users_id': 2}
2025-03-29 16:34:35,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:37,245 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:37,245 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:37,245 - sqlalchemy.engine.Engine - INFO - [cached since 711s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:34:37,246 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:37,247 - sqlalchemy.engine.Engine - INFO - [cached since 711s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 37, 246540), 'users_id': 2}
2025-03-29 16:34:37,247 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:37,577 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:34:37,577 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:34:37,577 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:34:37,578 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:34:38,790 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:34:38,791 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:34:38,791 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:34:38,792 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:34:54,260 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:34:54,261 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:34:54,261 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:34:54,262 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:34:56,194 - INFO - Incoming request: {"timestamp": "2025-03-29T13:34:56.194278", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:34:56,194 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:34:56.194278", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:34:56,195 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:34:56,195 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:34:56,532 - INFO - Incoming request: {"timestamp": "2025-03-29T13:34:56.532355", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:34:56,532 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:34:56.532355", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:34:56,533 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:56,534 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:56,534 - sqlalchemy.engine.Engine - INFO - [cached since 179.6s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'JT-QB3bZVp4CkF670bz6GIb2xDSJARnOAhvbqISIaoI', 'param_1': 1}
2025-03-29 16:34:56,535 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:34:56,535 - sqlalchemy.engine.Engine - INFO - [cached since 179.6s ago] {'refresh_token': '9exnRg3ZBdmrdYXhafcXHL_o67NtDUYgg2iwyxdIhBs', 'user_devices_id': 10}
2025-03-29 16:34:56,535 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:56,541 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.009}
2025-03-29 16:34:56,541 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.009}
2025-03-29 16:34:56,637 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:34:56,638 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:34:56,638 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:34:56,638 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:34:56,638 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:34:56,639 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:56,639 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:56,639 - sqlalchemy.engine.Engine - INFO - [cached since 730.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:34:56,640 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:56,640 - sqlalchemy.engine.Engine - INFO - [cached since 730.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 56, 640381), 'users_id': 3}
2025-03-29 16:34:56,640 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:56,641 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:34:57,661 - INFO - Incoming request: {"timestamp": "2025-03-29T13:34:57.660917", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:34:57,661 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:34:57.660917", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:34:57,662 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 6bd9b731-9a35-42c4-ab42-2527ea47bc3a
2025-03-29 16:34:57,662 - app.services.secure_channel_service - INFO - Creating channel with ID: 6bd9b731-9a35-42c4-ab42-2527ea47bc3a
2025-03-29 16:34:57,662 - app.services.secure_channel_service - INFO - Channel 6bd9b731-9a35-42c4-ab42-2527ea47bc3a saved to Redis with TTL 1800 seconds
2025-03-29 16:34:57,663 - app.api.v1.endpoints.auth - INFO - Channel 6bd9b731-9a35-42c4-ab42-2527ea47bc3a initialized successfully
2025-03-29 16:34:57,663 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:34:57,663 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:34:57,788 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:34:57,789 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:34:57,789 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:34:57,789 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:34:57,790 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:34:57,790 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:34:57,790 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:34:57,790 - sqlalchemy.engine.Engine - INFO - [cached since 731.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:34:57,791 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:34:57,791 - sqlalchemy.engine.Engine - INFO - [cached since 731.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 34, 57, 791030), 'users_id': 3}
2025-03-29 16:34:57,792 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:34:57,792 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:35:03,383 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:35:03,383 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:35:03,383 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:35:03,384 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:35:07,247 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:35:07,247 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:35:07,247 - sqlalchemy.engine.Engine - INFO - [cached since 741s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:35:07,248 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:35:07,248 - sqlalchemy.engine.Engine - INFO - [cached since 741s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 35, 7, 248084), 'users_id': 2}
2025-03-29 16:35:07,249 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:35:27,734 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:35:27,735 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:35:27,735 - sqlalchemy.engine.Engine - INFO - [cached since 761.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:35:27,736 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:35:27,736 - sqlalchemy.engine.Engine - INFO - [cached since 761.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 35, 27, 735874), 'users_id': 3}
2025-03-29 16:35:27,736 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:35:32,337 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:35:32,337 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:35:32,337 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:35:32,338 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:35:34,332 - INFO - Incoming request: {"timestamp": "2025-03-29T13:35:34.332577", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:35:34,332 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:35:34.332577", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:35:34,333 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 16:35:34,333 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 16:35:34,632 - INFO - Incoming request: {"timestamp": "2025-03-29T13:35:34.632714", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:35:34,632 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:35:34.632714", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:35:34,634 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:35:34,634 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:35:34,634 - sqlalchemy.engine.Engine - INFO - [cached since 217.7s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': '9exnRg3ZBdmrdYXhafcXHL_o67NtDUYgg2iwyxdIhBs', 'param_1': 1}
2025-03-29 16:35:34,637 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:35:34,637 - sqlalchemy.engine.Engine - INFO - [cached since 217.7s ago] {'refresh_token': 'buJO7THZstuUOX5Qzs5BW0qcEoKcEuOmZBPsp6tPTas', 'user_devices_id': 10}
2025-03-29 16:35:34,637 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:35:34,642 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-29 16:35:34,642 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-29 16:35:34,706 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:35:34,706 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:35:34,706 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:35:34,707 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:35:34,707 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:35:34,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:35:34,708 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:35:34,708 - sqlalchemy.engine.Engine - INFO - [cached since 768.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:35:34,709 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:35:34,709 - sqlalchemy.engine.Engine - INFO - [cached since 768.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 35, 34, 709732), 'users_id': 3}
2025-03-29 16:35:34,709 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:35:34,710 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:35:35,876 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:35:35,876 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:35:35,876 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:35:35,877 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:35:35,877 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:35:35,877 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:35:35,877 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:35:35,877 - sqlalchemy.engine.Engine - INFO - [cached since 769.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:35:35,878 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:35:35,878 - sqlalchemy.engine.Engine - INFO - [cached since 769.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 35, 35, 878079), 'users_id': 3}
2025-03-29 16:35:35,879 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:35:35,884 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:35:36,039 - INFO - Incoming request: {"timestamp": "2025-03-29T13:35:36.039130", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:35:36,039 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:35:36.039130", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:35:36,040 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 45753b05-01b8-4622-8299-7f3d1ede5f71
2025-03-29 16:35:36,040 - app.services.secure_channel_service - INFO - Creating channel with ID: 45753b05-01b8-4622-8299-7f3d1ede5f71
2025-03-29 16:35:36,041 - app.services.secure_channel_service - INFO - Channel 45753b05-01b8-4622-8299-7f3d1ede5f71 saved to Redis with TTL 1800 seconds
2025-03-29 16:35:36,041 - app.api.v1.endpoints.auth - INFO - Channel 45753b05-01b8-4622-8299-7f3d1ede5f71 initialized successfully
2025-03-29 16:35:36,041 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:35:36,041 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:35:37,245 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:35:37,246 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:35:37,246 - sqlalchemy.engine.Engine - INFO - [cached since 771s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:35:37,247 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:35:37,247 - sqlalchemy.engine.Engine - INFO - [cached since 771s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 35, 37, 246372), 'users_id': 2}
2025-03-29 16:35:37,247 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:35:41,099 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:35:41,099 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:35:41,099 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:35:41,100 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:36:05,799 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:05,799 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:05,800 - sqlalchemy.engine.Engine - INFO - [cached since 799.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:05,800 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:05,800 - sqlalchemy.engine.Engine - INFO - [cached since 799.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 5, 800706), 'users_id': 3}
2025-03-29 16:36:05,801 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:07,244 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:07,244 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:07,244 - sqlalchemy.engine.Engine - INFO - [cached since 801s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:36:07,245 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:07,245 - sqlalchemy.engine.Engine - INFO - [cached since 801s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 7, 245143), 'users_id': 2}
2025-03-29 16:36:07,246 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:15,103 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:36:15,103 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:36:15,103 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:36:15,104 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:36:20,439 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:20.439876", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:20,439 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:20.439876", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:20,440 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.008}
2025-03-29 16:36:20,440 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.008}
2025-03-29 16:36:20,596 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:20.596189", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:20,596 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:20.596189", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:20,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:20,599 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:20,599 - sqlalchemy.engine.Engine - INFO - [cached since 263.6s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'UgBCzJ4b7gGqGHfsHxumMqnMcjd74ptTIiFz_SFh5lQ', 'param_1': 1}
2025-03-29 16:36:20,600 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:36:20,600 - sqlalchemy.engine.Engine - INFO - [cached since 263.6s ago] {'refresh_token': 'r4L4Ql1wqU-3iVu9KoMtU-eisjNXZN9MhCZ_--Pv5EI', 'user_devices_id': 9}
2025-03-29 16:36:20,600 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:20,601 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 16:36:20,601 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 16:36:20,660 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:36:20,660 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:36:20,660 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:36:20,661 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:36:20,661 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:36:20,661 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:20,662 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:20,662 - sqlalchemy.engine.Engine - INFO - [cached since 814.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:36:20,662 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:20,662 - sqlalchemy.engine.Engine - INFO - [cached since 814.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 20, 662204), 'users_id': 2}
2025-03-29 16:36:20,663 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:20,663 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:36:21,696 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:21.696439", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:21,696 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:21.696439", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:21,697 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: f4911c8f-bf7d-4b45-92e6-77048f9d7418
2025-03-29 16:36:21,697 - app.services.secure_channel_service - INFO - Creating channel with ID: f4911c8f-bf7d-4b45-92e6-77048f9d7418
2025-03-29 16:36:21,698 - app.services.secure_channel_service - INFO - Channel f4911c8f-bf7d-4b45-92e6-77048f9d7418 saved to Redis with TTL 1800 seconds
2025-03-29 16:36:21,698 - app.api.v1.endpoints.auth - INFO - Channel f4911c8f-bf7d-4b45-92e6-77048f9d7418 initialized successfully
2025-03-29 16:36:21,698 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:36:21,698 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 16:36:22,832 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:36:22,832 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:36:22,832 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:36:22,833 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:36:22,833 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:36:22,833 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:22,833 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:22,833 - sqlalchemy.engine.Engine - INFO - [cached since 816.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:36:22,834 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:22,835 - sqlalchemy.engine.Engine - INFO - [cached since 816.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 22, 834193), 'users_id': 2}
2025-03-29 16:36:22,835 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:22,836 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:36:35,774 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:35,774 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:35,775 - sqlalchemy.engine.Engine - INFO - [cached since 829.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:35,776 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:35,776 - sqlalchemy.engine.Engine - INFO - [cached since 829.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 35, 775180), 'users_id': 3}
2025-03-29 16:36:35,776 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:36,258 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:36.258776", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:36,258 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:36.258776", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:36:36,260 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:36,260 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:36,260 - sqlalchemy.engine.Engine - INFO - [cached since 279.3s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'r4L4Ql1wqU-3iVu9KoMtU-eisjNXZN9MhCZ_--Pv5EI', 'param_1': 1}
2025-03-29 16:36:36,261 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:36:36,261 - sqlalchemy.engine.Engine - INFO - [cached since 279.3s ago] {'refresh_token': 'n6pp_wqm9LqATzRvzX--hKFVuj-fj8nHAy1quU8jKwY', 'user_devices_id': 9}
2025-03-29 16:36:36,261 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:36,267 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:36:36,267 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:36:36,322 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:36:36,322 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:36:36,322 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:36:36,323 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:36:36,323 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:36:36,323 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:36,323 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:36,323 - sqlalchemy.engine.Engine - INFO - [cached since 830.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:36:36,324 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:36,324 - sqlalchemy.engine.Engine - INFO - [cached since 830.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 36, 324791), 'users_id': 2}
2025-03-29 16:36:36,325 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:36,325 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:36:50,677 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:50.677249", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:50,677 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:50.677249", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:50,677 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:36:50,677 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:36:50,765 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:36:50,765 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:36:50,766 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:36:50,767 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:36:50,947 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:50.947621", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:50,947 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:50.947621", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:50,948 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:50,948 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:50,948 - sqlalchemy.engine.Engine - INFO - [cached since 294s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'buJO7THZstuUOX5Qzs5BW0qcEoKcEuOmZBPsp6tPTas', 'param_1': 1}
2025-03-29 16:36:50,950 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:36:50,950 - sqlalchemy.engine.Engine - INFO - [cached since 294s ago] {'refresh_token': '00VYe_LQCQRmNwhkNx5cEIBZ_094f5Cyzn2BSCIGdqY', 'user_devices_id': 10}
2025-03-29 16:36:50,950 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:50,955 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 16:36:50,955 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 16:36:51,038 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:36:51,038 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:36:51,038 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:36:51,039 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:36:51,039 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:36:51,039 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:51,039 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:51,039 - sqlalchemy.engine.Engine - INFO - [cached since 844.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:51,040 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:51,040 - sqlalchemy.engine.Engine - INFO - [cached since 844.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 51, 40643), 'users_id': 3}
2025-03-29 16:36:51,041 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:51,041 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:36:51,807 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:36:51,807 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:36:51,807 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:36:51,808 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:36:51,808 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:36:51,809 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:51,809 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:51,809 - sqlalchemy.engine.Engine - INFO - [cached since 845.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:51,810 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:51,810 - sqlalchemy.engine.Engine - INFO - [cached since 845.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 51, 810199), 'users_id': 3}
2025-03-29 16:36:51,811 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:51,811 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:36:51,924 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:51.924380", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:51,924 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:51.924380", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:51,926 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: b7cfbd24-4323-4ade-8af7-b9f3acb48459
2025-03-29 16:36:51,926 - app.services.secure_channel_service - INFO - Creating channel with ID: b7cfbd24-4323-4ade-8af7-b9f3acb48459
2025-03-29 16:36:51,927 - app.services.secure_channel_service - INFO - Channel b7cfbd24-4323-4ade-8af7-b9f3acb48459 saved to Redis with TTL 1800 seconds
2025-03-29 16:36:51,927 - app.api.v1.endpoints.auth - INFO - Channel b7cfbd24-4323-4ade-8af7-b9f3acb48459 initialized successfully
2025-03-29 16:36:51,928 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-29 16:36:51,928 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-29 16:36:52,778 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:52,778 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:52,779 - sqlalchemy.engine.Engine - INFO - [cached since 846.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:36:52,780 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:52,780 - sqlalchemy.engine.Engine - INFO - [cached since 846.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 52, 779947), 'users_id': 2}
2025-03-29 16:36:52,780 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:56,451 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:56.451193", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:56,451 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:56.451193", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:56,453 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:56,453 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:56,453 - sqlalchemy.engine.Engine - INFO - [cached since 299.5s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': '00VYe_LQCQRmNwhkNx5cEIBZ_094f5Cyzn2BSCIGdqY', 'param_1': 1}
2025-03-29 16:36:56,454 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:36:56,454 - sqlalchemy.engine.Engine - INFO - [cached since 299.5s ago] {'refresh_token': 'j_byCRverWYgD8H2ZviSUZ-EY_6tvby7PRyq1u6w1Kc', 'user_devices_id': 10}
2025-03-29 16:36:56,454 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:56,455 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 16:36:56,455 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 16:36:56,486 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:36:56,486 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:36:56,486 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:36:56,487 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:36:56,487 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:36:56,487 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:56,488 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:56,488 - sqlalchemy.engine.Engine - INFO - [cached since 850.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:56,488 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:56,489 - sqlalchemy.engine.Engine - INFO - [cached since 850.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 56, 488202), 'users_id': 3}
2025-03-29 16:36:56,489 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:56,489 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:36:58,160 - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:58.160643", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:58,160 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:36:58.160643", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:36:58,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:58,162 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:58,162 - sqlalchemy.engine.Engine - INFO - [cached since 851.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:58,163 - app.api.v1.endpoints.users - INFO - Search request received, channel: b7cfbd24-4323-4ade-8af7-b9f3acb48459
2025-03-29 16:36:58,164 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743257216}
2025-03-29 16:36:58,165 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 16:36:58,165 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 16:36:58,165 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 16:36:58,165 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:36:58,165 - sqlalchemy.engine.Engine - INFO - [cached since 763.6s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 16:36:58,166 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:36:58,166 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:36:58,167 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:36:58,167 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 16:36:58,167 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 16:36:59,640 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:59,640 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:59,640 - sqlalchemy.engine.Engine - INFO - [cached since 853.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:59,641 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:36:59,641 - sqlalchemy.engine.Engine - INFO - [cached since 853.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 36, 59, 641264), 'users_id': 3}
2025-03-29 16:36:59,641 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:36:59,642 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:36:59,642 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:59,642 - sqlalchemy.engine.Engine - INFO - [cached since 853.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:36:59,643 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:36:59,643 - sqlalchemy.engine.Engine - INFO - [cached since 853.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:36:59,644 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 16:36:59,644 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 30cf7ded-fe00-479d-b0ad-547b0e78d01e for users 3 and 2
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:36:59,644 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:36:59,645 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:36:59,645 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:37:06,306 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:06,306 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:06,306 - sqlalchemy.engine.Engine - INFO - [cached since 860.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:37:06,307 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:06,307 - sqlalchemy.engine.Engine - INFO - [cached since 860.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 6, 307415), 'users_id': 2}
2025-03-29 16:37:06,307 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:21,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:21,737 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:21,737 - sqlalchemy.engine.Engine - INFO - [cached since 875.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:37:21,738 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:21,738 - sqlalchemy.engine.Engine - INFO - [cached since 875.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 21, 738180), 'users_id': 3}
2025-03-29 16:37:21,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:22,766 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:22,767 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:22,767 - sqlalchemy.engine.Engine - INFO - [cached since 876.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:37:22,768 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:22,768 - sqlalchemy.engine.Engine - INFO - [cached since 876.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 22, 767016), 'users_id': 2}
2025-03-29 16:37:22,768 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:26,485 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:26,486 - sqlalchemy.engine.Engine - INFO - [cached since 880.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:37:26,487 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:26,487 - sqlalchemy.engine.Engine - INFO - [cached since 880.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 26, 486420), 'users_id': 3}
2025-03-29 16:37:26,487 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:36,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:36,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:36,299 - sqlalchemy.engine.Engine - INFO - [cached since 890.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:37:36,300 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:36,300 - sqlalchemy.engine.Engine - INFO - [cached since 890.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 36, 300206), 'users_id': 2}
2025-03-29 16:37:36,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:51,729 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:51,729 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:51,729 - sqlalchemy.engine.Engine - INFO - [cached since 905.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:37:51,730 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:51,730 - sqlalchemy.engine.Engine - INFO - [cached since 905.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 51, 730009), 'users_id': 3}
2025-03-29 16:37:51,731 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:52,766 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:52,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:52,766 - sqlalchemy.engine.Engine - INFO - [cached since 906.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:37:52,767 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:52,767 - sqlalchemy.engine.Engine - INFO - [cached since 906.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 52, 767687), 'users_id': 2}
2025-03-29 16:37:52,768 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:37:56,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:37:56,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:37:56,496 - sqlalchemy.engine.Engine - INFO - [cached since 910.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:37:56,496 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:37:56,497 - sqlalchemy.engine.Engine - INFO - [cached since 910.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 37, 56, 496550), 'users_id': 3}
2025-03-29 16:37:56,497 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:06,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:06,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:06,299 - sqlalchemy.engine.Engine - INFO - [cached since 920.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:38:06,300 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:06,300 - sqlalchemy.engine.Engine - INFO - [cached since 920.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 6, 300850), 'users_id': 2}
2025-03-29 16:38:06,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:21,722 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:21,722 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:21,723 - sqlalchemy.engine.Engine - INFO - [cached since 935.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:38:21,724 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:21,724 - sqlalchemy.engine.Engine - INFO - [cached since 935.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 21, 723360), 'users_id': 3}
2025-03-29 16:38:21,724 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:22,766 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:22,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:22,766 - sqlalchemy.engine.Engine - INFO - [cached since 936.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:38:22,767 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:22,767 - sqlalchemy.engine.Engine - INFO - [cached since 936.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 22, 767245), 'users_id': 2}
2025-03-29 16:38:22,768 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:26,493 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:26,493 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:26,494 - sqlalchemy.engine.Engine - INFO - [cached since 940.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:38:26,494 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:26,495 - sqlalchemy.engine.Engine - INFO - [cached since 940.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 26, 494524), 'users_id': 3}
2025-03-29 16:38:26,495 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:36,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:36,298 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:36,299 - sqlalchemy.engine.Engine - INFO - [cached since 950.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:38:36,299 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:36,299 - sqlalchemy.engine.Engine - INFO - [cached since 950.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 36, 299895), 'users_id': 2}
2025-03-29 16:38:36,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:51,743 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:51,743 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:51,743 - sqlalchemy.engine.Engine - INFO - [cached since 965.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:38:51,744 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:51,744 - sqlalchemy.engine.Engine - INFO - [cached since 965.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 51, 744457), 'users_id': 3}
2025-03-29 16:38:51,745 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:52,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:52,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:52,766 - sqlalchemy.engine.Engine - INFO - [cached since 966.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:38:52,767 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:52,767 - sqlalchemy.engine.Engine - INFO - [cached since 966.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 52, 766984), 'users_id': 2}
2025-03-29 16:38:52,767 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:38:56,485 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:38:56,486 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:38:56,486 - sqlalchemy.engine.Engine - INFO - [cached since 970.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:38:56,487 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:38:56,487 - sqlalchemy.engine.Engine - INFO - [cached since 970.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 38, 56, 486875), 'users_id': 3}
2025-03-29 16:38:56,487 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:06,302 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:06,302 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:06,303 - sqlalchemy.engine.Engine - INFO - [cached since 980.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:39:06,304 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:06,304 - sqlalchemy.engine.Engine - INFO - [cached since 980.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 6, 303123), 'users_id': 2}
2025-03-29 16:39:06,304 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:21,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:21,770 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:21,770 - sqlalchemy.engine.Engine - INFO - [cached since 995.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:39:21,771 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:21,772 - sqlalchemy.engine.Engine - INFO - [cached since 995.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 21, 771628), 'users_id': 3}
2025-03-29 16:39:21,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:22,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:22,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:22,766 - sqlalchemy.engine.Engine - INFO - [cached since 996.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:39:22,766 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:22,767 - sqlalchemy.engine.Engine - INFO - [cached since 996.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 22, 766853), 'users_id': 2}
2025-03-29 16:39:22,767 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:26,497 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:26,497 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:26,497 - sqlalchemy.engine.Engine - INFO - [cached since 1000s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:39:26,498 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:26,498 - sqlalchemy.engine.Engine - INFO - [cached since 1000s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 26, 498797), 'users_id': 3}
2025-03-29 16:39:26,499 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:36,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:36,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:36,299 - sqlalchemy.engine.Engine - INFO - [cached since 1010s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:39:36,300 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:36,300 - sqlalchemy.engine.Engine - INFO - [cached since 1010s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 36, 300515), 'users_id': 2}
2025-03-29 16:39:36,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:51,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:51,726 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:51,726 - sqlalchemy.engine.Engine - INFO - [cached since 1026s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:39:51,727 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:51,727 - sqlalchemy.engine.Engine - INFO - [cached since 1026s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 51, 726184), 'users_id': 3}
2025-03-29 16:39:51,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:52,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:52,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:52,766 - sqlalchemy.engine.Engine - INFO - [cached since 1027s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:39:52,767 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:52,767 - sqlalchemy.engine.Engine - INFO - [cached since 1027s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 52, 766993), 'users_id': 2}
2025-03-29 16:39:52,767 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:39:56,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:39:56,490 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:39:56,490 - sqlalchemy.engine.Engine - INFO - [cached since 1030s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:39:56,491 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:39:56,491 - sqlalchemy.engine.Engine - INFO - [cached since 1030s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 39, 56, 491836), 'users_id': 3}
2025-03-29 16:39:56,492 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:06,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:06,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:06,300 - sqlalchemy.engine.Engine - INFO - [cached since 1040s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:40:06,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:06,301 - sqlalchemy.engine.Engine - INFO - [cached since 1040s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 6, 301104), 'users_id': 2}
2025-03-29 16:40:06,302 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:21,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:21,721 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:21,721 - sqlalchemy.engine.Engine - INFO - [cached since 1056s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:40:21,722 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:21,722 - sqlalchemy.engine.Engine - INFO - [cached since 1056s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 21, 722204), 'users_id': 3}
2025-03-29 16:40:21,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:22,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:22,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:22,766 - sqlalchemy.engine.Engine - INFO - [cached since 1057s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:40:22,767 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:22,767 - sqlalchemy.engine.Engine - INFO - [cached since 1057s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 22, 766685), 'users_id': 2}
2025-03-29 16:40:22,767 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:26,498 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:26,499 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:26,499 - sqlalchemy.engine.Engine - INFO - [cached since 1060s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:40:26,499 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:26,500 - sqlalchemy.engine.Engine - INFO - [cached since 1060s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 26, 499843), 'users_id': 3}
2025-03-29 16:40:26,500 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:36,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:36,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:36,299 - sqlalchemy.engine.Engine - INFO - [cached since 1070s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:40:36,300 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:36,300 - sqlalchemy.engine.Engine - INFO - [cached since 1070s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 36, 300966), 'users_id': 2}
2025-03-29 16:40:36,301 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:51,723 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:51,724 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:51,724 - sqlalchemy.engine.Engine - INFO - [cached since 1086s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:40:51,725 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:51,725 - sqlalchemy.engine.Engine - INFO - [cached since 1086s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 51, 724677), 'users_id': 3}
2025-03-29 16:40:51,725 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:52,768 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:52,768 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:52,768 - sqlalchemy.engine.Engine - INFO - [cached since 1087s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:40:52,769 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:52,769 - sqlalchemy.engine.Engine - INFO - [cached since 1087s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 52, 769918), 'users_id': 2}
2025-03-29 16:40:52,770 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:40:56,494 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:40:56,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:40:56,495 - sqlalchemy.engine.Engine - INFO - [cached since 1090s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:40:56,495 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:40:56,496 - sqlalchemy.engine.Engine - INFO - [cached since 1090s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 40, 56, 495972), 'users_id': 3}
2025-03-29 16:40:56,496 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:06,302 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:06,303 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:06,303 - sqlalchemy.engine.Engine - INFO - [cached since 1100s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:41:06,303 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:06,304 - sqlalchemy.engine.Engine - INFO - [cached since 1100s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 6, 303266), 'users_id': 2}
2025-03-29 16:41:06,304 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:21,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:21,725 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:21,725 - sqlalchemy.engine.Engine - INFO - [cached since 1116s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:41:21,726 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:21,726 - sqlalchemy.engine.Engine - INFO - [cached since 1116s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 21, 726821), 'users_id': 3}
2025-03-29 16:41:21,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:22,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:22,770 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:22,770 - sqlalchemy.engine.Engine - INFO - [cached since 1117s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:41:22,771 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:22,771 - sqlalchemy.engine.Engine - INFO - [cached since 1117s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 22, 771811), 'users_id': 2}
2025-03-29 16:41:22,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:26,499 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:26,499 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:26,499 - sqlalchemy.engine.Engine - INFO - [cached since 1120s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:41:26,500 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:26,500 - sqlalchemy.engine.Engine - INFO - [cached since 1120s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 26, 500881), 'users_id': 3}
2025-03-29 16:41:26,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:36,302 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:36,302 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:36,302 - sqlalchemy.engine.Engine - INFO - [cached since 1130s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:41:36,303 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:36,303 - sqlalchemy.engine.Engine - INFO - [cached since 1130s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 36, 303601), 'users_id': 2}
2025-03-29 16:41:36,304 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:51,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:51,721 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:51,721 - sqlalchemy.engine.Engine - INFO - [cached since 1146s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:41:51,722 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:51,722 - sqlalchemy.engine.Engine - INFO - [cached since 1146s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 51, 722070), 'users_id': 3}
2025-03-29 16:41:51,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:52,769 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:52,769 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:52,769 - sqlalchemy.engine.Engine - INFO - [cached since 1147s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:41:52,770 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:52,770 - sqlalchemy.engine.Engine - INFO - [cached since 1147s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 52, 770324), 'users_id': 2}
2025-03-29 16:41:52,771 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:41:56,492 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:41:56,492 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:41:56,492 - sqlalchemy.engine.Engine - INFO - [cached since 1150s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:41:56,493 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:41:56,493 - sqlalchemy.engine.Engine - INFO - [cached since 1150s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 41, 56, 493763), 'users_id': 3}
2025-03-29 16:41:56,494 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:06,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:06,301 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:06,301 - sqlalchemy.engine.Engine - INFO - [cached since 1160s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:42:06,302 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:06,302 - sqlalchemy.engine.Engine - INFO - [cached since 1160s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 6, 302796), 'users_id': 2}
2025-03-29 16:42:06,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:21,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:21,725 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:21,725 - sqlalchemy.engine.Engine - INFO - [cached since 1176s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:42:21,726 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:21,727 - sqlalchemy.engine.Engine - INFO - [cached since 1176s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 21, 726380), 'users_id': 3}
2025-03-29 16:42:21,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:22,769 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:22,769 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:22,769 - sqlalchemy.engine.Engine - INFO - [cached since 1177s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:42:22,770 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:22,770 - sqlalchemy.engine.Engine - INFO - [cached since 1177s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 22, 770767), 'users_id': 2}
2025-03-29 16:42:22,771 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:26,504 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:26,505 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:26,505 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:42:26,506 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:26,506 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 26, 506790), 'users_id': 3}
2025-03-29 16:42:26,506 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:36,302 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:36,303 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:36,303 - sqlalchemy.engine.Engine - INFO - [cached since 1190s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:42:36,304 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:36,304 - sqlalchemy.engine.Engine - INFO - [cached since 1190s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 36, 304563), 'users_id': 2}
2025-03-29 16:42:36,305 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:51,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:51,722 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:51,722 - sqlalchemy.engine.Engine - INFO - [cached since 1206s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:42:51,723 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:51,723 - sqlalchemy.engine.Engine - INFO - [cached since 1206s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 51, 723400), 'users_id': 3}
2025-03-29 16:42:51,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:52,768 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:52,768 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:52,768 - sqlalchemy.engine.Engine - INFO - [cached since 1207s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:42:52,769 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:52,770 - sqlalchemy.engine.Engine - INFO - [cached since 1207s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 52, 769641), 'users_id': 2}
2025-03-29 16:42:52,770 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:42:56,499 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:42:56,499 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:42:56,499 - sqlalchemy.engine.Engine - INFO - [cached since 1210s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:42:56,500 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:42:56,500 - sqlalchemy.engine.Engine - INFO - [cached since 1210s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 42, 56, 500656), 'users_id': 3}
2025-03-29 16:42:56,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:06,303 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:06,303 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:06,303 - sqlalchemy.engine.Engine - INFO - [cached since 1220s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:43:06,304 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:06,304 - sqlalchemy.engine.Engine - INFO - [cached since 1220s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 6, 304106), 'users_id': 2}
2025-03-29 16:43:06,305 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:21,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:21,727 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:21,728 - sqlalchemy.engine.Engine - INFO - [cached since 1236s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:43:21,728 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:21,728 - sqlalchemy.engine.Engine - INFO - [cached since 1236s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 21, 728639), 'users_id': 3}
2025-03-29 16:43:21,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:22,769 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:22,769 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:22,770 - sqlalchemy.engine.Engine - INFO - [cached since 1237s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:43:22,770 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:22,770 - sqlalchemy.engine.Engine - INFO - [cached since 1237s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 22, 770667), 'users_id': 2}
2025-03-29 16:43:22,771 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:26,501 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:26,501 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:26,501 - sqlalchemy.engine.Engine - INFO - [cached since 1240s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:43:26,502 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:26,502 - sqlalchemy.engine.Engine - INFO - [cached since 1240s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 26, 502762), 'users_id': 3}
2025-03-29 16:43:26,503 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:36,322 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:36,322 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:36,322 - sqlalchemy.engine.Engine - INFO - [cached since 1250s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:43:36,323 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:36,323 - sqlalchemy.engine.Engine - INFO - [cached since 1250s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 36, 323652), 'users_id': 2}
2025-03-29 16:43:36,323 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:44,080 - INFO - Incoming request: {"timestamp": "2025-03-29T13:43:44.079725", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:43:44,080 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:43:44.079725", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:43:44,083 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:44,083 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:44,083 - sqlalchemy.engine.Engine - INFO - [cached since 707.1s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'n6pp_wqm9LqATzRvzX--hKFVuj-fj8nHAy1quU8jKwY', 'param_1': 1}
2025-03-29 16:43:44,084 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:43:44,084 - sqlalchemy.engine.Engine - INFO - [cached since 707.1s ago] {'refresh_token': 'f7NiL6PSY9ZtHX-GeS_lploSzwI9jRAxfKST7TBCSgk', 'user_devices_id': 9}
2025-03-29 16:43:44,085 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:44,090 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.001999999999999}
2025-03-29 16:43:44,090 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.001999999999999}
2025-03-29 16:43:44,154 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:43:44,154 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:43:44,154 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:43:44,155 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:43:44,155 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:43:44,156 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:44,156 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:44,156 - sqlalchemy.engine.Engine - INFO - [cached since 1258s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:43:44,157 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:44,157 - sqlalchemy.engine.Engine - INFO - [cached since 1258s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 44, 157743), 'users_id': 2}
2025-03-29 16:43:44,157 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:44,158 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:43:46,755 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:43:46,755 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:43:46,755 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:43:46,756 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:43:46,756 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:43:46,756 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:43:46,757 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:43:46,757 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:43:46,757 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:43:46,758 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:43:46,758 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:43:46,759 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:43:51,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:51,725 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:51,725 - sqlalchemy.engine.Engine - INFO - [cached since 1266s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:43:51,726 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:51,726 - sqlalchemy.engine.Engine - INFO - [cached since 1266s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 51, 726990), 'users_id': 3}
2025-03-29 16:43:51,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:52,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:52,770 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:52,770 - sqlalchemy.engine.Engine - INFO - [cached since 1267s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:43:52,771 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:52,772 - sqlalchemy.engine.Engine - INFO - [cached since 1267s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 52, 771455), 'users_id': 2}
2025-03-29 16:43:52,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:43:56,494 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:43:56,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:43:56,495 - sqlalchemy.engine.Engine - INFO - [cached since 1270s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:43:56,496 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:43:56,496 - sqlalchemy.engine.Engine - INFO - [cached since 1270s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 43, 56, 495061), 'users_id': 3}
2025-03-29 16:43:56,496 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:21,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:21,712 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:21,712 - sqlalchemy.engine.Engine - INFO - [cached since 1295s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:44:21,713 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:21,713 - sqlalchemy.engine.Engine - INFO - [cached since 1295s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 21, 713902), 'users_id': 3}
2025-03-29 16:44:21,713 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:22,365 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:44:22,365 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:44:22,365 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:44:22,366 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:44:26,492 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:26,493 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:26,493 - sqlalchemy.engine.Engine - INFO - [cached since 1300s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:44:26,494 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:26,494 - sqlalchemy.engine.Engine - INFO - [cached since 1300s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 26, 493963), 'users_id': 3}
2025-03-29 16:44:26,494 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:36,792 - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:36.791311", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:44:36,792 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:36.791311", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:44:36,792 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 16:44:36,792 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 16:44:37,223 - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:37.223409", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:44:37,223 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:37.223409", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:44:37,224 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:37,225 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:37,225 - sqlalchemy.engine.Engine - INFO - [cached since 760.3s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'f7NiL6PSY9ZtHX-GeS_lploSzwI9jRAxfKST7TBCSgk', 'param_1': 1}
2025-03-29 16:44:37,226 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:44:37,226 - sqlalchemy.engine.Engine - INFO - [cached since 760.3s ago] {'refresh_token': 'SJT8i2PEiiGarSLQyxDKqlLJyZy5zgRPTYox3TxLRxw', 'user_devices_id': 9}
2025-03-29 16:44:37,226 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:37,227 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 16:44:37,227 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 16:44:37,389 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:44:37,390 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:44:37,390 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:44:37,390 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:44:37,390 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:44:37,391 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:37,391 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:37,391 - sqlalchemy.engine.Engine - INFO - [cached since 1311s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:44:37,392 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:37,392 - sqlalchemy.engine.Engine - INFO - [cached since 1311s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 37, 392447), 'users_id': 2}
2025-03-29 16:44:37,393 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:37,393 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:44:38,151 - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:38.151161", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:44:38,151 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:38.151161", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:44:38,152 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: fec0b77a-d372-4e8b-95ed-54bc676e3572
2025-03-29 16:44:38,152 - app.services.secure_channel_service - INFO - Creating channel with ID: fec0b77a-d372-4e8b-95ed-54bc676e3572
2025-03-29 16:44:38,153 - app.services.secure_channel_service - INFO - Channel fec0b77a-d372-4e8b-95ed-54bc676e3572 saved to Redis with TTL 1800 seconds
2025-03-29 16:44:38,153 - app.api.v1.endpoints.auth - INFO - Channel fec0b77a-d372-4e8b-95ed-54bc676e3572 initialized successfully
2025-03-29 16:44:38,154 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 16:44:38,154 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 16:44:38,960 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:44:38,961 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:44:38,961 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:44:38,962 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:44:38,962 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:44:38,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:38,962 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:38,962 - sqlalchemy.engine.Engine - INFO - [cached since 1313s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:44:38,963 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:38,963 - sqlalchemy.engine.Engine - INFO - [cached since 1313s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 38, 963675), 'users_id': 2}
2025-03-29 16:44:38,964 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:38,969 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:44:48,932 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:44:48,933 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:44:48,933 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:44:48,934 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:44:50,598 - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:50.598530", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:44:50,598 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:50.598530", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:44:50,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:50,599 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:50,600 - sqlalchemy.engine.Engine - INFO - [cached since 773.6s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'j_byCRverWYgD8H2ZviSUZ-EY_6tvby7PRyq1u6w1Kc', 'param_1': 1}
2025-03-29 16:44:50,601 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:44:50,601 - sqlalchemy.engine.Engine - INFO - [cached since 773.6s ago] {'refresh_token': '1iSZ0LVpw1aqhSHyKX6gBCXoS3YNrP0xdFwg10q6HFQ', 'user_devices_id': 10}
2025-03-29 16:44:50,601 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:50,606 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:44:50,606 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:44:50,632 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:44:50,632 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:44:50,633 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:44:50,633 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:44:50,633 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:44:50,634 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:50,634 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:50,634 - sqlalchemy.engine.Engine - INFO - [cached since 1324s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:44:50,635 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:50,635 - sqlalchemy.engine.Engine - INFO - [cached since 1324s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 50, 634538), 'users_id': 3}
2025-03-29 16:44:50,635 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:50,635 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:44:51,854 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:51,855 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:51,855 - sqlalchemy.engine.Engine - INFO - [cached since 1326s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:44:51,856 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:51,856 - sqlalchemy.engine.Engine - INFO - [cached since 1326s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 51, 855386), 'users_id': 3}
2025-03-29 16:44:51,856 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:53,767 - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:53.767525", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:44:53,767 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:53.767525", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:44:53,768 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:53,769 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:53,769 - sqlalchemy.engine.Engine - INFO - [cached since 776.8s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': '1iSZ0LVpw1aqhSHyKX6gBCXoS3YNrP0xdFwg10q6HFQ', 'param_1': 1}
2025-03-29 16:44:53,770 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:44:53,770 - sqlalchemy.engine.Engine - INFO - [cached since 776.8s ago] {'refresh_token': 'xrALNq8bB9yzkUFpqO8JafAxXlg-w_C2HkFRdj_ceFs', 'user_devices_id': 10}
2025-03-29 16:44:53,770 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:53,776 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:44:53,776 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:44:53,804 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:44:53,804 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:44:53,804 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:44:53,805 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:44:53,805 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:44:53,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:53,805 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:53,805 - sqlalchemy.engine.Engine - INFO - [cached since 1328s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:44:53,806 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:53,806 - sqlalchemy.engine.Engine - INFO - [cached since 1328s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 53, 806533), 'users_id': 3}
2025-03-29 16:44:53,807 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:53,807 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:44:58,395 - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:58.395339", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:44:58,395 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:44:58.395339", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:44:58,397 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:58,397 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:58,397 - sqlalchemy.engine.Engine - INFO - [cached since 781.4s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'xrALNq8bB9yzkUFpqO8JafAxXlg-w_C2HkFRdj_ceFs', 'param_1': 1}
2025-03-29 16:44:58,398 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:44:58,398 - sqlalchemy.engine.Engine - INFO - [cached since 781.4s ago] {'refresh_token': 'IqarYzE4XheR3VHvQm4BBVEoYdn-JQZbtfYWft0xbik', 'user_devices_id': 10}
2025-03-29 16:44:58,399 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:58,404 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.003}
2025-03-29 16:44:58,404 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.003}
2025-03-29 16:44:58,430 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:44:58,430 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:44:58,430 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:44:58,431 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:44:58,431 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:44:58,431 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:44:58,432 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:44:58,432 - sqlalchemy.engine.Engine - INFO - [cached since 1332s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:44:58,433 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:44:58,433 - sqlalchemy.engine.Engine - INFO - [cached since 1332s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 44, 58, 432349), 'users_id': 3}
2025-03-29 16:44:58,433 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:44:58,433 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:45:00,252 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:00,252 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:00,252 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:45:00,253 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:00,253 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:45:00,253 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:45:00,253 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:00,254 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:45:00,254 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:45:00,254 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:00,254 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:45:00,254 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:45:00,254 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:00,255 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:45:00,255 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:45:00,257 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:00,258 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:00,258 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:00,258 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:00,259 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:08,935 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:08,936 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:08,936 - sqlalchemy.engine.Engine - INFO - [cached since 1343s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:08,937 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:08,937 - sqlalchemy.engine.Engine - INFO - [cached since 1343s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 8, 936066), 'users_id': 2}
2025-03-29 16:45:08,937 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:17,958 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:45:17,958 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:45:17,958 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:45:17,960 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:45:25,176 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:25.176242", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:25,176 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:25.176242", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:25,176 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:45:25,176 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:45:25,620 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:25.620576", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:25,620 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:25.620576", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:25,621 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:25,622 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:25,622 - sqlalchemy.engine.Engine - INFO - [cached since 808.7s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'SJT8i2PEiiGarSLQyxDKqlLJyZy5zgRPTYox3TxLRxw', 'param_1': 1}
2025-03-29 16:45:25,623 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:45:25,623 - sqlalchemy.engine.Engine - INFO - [cached since 808.7s ago] {'refresh_token': '5gIUuc4xvkF1SROVHztQtbZgjKEFHEfhuMZJYFrb2qU', 'user_devices_id': 9}
2025-03-29 16:45:25,623 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:25,628 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 16:45:25,628 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 16:45:25,715 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:45:25,715 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:25,715 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:45:25,716 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:45:25,716 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:45:25,717 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:25,717 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:25,717 - sqlalchemy.engine.Engine - INFO - [cached since 1359s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:25,718 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:25,718 - sqlalchemy.engine.Engine - INFO - [cached since 1359s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 25, 717625), 'users_id': 2}
2025-03-29 16:45:25,718 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:25,718 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:45:26,136 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:26.135026", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:26,136 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:26.135026", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:26,136 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:45:26,136 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:45:26,446 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:26.446108", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:26,446 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:26.446108", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:26,447 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:26,448 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:26,448 - sqlalchemy.engine.Engine - INFO - [cached since 809.5s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'IqarYzE4XheR3VHvQm4BBVEoYdn-JQZbtfYWft0xbik', 'param_1': 1}
2025-03-29 16:45:26,449 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:45:26,449 - sqlalchemy.engine.Engine - INFO - [cached since 809.5s ago] {'refresh_token': 'kZEqUvZ5QEW8-oxM4N0MVx4OJikMbj2QyBNkN74L__Y', 'user_devices_id': 10}
2025-03-29 16:45:26,449 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:26,454 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:45:26,454 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:45:26,567 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:45:26,568 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:26,568 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 16:45:26,569 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:45:26,569 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:26,570 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:45:26,570 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:45:26,570 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:45:26,570 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:26,570 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:26,571 - sqlalchemy.engine.Engine - INFO - [cached since 1360s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:26,571 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:26,572 - sqlalchemy.engine.Engine - INFO - [cached since 1360s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 26, 571136), 'users_id': 2}
2025-03-29 16:45:26,572 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:26,572 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:45:26,573 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:45:26,573 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:45:26,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:26,574 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:26,574 - sqlalchemy.engine.Engine - INFO - [cached since 1360s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:45:26,575 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:26,575 - sqlalchemy.engine.Engine - INFO - [cached since 1360s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 26, 574136), 'users_id': 3}
2025-03-29 16:45:26,575 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:26,576 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:45:27,169 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:27.168998", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:27,169 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:27.168998", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:27,170 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 131cc63e-d5a4-4292-8e3b-ee66e5f594ef
2025-03-29 16:45:27,170 - app.services.secure_channel_service - INFO - Creating channel with ID: 131cc63e-d5a4-4292-8e3b-ee66e5f594ef
2025-03-29 16:45:27,171 - app.services.secure_channel_service - INFO - Channel 131cc63e-d5a4-4292-8e3b-ee66e5f594ef saved to Redis with TTL 1800 seconds
2025-03-29 16:45:27,171 - app.api.v1.endpoints.auth - INFO - Channel 131cc63e-d5a4-4292-8e3b-ee66e5f594ef initialized successfully
2025-03-29 16:45:27,171 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:45:27,171 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:45:27,647 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:45:27,648 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:27,648 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:45:27,648 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:45:27,649 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:45:27,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:27,649 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:27,649 - sqlalchemy.engine.Engine - INFO - [cached since 1361s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:45:27,650 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:27,650 - sqlalchemy.engine.Engine - INFO - [cached since 1361s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 27, 650800), 'users_id': 3}
2025-03-29 16:45:27,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:27,656 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:45:27,756 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:27.756033", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:27,756 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:27.756033", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:27,758 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: fd58f51a-eb15-43fe-b5bf-a625d9e9fae2
2025-03-29 16:45:27,758 - app.services.secure_channel_service - INFO - Creating channel with ID: fd58f51a-eb15-43fe-b5bf-a625d9e9fae2
2025-03-29 16:45:27,758 - app.services.secure_channel_service - INFO - Channel fd58f51a-eb15-43fe-b5bf-a625d9e9fae2 saved to Redis with TTL 1800 seconds
2025-03-29 16:45:27,759 - app.api.v1.endpoints.auth - INFO - Channel fd58f51a-eb15-43fe-b5bf-a625d9e9fae2 initialized successfully
2025-03-29 16:45:27,759 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:45:27,759 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:45:29,555 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:29,555 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:29,555 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:45:29,556 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:31,940 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:31.940717", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:31,940 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:31.940717", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:45:31,941 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:31,941 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:31,942 - sqlalchemy.engine.Engine - INFO - [cached since 1366s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:31,942 - app.api.v1.endpoints.users - INFO - Search request received, channel: 131cc63e-d5a4-4292-8e3b-ee66e5f594ef
2025-03-29 16:45:31,942 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743257725}
2025-03-29 16:45:31,943 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-29 16:45:31,943 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-29 16:45:31,943 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-29 16:45:31,944 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:45:31,944 - sqlalchemy.engine.Engine - INFO - [cached since 1277s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-29 16:45:31,945 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:45:31,945 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': False}]
2025-03-29 16:45:31,946 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:45:31,946 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-29 16:45:31,946 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-29 16:45:35,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:35,569 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:35,569 - sqlalchemy.engine.Engine - INFO - [cached since 1369s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:35,570 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:35,570 - sqlalchemy.engine.Engine - INFO - [cached since 1369s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 35, 570532), 'users_id': 2}
2025-03-29 16:45:35,571 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:35,571 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:35,571 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:35,572 - sqlalchemy.engine.Engine - INFO - [cached since 1369s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:45:35,572 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:35,572 - sqlalchemy.engine.Engine - INFO - [cached since 1369s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:35,573 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:45:35,573 - app.api.v1.endpoints.websocket - INFO - Generated chat_id b4eca40c-86d3-4d3d-a24a-878f9ef7ccde for users 2 and 3
2025-03-29 16:45:35,573 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:45:35,573 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:45:35,573 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 16:45:35,573 - app.services.connection_manager - INFO - User 3 not connected to this server, checking online status
2025-03-29 16:45:35,573 - app.services.connection_manager - INFO - User 3 is offline or Redis publish failed, adding message to buffer
2025-03-29 16:45:35,574 - app.services.connection_manager - INFO - Message added to buffer for user 3
2025-03-29 16:45:35,574 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:45:35,574 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:45:35,574 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 16:45:35,574 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:45:35,575 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:45:45,134 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:45,134 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:45:45,135 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:45:45,136 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:55,638 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:45:55,638 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:45:55,639 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:45:55,640 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:45:55,723 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:55,723 - sqlalchemy.engine.Engine - INFO - [cached since 1390s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:55,724 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:55,725 - sqlalchemy.engine.Engine - INFO - [cached since 1390s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 55, 724933), 'users_id': 2}
2025-03-29 16:45:55,725 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:56,498 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:56,498 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:56,498 - sqlalchemy.engine.Engine - INFO - [cached since 1390s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:45:56,499 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:56,499 - sqlalchemy.engine.Engine - INFO - [cached since 1390s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 56, 499571), 'users_id': 2}
2025-03-29 16:45:56,500 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:57,679 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:57.679148", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:57,679 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:57.679148", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:57,680 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:45:57,680 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:45:57,975 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:57.974188", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:57,975 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:57.974188", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:57,976 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:57,977 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:57,977 - sqlalchemy.engine.Engine - INFO - [cached since 841s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'kZEqUvZ5QEW8-oxM4N0MVx4OJikMbj2QyBNkN74L__Y', 'param_1': 1}
2025-03-29 16:45:57,978 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:45:57,978 - sqlalchemy.engine.Engine - INFO - [cached since 841s ago] {'refresh_token': '5hulYuC44achedatpJJ94OI0_7dDjgi6z70PfkRJ2Ak', 'user_devices_id': 10}
2025-03-29 16:45:57,978 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:57,983 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:45:57,983 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 16:45:58,041 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:45:58,041 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:58,041 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:45:58,042 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:45:58,042 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:45:58,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:58,042 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:58,043 - sqlalchemy.engine.Engine - INFO - [cached since 1392s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:45:58,043 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:58,043 - sqlalchemy.engine.Engine - INFO - [cached since 1392s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 58, 43219), 'users_id': 3}
2025-03-29 16:45:58,044 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:58,044 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:45:58,045 - app.services.message_buffer - INFO - Retrieved and cleared 1 messages for user 3
2025-03-29 16:45:58,045 - app.api.v1.endpoints.websocket - INFO - Delivering 1 buffered messages to user 3
2025-03-29 16:45:59,117 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:45:59,117 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:45:59,117 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:45:59,118 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:45:59,118 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:45:59,119 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:59,119 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:59,119 - sqlalchemy.engine.Engine - INFO - [cached since 1393s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:45:59,120 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:59,120 - sqlalchemy.engine.Engine - INFO - [cached since 1393s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 59, 120314), 'users_id': 3}
2025-03-29 16:45:59,120 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:59,126 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:45:59,616 - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:59.615578", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:59,616 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:45:59.615578", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:45:59,617 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: cf88b9bd-64f5-4490-9585-301e1a28f94d
2025-03-29 16:45:59,617 - app.services.secure_channel_service - INFO - Creating channel with ID: cf88b9bd-64f5-4490-9585-301e1a28f94d
2025-03-29 16:45:59,618 - app.services.secure_channel_service - INFO - Channel cf88b9bd-64f5-4490-9585-301e1a28f94d saved to Redis with TTL 1800 seconds
2025-03-29 16:45:59,618 - app.api.v1.endpoints.auth - INFO - Channel cf88b9bd-64f5-4490-9585-301e1a28f94d initialized successfully
2025-03-29 16:45:59,618 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 16:45:59,618 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 16:45:59,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:45:59,828 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:45:59,828 - sqlalchemy.engine.Engine - INFO - [cached since 1394s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:45:59,829 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:45:59,830 - sqlalchemy.engine.Engine - INFO - [cached since 1394s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 45, 59, 829675), 'users_id': 3}
2025-03-29 16:45:59,830 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:45:59,835 - app.api.v1.endpoints.websocket - WARNING - Missing recipient_id in key exchange from user 3
2025-03-29 16:46:07,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:07,413 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:07,413 - sqlalchemy.engine.Engine - INFO - [cached since 1401s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:46:07,414 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:07,414 - sqlalchemy.engine.Engine - INFO - [cached since 1401s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 7, 414571), 'users_id': 2}
2025-03-29 16:46:07,415 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:07,415 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 2
2025-03-29 16:46:18,170 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:18,171 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:18,171 - sqlalchemy.engine.Engine - INFO - [cached since 1412s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:18,172 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:18,172 - sqlalchemy.engine.Engine - INFO - [cached since 1412s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 18, 171364), 'users_id': 3}
2025-03-29 16:46:18,172 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:18,177 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 3
2025-03-29 16:46:25,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:25,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:25,709 - sqlalchemy.engine.Engine - INFO - [cached since 1419s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:46:25,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:25,710 - sqlalchemy.engine.Engine - INFO - [cached since 1419s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 25, 710158), 'users_id': 2}
2025-03-29 16:46:25,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:26,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:26,475 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:26,476 - sqlalchemy.engine.Engine - INFO - [cached since 1420s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:46:26,477 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1420s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 26, 476579), 'users_id': 2}
2025-03-29 16:46:26,477 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:28,060 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:28,060 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:28,060 - sqlalchemy.engine.Engine - INFO - [cached since 1422s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:28,061 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:28,061 - sqlalchemy.engine.Engine - INFO - [cached since 1422s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 28, 61189), 'users_id': 3}
2025-03-29 16:46:28,062 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:28,377 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:28,377 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:28,378 - sqlalchemy.engine.Engine - INFO - [cached since 1422s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:28,378 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:28,379 - sqlalchemy.engine.Engine - INFO - [cached since 1422s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 28, 378433), 'users_id': 3}
2025-03-29 16:46:28,379 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:28,384 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 3
2025-03-29 16:46:29,082 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:29,082 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:29,082 - sqlalchemy.engine.Engine - INFO - [cached since 1423s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:29,083 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:29,083 - sqlalchemy.engine.Engine - INFO - [cached since 1423s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 29, 83432), 'users_id': 3}
2025-03-29 16:46:29,084 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:34,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:34,399 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:34,399 - sqlalchemy.engine.Engine - INFO - [cached since 1428s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:34,400 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:34,400 - sqlalchemy.engine.Engine - INFO - [cached since 1428s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 34, 400484), 'users_id': 3}
2025-03-29 16:46:34,401 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:34,406 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 3
2025-03-29 16:46:47,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:47,133 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:47,133 - sqlalchemy.engine.Engine - INFO - [cached since 1441s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:47,134 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:47,134 - sqlalchemy.engine.Engine - INFO - [cached since 1441s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 47, 134248), 'users_id': 3}
2025-03-29 16:46:47,134 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:47,139 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 3
2025-03-29 16:46:48,838 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:48,838 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:48,839 - sqlalchemy.engine.Engine - INFO - [cached since 1443s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:48,839 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:48,840 - sqlalchemy.engine.Engine - INFO - [cached since 1443s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 48, 839180), 'users_id': 3}
2025-03-29 16:46:48,840 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:48,842 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 3
2025-03-29 16:46:55,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:55,708 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:55,708 - sqlalchemy.engine.Engine - INFO - [cached since 1449s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:46:55,709 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:55,709 - sqlalchemy.engine.Engine - INFO - [cached since 1449s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 55, 709977), 'users_id': 2}
2025-03-29 16:46:55,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:56,479 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:56,479 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:56,479 - sqlalchemy.engine.Engine - INFO - [cached since 1450s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:46:56,480 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:56,480 - sqlalchemy.engine.Engine - INFO - [cached since 1450s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 56, 480159), 'users_id': 2}
2025-03-29 16:46:56,480 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:58,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:58,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:58,032 - sqlalchemy.engine.Engine - INFO - [cached since 1452s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:58,033 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:58,034 - sqlalchemy.engine.Engine - INFO - [cached since 1452s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 58, 33106), 'users_id': 3}
2025-03-29 16:46:58,034 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:46:59,097 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:46:59,097 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:46:59,097 - sqlalchemy.engine.Engine - INFO - [cached since 1453s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:46:59,098 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:46:59,098 - sqlalchemy.engine.Engine - INFO - [cached since 1453s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 46, 59, 98692), 'users_id': 3}
2025-03-29 16:46:59,098 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:25,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:25,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:25,710 - sqlalchemy.engine.Engine - INFO - [cached since 1479s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:47:25,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:25,711 - sqlalchemy.engine.Engine - INFO - [cached since 1479s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 25, 710462), 'users_id': 2}
2025-03-29 16:47:25,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:26,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:26,476 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:26,476 - sqlalchemy.engine.Engine - INFO - [cached since 1480s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:47:26,477 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1480s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 26, 477823), 'users_id': 2}
2025-03-29 16:47:26,478 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:28,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:28,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:28,032 - sqlalchemy.engine.Engine - INFO - [cached since 1482s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:47:28,033 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:28,033 - sqlalchemy.engine.Engine - INFO - [cached since 1482s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 28, 32760), 'users_id': 3}
2025-03-29 16:47:28,033 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:29,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:29,126 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:29,126 - sqlalchemy.engine.Engine - INFO - [cached since 1483s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:47:29,127 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:29,127 - sqlalchemy.engine.Engine - INFO - [cached since 1483s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 29, 127431), 'users_id': 3}
2025-03-29 16:47:29,128 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:38,100 - INFO - Incoming request: {"timestamp": "2025-03-29T13:47:38.100250", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:47:38,100 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:47:38.100250", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:47:38,102 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:38,102 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:38,103 - sqlalchemy.engine.Engine - INFO - [cached since 941.1s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': '5gIUuc4xvkF1SROVHztQtbZgjKEFHEfhuMZJYFrb2qU', 'param_1': 1}
2025-03-29 16:47:38,104 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:47:38,104 - sqlalchemy.engine.Engine - INFO - [cached since 941.1s ago] {'refresh_token': 'b5wV6fb1NZFnW7GWyEmN62vPJNWHCb9M7TtssDd4N1k', 'user_devices_id': 9}
2025-03-29 16:47:38,104 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:38,105 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.9959999999999996}
2025-03-29 16:47:38,105 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.9959999999999996}
2025-03-29 16:47:38,145 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:47:38,145 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:47:38,146 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:47:38,146 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:47:38,146 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:47:38,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:38,147 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:38,147 - sqlalchemy.engine.Engine - INFO - [cached since 1492s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:47:38,148 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:38,148 - sqlalchemy.engine.Engine - INFO - [cached since 1492s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 38, 148281), 'users_id': 2}
2025-03-29 16:47:38,149 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:38,149 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:47:56,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:56,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:56,477 - sqlalchemy.engine.Engine - INFO - [cached since 1510s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:47:56,478 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1510s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 56, 478551), 'users_id': 2}
2025-03-29 16:47:56,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:58,030 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:58,030 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:58,030 - sqlalchemy.engine.Engine - INFO - [cached since 1512s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:47:58,031 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:58,031 - sqlalchemy.engine.Engine - INFO - [cached since 1512s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 58, 31625), 'users_id': 3}
2025-03-29 16:47:58,031 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:47:59,164 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:47:59,164 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:47:59,164 - sqlalchemy.engine.Engine - INFO - [cached since 1513s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:47:59,165 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:47:59,165 - sqlalchemy.engine.Engine - INFO - [cached since 1513s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 47, 59, 165218), 'users_id': 3}
2025-03-29 16:47:59,165 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:08,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:08,143 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:08,143 - sqlalchemy.engine.Engine - INFO - [cached since 1522s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:08,144 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:08,144 - sqlalchemy.engine.Engine - INFO - [cached since 1522s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 8, 144976), 'users_id': 2}
2025-03-29 16:48:08,144 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:16,301 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:48:16,301 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:48:16,301 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:48:16,302 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:48:16,302 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:48:16,303 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:48:16,303 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:48:16,304 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:48:22,876 - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:22.876354", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:48:22,876 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:22.876354", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:48:22,877 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 16:48:22,877 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 16:48:23,300 - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:23.300260", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:48:23,300 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:23.300260", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:48:23,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:23,302 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:23,302 - sqlalchemy.engine.Engine - INFO - [cached since 986.3s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'b5wV6fb1NZFnW7GWyEmN62vPJNWHCb9M7TtssDd4N1k', 'param_1': 1}
2025-03-29 16:48:23,303 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:48:23,303 - sqlalchemy.engine.Engine - INFO - [cached since 986.3s ago] {'refresh_token': '9qu9hph-wR56KUqnBTYL9BNBJt7B8Gfyh9N61HOzRJg', 'user_devices_id': 9}
2025-03-29 16:48:23,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:23,308 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:48:23,308 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 16:48:23,377 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:48:23,377 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:48:23,378 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:48:23,378 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:48:23,378 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:48:23,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:23,379 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:23,379 - sqlalchemy.engine.Engine - INFO - [cached since 1537s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:23,380 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:23,380 - sqlalchemy.engine.Engine - INFO - [cached since 1537s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 23, 380341), 'users_id': 2}
2025-03-29 16:48:23,381 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:23,381 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:48:24,200 - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:24.200313", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:48:24,200 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:24.200313", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:48:24,201 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 906c8f35-b1c8-4e85-a991-936dd3264fb0
2025-03-29 16:48:24,201 - app.services.secure_channel_service - INFO - Creating channel with ID: 906c8f35-b1c8-4e85-a991-936dd3264fb0
2025-03-29 16:48:24,202 - app.services.secure_channel_service - INFO - Channel 906c8f35-b1c8-4e85-a991-936dd3264fb0 saved to Redis with TTL 1800 seconds
2025-03-29 16:48:24,203 - app.api.v1.endpoints.auth - INFO - Channel 906c8f35-b1c8-4e85-a991-936dd3264fb0 initialized successfully
2025-03-29 16:48:24,203 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:48:24,203 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:48:26,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:26,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1540s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:26,478 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:26,478 - sqlalchemy.engine.Engine - INFO - [cached since 1540s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 26, 478908), 'users_id': 2}
2025-03-29 16:48:26,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:28,040 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:28,040 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:28,040 - sqlalchemy.engine.Engine - INFO - [cached since 1542s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:28,041 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:28,041 - sqlalchemy.engine.Engine - INFO - [cached since 1542s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 28, 41252), 'users_id': 3}
2025-03-29 16:48:28,042 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:29,058 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:29,059 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:29,059 - sqlalchemy.engine.Engine - INFO - [cached since 1543s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:29,060 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:29,060 - sqlalchemy.engine.Engine - INFO - [cached since 1543s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 29, 59404), 'users_id': 3}
2025-03-29 16:48:29,060 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:31,169 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:31,169 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:31,170 - sqlalchemy.engine.Engine - INFO - [cached since 1545s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:31,170 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:31,170 - sqlalchemy.engine.Engine - INFO - [cached since 1545s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 31, 170626), 'users_id': 2}
2025-03-29 16:48:31,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:31,176 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 2
2025-03-29 16:48:34,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:34,569 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:34,569 - sqlalchemy.engine.Engine - INFO - [cached since 1548s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:34,570 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:34,570 - sqlalchemy.engine.Engine - INFO - [cached since 1548s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 34, 570749), 'users_id': 2}
2025-03-29 16:48:34,570 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:34,576 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:34,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:34,576 - sqlalchemy.engine.Engine - INFO - [cached since 1548s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:34,577 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:34,577 - sqlalchemy.engine.Engine - INFO - [cached since 1548s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:34,578 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:48:34,578 - app.api.v1.endpoints.websocket - INFO - Generated chat_id e83062fb-41d3-4db7-b3cb-8cde0c49a149 for users 2 and 3
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:48:34,578 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:48:34,579 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:48:34,579 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:48:34,579 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:48:53,371 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:53,371 - sqlalchemy.engine.Engine - INFO - [cached since 1567s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:53,372 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:53,372 - sqlalchemy.engine.Engine - INFO - [cached since 1567s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 53, 372556), 'users_id': 2}
2025-03-29 16:48:53,373 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:55,944 - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:55.944861", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:48:55,944 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:48:55.944861", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:48:55,946 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:55,946 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:55,946 - sqlalchemy.engine.Engine - INFO - [cached since 1570s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:55,947 - app.api.v1.endpoints.users - INFO - Search request received, channel: cf88b9bd-64f5-4490-9585-301e1a28f94d
2025-03-29 16:48:55,947 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743257757}
2025-03-29 16:48:55,948 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 16:48:55,948 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 16:48:55,949 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 16:48:55,949 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:48:55,949 - sqlalchemy.engine.Engine - INFO - [cached since 1481s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 16:48:55,950 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:48:55,950 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:48:55,951 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:48:55,951 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 16:48:55,951 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 16:48:56,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:56,476 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:56,476 - sqlalchemy.engine.Engine - INFO - [cached since 1570s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:56,477 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1570s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 56, 477941), 'users_id': 2}
2025-03-29 16:48:56,478 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:57,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:57,771 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:57,771 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:57,772 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:57,772 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 57, 772905), 'users_id': 3}
2025-03-29 16:48:57,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:57,777 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:57,777 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:57,778 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:57,778 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:57,779 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:57,779 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 16:48:57,779 - app.api.v1.endpoints.websocket - INFO - Generated chat_id a1b47c55-b62b-4178-887d-f32a55b2cdbe for users 3 and 2
2025-03-29 16:48:57,779 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:48:57,779 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:48:57,779 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:48:57,779 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:48:57,780 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:48:57,780 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:48:57,780 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:48:57,780 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:48:57,780 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:48:57,780 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:48:58,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:58,050 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:58,051 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:58,051 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 58, 51056), 'users_id': 3}
2025-03-29 16:48:58,052 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:58,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:58,600 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:58,600 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:48:58,601 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:58,601 - sqlalchemy.engine.Engine - INFO - [cached since 1572s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 58, 601341), 'users_id': 2}
2025-03-29 16:48:58,602 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:48:58,602 - app.api.v1.endpoints.websocket - WARNING - Missing recipient_id in key exchange from user 2
2025-03-29 16:48:59,038 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:48:59,038 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:48:59,038 - sqlalchemy.engine.Engine - INFO - [cached since 1573s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:48:59,039 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:48:59,039 - sqlalchemy.engine.Engine - INFO - [cached since 1573s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 48, 59, 39664), 'users_id': 3}
2025-03-29 16:48:59,040 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:23,371 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:23,372 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:23,372 - sqlalchemy.engine.Engine - INFO - [cached since 1597s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:49:23,372 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:23,373 - sqlalchemy.engine.Engine - INFO - [cached since 1597s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 23, 372997), 'users_id': 2}
2025-03-29 16:49:23,373 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:26,496 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:26,497 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:26,497 - sqlalchemy.engine.Engine - INFO - [cached since 1600s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:49:26,498 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:26,498 - sqlalchemy.engine.Engine - INFO - [cached since 1600s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 26, 497382), 'users_id': 2}
2025-03-29 16:49:26,498 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:28,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:28,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:28,032 - sqlalchemy.engine.Engine - INFO - [cached since 1602s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:49:28,033 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:28,033 - sqlalchemy.engine.Engine - INFO - [cached since 1602s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 28, 33936), 'users_id': 3}
2025-03-29 16:49:28,034 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:29,048 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:29,048 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:29,048 - sqlalchemy.engine.Engine - INFO - [cached since 1603s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:49:29,049 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:29,049 - sqlalchemy.engine.Engine - INFO - [cached since 1603s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 29, 49836), 'users_id': 3}
2025-03-29 16:49:29,049 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:53,371 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:53,371 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:53,371 - sqlalchemy.engine.Engine - INFO - [cached since 1627s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:49:53,372 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:53,372 - sqlalchemy.engine.Engine - INFO - [cached since 1627s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 53, 372296), 'users_id': 2}
2025-03-29 16:49:53,373 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:56,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:56,476 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:56,476 - sqlalchemy.engine.Engine - INFO - [cached since 1630s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:49:56,477 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:56,477 - sqlalchemy.engine.Engine - INFO - [cached since 1630s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 56, 477821), 'users_id': 2}
2025-03-29 16:49:56,478 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:58,031 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:58,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:58,032 - sqlalchemy.engine.Engine - INFO - [cached since 1632s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:49:58,033 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:58,033 - sqlalchemy.engine.Engine - INFO - [cached since 1632s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 58, 32915), 'users_id': 3}
2025-03-29 16:49:58,033 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:49:59,037 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:49:59,037 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:49:59,037 - sqlalchemy.engine.Engine - INFO - [cached since 1633s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:49:59,038 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:49:59,038 - sqlalchemy.engine.Engine - INFO - [cached since 1633s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 49, 59, 38775), 'users_id': 3}
2025-03-29 16:49:59,039 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:23,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:23,372 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:23,372 - sqlalchemy.engine.Engine - INFO - [cached since 1657s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:50:23,373 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:23,373 - sqlalchemy.engine.Engine - INFO - [cached since 1657s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 23, 373958), 'users_id': 2}
2025-03-29 16:50:23,374 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:26,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:26,475 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1660s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:50:26,477 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1660s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 26, 477000), 'users_id': 2}
2025-03-29 16:50:26,477 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:28,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:28,021 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:28,021 - sqlalchemy.engine.Engine - INFO - [cached since 1662s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:50:28,022 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:28,022 - sqlalchemy.engine.Engine - INFO - [cached since 1662s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 28, 22018), 'users_id': 3}
2025-03-29 16:50:28,023 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:29,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:29,043 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:29,044 - sqlalchemy.engine.Engine - INFO - [cached since 1663s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:50:29,044 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:29,045 - sqlalchemy.engine.Engine - INFO - [cached since 1663s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 29, 44084), 'users_id': 3}
2025-03-29 16:50:29,045 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:47,908 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:47,908 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:47,908 - sqlalchemy.engine.Engine - INFO - [cached since 1682s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:50:47,909 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:47,909 - sqlalchemy.engine.Engine - INFO - [cached since 1682s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 47, 909065), 'users_id': 2}
2025-03-29 16:50:47,910 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:47,915 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 2
2025-03-29 16:50:48,866 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:48,866 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:48,866 - sqlalchemy.engine.Engine - INFO - [cached since 1683s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:50:48,867 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:48,867 - sqlalchemy.engine.Engine - INFO - [cached since 1683s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 48, 867237), 'users_id': 2}
2025-03-29 16:50:48,867 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:48,873 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 2
2025-03-29 16:50:50,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:50,851 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:50,851 - sqlalchemy.engine.Engine - INFO - [cached since 1685s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:50:50,852 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:50,852 - sqlalchemy.engine.Engine - INFO - [cached since 1685s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 50, 852452), 'users_id': 3}
2025-03-29 16:50:50,852 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:50,857 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 3
2025-03-29 16:50:53,385 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:53,386 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:53,386 - sqlalchemy.engine.Engine - INFO - [cached since 1687s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:50:53,386 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:53,387 - sqlalchemy.engine.Engine - INFO - [cached since 1687s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 53, 386909), 'users_id': 2}
2025-03-29 16:50:53,387 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:56,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:56,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1690s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:50:56,479 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:56,479 - sqlalchemy.engine.Engine - INFO - [cached since 1690s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 56, 479531), 'users_id': 2}
2025-03-29 16:50:56,480 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:58,033 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:58,034 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:58,034 - sqlalchemy.engine.Engine - INFO - [cached since 1692s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:50:58,035 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:58,035 - sqlalchemy.engine.Engine - INFO - [cached since 1692s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 58, 35932), 'users_id': 3}
2025-03-29 16:50:58,036 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:50:59,048 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:50:59,048 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:50:59,048 - sqlalchemy.engine.Engine - INFO - [cached since 1693s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:50:59,049 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:50:59,049 - sqlalchemy.engine.Engine - INFO - [cached since 1693s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 50, 59, 49270), 'users_id': 3}
2025-03-29 16:50:59,050 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:23,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:23,372 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:23,373 - sqlalchemy.engine.Engine - INFO - [cached since 1717s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:51:23,374 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:23,374 - sqlalchemy.engine.Engine - INFO - [cached since 1717s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 23, 374744), 'users_id': 2}
2025-03-29 16:51:23,375 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:26,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:26,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1720s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:51:26,478 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:26,478 - sqlalchemy.engine.Engine - INFO - [cached since 1720s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 26, 478675), 'users_id': 2}
2025-03-29 16:51:26,478 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:28,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:28,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:28,032 - sqlalchemy.engine.Engine - INFO - [cached since 1722s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:51:28,033 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:28,033 - sqlalchemy.engine.Engine - INFO - [cached since 1722s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 28, 33269), 'users_id': 3}
2025-03-29 16:51:28,033 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:29,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:29,049 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:29,049 - sqlalchemy.engine.Engine - INFO - [cached since 1723s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:51:29,050 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:29,050 - sqlalchemy.engine.Engine - INFO - [cached since 1723s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 29, 50507), 'users_id': 3}
2025-03-29 16:51:29,051 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:53,371 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:53,371 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:53,372 - sqlalchemy.engine.Engine - INFO - [cached since 1747s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:51:53,372 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:53,373 - sqlalchemy.engine.Engine - INFO - [cached since 1747s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 53, 372529), 'users_id': 2}
2025-03-29 16:51:53,373 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:56,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:56,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:56,477 - sqlalchemy.engine.Engine - INFO - [cached since 1750s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:51:56,478 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1750s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 56, 478318), 'users_id': 2}
2025-03-29 16:51:56,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:58,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:58,021 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:58,021 - sqlalchemy.engine.Engine - INFO - [cached since 1752s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:51:58,022 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:58,022 - sqlalchemy.engine.Engine - INFO - [cached since 1752s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 58, 22192), 'users_id': 3}
2025-03-29 16:51:58,022 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:51:59,102 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:51:59,102 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:51:59,103 - sqlalchemy.engine.Engine - INFO - [cached since 1753s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:51:59,104 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:51:59,104 - sqlalchemy.engine.Engine - INFO - [cached since 1753s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 51, 59, 103193), 'users_id': 3}
2025-03-29 16:51:59,104 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:52:04,077 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:52:04,077 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:52:04,077 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:52:04,078 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:52:04,112 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:52:04,112 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:52:04,112 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:52:04,113 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:52:26,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:52:26,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:52:26,477 - sqlalchemy.engine.Engine - INFO - [cached since 1780s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:52:26,478 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:52:26,478 - sqlalchemy.engine.Engine - INFO - [cached since 1780s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 52, 26, 478660), 'users_id': 2}
2025-03-29 16:52:26,478 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:52:29,088 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:52:29,089 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:52:29,089 - sqlalchemy.engine.Engine - INFO - [cached since 1783s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:52:29,090 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:52:29,090 - sqlalchemy.engine.Engine - INFO - [cached since 1783s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 52, 29, 90258), 'users_id': 3}
2025-03-29 16:52:29,091 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:52:56,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:52:56,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:52:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1810s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:52:56,479 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:52:56,479 - sqlalchemy.engine.Engine - INFO - [cached since 1810s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 52, 56, 478471), 'users_id': 2}
2025-03-29 16:52:56,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:52:59,109 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:52:59,109 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:52:59,109 - sqlalchemy.engine.Engine - INFO - [cached since 1813s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:52:59,110 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:52:59,110 - sqlalchemy.engine.Engine - INFO - [cached since 1813s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 52, 59, 110072), 'users_id': 3}
2025-03-29 16:52:59,111 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:53:26,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:53:26,479 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:53:26,479 - sqlalchemy.engine.Engine - INFO - [cached since 1840s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:53:26,480 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:53:26,480 - sqlalchemy.engine.Engine - INFO - [cached since 1840s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 53, 26, 479399), 'users_id': 2}
2025-03-29 16:53:26,480 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:53:29,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:53:29,049 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:53:29,050 - sqlalchemy.engine.Engine - INFO - [cached since 1843s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:53:29,050 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:53:29,051 - sqlalchemy.engine.Engine - INFO - [cached since 1843s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 53, 29, 50701), 'users_id': 3}
2025-03-29 16:53:29,051 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:53:56,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:53:56,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:53:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1870s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:53:56,479 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:53:56,479 - sqlalchemy.engine.Engine - INFO - [cached since 1870s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 53, 56, 478779), 'users_id': 2}
2025-03-29 16:53:56,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:53:59,051 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:53:59,051 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:53:59,052 - sqlalchemy.engine.Engine - INFO - [cached since 1873s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:53:59,052 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:53:59,053 - sqlalchemy.engine.Engine - INFO - [cached since 1873s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 53, 59, 52363), 'users_id': 3}
2025-03-29 16:53:59,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:54:26,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:54:26,479 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:54:26,479 - sqlalchemy.engine.Engine - INFO - [cached since 1900s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:54:26,480 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:54:26,480 - sqlalchemy.engine.Engine - INFO - [cached since 1900s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 54, 26, 479227), 'users_id': 2}
2025-03-29 16:54:26,480 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:54:29,051 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:54:29,052 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:54:29,052 - sqlalchemy.engine.Engine - INFO - [cached since 1903s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:54:29,053 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:54:29,053 - sqlalchemy.engine.Engine - INFO - [cached since 1903s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 54, 29, 52900), 'users_id': 3}
2025-03-29 16:54:29,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:54:56,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:54:56,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:54:56,478 - sqlalchemy.engine.Engine - INFO - [cached since 1930s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:54:56,479 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:54:56,479 - sqlalchemy.engine.Engine - INFO - [cached since 1930s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 54, 56, 478580), 'users_id': 2}
2025-03-29 16:54:56,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:54:59,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:54:59,053 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:54:59,053 - sqlalchemy.engine.Engine - INFO - [cached since 1933s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:54:59,054 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:54:59,054 - sqlalchemy.engine.Engine - INFO - [cached since 1933s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 54, 59, 54934), 'users_id': 3}
2025-03-29 16:54:59,055 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:55:25,549 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:55:25,549 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:55:25,549 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 16:55:25,550 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:55:26,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:55:26,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:55:26,478 - sqlalchemy.engine.Engine - INFO - [cached since 1960s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:55:26,479 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:55:26,479 - sqlalchemy.engine.Engine - INFO - [cached since 1960s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 55, 26, 479387), 'users_id': 2}
2025-03-29 16:55:26,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:55:36,534 - INFO - Incoming request: {"timestamp": "2025-03-29T13:55:36.534893", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:55:36,534 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:55:36.534893", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:55:36,534 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:55:36,534 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:55:36,813 - INFO - Incoming request: {"timestamp": "2025-03-29T13:55:36.813111", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:55:36,813 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:55:36.813111", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:55:36,815 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:55:36,815 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:55:36,815 - sqlalchemy.engine.Engine - INFO - [cached since 1420s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': '5hulYuC44achedatpJJ94OI0_7dDjgi6z70PfkRJ2Ak', 'param_1': 1}
2025-03-29 16:55:36,816 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:55:36,816 - sqlalchemy.engine.Engine - INFO - [cached since 1420s ago] {'refresh_token': 'ko48UOr_TYLtuHSgkOAgfC0i5JjH9mX2VCBQVDkmQVw', 'user_devices_id': 10}
2025-03-29 16:55:36,817 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:55:36,822 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-29 16:55:36,822 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-29 16:55:37,980 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:55:37,981 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:55:37,981 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:55:37,982 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:55:37,982 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:55:37,982 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:55:37,982 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:55:37,982 - sqlalchemy.engine.Engine - INFO - [cached since 1972s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:55:37,983 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:55:37,983 - sqlalchemy.engine.Engine - INFO - [cached since 1972s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 55, 37, 983381), 'users_id': 3}
2025-03-29 16:55:37,984 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:55:37,984 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:55:37,985 - INFO - Incoming request: {"timestamp": "2025-03-29T13:55:37.985382", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:55:37,985 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:55:37.985382", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:55:37,986 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 7a6c0a91-735b-4291-ab08-bc967dab4f48
2025-03-29 16:55:37,986 - app.services.secure_channel_service - INFO - Creating channel with ID: 7a6c0a91-735b-4291-ab08-bc967dab4f48
2025-03-29 16:55:37,987 - app.services.secure_channel_service - INFO - Channel 7a6c0a91-735b-4291-ab08-bc967dab4f48 saved to Redis with TTL 1800 seconds
2025-03-29 16:55:37,987 - app.api.v1.endpoints.auth - INFO - Channel 7a6c0a91-735b-4291-ab08-bc967dab4f48 initialized successfully
2025-03-29 16:55:37,987 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 16:55:37,987 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 16:55:38,093 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:55:38,093 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:55:38,093 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 16:55:38,094 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:55:38,094 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:55:38,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:55:38,095 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:55:38,095 - sqlalchemy.engine.Engine - INFO - [cached since 1972s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:55:38,096 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:55:38,096 - sqlalchemy.engine.Engine - INFO - [cached since 1972s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 55, 38, 96407), 'users_id': 3}
2025-03-29 16:55:38,097 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:55:38,097 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:55:56,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:55:56,475 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:55:56,475 - sqlalchemy.engine.Engine - INFO - [cached since 1990s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:55:56,476 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:55:56,476 - sqlalchemy.engine.Engine - INFO - [cached since 1990s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 55, 56, 476607), 'users_id': 2}
2025-03-29 16:55:56,477 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:06,760 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:56:06,760 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:56:06,760 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:56:06,761 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:56:06,970 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:06,970 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:06,970 - sqlalchemy.engine.Engine - INFO - [cached since 2001s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:06,971 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:06,971 - sqlalchemy.engine.Engine - INFO - [cached since 2001s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 6, 971649), 'users_id': 3}
2025-03-29 16:56:06,971 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:07,938 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:07,938 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:07,939 - sqlalchemy.engine.Engine - INFO - [cached since 2002s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:07,939 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:07,940 - sqlalchemy.engine.Engine - INFO - [cached since 2002s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 7, 939161), 'users_id': 3}
2025-03-29 16:56:07,940 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:20,291 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:20.291384", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:20,291 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:20.291384", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:20,291 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:56:20,291 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 16:56:20,725 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:20.725622", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:20,725 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:20.725622", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:20,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:20,728 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:20,728 - sqlalchemy.engine.Engine - INFO - [cached since 1464s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': '9qu9hph-wR56KUqnBTYL9BNBJt7B8Gfyh9N61HOzRJg', 'param_1': 1}
2025-03-29 16:56:20,729 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:56:20,729 - sqlalchemy.engine.Engine - INFO - [cached since 1464s ago] {'refresh_token': '_wZ0l1zwCQiWhXQ5jy6zYOQEQQq9ANyIOpV2KaX-F9A', 'user_devices_id': 9}
2025-03-29 16:56:20,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:20,734 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.982000000000001}
2025-03-29 16:56:20,734 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.982000000000001}
2025-03-29 16:56:20,898 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:56:20,898 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:56:20,898 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:56:20,899 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:56:20,899 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:56:20,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:20,900 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:20,900 - sqlalchemy.engine.Engine - INFO - [cached since 2015s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:20,901 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:20,901 - sqlalchemy.engine.Engine - INFO - [cached since 2015s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 20, 901673), 'users_id': 2}
2025-03-29 16:56:20,902 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:20,902 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:56:22,338 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 16:56:22,338 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:56:22,338 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 16:56:22,339 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 16:56:22,339 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 16:56:22,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:22,340 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:22,340 - sqlalchemy.engine.Engine - INFO - [cached since 2016s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:22,341 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:22,341 - sqlalchemy.engine.Engine - INFO - [cached since 2016s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 22, 341087), 'users_id': 2}
2025-03-29 16:56:22,342 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:22,347 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 16:56:23,146 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:23.146529", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:23,146 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:23.146529", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:23,147 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c446f6a3-d41c-433f-a15f-663b64a549b0
2025-03-29 16:56:23,148 - app.services.secure_channel_service - INFO - Creating channel with ID: c446f6a3-d41c-433f-a15f-663b64a549b0
2025-03-29 16:56:23,148 - app.services.secure_channel_service - INFO - Channel c446f6a3-d41c-433f-a15f-663b64a549b0 saved to Redis with TTL 1800 seconds
2025-03-29 16:56:23,149 - app.api.v1.endpoints.auth - INFO - Channel c446f6a3-d41c-433f-a15f-663b64a549b0 initialized successfully
2025-03-29 16:56:23,149 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:56:23,149 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:56:33,580 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:33.580130", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:33,580 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:33.580130", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 16:56:33,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:33,582 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:33,582 - sqlalchemy.engine.Engine - INFO - [cached since 2027s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:33,583 - app.api.v1.endpoints.users - INFO - Search request received, channel: c446f6a3-d41c-433f-a15f-663b64a549b0
2025-03-29 16:56:33,583 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743258380}
2025-03-29 16:56:33,584 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mirai","limit":10}
2025-03-29 16:56:33,585 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mirai', 'limit': 10}
2025-03-29 16:56:33,585 - app.api.v1.endpoints.users - INFO - Searching users with query 'mirai', excluding user 2
2025-03-29 16:56:33,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:56:33,585 - sqlalchemy.engine.Engine - INFO - [cached since 1939s ago] {'id_1': '2', 'username_1': '%mirai%', 'email_1': '%mirai%', 'param_1': 10}
2025-03-29 16:56:33,586 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:56:33,586 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:56:33,587 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:56:33,587 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 16:56:33,587 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 16:56:35,319 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:35,319 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:35,319 - sqlalchemy.engine.Engine - INFO - [cached since 2029s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:35,321 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:35,321 - sqlalchemy.engine.Engine - INFO - [cached since 2029s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 35, 320188), 'users_id': 2}
2025-03-29 16:56:35,321 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:35,322 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:35,322 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:35,322 - sqlalchemy.engine.Engine - INFO - [cached since 2029s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:35,323 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:35,323 - sqlalchemy.engine.Engine - INFO - [cached since 2029s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:35,323 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:56:35,323 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 7c24225d-4a69-4e8d-bb20-c3d7ff3acfd9 for users 2 and 3
2025-03-29 16:56:35,323 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:56:35,323 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:56:35,324 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:56:36,873 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:36,873 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:36,874 - sqlalchemy.engine.Engine - INFO - [cached since 2031s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:36,875 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:36,875 - sqlalchemy.engine.Engine - INFO - [cached since 2031s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 36, 874203), 'users_id': 3}
2025-03-29 16:56:36,875 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:37,902 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:37,902 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:37,902 - sqlalchemy.engine.Engine - INFO - [cached since 2032s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:37,903 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:37,903 - sqlalchemy.engine.Engine - INFO - [cached since 2032s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 37, 903332), 'users_id': 3}
2025-03-29 16:56:37,903 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:43,988 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:56:43,989 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:56:43,989 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:56:43,990 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:56:49,685 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:56:49,685 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 16:56:49,685 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:56:49,686 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:56:50,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:50,801 - sqlalchemy.engine.Engine - INFO - [cached since 2045s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:50,802 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:50,802 - sqlalchemy.engine.Engine - INFO - [cached since 2045s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 50, 802232), 'users_id': 2}
2025-03-29 16:56:50,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:50,923 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:50.923421", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:56:50,923 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:50.923421", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:56:50,924 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:56:50,924 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:56:51,237 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:51.237516", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:56:51,237 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:51.237516", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:56:51,238 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:51,238 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:51,239 - sqlalchemy.engine.Engine - INFO - [cached since 1494s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'ko48UOr_TYLtuHSgkOAgfC0i5JjH9mX2VCBQVDkmQVw', 'param_1': 1}
2025-03-29 16:56:51,240 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:56:51,240 - sqlalchemy.engine.Engine - INFO - [cached since 1494s ago] {'refresh_token': '-nQOlrM5NJJmMnyLqp9HvyGkGTDCbbqQHafXosO_LKo', 'user_devices_id': 10}
2025-03-29 16:56:51,240 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:51,241 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.994}
2025-03-29 16:56:51,241 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.994}
2025-03-29 16:56:51,300 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:56:51,300 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:56:51,300 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:56:51,301 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:56:51,301 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:56:51,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:51,301 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:51,302 - sqlalchemy.engine.Engine - INFO - [cached since 2045s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:51,302 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:51,302 - sqlalchemy.engine.Engine - INFO - [cached since 2045s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 51, 302530), 'users_id': 3}
2025-03-29 16:56:51,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:51,303 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:56:52,189 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:56:52,190 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:56:52,190 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:56:52,191 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:56:52,191 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:56:52,191 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:52,191 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:52,191 - sqlalchemy.engine.Engine - INFO - [cached since 2046s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:52,192 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:52,192 - sqlalchemy.engine.Engine - INFO - [cached since 2046s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 52, 192963), 'users_id': 3}
2025-03-29 16:56:52,193 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:52,195 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:56:52,279 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:52,279 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:52,279 - sqlalchemy.engine.Engine - INFO - [cached since 2046s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:52,281 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:52,281 - sqlalchemy.engine.Engine - INFO - [cached since 2046s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 52, 281983), 'users_id': 2}
2025-03-29 16:56:52,282 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:52,282 - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:52.282983", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:56:52,282 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:56:52.282983", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:56:52,283 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: bb94dbaa-ab60-4966-b21b-ddddd656a1ef
2025-03-29 16:56:52,283 - app.services.secure_channel_service - INFO - Creating channel with ID: bb94dbaa-ab60-4966-b21b-ddddd656a1ef
2025-03-29 16:56:52,284 - app.services.secure_channel_service - INFO - Channel bb94dbaa-ab60-4966-b21b-ddddd656a1ef saved to Redis with TTL 1800 seconds
2025-03-29 16:56:52,285 - app.api.v1.endpoints.auth - INFO - Channel bb94dbaa-ab60-4966-b21b-ddddd656a1ef initialized successfully
2025-03-29 16:56:52,285 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:56:52,285 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:56:58,471 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:58,471 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:58,471 - sqlalchemy.engine.Engine - INFO - [cached since 2052s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:58,472 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:56:58,472 - sqlalchemy.engine.Engine - INFO - [cached since 2052s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 56, 58, 472359), 'users_id': 2}
2025-03-29 16:56:58,473 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:56:58,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:56:58,474 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:58,474 - sqlalchemy.engine.Engine - INFO - [cached since 2052s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:56:58,475 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:56:58,475 - sqlalchemy.engine.Engine - INFO - [cached since 2052s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:56:58,475 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 16:56:58,475 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 650b441a-7f20-4b41-836a-8b13301dab28 for users 2 and 3
2025-03-29 16:56:58,475 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:56:58,476 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:57:20,501 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 16:57:20,501 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:57:20,501 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 16:57:20,503 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 16:57:20,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:20,802 - sqlalchemy.engine.Engine - INFO - [cached since 2075s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:57:20,802 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:20,803 - sqlalchemy.engine.Engine - INFO - [cached since 2075s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 20, 802114), 'users_id': 2}
2025-03-29 16:57:20,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:22,001 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:22,002 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:22,002 - sqlalchemy.engine.Engine - INFO - [cached since 2076s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:22,003 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:22,003 - sqlalchemy.engine.Engine - INFO - [cached since 2076s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 22, 2789), 'users_id': 3}
2025-03-29 16:57:22,003 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:22,014 - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:22.014792", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:22,014 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:22.014792", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:22,015 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:57:22,015 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 16:57:22,269 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:22,269 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:22,269 - sqlalchemy.engine.Engine - INFO - [cached since 2076s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:57:22,270 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:22,270 - sqlalchemy.engine.Engine - INFO - [cached since 2076s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 22, 270236), 'users_id': 2}
2025-03-29 16:57:22,271 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:22,327 - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:22.327468", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:22,327 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:22.327468", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:22,328 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:22,329 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:22,329 - sqlalchemy.engine.Engine - INFO - [cached since 1525s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': '-nQOlrM5NJJmMnyLqp9HvyGkGTDCbbqQHafXosO_LKo', 'param_1': 1}
2025-03-29 16:57:22,330 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 16:57:22,330 - sqlalchemy.engine.Engine - INFO - [cached since 1525s ago] {'refresh_token': 'VuRFoFwf492A42sOWYkDeU19JEazk9nbohvgD4u6mkE', 'user_devices_id': 10}
2025-03-29 16:57:22,330 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:22,331 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 16:57:22,331 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 16:57:22,381 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 16:57:22,381 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:57:22,381 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 16:57:22,382 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 16:57:22,382 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 16:57:22,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:22,383 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:22,383 - sqlalchemy.engine.Engine - INFO - [cached since 2076s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:22,384 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:22,384 - sqlalchemy.engine.Engine - INFO - [cached since 2076s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 22, 383481), 'users_id': 3}
2025-03-29 16:57:22,384 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:22,384 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 16:57:22,967 - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:22.967887", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:22,967 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:22.967887", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:22,968 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 55a18625-4c43-4876-81d7-890506ebf207
2025-03-29 16:57:22,968 - app.services.secure_channel_service - INFO - Creating channel with ID: 55a18625-4c43-4876-81d7-890506ebf207
2025-03-29 16:57:22,969 - app.services.secure_channel_service - INFO - Channel 55a18625-4c43-4876-81d7-890506ebf207 saved to Redis with TTL 1800 seconds
2025-03-29 16:57:22,969 - app.api.v1.endpoints.auth - INFO - Channel 55a18625-4c43-4876-81d7-890506ebf207 initialized successfully
2025-03-29 16:57:22,970 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:57:22,970 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 16:57:25,782 - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:25.781292", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:25,782 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T13:57:25.781292", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 16:57:25,786 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:25,786 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:25,786 - sqlalchemy.engine.Engine - INFO - [cached since 2080s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:25,787 - app.api.v1.endpoints.users - INFO - Search request received, channel: 55a18625-4c43-4876-81d7-890506ebf207
2025-03-29 16:57:25,787 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743258442}
2025-03-29 16:57:25,788 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yude","limit":10}
2025-03-29 16:57:25,788 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yude', 'limit': 10}
2025-03-29 16:57:25,788 - app.api.v1.endpoints.users - INFO - Searching users with query 'yude', excluding user 3
2025-03-29 16:57:25,789 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 16:57:25,789 - sqlalchemy.engine.Engine - INFO - [cached since 1991s ago] {'id_1': '3', 'username_1': '%yude%', 'email_1': '%yude%', 'param_1': 10}
2025-03-29 16:57:25,789 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 16:57:25,790 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 16:57:25,790 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 16:57:25,791 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.022}
2025-03-29 16:57:25,791 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.022}
2025-03-29 16:57:27,813 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:27,813 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:27,813 - sqlalchemy.engine.Engine - INFO - [cached since 2082s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:27,814 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:27,814 - sqlalchemy.engine.Engine - INFO - [cached since 2082s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 27, 814048), 'users_id': 3}
2025-03-29 16:57:27,814 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:27,819 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:27,819 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:27,820 - sqlalchemy.engine.Engine - INFO - [cached since 2082s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:57:27,820 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:27,821 - sqlalchemy.engine.Engine - INFO - [cached since 2082s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:27,821 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 16:57:27,821 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 194c0ad8-d446-43c6-9549-000c473872ec for users 3 and 2
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 16:57:27,821 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 16:57:27,822 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 16:57:27,822 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 16:57:27,822 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 16:57:50,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:50,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:50,801 - sqlalchemy.engine.Engine - INFO - [cached since 2105s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:57:50,802 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:50,802 - sqlalchemy.engine.Engine - INFO - [cached since 2105s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 50, 802024), 'users_id': 2}
2025-03-29 16:57:50,802 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:52,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:52,013 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:52,013 - sqlalchemy.engine.Engine - INFO - [cached since 2106s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:52,014 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:52,014 - sqlalchemy.engine.Engine - INFO - [cached since 2106s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 52, 13554), 'users_id': 3}
2025-03-29 16:57:52,014 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:52,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:57:52,268 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:52,268 - sqlalchemy.engine.Engine - INFO - [cached since 2106s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:57:52,269 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:52,269 - sqlalchemy.engine.Engine - INFO - [cached since 2106s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 52, 269612), 'users_id': 2}
2025-03-29 16:57:52,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:57:52,375 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:57:52,375 - sqlalchemy.engine.Engine - INFO - [cached since 2106s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:57:52,376 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:57:52,376 - sqlalchemy.engine.Engine - INFO - [cached since 2106s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 57, 52, 376636), 'users_id': 3}
2025-03-29 16:57:52,376 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:20,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:20,800 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:20,800 - sqlalchemy.engine.Engine - INFO - [cached since 2135s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:58:20,801 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:20,802 - sqlalchemy.engine.Engine - INFO - [cached since 2135s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 20, 801603), 'users_id': 2}
2025-03-29 16:58:20,802 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:22,007 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:22,007 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:22,007 - sqlalchemy.engine.Engine - INFO - [cached since 2136s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:58:22,008 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:22,008 - sqlalchemy.engine.Engine - INFO - [cached since 2136s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 22, 8970), 'users_id': 3}
2025-03-29 16:58:22,009 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:22,269 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:22,269 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:22,269 - sqlalchemy.engine.Engine - INFO - [cached since 2136s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:58:22,270 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:22,270 - sqlalchemy.engine.Engine - INFO - [cached since 2136s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 22, 270029), 'users_id': 2}
2025-03-29 16:58:22,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:22,374 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:22,374 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:22,374 - sqlalchemy.engine.Engine - INFO - [cached since 2136s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:58:22,375 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:22,375 - sqlalchemy.engine.Engine - INFO - [cached since 2136s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 22, 375550), 'users_id': 3}
2025-03-29 16:58:22,375 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:50,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:50,800 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:50,800 - sqlalchemy.engine.Engine - INFO - [cached since 2165s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:58:50,801 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:50,801 - sqlalchemy.engine.Engine - INFO - [cached since 2165s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 50, 801966), 'users_id': 2}
2025-03-29 16:58:50,802 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:52,009 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:52,009 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:52,010 - sqlalchemy.engine.Engine - INFO - [cached since 2166s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:58:52,010 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:52,011 - sqlalchemy.engine.Engine - INFO - [cached since 2166s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 52, 10582), 'users_id': 3}
2025-03-29 16:58:52,011 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:52,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:52,268 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:52,268 - sqlalchemy.engine.Engine - INFO - [cached since 2166s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:58:52,269 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:52,270 - sqlalchemy.engine.Engine - INFO - [cached since 2166s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 52, 269780), 'users_id': 2}
2025-03-29 16:58:52,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:58:52,387 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:58:52,387 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:58:52,387 - sqlalchemy.engine.Engine - INFO - [cached since 2166s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:58:52,388 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:58:52,388 - sqlalchemy.engine.Engine - INFO - [cached since 2166s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 58, 52, 388807), 'users_id': 3}
2025-03-29 16:58:52,389 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:59:20,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:59:20,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:59:20,801 - sqlalchemy.engine.Engine - INFO - [cached since 2195s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:59:20,802 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:59:20,802 - sqlalchemy.engine.Engine - INFO - [cached since 2195s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 59, 20, 802638), 'users_id': 2}
2025-03-29 16:59:20,802 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:59:22,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:59:22,012 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:59:22,012 - sqlalchemy.engine.Engine - INFO - [cached since 2196s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:59:22,013 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:59:22,013 - sqlalchemy.engine.Engine - INFO - [cached since 2196s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 59, 22, 13482), 'users_id': 3}
2025-03-29 16:59:22,014 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:59:22,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:59:22,268 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:59:22,268 - sqlalchemy.engine.Engine - INFO - [cached since 2196s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 16:59:22,269 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:59:22,269 - sqlalchemy.engine.Engine - INFO - [cached since 2196s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 59, 22, 269539), 'users_id': 2}
2025-03-29 16:59:22,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:59:22,386 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:59:22,386 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:59:22,387 - sqlalchemy.engine.Engine - INFO - [cached since 2196s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:59:22,388 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:59:22,388 - sqlalchemy.engine.Engine - INFO - [cached since 2196s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 59, 22, 387596), 'users_id': 3}
2025-03-29 16:59:22,388 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:59:49,369 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:59:49,369 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 16:59:49,369 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:59:49,370 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 16:59:49,370 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 16:59:49,370 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 16:59:49,371 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:59:49,371 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 16:59:52,009 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:59:52,009 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:59:52,009 - sqlalchemy.engine.Engine - INFO - [cached since 2226s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:59:52,010 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:59:52,010 - sqlalchemy.engine.Engine - INFO - [cached since 2226s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 59, 52, 10539), 'users_id': 3}
2025-03-29 16:59:52,010 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 16:59:52,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 16:59:52,400 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 16:59:52,400 - sqlalchemy.engine.Engine - INFO - [cached since 2226s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 16:59:52,401 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 16:59:52,401 - sqlalchemy.engine.Engine - INFO - [cached since 2226s ago] {'last_seen': datetime.datetime(2025, 3, 29, 13, 59, 52, 401795), 'users_id': 3}
2025-03-29 16:59:52,402 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:00:22,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:00:22,010 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:00:22,010 - sqlalchemy.engine.Engine - INFO - [cached since 2256s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:00:22,011 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:00:22,011 - sqlalchemy.engine.Engine - INFO - [cached since 2256s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 0, 22, 11274), 'users_id': 3}
2025-03-29 17:00:22,012 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:00:22,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:00:22,389 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:00:22,389 - sqlalchemy.engine.Engine - INFO - [cached since 2256s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:00:22,390 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:00:22,390 - sqlalchemy.engine.Engine - INFO - [cached since 2256s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 0, 22, 390356), 'users_id': 3}
2025-03-29 17:00:22,391 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:00:52,013 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:00:52,013 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:00:52,013 - sqlalchemy.engine.Engine - INFO - [cached since 2286s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:00:52,014 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:00:52,014 - sqlalchemy.engine.Engine - INFO - [cached since 2286s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 0, 52, 14564), 'users_id': 3}
2025-03-29 17:00:52,015 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:00:52,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:00:52,393 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:00:52,393 - sqlalchemy.engine.Engine - INFO - [cached since 2286s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:00:52,394 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:00:52,394 - sqlalchemy.engine.Engine - INFO - [cached since 2286s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 0, 52, 394678), 'users_id': 3}
2025-03-29 17:00:52,395 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:01:22,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:01:22,010 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:01:22,010 - sqlalchemy.engine.Engine - INFO - [cached since 2316s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:01:22,011 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:01:22,012 - sqlalchemy.engine.Engine - INFO - [cached since 2316s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 1, 22, 11545), 'users_id': 3}
2025-03-29 17:01:22,012 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:01:22,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:01:22,389 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:01:22,389 - sqlalchemy.engine.Engine - INFO - [cached since 2316s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:01:22,390 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:01:22,390 - sqlalchemy.engine.Engine - INFO - [cached since 2316s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 1, 22, 390628), 'users_id': 3}
2025-03-29 17:01:22,391 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:01:52,013 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:01:52,013 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:01:52,014 - sqlalchemy.engine.Engine - INFO - [cached since 2346s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:01:52,015 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:01:52,015 - sqlalchemy.engine.Engine - INFO - [cached since 2346s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 1, 52, 14701), 'users_id': 3}
2025-03-29 17:01:52,015 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:01:52,387 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:01:52,387 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:01:52,387 - sqlalchemy.engine.Engine - INFO - [cached since 2346s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:01:52,388 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:01:52,388 - sqlalchemy.engine.Engine - INFO - [cached since 2346s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 1, 52, 388664), 'users_id': 3}
2025-03-29 17:01:52,389 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:22,035 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:02:22,036 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:02:22,036 - sqlalchemy.engine.Engine - INFO - [cached since 2376s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:02:22,037 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:02:22,037 - sqlalchemy.engine.Engine - INFO - [cached since 2376s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 2, 22, 36354), 'users_id': 3}
2025-03-29 17:02:22,037 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:22,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:02:22,390 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:02:22,390 - sqlalchemy.engine.Engine - INFO - [cached since 2376s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:02:22,391 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:02:22,391 - sqlalchemy.engine.Engine - INFO - [cached since 2376s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 2, 22, 391434), 'users_id': 3}
2025-03-29 17:02:22,391 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:46,471 - INFO - Incoming request: {"timestamp": "2025-03-29T14:02:46.471977", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:02:46,471 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:02:46.471977", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:02:46,472 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:02:46,473 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:02:46,473 - sqlalchemy.engine.Engine - INFO - [cached since 1850s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'VuRFoFwf492A42sOWYkDeU19JEazk9nbohvgD4u6mkE', 'param_1': 1}
2025-03-29 17:02:46,474 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:02:46,474 - sqlalchemy.engine.Engine - INFO - [cached since 1850s ago] {'refresh_token': 'halmRRxAxs6MGYkp8myon1WCNbgdzKJB0foeR-e3QXc', 'user_devices_id': 10}
2025-03-29 17:02:46,474 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:46,480 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.004}
2025-03-29 17:02:46,480 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.004}
2025-03-29 17:02:46,543 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:02:46,543 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:02:46,544 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 17:02:46,544 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:02:46,544 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:02:46,545 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:02:46,545 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:02:46,545 - sqlalchemy.engine.Engine - INFO - [cached since 2400s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:02:46,546 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:02:46,546 - sqlalchemy.engine.Engine - INFO - [cached since 2400s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 2, 46, 546996), 'users_id': 3}
2025-03-29 17:02:46,546 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:46,547 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:02:47,669 - INFO - Incoming request: {"timestamp": "2025-03-29T14:02:47.669192", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:02:47,669 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:02:47.669192", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:02:47,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:02:47,671 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:02:47,671 - sqlalchemy.engine.Engine - INFO - [cached since 1851s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'halmRRxAxs6MGYkp8myon1WCNbgdzKJB0foeR-e3QXc', 'param_1': 1}
2025-03-29 17:02:47,672 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:02:47,672 - sqlalchemy.engine.Engine - INFO - [cached since 1851s ago] {'refresh_token': 'XpD6w4NBcy0DXE_DjPdamNl5L0AcKP-SFVtLkK2w1nY', 'user_devices_id': 10}
2025-03-29 17:02:47,673 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:47,678 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:02:47,678 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:02:47,719 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:02:47,719 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:02:47,719 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 17:02:47,720 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:02:47,720 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:02:47,720 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:02:47,720 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:02:47,721 - sqlalchemy.engine.Engine - INFO - [cached since 2402s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:02:47,721 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:02:47,721 - sqlalchemy.engine.Engine - INFO - [cached since 2402s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 2, 47, 721204), 'users_id': 3}
2025-03-29 17:02:47,722 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:02:47,722 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:02:49,023 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:02:49,023 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:02:49,023 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:02:49,023 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:02:49,023 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:02:49,023 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:02:49,024 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:02:49,024 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:02:49,024 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:02:49,025 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:02:49,025 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:02:49,025 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:03:08,694 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:08.694132", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:08,694 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:08.694132", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:08,694 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:03:08,694 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:03:08,851 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:08.851168", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:08,851 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:08.851168", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:08,852 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:08,852 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:08,853 - sqlalchemy.engine.Engine - INFO - [cached since 1872s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': '_wZ0l1zwCQiWhXQ5jy6zYOQEQQq9ANyIOpV2KaX-F9A', 'param_1': 1}
2025-03-29 17:03:08,853 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:03:08,854 - sqlalchemy.engine.Engine - INFO - [cached since 1872s ago] {'refresh_token': 'ygXCkHA71BcKGqdNzcj2k2isLYiogJl_bFaXRqaD8UA', 'user_devices_id': 9}
2025-03-29 17:03:08,854 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:08,859 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.004000000000001}
2025-03-29 17:03:08,859 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.004000000000001}
2025-03-29 17:03:08,970 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:03:08,970 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:08,970 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 17:03:08,971 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:03:08,971 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:03:08,971 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:08,972 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:08,972 - sqlalchemy.engine.Engine - INFO - [cached since 2423s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:03:08,973 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:08,973 - sqlalchemy.engine.Engine - INFO - [cached since 2423s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 8, 972197), 'users_id': 2}
2025-03-29 17:03:08,973 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:08,974 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:03:10,297 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:03:10,297 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:10,297 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 17:03:10,299 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:03:10,299 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:03:10,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:10,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:10,300 - sqlalchemy.engine.Engine - INFO - [cached since 2424s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:03:10,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:10,301 - sqlalchemy.engine.Engine - INFO - [cached since 2424s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 10, 301000), 'users_id': 2}
2025-03-29 17:03:10,301 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:10,306 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:03:10,455 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:10.455771", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:10,455 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:10.455771", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:10,456 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9e2d4386-3fef-4156-a2a3-de5e847ec647
2025-03-29 17:03:10,456 - app.services.secure_channel_service - INFO - Creating channel with ID: 9e2d4386-3fef-4156-a2a3-de5e847ec647
2025-03-29 17:03:10,457 - app.services.secure_channel_service - INFO - Channel 9e2d4386-3fef-4156-a2a3-de5e847ec647 saved to Redis with TTL 1800 seconds
2025-03-29 17:03:10,458 - app.api.v1.endpoints.auth - INFO - Channel 9e2d4386-3fef-4156-a2a3-de5e847ec647 initialized successfully
2025-03-29 17:03:10,458 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 17:03:10,458 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 17:03:19,113 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:03:19,113 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:19,113 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:03:19,114 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:03:21,035 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:03:21,036 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:03:21,036 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:03:21,037 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:03:22,661 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:03:22,661 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 17:03:22,661 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:03:22,662 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:03:43,326 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:43.326382", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:43,326 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:43.326382", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:43,327 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:03:43,327 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:03:43,744 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:43.744709", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:43,744 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:43.744709", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:43,745 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:43,746 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:43,746 - sqlalchemy.engine.Engine - INFO - [cached since 1907s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'ygXCkHA71BcKGqdNzcj2k2isLYiogJl_bFaXRqaD8UA', 'param_1': 1}
2025-03-29 17:03:43,747 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:03:43,747 - sqlalchemy.engine.Engine - INFO - [cached since 1907s ago] {'refresh_token': 'xBtwMZu2PtfnWPoznhLCvrSYZyaCB06pj90TqdW4MJY', 'user_devices_id': 9}
2025-03-29 17:03:43,747 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:43,753 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.388}
2025-03-29 17:03:43,753 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.388}
2025-03-29 17:03:43,851 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:03:43,851 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:43,851 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 17:03:43,852 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:03:43,852 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:03:43,852 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:43,852 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:43,853 - sqlalchemy.engine.Engine - INFO - [cached since 2458s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:03:43,853 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:43,854 - sqlalchemy.engine.Engine - INFO - [cached since 2458s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 43, 853120), 'users_id': 2}
2025-03-29 17:03:43,854 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:43,855 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:03:44,699 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:03:44,699 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:44,699 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 17:03:44,700 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:03:44,700 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:03:44,700 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:44,701 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:44,701 - sqlalchemy.engine.Engine - INFO - [cached since 2458s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:03:44,702 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:44,702 - sqlalchemy.engine.Engine - INFO - [cached since 2458s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 44, 702746), 'users_id': 2}
2025-03-29 17:03:44,703 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:44,703 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:03:45,080 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:45.080832", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:45,080 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:45.080832", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:03:45,082 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: ea5c34bc-adb5-487a-861d-e9489868a1b4
2025-03-29 17:03:45,082 - app.services.secure_channel_service - INFO - Creating channel with ID: ea5c34bc-adb5-487a-861d-e9489868a1b4
2025-03-29 17:03:45,083 - app.services.secure_channel_service - INFO - Channel ea5c34bc-adb5-487a-861d-e9489868a1b4 saved to Redis with TTL 1800 seconds
2025-03-29 17:03:45,083 - app.api.v1.endpoints.auth - INFO - Channel ea5c34bc-adb5-487a-861d-e9489868a1b4 initialized successfully
2025-03-29 17:03:45,083 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 17:03:45,083 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 17:03:47,377 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:47.377032", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:47,377 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:47.377032", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:47,378 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:03:47,378 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:03:47,452 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:47.452602", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:47,452 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:47.452602", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:47,453 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:47,454 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:47,454 - sqlalchemy.engine.Engine - INFO - [cached since 1910s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'XpD6w4NBcy0DXE_DjPdamNl5L0AcKP-SFVtLkK2w1nY', 'param_1': 1}
2025-03-29 17:03:47,455 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:03:47,455 - sqlalchemy.engine.Engine - INFO - [cached since 1910s ago] {'refresh_token': 'P6ai7BQl5R00MRI31-IC3gQWzx6mHZuYylBPo80r2Ag', 'user_devices_id': 10}
2025-03-29 17:03:47,455 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:47,456 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:03:47,456 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:03:47,567 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:03:47,567 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:47,567 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:03:47,568 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:03:47,568 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:03:47,568 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:47,569 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:47,569 - sqlalchemy.engine.Engine - INFO - [cached since 2461s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:03:47,570 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:47,570 - sqlalchemy.engine.Engine - INFO - [cached since 2461s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 47, 569633), 'users_id': 3}
2025-03-29 17:03:47,570 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:47,570 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:03:48,661 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:03:48,662 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:03:48,662 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:03:48,662 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:03:48,663 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:03:48,663 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:48,663 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:48,663 - sqlalchemy.engine.Engine - INFO - [cached since 2462s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:03:48,664 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:48,664 - sqlalchemy.engine.Engine - INFO - [cached since 2462s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 48, 664687), 'users_id': 3}
2025-03-29 17:03:48,665 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:48,665 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:03:48,822 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:48.822723", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:48,822 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:48.822723", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:48,823 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: af1a9ce8-d263-470e-aaea-72fdbba69170
2025-03-29 17:03:48,823 - app.services.secure_channel_service - INFO - Creating channel with ID: af1a9ce8-d263-470e-aaea-72fdbba69170
2025-03-29 17:03:48,823 - app.services.secure_channel_service - INFO - Channel af1a9ce8-d263-470e-aaea-72fdbba69170 saved to Redis with TTL 1800 seconds
2025-03-29 17:03:48,824 - app.api.v1.endpoints.auth - INFO - Channel af1a9ce8-d263-470e-aaea-72fdbba69170 initialized successfully
2025-03-29 17:03:48,824 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 17:03:48,824 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 17:03:54,536 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:54.536251", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:54,536 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:54.536251", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:54,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:54,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:54,538 - sqlalchemy.engine.Engine - INFO - [cached since 2468s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:03:54,539 - app.api.v1.endpoints.users - INFO - Search request received, channel: af1a9ce8-d263-470e-aaea-72fdbba69170
2025-03-29 17:03:54,539 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743258827}
2025-03-29 17:03:54,540 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yude","limit":10}
2025-03-29 17:03:54,540 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yude', 'limit': 10}
2025-03-29 17:03:54,540 - app.api.v1.endpoints.users - INFO - Searching users with query 'yude', excluding user 3
2025-03-29 17:03:54,541 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 17:03:54,541 - sqlalchemy.engine.Engine - INFO - [cached since 2380s ago] {'id_1': '3', 'username_1': '%yude%', 'email_1': '%yude%', 'param_1': 10}
2025-03-29 17:03:54,542 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 17:03:54,542 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 17:03:54,543 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:03:54,543 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 17:03:54,543 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 17:03:54,779 - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:54.779315", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:54,779 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:03:54.779315", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:03:54,781 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:54,781 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:54,782 - sqlalchemy.engine.Engine - INFO - [cached since 2469s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:03:54,782 - app.api.v1.endpoints.users - INFO - Search request received, channel: af1a9ce8-d263-470e-aaea-72fdbba69170
2025-03-29 17:03:54,782 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743258827}
2025-03-29 17:03:54,783 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yudev","limit":10}
2025-03-29 17:03:54,783 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yudev', 'limit': 10}
2025-03-29 17:03:54,784 - app.api.v1.endpoints.users - INFO - Searching users with query 'yudev', excluding user 3
2025-03-29 17:03:54,784 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 17:03:54,784 - sqlalchemy.engine.Engine - INFO - [cached since 2380s ago] {'id_1': '3', 'username_1': '%yudev%', 'email_1': '%yudev%', 'param_1': 10}
2025-03-29 17:03:54,784 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 17:03:54,785 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 17:03:54,786 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:03:54,786 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 17:03:54,786 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 17:03:58,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:58,329 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:58,329 - sqlalchemy.engine.Engine - INFO - [cached since 2472s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:03:58,330 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:03:58,330 - sqlalchemy.engine.Engine - INFO - [cached since 2472s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 3, 58, 330891), 'users_id': 3}
2025-03-29 17:03:58,331 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:03:58,332 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:03:58,332 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:58,332 - sqlalchemy.engine.Engine - INFO - [cached since 2472s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:03:58,333 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:03:58,333 - sqlalchemy.engine.Engine - INFO - [cached since 2472s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:03:58,333 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 17:03:58,334 - app.api.v1.endpoints.websocket - INFO - Generated chat_id b0149a74-8f8b-4bca-bc77-c60b52110d0c for users 3 and 2
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 17:03:58,334 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 17:04:13,893 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:04:13,894 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:04:13,894 - sqlalchemy.engine.Engine - INFO - [cached since 2488s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:04:13,895 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:04:13,895 - sqlalchemy.engine.Engine - INFO - [cached since 2488s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 4, 13, 894667), 'users_id': 2}
2025-03-29 17:04:13,895 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:04:14,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:04:14,649 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:04:14,649 - sqlalchemy.engine.Engine - INFO - [cached since 2488s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:04:14,650 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:04:14,650 - sqlalchemy.engine.Engine - INFO - [cached since 2488s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 4, 14, 650446), 'users_id': 2}
2025-03-29 17:04:14,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:04:17,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:04:17,510 - sqlalchemy.engine.Engine - INFO - [cached since 2491s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:04:17,511 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:04:17,511 - sqlalchemy.engine.Engine - INFO - [cached since 2491s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 4, 17, 511658), 'users_id': 3}
2025-03-29 17:04:17,512 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:04:18,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:04:18,618 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:04:18,618 - sqlalchemy.engine.Engine - INFO - [cached since 2492s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:04:18,619 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:04:18,619 - sqlalchemy.engine.Engine - INFO - [cached since 2492s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 4, 18, 619449), 'users_id': 3}
2025-03-29 17:04:18,620 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:04:43,843 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:04:43,844 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:04:43,844 - sqlalchemy.engine.Engine - INFO - [cached since 2518s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:04:43,845 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:04:43,845 - sqlalchemy.engine.Engine - INFO - [cached since 2518s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 4, 43, 844184), 'users_id': 2}
2025-03-29 17:04:43,845 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:04:44,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:04:44,606 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:04:44,606 - sqlalchemy.engine.Engine - INFO - [cached since 2518s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:04:44,606 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:04:44,606 - sqlalchemy.engine.Engine - INFO - [cached since 2518s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 4, 44, 606356), 'users_id': 2}
2025-03-29 17:04:44,607 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:04:45,895 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:04:45,895 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:04:45,895 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:04:45,896 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:04:45,897 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:04:45,897 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:04:45,897 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:04:45,898 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:05:13,844 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:05:13,844 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:05:13,844 - sqlalchemy.engine.Engine - INFO - [cached since 2548s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:05:13,845 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:05:13,845 - sqlalchemy.engine.Engine - INFO - [cached since 2548s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 5, 13, 845951), 'users_id': 2}
2025-03-29 17:05:13,846 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:05:14,604 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:05:14,605 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:05:14,605 - sqlalchemy.engine.Engine - INFO - [cached since 2548s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:05:14,605 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:05:14,606 - sqlalchemy.engine.Engine - INFO - [cached since 2548s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 5, 14, 605630), 'users_id': 2}
2025-03-29 17:05:14,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:05:43,843 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:05:43,843 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:05:43,843 - sqlalchemy.engine.Engine - INFO - [cached since 2578s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:05:43,844 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:05:43,844 - sqlalchemy.engine.Engine - INFO - [cached since 2578s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 5, 43, 844390), 'users_id': 2}
2025-03-29 17:05:43,845 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:05:44,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:05:44,606 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:05:44,606 - sqlalchemy.engine.Engine - INFO - [cached since 2578s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:05:44,607 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:05:44,607 - sqlalchemy.engine.Engine - INFO - [cached since 2578s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 5, 44, 607906), 'users_id': 2}
2025-03-29 17:05:44,608 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:06:13,843 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:06:13,843 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:06:13,843 - sqlalchemy.engine.Engine - INFO - [cached since 2608s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:06:13,844 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:06:13,844 - sqlalchemy.engine.Engine - INFO - [cached since 2608s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 6, 13, 844685), 'users_id': 2}
2025-03-29 17:06:13,845 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:06:14,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:06:14,606 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:06:14,606 - sqlalchemy.engine.Engine - INFO - [cached since 2608s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:06:14,607 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:06:14,607 - sqlalchemy.engine.Engine - INFO - [cached since 2608s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 6, 14, 607562), 'users_id': 2}
2025-03-29 17:06:14,608 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:06:31,931 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:06:31,931 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:06:31,931 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:06:31,933 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:06:34,330 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:06:34,330 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 17:06:34,330 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:06:34,332 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:10:48,465 - INFO - Incoming request: {"timestamp": "2025-03-29T14:10:48.465132", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:10:48,465 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:10:48.465132", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:10:48,466 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 17:10:48,466 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 17:10:48,858 - INFO - Incoming request: {"timestamp": "2025-03-29T14:10:48.858230", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:10:48,858 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:10:48.858230", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:10:48,859 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:10:48,860 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:10:48,860 - sqlalchemy.engine.Engine - INFO - [cached since 2332s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'P6ai7BQl5R00MRI31-IC3gQWzx6mHZuYylBPo80r2Ag', 'param_1': 1}
2025-03-29 17:10:48,861 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:10:48,861 - sqlalchemy.engine.Engine - INFO - [cached since 2332s ago] {'refresh_token': 'Ubx310I0kGwzn5QeNa50gAi_wvNWjC4gut5-7jhUF5c', 'user_devices_id': 10}
2025-03-29 17:10:48,861 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:10:48,862 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:10:48,862 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:10:48,957 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:10:48,958 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:10:48,958 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 17:10:48,959 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:10:48,959 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:10:48,959 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:10:48,959 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:10:48,960 - sqlalchemy.engine.Engine - INFO - [cached since 2883s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:10:48,960 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:10:48,961 - sqlalchemy.engine.Engine - INFO - [cached since 2883s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 10, 48, 960253), 'users_id': 3}
2025-03-29 17:10:48,961 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:10:48,961 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:10:49,965 - INFO - Incoming request: {"timestamp": "2025-03-29T14:10:49.965482", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:10:49,965 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:10:49.965482", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:10:49,966 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 95a53482-eafe-4668-96e7-ec4f4e7966a8
2025-03-29 17:10:49,966 - app.services.secure_channel_service - INFO - Creating channel with ID: 95a53482-eafe-4668-96e7-ec4f4e7966a8
2025-03-29 17:10:49,967 - app.services.secure_channel_service - INFO - Channel 95a53482-eafe-4668-96e7-ec4f4e7966a8 saved to Redis with TTL 1800 seconds
2025-03-29 17:10:49,967 - app.api.v1.endpoints.auth - INFO - Channel 95a53482-eafe-4668-96e7-ec4f4e7966a8 initialized successfully
2025-03-29 17:10:49,968 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.002}
2025-03-29 17:10:49,968 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.002}
2025-03-29 17:10:50,070 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:10:50,071 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:10:50,071 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 17:10:50,071 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:10:50,071 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:10:50,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:10:50,072 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:10:50,072 - sqlalchemy.engine.Engine - INFO - [cached since 2884s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:10:50,073 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:10:50,073 - sqlalchemy.engine.Engine - INFO - [cached since 2884s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 10, 50, 73508), 'users_id': 3}
2025-03-29 17:10:50,073 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:10:50,078 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:10:57,415 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:10:57,416 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:10:57,416 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:10:57,417 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:11:10,103 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:11:10,103 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:11:10,104 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:11:10,105 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:11:11,867 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:11.867679", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:11,867 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:11.867679", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:11,867 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:11:11,867 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:11:12,168 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:12.168670", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:12,168 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:12.168670", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:12,170 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:12,170 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:12,170 - sqlalchemy.engine.Engine - INFO - [cached since 2355s ago] {'device_id_1': 'dccd89c8-48ab-4ab3-aa20-fd4f6eae4381', 'refresh_token_1': 'Ubx310I0kGwzn5QeNa50gAi_wvNWjC4gut5-7jhUF5c', 'param_1': 1}
2025-03-29 17:11:12,171 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:11:12,171 - sqlalchemy.engine.Engine - INFO - [cached since 2355s ago] {'refresh_token': 'kDHpHBxvaz6aWHApzGJPUn8m1KIhfykHOYKdNUnrYnA', 'user_devices_id': 10}
2025-03-29 17:11:12,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:12,177 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:11:12,177 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:11:12,254 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:11:12,254 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:11:12,254 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 17:11:12,255 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:11:12,255 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:11:12,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:12,256 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:12,256 - sqlalchemy.engine.Engine - INFO - [cached since 2906s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:11:12,256 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:11:12,257 - sqlalchemy.engine.Engine - INFO - [cached since 2906s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 11, 12, 256690), 'users_id': 3}
2025-03-29 17:11:12,257 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:12,257 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:11:13,277 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:13.277863", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:13,277 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:13.277863", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:13,280 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 2af062ab-535f-48f6-8caa-ed617cc39792
2025-03-29 17:11:13,280 - app.services.secure_channel_service - INFO - Creating channel with ID: 2af062ab-535f-48f6-8caa-ed617cc39792
2025-03-29 17:11:13,280 - app.services.secure_channel_service - INFO - Channel 2af062ab-535f-48f6-8caa-ed617cc39792 saved to Redis with TTL 1800 seconds
2025-03-29 17:11:13,280 - app.api.v1.endpoints.auth - INFO - Channel 2af062ab-535f-48f6-8caa-ed617cc39792 initialized successfully
2025-03-29 17:11:13,280 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.999}
2025-03-29 17:11:13,280 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.999}
2025-03-29 17:11:13,581 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:11:13,581 - app.services.connection_manager - INFO - User 3 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:11:13,581 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 17:11:13,582 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:11:13,582 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:11:13,583 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:13,583 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:13,583 - sqlalchemy.engine.Engine - INFO - [cached since 2907s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:11:13,584 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:11:13,584 - sqlalchemy.engine.Engine - INFO - [cached since 2907s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 11, 13, 583772), 'users_id': 3}
2025-03-29 17:11:13,584 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:13,590 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:11:42,257 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:42,257 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:42,258 - sqlalchemy.engine.Engine - INFO - [cached since 2936s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:11:42,258 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:11:42,259 - sqlalchemy.engine.Engine - INFO - [cached since 2936s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 11, 42, 258994), 'users_id': 3}
2025-03-29 17:11:42,259 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:43,542 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:43,542 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:43,542 - sqlalchemy.engine.Engine - INFO - [cached since 2937s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:11:43,543 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:11:43,543 - sqlalchemy.engine.Engine - INFO - [cached since 2937s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 11, 43, 543224), 'users_id': 3}
2025-03-29 17:11:43,543 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:52,018 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:52.018317", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:11:52,018 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:52.018317", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:11:52,019 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 17:11:52,019 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 17:11:52,111 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:52.111337", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:11:52,111 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:52.111337", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:11:52,113 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:52,113 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:52,113 - sqlalchemy.engine.Engine - INFO - [cached since 2395s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'xBtwMZu2PtfnWPoznhLCvrSYZyaCB06pj90TqdW4MJY', 'param_1': 1}
2025-03-29 17:11:52,114 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:11:52,114 - sqlalchemy.engine.Engine - INFO - [cached since 2395s ago] {'refresh_token': 'KHDzsrNaR5-d_OO91kKGDpcOZeAWZF5lKXs-7TlLr-o', 'user_devices_id': 9}
2025-03-29 17:11:52,114 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:52,120 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:11:52,120 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:11:52,274 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:11:52,274 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:11:52,274 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 17:11:52,275 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:11:52,275 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:11:52,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:52,275 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:52,275 - sqlalchemy.engine.Engine - INFO - [cached since 2946s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:11:52,276 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:11:52,276 - sqlalchemy.engine.Engine - INFO - [cached since 2946s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 11, 52, 276374), 'users_id': 2}
2025-03-29 17:11:52,277 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:52,278 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:11:52,820 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:52.820299", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:11:52,820 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:52.820299", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:11:52,822 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: f7e0b69d-cc91-4f8c-bfcf-ea596adfc993
2025-03-29 17:11:52,822 - app.services.secure_channel_service - INFO - Creating channel with ID: f7e0b69d-cc91-4f8c-bfcf-ea596adfc993
2025-03-29 17:11:52,823 - app.services.secure_channel_service - INFO - Channel f7e0b69d-cc91-4f8c-bfcf-ea596adfc993 saved to Redis with TTL 1800 seconds
2025-03-29 17:11:52,823 - app.api.v1.endpoints.auth - INFO - Channel f7e0b69d-cc91-4f8c-bfcf-ea596adfc993 initialized successfully
2025-03-29 17:11:52,823 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 17:11:52,823 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 17:11:53,837 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:11:53,838 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:11:53,838 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 17:11:53,839 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:11:53,839 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:11:53,839 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:53,839 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:53,839 - sqlalchemy.engine.Engine - INFO - [cached since 2948s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:11:53,840 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:11:53,840 - sqlalchemy.engine.Engine - INFO - [cached since 2948s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 11, 53, 840300), 'users_id': 2}
2025-03-29 17:11:53,841 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:11:53,846 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:11:59,572 - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:59.572199", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:59,572 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:11:59.572199", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:11:59,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:11:59,573 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:11:59,573 - sqlalchemy.engine.Engine - INFO - [cached since 2953s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:11:59,574 - app.api.v1.endpoints.users - INFO - Search request received, channel: 2af062ab-535f-48f6-8caa-ed617cc39792
2025-03-29 17:11:59,574 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743259272}
2025-03-29 17:11:59,575 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 17:11:59,575 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 17:11:59,575 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 17:11:59,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 17:11:59,576 - sqlalchemy.engine.Engine - INFO - [cached since 2865s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 17:11:59,576 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 17:11:59,577 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 17:11:59,577 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:11:59,578 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-29 17:11:59,578 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-29 17:12:02,191 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:02,191 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:02,191 - sqlalchemy.engine.Engine - INFO - [cached since 2956s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:12:02,192 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:02,192 - sqlalchemy.engine.Engine - INFO - [cached since 2956s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 2, 192895), 'users_id': 3}
2025-03-29 17:12:02,193 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:02,193 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:02,194 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:02,194 - sqlalchemy.engine.Engine - INFO - [cached since 2956s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:12:02,194 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:02,195 - sqlalchemy.engine.Engine - INFO - [cached since 2956s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:12:02,195 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 17:12:02,195 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 894324c6-030c-4a7f-bef4-41399472098a for users 3 and 2
2025-03-29 17:12:02,195 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 17:12:02,195 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 17:12:02,195 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 17:12:02,195 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 17:12:02,195 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 17:12:02,196 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 17:12:02,196 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 17:12:02,196 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 17:12:02,196 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 17:12:02,196 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 17:12:12,221 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:12,221 - sqlalchemy.engine.Engine - INFO - [cached since 2966s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:12:12,222 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:12,222 - sqlalchemy.engine.Engine - INFO - [cached since 2966s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 12, 222513), 'users_id': 3}
2025-03-29 17:12:12,222 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:13,564 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:13,565 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:13,565 - sqlalchemy.engine.Engine - INFO - [cached since 2967s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:12:13,566 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:13,566 - sqlalchemy.engine.Engine - INFO - [cached since 2967s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 13, 566534), 'users_id': 3}
2025-03-29 17:12:13,566 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:22,190 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:22,190 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:22,190 - sqlalchemy.engine.Engine - INFO - [cached since 2976s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:12:22,191 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:22,191 - sqlalchemy.engine.Engine - INFO - [cached since 2976s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 22, 191155), 'users_id': 2}
2025-03-29 17:12:22,191 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:23,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:23,782 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:23,782 - sqlalchemy.engine.Engine - INFO - [cached since 2978s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:12:23,783 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:23,783 - sqlalchemy.engine.Engine - INFO - [cached since 2978s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 23, 783373), 'users_id': 2}
2025-03-29 17:12:23,783 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:42,227 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:42,228 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:42,228 - sqlalchemy.engine.Engine - INFO - [cached since 2996s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:12:42,229 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:42,229 - sqlalchemy.engine.Engine - INFO - [cached since 2996s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 42, 228549), 'users_id': 3}
2025-03-29 17:12:42,229 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:43,466 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:43,466 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:43,466 - sqlalchemy.engine.Engine - INFO - [cached since 2997s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:12:43,467 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:43,467 - sqlalchemy.engine.Engine - INFO - [cached since 2997s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 43, 467737), 'users_id': 3}
2025-03-29 17:12:43,468 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:52,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:52,176 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:52,176 - sqlalchemy.engine.Engine - INFO - [cached since 3006s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:12:52,177 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:52,177 - sqlalchemy.engine.Engine - INFO - [cached since 3006s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 52, 176416), 'users_id': 2}
2025-03-29 17:12:52,177 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:12:53,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:12:53,772 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:12:53,772 - sqlalchemy.engine.Engine - INFO - [cached since 3008s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:12:53,773 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:12:53,773 - sqlalchemy.engine.Engine - INFO - [cached since 3008s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 12, 53, 773315), 'users_id': 2}
2025-03-29 17:12:53,774 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:12,229 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:12,230 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:12,230 - sqlalchemy.engine.Engine - INFO - [cached since 3026s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:13:12,231 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:12,231 - sqlalchemy.engine.Engine - INFO - [cached since 3026s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 12, 230375), 'users_id': 3}
2025-03-29 17:13:12,231 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:13,484 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:13,484 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:13,484 - sqlalchemy.engine.Engine - INFO - [cached since 3027s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:13:13,485 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:13,485 - sqlalchemy.engine.Engine - INFO - [cached since 3027s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 13, 485254), 'users_id': 3}
2025-03-29 17:13:13,486 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:22,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:22,175 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:22,175 - sqlalchemy.engine.Engine - INFO - [cached since 3036s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:13:22,176 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:22,177 - sqlalchemy.engine.Engine - INFO - [cached since 3036s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 22, 176544), 'users_id': 2}
2025-03-29 17:13:22,177 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:23,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:23,772 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:23,773 - sqlalchemy.engine.Engine - INFO - [cached since 3038s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:13:23,773 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:23,774 - sqlalchemy.engine.Engine - INFO - [cached since 3038s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 23, 773497), 'users_id': 2}
2025-03-29 17:13:23,774 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:31,245 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:13:31,246 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:13:31,246 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 17:13:31,247 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:13:36,446 - INFO - Incoming request: {"timestamp": "2025-03-29T14:13:36.446948", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:13:36,446 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:13:36.446948", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:13:36,447 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0150000000000001}
2025-03-29 17:13:36,447 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0150000000000001}
2025-03-29 17:13:36,864 - INFO - Incoming request: {"timestamp": "2025-03-29T14:13:36.864196", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:13:36,864 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:13:36.864196", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:13:36,866 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:36,866 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:36,866 - sqlalchemy.engine.Engine - INFO - [cached since 2500s ago] {'device_id_1': '22b5d08d-cad7-4c86-a460-dce2c09843bd', 'refresh_token_1': 'KHDzsrNaR5-d_OO91kKGDpcOZeAWZF5lKXs-7TlLr-o', 'param_1': 1}
2025-03-29 17:13:36,867 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:13:36,867 - sqlalchemy.engine.Engine - INFO - [cached since 2500s ago] {'refresh_token': '4AEvXHTB-bCn0uMP90TXLYm8nRLWfhJK6TZ_hCjhl1g', 'user_devices_id': 9}
2025-03-29 17:13:36,868 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:36,868 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:13:36,868 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:13:36,936 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:13:36,937 - app.services.connection_manager - INFO - User 2 connected to server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:13:36,937 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 17:13:36,937 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:13:36,937 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:13:36,938 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:36,938 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:36,938 - sqlalchemy.engine.Engine - INFO - [cached since 3051s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:13:36,939 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:36,939 - sqlalchemy.engine.Engine - INFO - [cached since 3051s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 36, 939213), 'users_id': 2}
2025-03-29 17:13:36,940 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:36,940 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:13:37,813 - INFO - Incoming request: {"timestamp": "2025-03-29T14:13:37.813462", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:13:37,813 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:13:37.813462", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:13:37,814 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9f933dd2-7058-4533-8596-9fc2ba7c3d0b
2025-03-29 17:13:37,814 - app.services.secure_channel_service - INFO - Creating channel with ID: 9f933dd2-7058-4533-8596-9fc2ba7c3d0b
2025-03-29 17:13:37,815 - app.services.secure_channel_service - INFO - Channel 9f933dd2-7058-4533-8596-9fc2ba7c3d0b saved to Redis with TTL 1800 seconds
2025-03-29 17:13:37,815 - app.api.v1.endpoints.auth - INFO - Channel 9f933dd2-7058-4533-8596-9fc2ba7c3d0b initialized successfully
2025-03-29 17:13:37,815 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 17:13:37,815 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 17:13:42,221 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:42,221 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:42,221 - sqlalchemy.engine.Engine - INFO - [cached since 3056s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:13:42,222 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:42,222 - sqlalchemy.engine.Engine - INFO - [cached since 3056s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 42, 222228), 'users_id': 3}
2025-03-29 17:13:42,223 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:43,452 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:43,452 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:43,452 - sqlalchemy.engine.Engine - INFO - [cached since 3057s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:13:43,453 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:43,453 - sqlalchemy.engine.Engine - INFO - [cached since 3057s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 43, 453309), 'users_id': 3}
2025-03-29 17:13:43,454 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:13:53,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:13:53,773 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:13:53,773 - sqlalchemy.engine.Engine - INFO - [cached since 3068s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:13:53,774 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:13:53,774 - sqlalchemy.engine.Engine - INFO - [cached since 3068s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 13, 53, 773545), 'users_id': 2}
2025-03-29 17:13:53,774 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:06,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:06,940 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:06,940 - sqlalchemy.engine.Engine - INFO - [cached since 3081s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:14:06,941 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:06,941 - sqlalchemy.engine.Engine - INFO - [cached since 3081s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 6, 940955), 'users_id': 2}
2025-03-29 17:14:06,941 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:12,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:12,231 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:12,231 - sqlalchemy.engine.Engine - INFO - [cached since 3086s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:14:12,232 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:12,232 - sqlalchemy.engine.Engine - INFO - [cached since 3086s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 12, 231957), 'users_id': 3}
2025-03-29 17:14:12,232 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:13,452 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:13,453 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:13,453 - sqlalchemy.engine.Engine - INFO - [cached since 3087s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:14:13,454 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:13,454 - sqlalchemy.engine.Engine - INFO - [cached since 3087s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 13, 453431), 'users_id': 3}
2025-03-29 17:14:13,454 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:23,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:23,773 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:23,773 - sqlalchemy.engine.Engine - INFO - [cached since 3098s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:14:23,774 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:23,774 - sqlalchemy.engine.Engine - INFO - [cached since 3098s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 23, 774356), 'users_id': 2}
2025-03-29 17:14:23,775 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:36,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:36,931 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:36,931 - sqlalchemy.engine.Engine - INFO - [cached since 3111s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:14:36,932 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:36,932 - sqlalchemy.engine.Engine - INFO - [cached since 3111s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 36, 932267), 'users_id': 2}
2025-03-29 17:14:36,933 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:42,223 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:42,223 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:42,223 - sqlalchemy.engine.Engine - INFO - [cached since 3116s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:14:42,224 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:42,224 - sqlalchemy.engine.Engine - INFO - [cached since 3116s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 42, 224753), 'users_id': 3}
2025-03-29 17:14:42,225 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:43,461 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:43,461 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:43,461 - sqlalchemy.engine.Engine - INFO - [cached since 3117s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:14:43,462 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:43,462 - sqlalchemy.engine.Engine - INFO - [cached since 3117s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 43, 462295), 'users_id': 3}
2025-03-29 17:14:43,463 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:53,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:14:53,773 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:14:53,773 - sqlalchemy.engine.Engine - INFO - [cached since 3128s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:14:53,774 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:14:53,774 - sqlalchemy.engine.Engine - INFO - [cached since 3128s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 14, 53, 774436), 'users_id': 2}
2025-03-29 17:14:53,775 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:14:59,318 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:14:59,318 - app.services.connection_manager - INFO - User 3 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:14:59,318 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:14:59,319 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:14:59,347 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:14:59,348 - app.services.connection_manager - INFO - User 2 disconnected from server 973eda8b-248e-4af1-924e-332d361711ff
2025-03-29 17:14:59,348 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:14:59,349 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:15:05,176 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:15:05,176 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 17:15:05,176 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:15:05,178 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:15:33,506 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:15:33,506 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:15:33,507 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:15:33,508 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:16:05,136 - app.main - INFO - Shutting down server...
2025-03-29 17:16:05,137 - app.main - INFO - Redis connections closed
2025-03-29 17:16:05,137 - app.main - INFO - Server shutdown completed
2025-03-29 17:16:12,194 - app.main - INFO - Starting up server...
2025-03-29 17:16:12,195 - app.main - INFO - Redis initialized
2025-03-29 17:16:12,243 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-29 17:16:12,244 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 17:16:12,244 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-29 17:16:12,244 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 17:16:12,245 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-29 17:16:12,245 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 17:16:12,248 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:12,248 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 17:16:12,248 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 17:16:12,255 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:16:12,256 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:12,257 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 17:16:12,257 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 17:16:12,257 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 17:16:12,257 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007667s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 17:16:12,258 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:12,258 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:12,259 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 17:16:12,259 - sqlalchemy.engine.Engine - INFO - [cached since 0.01096s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 17:16:12,259 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:16:12,259 - app.main - INFO - Database initialized
2025-03-29 17:16:12,303 - app.main - INFO - Server key pair generated
2025-03-29 17:16:12,304 - app.main - INFO - Server startup completed successfully
2025-03-29 17:16:16,764 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:16.764183", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:16,764 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:16.764183", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:16,764 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:16:16,764 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:16:25,193 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:25.193675", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:25,193 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:25.193675", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:25,196 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: eabacc1a-e216-4353-853e-fbb86b47e7eb
2025-03-29 17:16:25,196 - app.services.secure_channel_service - INFO - Creating channel with ID: eabacc1a-e216-4353-853e-fbb86b47e7eb
2025-03-29 17:16:25,200 - app.services.secure_channel_service - INFO - Channel eabacc1a-e216-4353-853e-fbb86b47e7eb saved to Redis with TTL 1800 seconds
2025-03-29 17:16:25,200 - app.api.v1.endpoints.auth - INFO - Channel eabacc1a-e216-4353-853e-fbb86b47e7eb initialized successfully
2025-03-29 17:16:25,200 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 17:16:25,200 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 17:16:25,366 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:25.366732", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:25,366 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:25.366732", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:25,368 - app.api.v1.endpoints.auth - INFO - Login request using channel: eabacc1a-e216-4353-853e-fbb86b47e7eb
2025-03-29 17:16:25,369 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"42bf9256-2ecf-435c-aeea-e383ed8d4d6f"}
2025-03-29 17:16:25,369 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '42bf9256-2ecf-435c-aeea-e383ed8d4d6f'}
2025-03-29 17:16:25,373 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:25,374 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:25,374 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-29 17:16:25,605 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:25,606 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] {'user_id_1': 2, 'device_id_1': '42bf9256-2ecf-435c-aeea-e383ed8d4d6f', 'param_1': 1}
2025-03-29 17:16:25,608 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 17:16:25,608 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'users_id': 2}
2025-03-29 17:16:25,609 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 17:16:25,609 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'user_id': 2, 'device_id': '42bf9256-2ecf-435c-aeea-e383ed8d4d6f', 'refresh_token': None, 'last_login': None}
2025-03-29 17:16:25,610 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-29 17:16:25,611 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:16:25,611 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] {'refresh_token': 'BGhg_6XbHW9kiiCvX7ulxSqNMOXZ2-M_azzprJrXGN8', 'user_devices_id': 11}
2025-03-29 17:16:25,611 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:25,616 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 17:16:25,616 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 17:16:25,617 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 17:16:25,618 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 252.056}
2025-03-29 17:16:25,618 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 252.056}
2025-03-29 17:16:26,460 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:26.460018", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:26,460 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:26.460018", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:16:26,461 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 1cadc76f-bb86-4332-849b-f2829c6393ea
2025-03-29 17:16:26,461 - app.services.secure_channel_service - INFO - Creating channel with ID: 1cadc76f-bb86-4332-849b-f2829c6393ea
2025-03-29 17:16:26,462 - app.services.secure_channel_service - INFO - Channel 1cadc76f-bb86-4332-849b-f2829c6393ea saved to Redis with TTL 1800 seconds
2025-03-29 17:16:26,462 - app.api.v1.endpoints.auth - INFO - Channel 1cadc76f-bb86-4332-849b-f2829c6393ea initialized successfully
2025-03-29 17:16:26,462 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 17:16:26,462 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 17:16:26,465 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:16:26,465 - app.services.connection_manager - INFO - User 2 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:16:26,465 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 17:16:26,467 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:16:26,467 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:16:26,468 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:26,469 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:26,469 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'id_1': '2', 'param_1': 1}
2025-03-29 17:16:26,470 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:16:26,470 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'last_seen': datetime.datetime(2025, 3, 29, 14, 16, 26, 469019), 'users_id': 2}
2025-03-29 17:16:26,470 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:26,475 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:16:27,803 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:16:27,804 - app.services.connection_manager - INFO - User 2 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:16:27,804 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 17:16:27,805 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:16:27,805 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:16:27,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:27,805 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:27,805 - sqlalchemy.engine.Engine - INFO - [cached since 1.337s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:16:27,806 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:16:27,807 - sqlalchemy.engine.Engine - INFO - [cached since 1.337s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 16, 27, 806225), 'users_id': 2}
2025-03-29 17:16:27,807 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:27,812 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:16:45,685 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:45.685287", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:45,685 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:45.685287", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:45,685 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:16:45,685 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 17:16:55,737 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:55.736877", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:55,737 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:55.736877", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:55,739 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 84a01709-098a-4bc5-a213-4fd91e8b2f12
2025-03-29 17:16:55,739 - app.services.secure_channel_service - INFO - Creating channel with ID: 84a01709-098a-4bc5-a213-4fd91e8b2f12
2025-03-29 17:16:55,740 - app.services.secure_channel_service - INFO - Channel 84a01709-098a-4bc5-a213-4fd91e8b2f12 saved to Redis with TTL 1800 seconds
2025-03-29 17:16:55,740 - app.api.v1.endpoints.auth - INFO - Channel 84a01709-098a-4bc5-a213-4fd91e8b2f12 initialized successfully
2025-03-29 17:16:55,740 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9880000000000004}
2025-03-29 17:16:55,740 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9880000000000004}
2025-03-29 17:16:55,913 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:55.913171", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:55,913 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:55.913171", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:55,914 - app.api.v1.endpoints.auth - INFO - Login request using channel: 84a01709-098a-4bc5-a213-4fd91e8b2f12
2025-03-29 17:16:55,915 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"e5c0d947-73b4-4ddb-aaab-4169d56801ad"}
2025-03-29 17:16:55,915 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': 'e5c0d947-73b4-4ddb-aaab-4169d56801ad'}
2025-03-29 17:16:55,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:55,916 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:55,916 - sqlalchemy.engine.Engine - INFO - [cached since 30.54s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-29 17:16:56,121 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:56,122 - sqlalchemy.engine.Engine - INFO - [cached since 30.52s ago] {'user_id_1': 3, 'device_id_1': 'e5c0d947-73b4-4ddb-aaab-4169d56801ad', 'param_1': 1}
2025-03-29 17:16:56,123 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 17:16:56,123 - sqlalchemy.engine.Engine - INFO - [cached since 30.51s ago] {'users_id': 3}
2025-03-29 17:16:56,123 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 17:16:56,123 - sqlalchemy.engine.Engine - INFO - [cached since 30.51s ago] {'user_id': 3, 'device_id': 'e5c0d947-73b4-4ddb-aaab-4169d56801ad', 'refresh_token': None, 'last_login': None}
2025-03-29 17:16:56,124 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-29 17:16:56,124 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:16:56,124 - sqlalchemy.engine.Engine - INFO - [cached since 30.51s ago] {'refresh_token': '-ZILypc_2MvW-ZgoinMwM7Srn_4dzaiw3Hd58iAf-k4', 'user_devices_id': 12}
2025-03-29 17:16:56,125 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:56,130 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 17:16:56,130 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 17:16:56,131 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 17:16:56,131 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 218.04999999999998}
2025-03-29 17:16:56,131 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 218.04999999999998}
2025-03-29 17:16:56,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:56,474 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:56,474 - sqlalchemy.engine.Engine - INFO - [cached since 30.01s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:16:56,475 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:16:56,475 - sqlalchemy.engine.Engine - INFO - [cached since 30.01s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 16, 56, 474967), 'users_id': 2}
2025-03-29 17:16:56,475 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:56,938 - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:56.938209", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:56,938 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:16:56.938209", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:16:57,040 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: af068d23-9bba-418f-9746-263750a6cf47
2025-03-29 17:16:57,040 - app.services.secure_channel_service - INFO - Creating channel with ID: af068d23-9bba-418f-9746-263750a6cf47
2025-03-29 17:16:57,040 - app.services.secure_channel_service - INFO - Channel af068d23-9bba-418f-9746-263750a6cf47 saved to Redis with TTL 1800 seconds
2025-03-29 17:16:57,040 - app.api.v1.endpoints.auth - INFO - Channel af068d23-9bba-418f-9746-263750a6cf47 initialized successfully
2025-03-29 17:16:57,041 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 103.02300000000001}
2025-03-29 17:16:57,041 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 103.02300000000001}
2025-03-29 17:16:57,113 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:16:57,113 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:16:57,113 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:16:57,114 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:16:57,114 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:16:57,115 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:57,115 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:57,115 - sqlalchemy.engine.Engine - INFO - [cached since 30.65s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:16:57,116 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:16:57,116 - sqlalchemy.engine.Engine - INFO - [cached since 30.65s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 16, 57, 116249), 'users_id': 3}
2025-03-29 17:16:57,117 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:57,122 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:16:57,564 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:16:57,564 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:16:57,564 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:16:57,565 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:16:57,565 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:16:57,565 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:57,565 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:57,565 - sqlalchemy.engine.Engine - INFO - [cached since 31.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:16:57,566 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:16:57,566 - sqlalchemy.engine.Engine - INFO - [cached since 31.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 16, 57, 566429), 'users_id': 3}
2025-03-29 17:16:57,567 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:16:57,572 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:16:57,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:16:57,752 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:16:57,752 - sqlalchemy.engine.Engine - INFO - [cached since 31.28s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:16:57,753 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:16:57,753 - sqlalchemy.engine.Engine - INFO - [cached since 31.28s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 16, 57, 753471), 'users_id': 2}
2025-03-29 17:16:57,754 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:04,286 - INFO - Incoming request: {"timestamp": "2025-03-29T14:17:04.286289", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:17:04,286 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:17:04.286289", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:17:04,288 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:04,288 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:04,288 - sqlalchemy.engine.Engine - INFO - [cached since 37.82s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:04,289 - app.api.v1.endpoints.users - INFO - Search request received, channel: af068d23-9bba-418f-9746-263750a6cf47
2025-03-29 17:17:04,289 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743259616}
2025-03-29 17:17:04,290 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 17:17:04,290 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 17:17:04,291 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 17:17:04,292 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 17:17:04,292 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 17:17:04,293 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 17:17:04,293 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 17:17:04,294 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:17:04,294 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 17:17:04,294 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 17:17:06,815 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:06,815 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:06,815 - sqlalchemy.engine.Engine - INFO - [cached since 40.35s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:06,816 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:06,816 - sqlalchemy.engine.Engine - INFO - [cached since 40.35s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 6, 816803), 'users_id': 3}
2025-03-29 17:17:06,817 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:06,817 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:06,817 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:06,817 - sqlalchemy.engine.Engine - INFO - [cached since 40.35s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:17:06,818 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:06,818 - sqlalchemy.engine.Engine - INFO - [cached since 40.35s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:06,818 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 17:17:06,818 - app.api.v1.endpoints.websocket - INFO - Generated chat_id f71ef446-5aa4-4e29-b855-e81269eb4b92 for users 3 and 2
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 17:17:06,819 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 17:17:26,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:26,590 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:26,590 - sqlalchemy.engine.Engine - INFO - [cached since 60.12s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:17:26,592 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:26,592 - sqlalchemy.engine.Engine - INFO - [cached since 60.12s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 26, 592634), 'users_id': 2}
2025-03-29 17:17:26,593 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:26,966 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:26,966 - sqlalchemy.engine.Engine - INFO - [cached since 60.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:26,967 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:26,967 - sqlalchemy.engine.Engine - INFO - [cached since 60.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 26, 967732), 'users_id': 3}
2025-03-29 17:17:26,968 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:27,531 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:27,532 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:27,532 - sqlalchemy.engine.Engine - INFO - [cached since 61.06s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:27,533 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:27,533 - sqlalchemy.engine.Engine - INFO - [cached since 61.06s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 27, 532875), 'users_id': 3}
2025-03-29 17:17:27,533 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:27,738 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:27,739 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:27,739 - sqlalchemy.engine.Engine - INFO - [cached since 61.27s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:17:27,740 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:27,740 - sqlalchemy.engine.Engine - INFO - [cached since 61.27s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 27, 739932), 'users_id': 2}
2025-03-29 17:17:27,741 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:56,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:56,458 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:56,459 - sqlalchemy.engine.Engine - INFO - [cached since 89.99s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:17:56,460 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:56,460 - sqlalchemy.engine.Engine - INFO - [cached since 89.99s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 56, 459789), 'users_id': 2}
2025-03-29 17:17:56,460 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:56,990 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:56,990 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:56,990 - sqlalchemy.engine.Engine - INFO - [cached since 90.52s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:56,991 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:56,991 - sqlalchemy.engine.Engine - INFO - [cached since 90.52s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 56, 991335), 'users_id': 3}
2025-03-29 17:17:56,992 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:57,516 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:57,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:57,517 - sqlalchemy.engine.Engine - INFO - [cached since 91.05s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:17:57,518 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:57,518 - sqlalchemy.engine.Engine - INFO - [cached since 91.05s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 57, 517717), 'users_id': 3}
2025-03-29 17:17:57,518 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:17:57,743 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:17:57,743 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:17:57,743 - sqlalchemy.engine.Engine - INFO - [cached since 91.28s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:17:57,744 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:17:57,744 - sqlalchemy.engine.Engine - INFO - [cached since 91.28s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 17, 57, 744838), 'users_id': 2}
2025-03-29 17:17:57,745 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:02,459 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:18:02,459 - app.services.connection_manager - INFO - User 2 disconnected from server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:18:02,460 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 17:18:02,461 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:18:19,742 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:18:19,742 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 17:18:19,742 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 17:18:19,743 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:18:27,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:27,011 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:27,011 - sqlalchemy.engine.Engine - INFO - [cached since 120.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:18:27,012 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:18:27,012 - sqlalchemy.engine.Engine - INFO - [cached since 120.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 18, 27, 11063), 'users_id': 3}
2025-03-29 17:18:27,012 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:27,521 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:27,521 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:27,521 - sqlalchemy.engine.Engine - INFO - [cached since 121.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:18:27,522 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:18:27,522 - sqlalchemy.engine.Engine - INFO - [cached since 121.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 18, 27, 522408), 'users_id': 3}
2025-03-29 17:18:27,523 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:33,691 - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:33.691837", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:18:33,691 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:33.691837", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:18:33,692 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 17:18:33,692 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 17:18:34,144 - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:34.144939", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:18:34,144 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:34.144939", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:18:34,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:34,147 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:34,147 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'device_id_1': '42bf9256-2ecf-435c-aeea-e383ed8d4d6f', 'refresh_token_1': 'BGhg_6XbHW9kiiCvX7ulxSqNMOXZ2-M_azzprJrXGN8', 'param_1': 1}
2025-03-29 17:18:34,149 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:18:34,149 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'refresh_token': 'Vqyca98FQyVqEhpaujcOxHqPiZVXHmNWWGZk6sKy0cc', 'user_devices_id': 11}
2025-03-29 17:18:34,150 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:34,155 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.466}
2025-03-29 17:18:34,155 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.466}
2025-03-29 17:18:34,298 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:18:34,298 - app.services.connection_manager - INFO - User 2 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:18:34,298 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 17:18:34,299 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:18:34,299 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:18:34,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:34,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:34,300 - sqlalchemy.engine.Engine - INFO - [cached since 127.8s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:18:34,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:18:34,301 - sqlalchemy.engine.Engine - INFO - [cached since 127.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 18, 34, 301439), 'users_id': 2}
2025-03-29 17:18:34,301 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:34,302 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:18:35,443 - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:35.442919", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:18:35,443 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:35.442919", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:18:35,444 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 3f798a92-ea16-4b13-9b2d-32f2999f8b1c
2025-03-29 17:18:35,444 - app.services.secure_channel_service - INFO - Creating channel with ID: 3f798a92-ea16-4b13-9b2d-32f2999f8b1c
2025-03-29 17:18:35,445 - app.services.secure_channel_service - INFO - Channel 3f798a92-ea16-4b13-9b2d-32f2999f8b1c saved to Redis with TTL 1800 seconds
2025-03-29 17:18:35,445 - app.api.v1.endpoints.auth - INFO - Channel 3f798a92-ea16-4b13-9b2d-32f2999f8b1c initialized successfully
2025-03-29 17:18:35,445 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 17:18:35,445 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 17:18:35,920 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 17:18:35,920 - app.services.connection_manager - INFO - User 2 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:18:35,920 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 17:18:35,920 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 17:18:35,921 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 17:18:35,921 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:35,921 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:35,922 - sqlalchemy.engine.Engine - INFO - [cached since 129.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:18:35,923 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:18:35,923 - sqlalchemy.engine.Engine - INFO - [cached since 129.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 18, 35, 922771), 'users_id': 2}
2025-03-29 17:18:35,923 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:35,928 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 17:18:40,407 - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:40.407599", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:18:40,407 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:40.407599", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:18:40,437 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:40,437 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:40,437 - sqlalchemy.engine.Engine - INFO - [cached since 6.29s ago] {'device_id_1': 'e5c0d947-73b4-4ddb-aaab-4169d56801ad', 'refresh_token_1': '-ZILypc_2MvW-ZgoinMwM7Srn_4dzaiw3Hd58iAf-k4', 'param_1': 1}
2025-03-29 17:18:40,438 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:18:40,438 - sqlalchemy.engine.Engine - INFO - [cached since 6.289s ago] {'refresh_token': 'plvyEmbguQU7PHYDnNFvx2tPFX65guDhTMdbb9FILh8', 'user_devices_id': 12}
2025-03-29 17:18:40,438 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:40,439 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 32.007}
2025-03-29 17:18:40,439 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 32.007}
2025-03-29 17:18:40,472 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:18:40,472 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:18:40,472 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 17:18:40,473 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:18:40,473 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:18:40,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:40,474 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:40,474 - sqlalchemy.engine.Engine - INFO - [cached since 134s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:18:40,475 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:18:40,475 - sqlalchemy.engine.Engine - INFO - [cached since 134s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 18, 40, 475615), 'users_id': 3}
2025-03-29 17:18:40,476 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:40,476 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:18:48,288 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:18:48,288 - app.services.connection_manager - INFO - User 3 disconnected from server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:18:48,288 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:18:48,289 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:18:48,289 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:18:48,289 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:18:48,289 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:18:48,289 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:18:48,289 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:18:48,292 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:18:48,293 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:18:48,293 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:18:59,702 - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:59.701157", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:18:59,702 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:59.701157", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:18:59,702 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:18:59,702 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:18:59,776 - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:59.776189", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:18:59,776 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:18:59.776189", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:18:59,777 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:59,778 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:59,778 - sqlalchemy.engine.Engine - INFO - [cached since 25.63s ago] {'device_id_1': 'e5c0d947-73b4-4ddb-aaab-4169d56801ad', 'refresh_token_1': 'plvyEmbguQU7PHYDnNFvx2tPFX65guDhTMdbb9FILh8', 'param_1': 1}
2025-03-29 17:18:59,779 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:18:59,779 - sqlalchemy.engine.Engine - INFO - [cached since 25.63s ago] {'refresh_token': 'cuxj7izBVLw066MAHJ6-MyUsVs6MKuVT9pSDP-U1Y88', 'user_devices_id': 12}
2025-03-29 17:18:59,779 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:59,784 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 17:18:59,784 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 17:18:59,914 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:18:59,914 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:18:59,914 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:18:59,915 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:18:59,915 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:18:59,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:18:59,916 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:18:59,916 - sqlalchemy.engine.Engine - INFO - [cached since 153.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:18:59,917 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:18:59,917 - sqlalchemy.engine.Engine - INFO - [cached since 153.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 18, 59, 917221), 'users_id': 3}
2025-03-29 17:18:59,917 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:18:59,918 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:19:00,970 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:19:00,970 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:19:00,970 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:19:00,972 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:19:00,972 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:19:00,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:00,972 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:00,972 - sqlalchemy.engine.Engine - INFO - [cached since 154.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:19:00,973 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:00,973 - sqlalchemy.engine.Engine - INFO - [cached since 154.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 0, 973218), 'users_id': 3}
2025-03-29 17:19:00,974 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:00,979 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:19:01,687 - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:01.687110", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:01,687 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:01.687110", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:01,688 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 38a25605-afd9-46ec-b0f9-f5045176df6e
2025-03-29 17:19:01,688 - app.services.secure_channel_service - INFO - Creating channel with ID: 38a25605-afd9-46ec-b0f9-f5045176df6e
2025-03-29 17:19:01,689 - app.services.secure_channel_service - INFO - Channel 38a25605-afd9-46ec-b0f9-f5045176df6e saved to Redis with TTL 1800 seconds
2025-03-29 17:19:01,689 - app.api.v1.endpoints.auth - INFO - Channel 38a25605-afd9-46ec-b0f9-f5045176df6e initialized successfully
2025-03-29 17:19:01,689 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 17:19:01,689 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 17:19:03,407 - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:03.407610", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:19:03,407 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:03.407610", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:19:03,408 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:03,409 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:03,409 - sqlalchemy.engine.Engine - INFO - [cached since 156.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:03,410 - app.api.v1.endpoints.users - INFO - Search request received, channel: 3f798a92-ea16-4b13-9b2d-32f2999f8b1c
2025-03-29 17:19:03,410 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743259714}
2025-03-29 17:19:03,411 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-29 17:19:03,411 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-29 17:19:03,411 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-29 17:19:03,412 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 17:19:03,412 - sqlalchemy.engine.Engine - INFO - [cached since 119.1s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-29 17:19:03,412 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 17:19:03,413 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 17:19:03,413 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:19:03,414 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 17:19:03,414 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 17:19:03,932 - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:03.932327", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:19:03,932 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:03.932327", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 17:19:03,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:03,934 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:03,934 - sqlalchemy.engine.Engine - INFO - [cached since 157.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:03,935 - app.api.v1.endpoints.users - INFO - Search request received, channel: 3f798a92-ea16-4b13-9b2d-32f2999f8b1c
2025-03-29 17:19:03,935 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743259714}
2025-03-29 17:19:03,936 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-29 17:19:03,937 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-29 17:19:03,937 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-29 17:19:03,937 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 17:19:03,937 - sqlalchemy.engine.Engine - INFO - [cached since 119.6s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-29 17:19:03,938 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 17:19:03,938 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 17:19:03,939 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 17:19:03,939 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 17:19:03,939 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 17:19:04,227 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:04,227 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:04,227 - sqlalchemy.engine.Engine - INFO - [cached since 157.8s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:04,228 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:04,228 - sqlalchemy.engine.Engine - INFO - [cached since 157.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 4, 228175), 'users_id': 2}
2025-03-29 17:19:04,229 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:05,836 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:05,837 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:05,837 - sqlalchemy.engine.Engine - INFO - [cached since 159.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:05,838 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:05,838 - sqlalchemy.engine.Engine - INFO - [cached since 159.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 5, 837030), 'users_id': 2}
2025-03-29 17:19:05,838 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:06,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:06,612 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:06,613 - sqlalchemy.engine.Engine - INFO - [cached since 160.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:06,614 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:06,614 - sqlalchemy.engine.Engine - INFO - [cached since 160.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 6, 613809), 'users_id': 2}
2025-03-29 17:19:06,614 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:06,619 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:06,619 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:06,620 - sqlalchemy.engine.Engine - INFO - [cached since 160.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:19:06,620 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:06,620 - sqlalchemy.engine.Engine - INFO - [cached since 160.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:06,621 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 17:19:06,621 - app.api.v1.endpoints.websocket - INFO - Generated chat_id e5ae8ecd-9d17-42ac-aca9-4b734411f225 for users 2 and 3
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 17:19:06,621 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 17:19:06,622 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 17:19:06,622 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 17:19:24,617 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:19:24,617 - app.services.connection_manager - INFO - User 3 disconnected from server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:19:24,617 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:19:24,618 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:19:30,899 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:30,900 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:30,900 - sqlalchemy.engine.Engine - INFO - [cached since 184.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:19:30,901 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:30,901 - sqlalchemy.engine.Engine - INFO - [cached since 184.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 30, 900646), 'users_id': 3}
2025-03-29 17:19:30,901 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:33,523 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:19:33,523 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:19:33,524 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 17:19:33,524 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:19:34,211 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:34,211 - sqlalchemy.engine.Engine - INFO - [cached since 187.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:34,212 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:34,212 - sqlalchemy.engine.Engine - INFO - [cached since 187.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 34, 212256), 'users_id': 2}
2025-03-29 17:19:34,213 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:34,796 - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:34.796458", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:34,796 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:34.796458", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:34,797 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:19:34,797 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 17:19:35,083 - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:35.083523", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:35,083 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:35.083523", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:35,085 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:35,085 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:35,085 - sqlalchemy.engine.Engine - INFO - [cached since 60.94s ago] {'device_id_1': 'e5c0d947-73b4-4ddb-aaab-4169d56801ad', 'refresh_token_1': 'cuxj7izBVLw066MAHJ6-MyUsVs6MKuVT9pSDP-U1Y88', 'param_1': 1}
2025-03-29 17:19:35,086 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 17:19:35,086 - sqlalchemy.engine.Engine - INFO - [cached since 60.94s ago] {'refresh_token': 'o2bSy16FDc6wpA_W3VlYcp4xjNE0F7ravpxIYPPpuiY', 'user_devices_id': 12}
2025-03-29 17:19:35,086 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:35,092 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:19:35,092 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 17:19:35,151 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:19:35,152 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:19:35,152 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:19:35,152 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:19:35,153 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:19:35,153 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:35,153 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:35,153 - sqlalchemy.engine.Engine - INFO - [cached since 188.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:19:35,154 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:35,154 - sqlalchemy.engine.Engine - INFO - [cached since 188.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 35, 154540), 'users_id': 3}
2025-03-29 17:19:35,155 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:35,155 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:19:35,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:35,828 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:35,828 - sqlalchemy.engine.Engine - INFO - [cached since 189.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:19:35,829 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:35,829 - sqlalchemy.engine.Engine - INFO - [cached since 189.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 35, 829147), 'users_id': 2}
2025-03-29 17:19:35,830 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:35,935 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 17:19:35,935 - app.services.connection_manager - INFO - User 3 connected to server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:19:35,935 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 17:19:35,937 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 17:19:35,937 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 17:19:35,937 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:19:35,937 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:19:35,937 - sqlalchemy.engine.Engine - INFO - [cached since 189.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:19:35,938 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:19:35,939 - sqlalchemy.engine.Engine - INFO - [cached since 189.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 19, 35, 938741), 'users_id': 3}
2025-03-29 17:19:35,939 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:19:35,940 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 17:19:35,946 - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:35.946732", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:35,946 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T14:19:35.946732", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 17:19:35,949 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: a963f588-0cd2-40ca-ac89-700a7f26e2a0
2025-03-29 17:19:35,949 - app.services.secure_channel_service - INFO - Creating channel with ID: a963f588-0cd2-40ca-ac89-700a7f26e2a0
2025-03-29 17:19:35,950 - app.services.secure_channel_service - INFO - Channel a963f588-0cd2-40ca-ac89-700a7f26e2a0 saved to Redis with TTL 1800 seconds
2025-03-29 17:19:35,950 - app.api.v1.endpoints.auth - INFO - Channel a963f588-0cd2-40ca-ac89-700a7f26e2a0 initialized successfully
2025-03-29 17:19:35,950 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:19:35,950 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 17:20:04,214 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:04,215 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:04,215 - sqlalchemy.engine.Engine - INFO - [cached since 217.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:20:04,216 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:04,216 - sqlalchemy.engine.Engine - INFO - [cached since 217.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 4, 216134), 'users_id': 2}
2025-03-29 17:20:04,217 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:05,160 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:05,161 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:05,161 - sqlalchemy.engine.Engine - INFO - [cached since 218.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:20:05,162 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:05,162 - sqlalchemy.engine.Engine - INFO - [cached since 218.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 5, 161553), 'users_id': 3}
2025-03-29 17:20:05,162 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:05,826 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:05,827 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:05,827 - sqlalchemy.engine.Engine - INFO - [cached since 219.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:20:05,828 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:05,828 - sqlalchemy.engine.Engine - INFO - [cached since 219.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 5, 827107), 'users_id': 2}
2025-03-29 17:20:05,828 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:05,871 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:05,872 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:05,872 - sqlalchemy.engine.Engine - INFO - [cached since 219.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:20:05,873 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:05,873 - sqlalchemy.engine.Engine - INFO - [cached since 219.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 5, 872120), 'users_id': 3}
2025-03-29 17:20:05,873 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:34,210 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:34,210 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:34,210 - sqlalchemy.engine.Engine - INFO - [cached since 247.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:20:34,211 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:34,211 - sqlalchemy.engine.Engine - INFO - [cached since 247.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 34, 211400), 'users_id': 2}
2025-03-29 17:20:34,212 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:35,141 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:35,142 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:35,142 - sqlalchemy.engine.Engine - INFO - [cached since 248.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:20:35,143 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:35,143 - sqlalchemy.engine.Engine - INFO - [cached since 248.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 35, 142157), 'users_id': 3}
2025-03-29 17:20:35,143 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:35,826 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:35,826 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:35,826 - sqlalchemy.engine.Engine - INFO - [cached since 249.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:20:35,827 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:35,827 - sqlalchemy.engine.Engine - INFO - [cached since 249.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 35, 827311), 'users_id': 2}
2025-03-29 17:20:35,828 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:20:35,857 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:20:35,857 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:20:35,857 - sqlalchemy.engine.Engine - INFO - [cached since 249.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:20:35,858 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:20:35,858 - sqlalchemy.engine.Engine - INFO - [cached since 249.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 20, 35, 858320), 'users_id': 3}
2025-03-29 17:20:35,859 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:04,212 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:04,212 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:04,212 - sqlalchemy.engine.Engine - INFO - [cached since 277.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:21:04,213 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:04,213 - sqlalchemy.engine.Engine - INFO - [cached since 277.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 4, 213114), 'users_id': 2}
2025-03-29 17:21:04,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:05,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:05,143 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:05,143 - sqlalchemy.engine.Engine - INFO - [cached since 278.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:21:05,144 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:05,144 - sqlalchemy.engine.Engine - INFO - [cached since 278.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 5, 144536), 'users_id': 3}
2025-03-29 17:21:05,145 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:05,826 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:05,826 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:05,826 - sqlalchemy.engine.Engine - INFO - [cached since 279.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:21:05,827 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:05,828 - sqlalchemy.engine.Engine - INFO - [cached since 279.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 5, 827694), 'users_id': 2}
2025-03-29 17:21:05,828 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:05,849 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:05,849 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:05,849 - sqlalchemy.engine.Engine - INFO - [cached since 279.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:21:05,850 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:05,850 - sqlalchemy.engine.Engine - INFO - [cached since 279.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 5, 850700), 'users_id': 3}
2025-03-29 17:21:05,851 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:34,212 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:34,212 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:34,212 - sqlalchemy.engine.Engine - INFO - [cached since 307.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:21:34,213 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:34,213 - sqlalchemy.engine.Engine - INFO - [cached since 307.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 34, 213154), 'users_id': 2}
2025-03-29 17:21:34,213 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:35,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:35,147 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:35,147 - sqlalchemy.engine.Engine - INFO - [cached since 308.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:21:35,148 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:35,148 - sqlalchemy.engine.Engine - INFO - [cached since 308.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 35, 148579), 'users_id': 3}
2025-03-29 17:21:35,149 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:35,825 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:35,826 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:35,826 - sqlalchemy.engine.Engine - INFO - [cached since 309.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 17:21:35,827 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:35,827 - sqlalchemy.engine.Engine - INFO - [cached since 309.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 35, 826750), 'users_id': 2}
2025-03-29 17:21:35,827 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:35,868 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 17:21:35,869 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 17:21:35,869 - sqlalchemy.engine.Engine - INFO - [cached since 309.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 17:21:35,869 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 17:21:35,870 - sqlalchemy.engine.Engine - INFO - [cached since 309.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 14, 21, 35, 869760), 'users_id': 3}
2025-03-29 17:21:35,870 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 17:21:38,185 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:21:38,186 - app.services.connection_manager - INFO - User 2 disconnected from server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:21:38,186 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 17:21:38,187 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:21:39,928 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 17:21:39,928 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 17:21:39,928 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 17:21:39,930 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 17:21:41,252 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:21:41,252 - app.services.connection_manager - INFO - User 3 disconnected from server 3665cce2-f687-4bd3-9b26-0e63b53bedd4
2025-03-29 17:21:41,252 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:21:41,253 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 17:22:15,596 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 17:22:15,596 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 17:22:15,596 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 17:22:15,597 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:02:31,635 - app.main - INFO - Shutting down server...
2025-03-29 18:02:31,636 - app.main - INFO - Redis connections closed
2025-03-29 18:02:31,636 - app.main - INFO - Server shutdown completed
2025-03-29 18:02:37,431 - app.main - INFO - Starting up server...
2025-03-29 18:02:37,432 - app.main - INFO - Redis initialized
2025-03-29 18:02:37,468 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-29 18:02:37,468 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:02:37,469 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-29 18:02:37,469 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:02:37,470 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-29 18:02:37,470 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:02:37,472 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:02:37,473 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:02:37,473 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:02:37,474 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:02:37,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:02:37,476 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:02:37,476 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:02:37,476 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:02:37,476 - sqlalchemy.engine.Engine - INFO - [cached since 0.0008254s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:02:37,477 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:02:37,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:02:37,477 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:02:37,478 - sqlalchemy.engine.Engine - INFO - [cached since 0.005182s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:02:37,478 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:02:37,479 - app.main - INFO - Database initialized
2025-03-29 18:02:37,539 - app.main - INFO - Server key pair generated
2025-03-29 18:02:37,540 - app.main - INFO - Server startup completed successfully
2025-03-29 18:03:13,009 - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:13.008526", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:13,009 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:13.008526", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:13,009 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 18:03:13,009 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-29 18:03:30,505 - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:30.505325", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:30,505 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:30.505325", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:30,509 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 847126b6-8cbb-48cf-961d-978b02467d1f
2025-03-29 18:03:30,509 - app.services.secure_channel_service - INFO - Creating channel with ID: 847126b6-8cbb-48cf-961d-978b02467d1f
2025-03-29 18:03:30,513 - app.services.secure_channel_service - INFO - Channel 847126b6-8cbb-48cf-961d-978b02467d1f saved to Redis with TTL 1800 seconds
2025-03-29 18:03:30,513 - app.api.v1.endpoints.auth - INFO - Channel 847126b6-8cbb-48cf-961d-978b02467d1f initialized successfully
2025-03-29 18:03:30,514 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 18:03:30,514 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 18:03:30,666 - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:30.666361", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:30,666 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:30.666361", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:30,668 - app.api.v1.endpoints.auth - INFO - Login request using channel: 847126b6-8cbb-48cf-961d-978b02467d1f
2025-03-29 18:03:30,669 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"7bafacd9-8c1e-4df4-99ff-50e0a10b3384"}
2025-03-29 18:03:30,669 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384'}
2025-03-29 18:03:30,673 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:03:30,674 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 18:03:30,675 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-29 18:03:30,904 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:03:30,904 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'user_id_1': 2, 'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'param_1': 1}
2025-03-29 18:03:30,907 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 18:03:30,907 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'users_id': 2}
2025-03-29 18:03:30,909 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 18:03:30,909 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] {'user_id': 2, 'device_id': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token': None, 'last_login': None}
2025-03-29 18:03:30,910 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-29 18:03:30,911 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:03:30,911 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'refresh_token': 'xKxrFVMP8uAZaicnoqe-4mw30sAMFIAp2HD4cU5jlSk', 'user_devices_id': 13}
2025-03-29 18:03:30,912 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:03:30,913 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 18:03:30,913 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 18:03:30,914 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 18:03:30,914 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 248.058}
2025-03-29 18:03:30,914 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 248.058}
2025-03-29 18:03:31,469 - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:31.469595", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:31,469 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:03:31.469595", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:03:31,470 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: d67c50cf-a7c3-4156-a124-5930d5c5754a
2025-03-29 18:03:31,470 - app.services.secure_channel_service - INFO - Creating channel with ID: d67c50cf-a7c3-4156-a124-5930d5c5754a
2025-03-29 18:03:31,471 - app.services.secure_channel_service - INFO - Channel d67c50cf-a7c3-4156-a124-5930d5c5754a saved to Redis with TTL 1800 seconds
2025-03-29 18:03:31,471 - app.api.v1.endpoints.auth - INFO - Channel d67c50cf-a7c3-4156-a124-5930d5c5754a initialized successfully
2025-03-29 18:03:31,471 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 18:03:31,471 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-29 18:03:31,475 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:03:31,475 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:03:31,475 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:03:31,477 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:03:31,477 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:03:31,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:03:31,479 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:03:31,479 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '2', 'param_1': 1}
2025-03-29 18:03:31,480 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:03:31,480 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'last_seen': datetime.datetime(2025, 3, 29, 15, 3, 31, 479597), 'users_id': 2}
2025-03-29 18:03:31,481 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:03:31,481 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:04:01,503 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:01,503 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:01,503 - sqlalchemy.engine.Engine - INFO - [cached since 30.02s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:04:01,504 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:01,504 - sqlalchemy.engine.Engine - INFO - [cached since 30.02s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 1, 504789), 'users_id': 2}
2025-03-29 18:04:01,504 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:06,167 - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:06.167388", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:06,167 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:06.167388", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:06,168 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:04:06,168 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:04:14,635 - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:14.635415", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:14,635 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:14.635415", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:14,636 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 41a25807-65b6-4647-a253-a6064ea61087
2025-03-29 18:04:14,636 - app.services.secure_channel_service - INFO - Creating channel with ID: 41a25807-65b6-4647-a253-a6064ea61087
2025-03-29 18:04:14,637 - app.services.secure_channel_service - INFO - Channel 41a25807-65b6-4647-a253-a6064ea61087 saved to Redis with TTL 1800 seconds
2025-03-29 18:04:14,637 - app.api.v1.endpoints.auth - INFO - Channel 41a25807-65b6-4647-a253-a6064ea61087 initialized successfully
2025-03-29 18:04:14,637 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:04:14,637 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:04:14,844 - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:14.844462", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:14,844 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:14.844462", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:14,846 - app.api.v1.endpoints.auth - INFO - Login request using channel: 41a25807-65b6-4647-a253-a6064ea61087
2025-03-29 18:04:14,847 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"237a9b4a-3d78-4c0e-a66f-37a16bebe1d6"}
2025-03-29 18:04:14,847 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6'}
2025-03-29 18:04:14,847 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:14,848 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:14,848 - sqlalchemy.engine.Engine - INFO - [cached since 44.17s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-29 18:04:15,051 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:15,051 - sqlalchemy.engine.Engine - INFO - [cached since 44.15s ago] {'user_id_1': 3, 'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'param_1': 1}
2025-03-29 18:04:15,052 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 18:04:15,053 - sqlalchemy.engine.Engine - INFO - [cached since 44.15s ago] {'users_id': 3}
2025-03-29 18:04:15,053 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 18:04:15,053 - sqlalchemy.engine.Engine - INFO - [cached since 44.14s ago] {'user_id': 3, 'device_id': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token': None, 'last_login': None}
2025-03-29 18:04:15,054 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-29 18:04:15,054 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:04:15,054 - sqlalchemy.engine.Engine - INFO - [cached since 44.14s ago] {'refresh_token': 'DZ4_rXqBUWNiDvjb0FfbEBknrIG4kJXg1Lk1rLZzQ1I', 'user_devices_id': 14}
2025-03-29 18:04:15,055 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:15,064 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 18:04:15,064 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 18:04:15,065 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 18:04:15,065 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 221.04999999999998}
2025-03-29 18:04:15,065 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 221.04999999999998}
2025-03-29 18:04:15,687 - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:15.687338", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:15,687 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:15.687338", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:15,688 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: fbbabcf5-85ba-48d2-bb8b-3588a55ac4f2
2025-03-29 18:04:15,688 - app.services.secure_channel_service - INFO - Creating channel with ID: fbbabcf5-85ba-48d2-bb8b-3588a55ac4f2
2025-03-29 18:04:15,690 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:04:15,690 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:04:15,690 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:04:15,690 - app.services.secure_channel_service - INFO - Channel fbbabcf5-85ba-48d2-bb8b-3588a55ac4f2 saved to Redis with TTL 1800 seconds
2025-03-29 18:04:15,690 - app.api.v1.endpoints.auth - INFO - Channel fbbabcf5-85ba-48d2-bb8b-3588a55ac4f2 initialized successfully
2025-03-29 18:04:15,691 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.8449999999999998}
2025-03-29 18:04:15,691 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.8449999999999998}
2025-03-29 18:04:15,691 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:04:15,691 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:04:15,692 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:15,692 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:15,692 - sqlalchemy.engine.Engine - INFO - [cached since 44.21s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:15,693 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:15,693 - sqlalchemy.engine.Engine - INFO - [cached since 44.21s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 15, 693184), 'users_id': 3}
2025-03-29 18:04:15,694 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:15,695 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:04:16,609 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:04:16,609 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:04:16,609 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:04:16,610 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:04:16,610 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:04:16,611 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:16,611 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:16,611 - sqlalchemy.engine.Engine - INFO - [cached since 45.13s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:16,612 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:16,612 - sqlalchemy.engine.Engine - INFO - [cached since 45.13s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 16, 612536), 'users_id': 3}
2025-03-29 18:04:16,612 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:16,613 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:04:22,423 - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:22.423212", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:22,423 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:22.423212", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:04:22,425 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:22,425 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:22,425 - sqlalchemy.engine.Engine - INFO - [cached since 50.95s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:22,426 - app.api.v1.endpoints.users - INFO - Search request received, channel: fbbabcf5-85ba-48d2-bb8b-3588a55ac4f2
2025-03-29 18:04:22,426 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743262455}
2025-03-29 18:04:22,427 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 18:04:22,427 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 18:04:22,427 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 18:04:22,428 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:04:22,428 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 18:04:22,429 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:04:22,429 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:04:22,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:04:22,430 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:04:22,430 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:04:23,637 - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:23.637432", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:04:23,637 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:04:23.637432", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:04:23,645 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:23,646 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:23,647 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'xKxrFVMP8uAZaicnoqe-4mw30sAMFIAp2HD4cU5jlSk', 'param_1': 1}
2025-03-29 18:04:23,648 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:04:23,648 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'refresh_token': 'TtIozQmsA70rgMkj_uCM9CApT6045u_KUAGVK0ged-8', 'user_devices_id': 13}
2025-03-29 18:04:23,648 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:23,649 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.003}
2025-03-29 18:04:23,649 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.003}
2025-03-29 18:04:23,696 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:04:23,696 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:04:23,696 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:04:23,697 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:04:23,697 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:04:23,698 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:23,698 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:23,698 - sqlalchemy.engine.Engine - INFO - [cached since 52.22s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:04:23,699 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:23,699 - sqlalchemy.engine.Engine - INFO - [cached since 52.22s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 23, 699445), 'users_id': 2}
2025-03-29 18:04:23,700 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:23,700 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:04:26,212 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:26,213 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:26,213 - sqlalchemy.engine.Engine - INFO - [cached since 54.73s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:26,214 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:26,214 - sqlalchemy.engine.Engine - INFO - [cached since 54.73s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 26, 213572), 'users_id': 3}
2025-03-29 18:04:26,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:26,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:26,220 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:26,220 - sqlalchemy.engine.Engine - INFO - [cached since 54.74s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:04:26,220 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:26,221 - sqlalchemy.engine.Engine - INFO - [cached since 54.74s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:26,221 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 18:04:26,221 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 583c821d-f781-491f-bdf3-ab3cb21fa1e6 for users 3 and 2
2025-03-29 18:04:26,221 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:04:26,221 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:04:26,221 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:04:26,221 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:04:26,222 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:04:26,222 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:04:26,222 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:04:26,222 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:04:26,222 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:04:26,222 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:04:26,787 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:26,787 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:26,787 - sqlalchemy.engine.Engine - INFO - [cached since 55.31s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:04:26,789 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:26,789 - sqlalchemy.engine.Engine - INFO - [cached since 55.31s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 26, 788756), 'users_id': 2}
2025-03-29 18:04:26,789 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:26,792 - app.api.v1.endpoints.websocket - WARNING - Missing recipient_id in key exchange from user 2
2025-03-29 18:04:45,591 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:45,591 - sqlalchemy.engine.Engine - INFO - [cached since 74.11s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:45,592 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:45,592 - sqlalchemy.engine.Engine - INFO - [cached since 74.11s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 45, 592580), 'users_id': 3}
2025-03-29 18:04:45,593 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:46,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:46,589 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:46,589 - sqlalchemy.engine.Engine - INFO - [cached since 75.11s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:04:46,590 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:46,590 - sqlalchemy.engine.Engine - INFO - [cached since 75.11s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 46, 590843), 'users_id': 3}
2025-03-29 18:04:46,591 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:50,597 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:50,598 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:50,598 - sqlalchemy.engine.Engine - INFO - [cached since 79.12s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:04:50,599 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:50,599 - sqlalchemy.engine.Engine - INFO - [cached since 79.12s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 50, 599410), 'users_id': 2}
2025-03-29 18:04:50,599 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:04:50,605 - app.api.v1.endpoints.websocket - WARNING - Missing required data in chat message from user 2
2025-03-29 18:04:53,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:04:53,690 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:04:53,690 - sqlalchemy.engine.Engine - INFO - [cached since 82.21s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:04:53,691 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:04:53,691 - sqlalchemy.engine.Engine - INFO - [cached since 82.21s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 4, 53, 691670), 'users_id': 2}
2025-03-29 18:04:53,692 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:05:15,610 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:05:15,610 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:05:15,610 - sqlalchemy.engine.Engine - INFO - [cached since 104.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:05:15,611 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:05:15,611 - sqlalchemy.engine.Engine - INFO - [cached since 104.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 5, 15, 611103), 'users_id': 3}
2025-03-29 18:05:15,612 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:05:16,565 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:05:16,565 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:05:16,565 - sqlalchemy.engine.Engine - INFO - [cached since 105.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:05:16,566 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:05:16,567 - sqlalchemy.engine.Engine - INFO - [cached since 105.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 5, 16, 566385), 'users_id': 3}
2025-03-29 18:05:16,567 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:05:23,690 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:05:23,690 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:05:23,690 - sqlalchemy.engine.Engine - INFO - [cached since 112.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:05:23,691 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:05:23,691 - sqlalchemy.engine.Engine - INFO - [cached since 112.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 5, 23, 691937), 'users_id': 2}
2025-03-29 18:05:23,691 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:05:45,629 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:05:45,629 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:05:45,629 - sqlalchemy.engine.Engine - INFO - [cached since 134.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:05:45,630 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:05:45,630 - sqlalchemy.engine.Engine - INFO - [cached since 134.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 5, 45, 630564), 'users_id': 3}
2025-03-29 18:05:45,630 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:05:46,567 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:05:46,568 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:05:46,568 - sqlalchemy.engine.Engine - INFO - [cached since 135.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:05:46,569 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:05:46,569 - sqlalchemy.engine.Engine - INFO - [cached since 135.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 5, 46, 569979), 'users_id': 3}
2025-03-29 18:05:46,569 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:05:53,691 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:05:53,691 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:05:53,691 - sqlalchemy.engine.Engine - INFO - [cached since 142.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:05:53,692 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:05:53,692 - sqlalchemy.engine.Engine - INFO - [cached since 142.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 5, 53, 692356), 'users_id': 2}
2025-03-29 18:05:53,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:06:15,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:06:15,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:06:15,538 - sqlalchemy.engine.Engine - INFO - [cached since 164.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:06:15,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:06:15,539 - sqlalchemy.engine.Engine - INFO - [cached since 164.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 6, 15, 538727), 'users_id': 3}
2025-03-29 18:06:15,539 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:06:16,576 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:06:16,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:06:16,576 - sqlalchemy.engine.Engine - INFO - [cached since 165.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:06:16,577 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:06:16,577 - sqlalchemy.engine.Engine - INFO - [cached since 165.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 6, 16, 577970), 'users_id': 3}
2025-03-29 18:06:16,578 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:06:23,691 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:06:23,691 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:06:23,691 - sqlalchemy.engine.Engine - INFO - [cached since 172.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:06:23,692 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:06:23,693 - sqlalchemy.engine.Engine - INFO - [cached since 172.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 6, 23, 692605), 'users_id': 2}
2025-03-29 18:06:23,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:06:40,544 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:06:40,545 - app.services.connection_manager - INFO - User 3 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:06:40,545 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:06:40,545 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:06:40,545 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:06:40,545 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:06:40,547 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:06:40,548 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:06:46,766 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:06:46,766 - app.services.connection_manager - INFO - User 2 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:06:46,766 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:06:46,767 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:06:46,767 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:06:46,767 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:06:46,767 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:06:46,768 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:07:06,599 - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:06.598798", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:07:06,599 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:06.598798", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:07:06,599 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:07:06,599 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:07:07,033 - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:07.033425", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:07:07,033 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:07.033425", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:07:07,035 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:07,035 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:07,035 - sqlalchemy.engine.Engine - INFO - [cached since 163.4s ago] {'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token_1': 'DZ4_rXqBUWNiDvjb0FfbEBknrIG4kJXg1Lk1rLZzQ1I', 'param_1': 1}
2025-03-29 18:07:07,037 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:07:07,037 - sqlalchemy.engine.Engine - INFO - [cached since 163.4s ago] {'refresh_token': '3R3muszbx-TyJKmPwqkjLQv2ZherSLCtD6jWbtXFih8', 'user_devices_id': 14}
2025-03-29 18:07:07,037 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:07,040 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:07:07,040 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:07:07,125 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:07:07,125 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:07:07,125 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:07:07,126 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:07:07,126 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:07:07,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:07,127 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:07,127 - sqlalchemy.engine.Engine - INFO - [cached since 215.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:07:07,128 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:07:07,128 - sqlalchemy.engine.Engine - INFO - [cached since 215.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 7, 7, 127447), 'users_id': 3}
2025-03-29 18:07:07,128 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:07,129 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:07:08,203 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:07:08,203 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:07:08,203 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:07:08,204 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:07:08,204 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:07:08,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:08,205 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:08,205 - sqlalchemy.engine.Engine - INFO - [cached since 216.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:07:08,206 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:07:08,206 - sqlalchemy.engine.Engine - INFO - [cached since 216.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 7, 8, 205367), 'users_id': 3}
2025-03-29 18:07:08,206 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:08,211 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:07:08,353 - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:08.353466", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:07:08,353 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:08.353466", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:07:08,355 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: af456d04-cfe6-4445-9e8e-979d7ccf4fe9
2025-03-29 18:07:08,355 - app.services.secure_channel_service - INFO - Creating channel with ID: af456d04-cfe6-4445-9e8e-979d7ccf4fe9
2025-03-29 18:07:08,355 - app.services.secure_channel_service - INFO - Channel af456d04-cfe6-4445-9e8e-979d7ccf4fe9 saved to Redis with TTL 1800 seconds
2025-03-29 18:07:08,356 - app.api.v1.endpoints.auth - INFO - Channel af456d04-cfe6-4445-9e8e-979d7ccf4fe9 initialized successfully
2025-03-29 18:07:08,356 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:07:08,356 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:07:37,141 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:37,142 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:37,142 - sqlalchemy.engine.Engine - INFO - [cached since 245.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:07:37,143 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:07:37,143 - sqlalchemy.engine.Engine - INFO - [cached since 245.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 7, 37, 142649), 'users_id': 3}
2025-03-29 18:07:37,143 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:38,157 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:38,157 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:38,157 - sqlalchemy.engine.Engine - INFO - [cached since 246.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:07:38,158 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:07:38,158 - sqlalchemy.engine.Engine - INFO - [cached since 246.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 7, 38, 158222), 'users_id': 3}
2025-03-29 18:07:38,158 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:54,140 - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:54.140771", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:07:54,140 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:54.140771", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:07:54,141 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:07:54,141 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:07:54,586 - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:54.586993", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:07:54,586 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:54.586993", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:07:54,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:54,588 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:54,588 - sqlalchemy.engine.Engine - INFO - [cached since 210.9s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'TtIozQmsA70rgMkj_uCM9CApT6045u_KUAGVK0ged-8', 'param_1': 1}
2025-03-29 18:07:54,589 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:07:54,589 - sqlalchemy.engine.Engine - INFO - [cached since 210.9s ago] {'refresh_token': '8ldiWL39ks4AtfpndTTdcIvhliofDKTKWa_Mz7zfSBY', 'user_devices_id': 13}
2025-03-29 18:07:54,589 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:54,590 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-29 18:07:54,590 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-29 18:07:54,729 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:07:54,729 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:07:54,730 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:07:54,730 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:07:54,730 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:07:54,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:54,731 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:54,731 - sqlalchemy.engine.Engine - INFO - [cached since 263.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:07:54,732 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:07:54,732 - sqlalchemy.engine.Engine - INFO - [cached since 263.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 7, 54, 732031), 'users_id': 2}
2025-03-29 18:07:54,733 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:54,733 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:07:56,177 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:07:56,177 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:07:56,177 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:07:56,178 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:07:56,178 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:07:56,178 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:07:56,179 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:07:56,179 - sqlalchemy.engine.Engine - INFO - [cached since 264.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:07:56,180 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:07:56,180 - sqlalchemy.engine.Engine - INFO - [cached since 264.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 7, 56, 179576), 'users_id': 2}
2025-03-29 18:07:56,180 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:07:56,186 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:07:56,227 - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:56.227633", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:07:56,227 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:07:56.227633", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:07:56,228 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 4f167628-257f-443d-b773-74b4a6c6ddff
2025-03-29 18:07:56,228 - app.services.secure_channel_service - INFO - Creating channel with ID: 4f167628-257f-443d-b773-74b4a6c6ddff
2025-03-29 18:07:56,229 - app.services.secure_channel_service - INFO - Channel 4f167628-257f-443d-b773-74b4a6c6ddff saved to Redis with TTL 1800 seconds
2025-03-29 18:07:56,230 - app.api.v1.endpoints.auth - INFO - Channel 4f167628-257f-443d-b773-74b4a6c6ddff initialized successfully
2025-03-29 18:07:56,230 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:07:56,230 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:08:01,580 - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:01.580267", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:08:01,580 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:01.580267", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:08:01,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:01,582 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:01,582 - sqlalchemy.engine.Engine - INFO - [cached since 270.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:08:01,583 - app.api.v1.endpoints.users - INFO - Search request received, channel: 4f167628-257f-443d-b773-74b4a6c6ddff
2025-03-29 18:08:01,584 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743262674}
2025-03-29 18:08:01,584 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-29 18:08:01,585 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-29 18:08:01,585 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-29 18:08:01,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:08:01,585 - sqlalchemy.engine.Engine - INFO - [cached since 219.2s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-29 18:08:01,586 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:08:01,587 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:08:01,587 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:08:01,588 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:08:01,588 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:08:03,079 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:03,079 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:03,079 - sqlalchemy.engine.Engine - INFO - [cached since 271.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:08:03,080 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:03,081 - sqlalchemy.engine.Engine - INFO - [cached since 271.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 3, 80939), 'users_id': 2}
2025-03-29 18:08:03,081 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:03,086 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:03,086 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:03,086 - sqlalchemy.engine.Engine - INFO - [cached since 271.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:03,087 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:03,087 - sqlalchemy.engine.Engine - INFO - [cached since 271.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:08:03,087 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:08:03,087 - app.api.v1.endpoints.websocket - INFO - Generated chat_id d56310ff-e92f-4632-a0fc-71d589127228 for users 2 and 3
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:08:03,088 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:08:07,121 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:07,121 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:07,121 - sqlalchemy.engine.Engine - INFO - [cached since 275.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:07,122 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:07,122 - sqlalchemy.engine.Engine - INFO - [cached since 275.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 7, 122026), 'users_id': 3}
2025-03-29 18:08:07,123 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:08,128 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:08,128 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:08,128 - sqlalchemy.engine.Engine - INFO - [cached since 276.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:08,129 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:08,129 - sqlalchemy.engine.Engine - INFO - [cached since 276.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 8, 129836), 'users_id': 3}
2025-03-29 18:08:08,130 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:24,756 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:08:24,756 - app.services.connection_manager - INFO - User 2 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:08:24,756 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:08:24,756 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:08:24,756 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:08:24,756 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:08:24,757 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:08:24,758 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:08:31,542 - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:31.542266", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:31,542 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:31.542266", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:31,547 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:31,548 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:31,548 - sqlalchemy.engine.Engine - INFO - [cached since 247.9s ago] {'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token_1': '3R3muszbx-TyJKmPwqkjLQv2ZherSLCtD6jWbtXFih8', 'param_1': 1}
2025-03-29 18:08:31,548 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:08:31,549 - sqlalchemy.engine.Engine - INFO - [cached since 247.9s ago] {'refresh_token': 'izziIpwQo1mbJkn42wTYY4kQ8xsGdAswfGTYmjumlCE', 'user_devices_id': 14}
2025-03-29 18:08:31,549 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:31,550 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 18:08:31,550 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 18:08:31,585 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:08:31,585 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:08:31,585 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:08:31,586 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:08:31,586 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:08:31,586 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:31,586 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:31,587 - sqlalchemy.engine.Engine - INFO - [cached since 300.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:31,587 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:31,588 - sqlalchemy.engine.Engine - INFO - [cached since 300.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 31, 587277), 'users_id': 3}
2025-03-29 18:08:31,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:31,588 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:08:38,189 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:38,190 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:38,190 - sqlalchemy.engine.Engine - INFO - [cached since 306.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:38,192 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:38,192 - sqlalchemy.engine.Engine - INFO - [cached since 306.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 38, 191821), 'users_id': 3}
2025-03-29 18:08:38,193 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:46,540 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:08:46,540 - app.services.connection_manager - INFO - User 3 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:08:46,540 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:08:46,540 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:08:46,541 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:08:46,541 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:08:46,541 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:08:46,541 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:08:46,541 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:08:46,542 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:08:46,543 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:08:46,543 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:08:57,227 - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:57.227300", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:57,227 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:57.227300", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:57,228 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:08:57,228 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:08:57,571 - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:57.571622", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:57,571 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:57.571622", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:57,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:57,573 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:57,573 - sqlalchemy.engine.Engine - INFO - [cached since 273.9s ago] {'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token_1': 'izziIpwQo1mbJkn42wTYY4kQ8xsGdAswfGTYmjumlCE', 'param_1': 1}
2025-03-29 18:08:57,574 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:08:57,574 - sqlalchemy.engine.Engine - INFO - [cached since 273.9s ago] {'refresh_token': 'g6UdyiQDuUyilQqtnaZQTVoiZVuw9JFdoDka8suH_I8', 'user_devices_id': 14}
2025-03-29 18:08:57,575 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:57,576 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:08:57,576 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:08:57,638 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:08:57,638 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:08:57,638 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:08:57,639 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:08:57,639 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:08:57,640 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:57,640 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:57,640 - sqlalchemy.engine.Engine - INFO - [cached since 326.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:57,641 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:57,641 - sqlalchemy.engine.Engine - INFO - [cached since 326.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 57, 641637), 'users_id': 3}
2025-03-29 18:08:57,642 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:57,642 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:08:58,484 - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:58.484874", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:58,484 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:08:58.484874", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:08:58,485 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 31197e86-b451-4f03-8a5f-b95ad7e2bf92
2025-03-29 18:08:58,485 - app.services.secure_channel_service - INFO - Creating channel with ID: 31197e86-b451-4f03-8a5f-b95ad7e2bf92
2025-03-29 18:08:58,486 - app.services.secure_channel_service - INFO - Channel 31197e86-b451-4f03-8a5f-b95ad7e2bf92 saved to Redis with TTL 1800 seconds
2025-03-29 18:08:58,486 - app.api.v1.endpoints.auth - INFO - Channel 31197e86-b451-4f03-8a5f-b95ad7e2bf92 initialized successfully
2025-03-29 18:08:58,486 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:08:58,486 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:08:58,755 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:08:58,755 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:08:58,755 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:08:58,756 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:08:58,756 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:08:58,757 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:08:58,757 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:08:58,757 - sqlalchemy.engine.Engine - INFO - [cached since 327.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:08:58,758 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:08:58,758 - sqlalchemy.engine.Engine - INFO - [cached since 327.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 8, 58, 758137), 'users_id': 3}
2025-03-29 18:08:58,759 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:08:58,759 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:09:27,660 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:27,660 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:27,660 - sqlalchemy.engine.Engine - INFO - [cached since 356.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:27,661 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:27,661 - sqlalchemy.engine.Engine - INFO - [cached since 356.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 27, 661900), 'users_id': 3}
2025-03-29 18:09:27,662 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:28,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:28,725 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:28,725 - sqlalchemy.engine.Engine - INFO - [cached since 357.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:28,726 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:28,726 - sqlalchemy.engine.Engine - INFO - [cached since 357.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 28, 726196), 'users_id': 3}
2025-03-29 18:09:28,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:33,291 - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:33.291608", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:09:33,291 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:33.291608", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:09:33,292 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:09:33,292 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:09:33,425 - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:33.425644", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:09:33,425 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:33.425644", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:09:33,427 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:33,427 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:33,427 - sqlalchemy.engine.Engine - INFO - [cached since 309.8s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': '8ldiWL39ks4AtfpndTTdcIvhliofDKTKWa_Mz7zfSBY', 'param_1': 1}
2025-03-29 18:09:33,428 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:09:33,428 - sqlalchemy.engine.Engine - INFO - [cached since 309.8s ago] {'refresh_token': 'crbjxH2HERSLUuoUZvObFfoQVMb7S0pfJaVAmxT02vo', 'user_devices_id': 13}
2025-03-29 18:09:33,429 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:33,438 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.003}
2025-03-29 18:09:33,438 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.003}
2025-03-29 18:09:33,499 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:09:33,499 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:09:33,499 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:09:33,500 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:09:33,500 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:09:33,500 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:33,501 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:33,501 - sqlalchemy.engine.Engine - INFO - [cached since 362s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:09:33,501 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:33,502 - sqlalchemy.engine.Engine - INFO - [cached since 362s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 33, 501674), 'users_id': 2}
2025-03-29 18:09:33,502 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:33,502 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:09:35,012 - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:35.012789", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:09:35,012 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:35.012789", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:09:35,013 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: cf063703-cbf2-4e8d-a0d2-d91f2a0362b6
2025-03-29 18:09:35,014 - app.services.secure_channel_service - INFO - Creating channel with ID: cf063703-cbf2-4e8d-a0d2-d91f2a0362b6
2025-03-29 18:09:35,015 - app.services.secure_channel_service - INFO - Channel cf063703-cbf2-4e8d-a0d2-d91f2a0362b6 saved to Redis with TTL 1800 seconds
2025-03-29 18:09:35,015 - app.api.v1.endpoints.auth - INFO - Channel cf063703-cbf2-4e8d-a0d2-d91f2a0362b6 initialized successfully
2025-03-29 18:09:35,015 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:09:35,015 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:09:35,213 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:09:35,213 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:09:35,213 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:09:35,214 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:09:35,214 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:09:35,214 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:35,215 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:35,215 - sqlalchemy.engine.Engine - INFO - [cached since 363.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:09:35,216 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:35,216 - sqlalchemy.engine.Engine - INFO - [cached since 363.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 35, 215835), 'users_id': 2}
2025-03-29 18:09:35,216 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:35,217 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:09:43,551 - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:43.551419", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:09:43,551 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:09:43.551419", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:09:43,554 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:43,554 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:43,554 - sqlalchemy.engine.Engine - INFO - [cached since 372.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:43,555 - app.api.v1.endpoints.users - INFO - Search request received, channel: 31197e86-b451-4f03-8a5f-b95ad7e2bf92
2025-03-29 18:09:43,555 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743262737}
2025-03-29 18:09:43,556 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"Yu","limit":10}
2025-03-29 18:09:43,556 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'Yu', 'limit': 10}
2025-03-29 18:09:43,556 - app.api.v1.endpoints.users - INFO - Searching users with query 'Yu', excluding user 3
2025-03-29 18:09:43,557 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:09:43,557 - sqlalchemy.engine.Engine - INFO - [cached since 321.1s ago] {'id_1': '3', 'username_1': '%Yu%', 'email_1': '%Yu%', 'param_1': 10}
2025-03-29 18:09:43,557 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:09:43,558 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:09:43,559 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:09:43,559 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:09:43,559 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:09:46,200 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:46,200 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:46,200 - sqlalchemy.engine.Engine - INFO - [cached since 374.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:46,201 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:46,201 - sqlalchemy.engine.Engine - INFO - [cached since 374.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 46, 201241), 'users_id': 3}
2025-03-29 18:09:46,202 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:46,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:46,203 - sqlalchemy.engine.Engine - INFO - [cached since 374.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:09:46,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:46,204 - sqlalchemy.engine.Engine - INFO - [cached since 374.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:46,204 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 18:09:46,204 - app.api.v1.endpoints.websocket - INFO - Generated chat_id de9988f0-d7d2-4f4b-b91e-6a11aade2b77 for users 3 and 2
2025-03-29 18:09:46,204 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:09:46,204 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:09:46,204 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:09:46,204 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:09:46,205 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:09:46,205 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:09:46,205 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:09:46,205 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:09:46,205 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:09:46,205 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:09:57,641 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:57,641 - sqlalchemy.engine.Engine - INFO - [cached since 386.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:57,642 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:57,642 - sqlalchemy.engine.Engine - INFO - [cached since 386.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 57, 642559), 'users_id': 3}
2025-03-29 18:09:57,643 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:09:57,767 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:09:57,768 - app.services.connection_manager - INFO - User 2 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:09:57,768 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:09:57,769 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:09:58,742 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:09:58,742 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:09:58,743 - sqlalchemy.engine.Engine - INFO - [cached since 387.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:09:58,744 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:09:58,744 - sqlalchemy.engine.Engine - INFO - [cached since 387.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 9, 58, 743189), 'users_id': 3}
2025-03-29 18:09:58,744 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:05,157 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:05,157 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:05,157 - sqlalchemy.engine.Engine - INFO - [cached since 393.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:05,158 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:05,158 - sqlalchemy.engine.Engine - INFO - [cached since 393.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 5, 158621), 'users_id': 2}
2025-03-29 18:10:05,159 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:16,081 - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:16.081094", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:16,081 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:16.081094", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:16,082 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0070000000000001}
2025-03-29 18:10:16,082 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0070000000000001}
2025-03-29 18:10:16,498 - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:16.498938", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:16,498 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:16.498938", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:16,500 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:16,500 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:16,500 - sqlalchemy.engine.Engine - INFO - [cached since 352.9s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'crbjxH2HERSLUuoUZvObFfoQVMb7S0pfJaVAmxT02vo', 'param_1': 1}
2025-03-29 18:10:16,501 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:10:16,501 - sqlalchemy.engine.Engine - INFO - [cached since 352.9s ago] {'refresh_token': '1fBRvMMzf9Tex8glCQZt8CpHVSqowKnmt5dlSXvI3uI', 'user_devices_id': 13}
2025-03-29 18:10:16,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:16,506 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 18:10:16,506 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-29 18:10:16,573 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:10:16,574 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:10:16,574 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:10:16,575 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:10:16,575 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:10:16,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:16,575 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:16,575 - sqlalchemy.engine.Engine - INFO - [cached since 405.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:16,576 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:16,577 - sqlalchemy.engine.Engine - INFO - [cached since 405.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 16, 576958), 'users_id': 2}
2025-03-29 18:10:16,577 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:16,578 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:10:17,040 - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:17.040351", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:17,040 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:17.040351", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:17,042 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 454a47c2-9429-4985-9a2c-04b6782ebc50
2025-03-29 18:10:17,042 - app.services.secure_channel_service - INFO - Creating channel with ID: 454a47c2-9429-4985-9a2c-04b6782ebc50
2025-03-29 18:10:17,043 - app.services.secure_channel_service - INFO - Channel 454a47c2-9429-4985-9a2c-04b6782ebc50 saved to Redis with TTL 1800 seconds
2025-03-29 18:10:17,043 - app.api.v1.endpoints.auth - INFO - Channel 454a47c2-9429-4985-9a2c-04b6782ebc50 initialized successfully
2025-03-29 18:10:17,043 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:10:17,043 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:10:19,571 - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:19.570353", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:19,571 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:10:19.570353", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:10:19,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:19,573 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:19,573 - sqlalchemy.engine.Engine - INFO - [cached since 408.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:19,574 - app.api.v1.endpoints.users - INFO - Search request received, channel: 454a47c2-9429-4985-9a2c-04b6782ebc50
2025-03-29 18:10:19,574 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743262816}
2025-03-29 18:10:19,575 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-29 18:10:19,575 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-29 18:10:19,575 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-29 18:10:19,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:10:19,576 - sqlalchemy.engine.Engine - INFO - [cached since 357.1s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-29 18:10:19,577 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:10:19,577 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:10:19,578 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:10:19,578 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.0}
2025-03-29 18:10:19,578 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.0}
2025-03-29 18:10:22,388 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:22,388 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:22,388 - sqlalchemy.engine.Engine - INFO - [cached since 410.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:22,389 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:22,389 - sqlalchemy.engine.Engine - INFO - [cached since 410.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 22, 389095), 'users_id': 2}
2025-03-29 18:10:22,390 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:22,391 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:22,391 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:22,391 - sqlalchemy.engine.Engine - INFO - [cached since 410.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:10:22,391 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:22,392 - sqlalchemy.engine.Engine - INFO - [cached since 410.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:22,392 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:10:22,392 - app.api.v1.endpoints.websocket - INFO - Generated chat_id f63757b8-41d4-40e9-96b8-06271af76440 for users 2 and 3
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:10:22,392 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:10:22,393 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:10:22,393 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:10:22,393 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:10:27,624 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:27,625 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:27,625 - sqlalchemy.engine.Engine - INFO - [cached since 416.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:10:27,626 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:27,626 - sqlalchemy.engine.Engine - INFO - [cached since 416.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 27, 625090), 'users_id': 3}
2025-03-29 18:10:27,626 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:28,760 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:28,760 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:28,760 - sqlalchemy.engine.Engine - INFO - [cached since 417.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:10:28,761 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:28,761 - sqlalchemy.engine.Engine - INFO - [cached since 417.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 28, 761153), 'users_id': 3}
2025-03-29 18:10:28,762 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:35,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:35,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:35,115 - sqlalchemy.engine.Engine - INFO - [cached since 423.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:35,115 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:35,116 - sqlalchemy.engine.Engine - INFO - [cached since 423.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 35, 115634), 'users_id': 2}
2025-03-29 18:10:35,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:46,567 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:46,567 - sqlalchemy.engine.Engine - INFO - [cached since 435.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:10:46,568 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:46,568 - sqlalchemy.engine.Engine - INFO - [cached since 435.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 46, 568901), 'users_id': 2}
2025-03-29 18:10:46,569 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:57,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:57,638 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:57,639 - sqlalchemy.engine.Engine - INFO - [cached since 446.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:10:57,639 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:57,640 - sqlalchemy.engine.Engine - INFO - [cached since 446.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 57, 639384), 'users_id': 3}
2025-03-29 18:10:57,640 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:10:58,673 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:10:58,673 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:10:58,673 - sqlalchemy.engine.Engine - INFO - [cached since 447.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:10:58,674 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:10:58,674 - sqlalchemy.engine.Engine - INFO - [cached since 447.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 10, 58, 674296), 'users_id': 3}
2025-03-29 18:10:58,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:02,414 - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:02.414684", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:02,414 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:02.414684", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:02,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:02,416 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:02,416 - sqlalchemy.engine.Engine - INFO - [cached since 398.8s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': '1fBRvMMzf9Tex8glCQZt8CpHVSqowKnmt5dlSXvI3uI', 'param_1': 1}
2025-03-29 18:11:02,417 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:11:02,417 - sqlalchemy.engine.Engine - INFO - [cached since 398.8s ago] {'refresh_token': 'SxOuMU7vqTav1OBEFwyQsBprB-HwEZM_hA5_FpuYniU', 'user_devices_id': 13}
2025-03-29 18:11:02,418 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:02,418 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-29 18:11:02,418 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-29 18:11:02,461 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:11:02,461 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:11:02,461 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:11:02,461 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:11:02,462 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:11:02,462 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:02,462 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:02,462 - sqlalchemy.engine.Engine - INFO - [cached since 451s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:11:02,463 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:02,463 - sqlalchemy.engine.Engine - INFO - [cached since 451s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 2, 463694), 'users_id': 2}
2025-03-29 18:11:02,464 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:02,464 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:11:05,115 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:05,115 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:05,115 - sqlalchemy.engine.Engine - INFO - [cached since 453.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:11:05,116 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:05,116 - sqlalchemy.engine.Engine - INFO - [cached since 453.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 5, 116525), 'users_id': 2}
2025-03-29 18:11:05,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:11,900 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:11:11,900 - app.services.connection_manager - INFO - User 2 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:11:11,900 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:11:11,901 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:11:11,901 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:11:11,901 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:11:11,902 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:11:11,902 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:11:11,902 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:11:11,903 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:11:11,903 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:11:11,904 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:11:17,241 - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:17.241221", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:17,241 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:17.241221", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:17,241 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:11:17,241 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:11:17,334 - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:17.334241", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:17,334 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:17.334241", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:17,336 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:17,336 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:17,336 - sqlalchemy.engine.Engine - INFO - [cached since 413.7s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'SxOuMU7vqTav1OBEFwyQsBprB-HwEZM_hA5_FpuYniU', 'param_1': 1}
2025-03-29 18:11:17,337 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:11:17,337 - sqlalchemy.engine.Engine - INFO - [cached since 413.7s ago] {'refresh_token': 'aV0tqUtM3kuat_bA8ZhxtmaV1EtcSG0UI9gFbXxRytA', 'user_devices_id': 13}
2025-03-29 18:11:17,338 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:17,339 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-03-29 18:11:17,339 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-03-29 18:11:17,482 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:11:17,482 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:11:17,482 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:11:17,483 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:11:17,483 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:11:17,484 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:17,484 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:17,484 - sqlalchemy.engine.Engine - INFO - [cached since 466s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:11:17,485 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:17,485 - sqlalchemy.engine.Engine - INFO - [cached since 466s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 17, 485276), 'users_id': 2}
2025-03-29 18:11:17,485 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:17,486 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:11:18,811 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:11:18,812 - app.services.connection_manager - INFO - User 2 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:11:18,812 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:11:18,812 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:11:18,813 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:11:18,813 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:18,813 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:18,813 - sqlalchemy.engine.Engine - INFO - [cached since 467.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:11:18,814 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:18,814 - sqlalchemy.engine.Engine - INFO - [cached since 467.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 18, 814583), 'users_id': 2}
2025-03-29 18:11:18,815 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:18,815 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:11:18,833 - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:18.833587", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:18,833 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:18.833587", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:11:18,834 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0cb1a0ed-82a4-43f9-902d-60e9b757a3a5
2025-03-29 18:11:18,834 - app.services.secure_channel_service - INFO - Creating channel with ID: 0cb1a0ed-82a4-43f9-902d-60e9b757a3a5
2025-03-29 18:11:18,835 - app.services.secure_channel_service - INFO - Channel 0cb1a0ed-82a4-43f9-902d-60e9b757a3a5 saved to Redis with TTL 1800 seconds
2025-03-29 18:11:18,835 - app.api.v1.endpoints.auth - INFO - Channel 0cb1a0ed-82a4-43f9-902d-60e9b757a3a5 initialized successfully
2025-03-29 18:11:18,835 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:11:18,835 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:11:27,658 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:27,658 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:27,658 - sqlalchemy.engine.Engine - INFO - [cached since 476.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:11:27,659 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:27,659 - sqlalchemy.engine.Engine - INFO - [cached since 476.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 27, 659660), 'users_id': 3}
2025-03-29 18:11:27,660 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:28,672 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:28,672 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:28,673 - sqlalchemy.engine.Engine - INFO - [cached since 477.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:11:28,674 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:28,674 - sqlalchemy.engine.Engine - INFO - [cached since 477.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 28, 673085), 'users_id': 3}
2025-03-29 18:11:28,674 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:33,226 - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:33.226893", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:11:33,226 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:11:33.226893", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:11:33,227 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:33,227 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:33,227 - sqlalchemy.engine.Engine - INFO - [cached since 429.6s ago] {'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token_1': 'g6UdyiQDuUyilQqtnaZQTVoiZVuw9JFdoDka8suH_I8', 'param_1': 1}
2025-03-29 18:11:33,229 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:11:33,229 - sqlalchemy.engine.Engine - INFO - [cached since 429.6s ago] {'refresh_token': 'sPxrYCtb6pGy3EHZWDQanjTZ9coxZHY72IWWuK_aJFk', 'user_devices_id': 14}
2025-03-29 18:11:33,230 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:33,230 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 18:11:33,230 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-29 18:11:33,365 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:11:33,366 - app.services.connection_manager - INFO - User 3 connected to server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:11:33,366 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:11:33,367 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:11:33,367 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:11:33,367 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:33,367 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:33,367 - sqlalchemy.engine.Engine - INFO - [cached since 481.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:11:33,368 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:33,368 - sqlalchemy.engine.Engine - INFO - [cached since 481.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 33, 368941), 'users_id': 3}
2025-03-29 18:11:33,369 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:33,369 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:11:47,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:47,422 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:47,422 - sqlalchemy.engine.Engine - INFO - [cached since 495.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:11:47,423 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:47,423 - sqlalchemy.engine.Engine - INFO - [cached since 495.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 47, 423918), 'users_id': 2}
2025-03-29 18:11:47,424 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:48,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:48,774 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:48,774 - sqlalchemy.engine.Engine - INFO - [cached since 497.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:11:48,775 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:48,775 - sqlalchemy.engine.Engine - INFO - [cached since 497.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 48, 774611), 'users_id': 2}
2025-03-29 18:11:48,775 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:11:58,665 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:11:58,665 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:11:58,666 - sqlalchemy.engine.Engine - INFO - [cached since 507.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:11:58,667 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:11:58,667 - sqlalchemy.engine.Engine - INFO - [cached since 507.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 11, 58, 666387), 'users_id': 3}
2025-03-29 18:11:58,667 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:03,263 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:03,263 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:03,263 - sqlalchemy.engine.Engine - INFO - [cached since 511.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:03,264 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:03,264 - sqlalchemy.engine.Engine - INFO - [cached since 511.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 3, 264971), 'users_id': 3}
2025-03-29 18:12:03,265 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:09,556 - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:09.556404", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:09,556 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:09.556404", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:09,559 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:09,559 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:09,559 - sqlalchemy.engine.Engine - INFO - [cached since 518.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:09,560 - app.api.v1.endpoints.users - INFO - Search request received, channel: 31197e86-b451-4f03-8a5f-b95ad7e2bf92
2025-03-29 18:12:09,561 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743262893}
2025-03-29 18:12:09,562 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 18:12:09,562 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 18:12:09,562 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 18:12:09,562 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:12:09,562 - sqlalchemy.engine.Engine - INFO - [cached since 467.1s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 18:12:09,563 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:12:09,563 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:12:09,564 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:12:09,564 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:12:09,564 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:12:11,181 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:11,181 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:11,181 - sqlalchemy.engine.Engine - INFO - [cached since 519.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:11,183 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:11,183 - sqlalchemy.engine.Engine - INFO - [cached since 519.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 11, 182430), 'users_id': 3}
2025-03-29 18:12:11,183 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:11,188 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:11,188 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:11,189 - sqlalchemy.engine.Engine - INFO - [cached since 519.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:12:11,189 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:11,189 - sqlalchemy.engine.Engine - INFO - [cached since 519.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:11,190 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 18:12:11,190 - app.api.v1.endpoints.websocket - INFO - Generated chat_id d8705834-8b19-4e62-aa36-fed1e1ae02dd for users 3 and 2
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:12:11,190 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:12:11,191 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:12:11,191 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:12:11,191 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:12:17,405 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:17,405 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:17,405 - sqlalchemy.engine.Engine - INFO - [cached since 525.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:12:17,406 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:17,406 - sqlalchemy.engine.Engine - INFO - [cached since 525.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 17, 406336), 'users_id': 2}
2025-03-29 18:12:17,407 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:18,721 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:12:18,722 - app.services.connection_manager - INFO - User 3 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:12:18,722 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:12:18,723 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:12:18,725 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:12:18,725 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:12:18,725 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:12:18,726 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:12:18,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:18,762 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:18,763 - sqlalchemy.engine.Engine - INFO - [cached since 527.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:12:18,763 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:18,764 - sqlalchemy.engine.Engine - INFO - [cached since 527.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 18, 763407), 'users_id': 2}
2025-03-29 18:12:18,764 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:20,386 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:12:20,386 - app.services.connection_manager - INFO - User 2 disconnected from server 6741028e-ba04-4c02-941f-edc8cc2744a8
2025-03-29 18:12:20,386 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:12:20,387 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:12:26,033 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:12:26,033 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:12:26,033 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:12:26,033 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:12:26,034 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:12:26,034 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:12:26,035 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:12:26,035 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:12:26,126 - app.main - INFO - Shutting down server...
2025-03-29 18:12:26,127 - app.main - INFO - Redis connections closed
2025-03-29 18:12:26,127 - app.main - INFO - Server shutdown completed
2025-03-29 18:12:33,517 - app.main - INFO - Starting up server...
2025-03-29 18:12:33,518 - app.main - INFO - Redis initialized
2025-03-29 18:12:33,554 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-29 18:12:33,554 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:12:33,555 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-29 18:12:33,555 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:12:33,555 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-29 18:12:33,555 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:12:33,558 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:33,558 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:12:33,558 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:12:33,560 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:12:33,560 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:33,561 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:12:33,561 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:12:33,561 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:12:33,562 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007349s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:12:33,562 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:33,563 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:33,563 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:12:33,563 - sqlalchemy.engine.Engine - INFO - [cached since 0.004765s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:12:33,563 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:12:33,563 - app.main - INFO - Database initialized
2025-03-29 18:12:33,589 - app.main - INFO - Server key pair generated
2025-03-29 18:12:33,590 - app.main - INFO - Server startup completed successfully
2025-03-29 18:12:34,125 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:12:34,125 - app.services.connection_manager - INFO - User 2 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:34,125 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:12:34,131 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:12:34,131 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:12:34,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:34,136 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:34,137 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'id_1': '2', 'param_1': 1}
2025-03-29 18:12:34,139 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:34,139 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 34, 138188), 'users_id': 2}
2025-03-29 18:12:34,140 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:34,143 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:12:34,336 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:12:34,336 - app.services.connection_manager - INFO - User 3 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:34,336 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:12:34,336 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:12:34,337 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:12:34,337 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:34,337 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:34,337 - sqlalchemy.engine.Engine - INFO - [cached since 0.2017s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:34,338 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:34,338 - sqlalchemy.engine.Engine - INFO - [cached since 0.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 34, 338938), 'users_id': 3}
2025-03-29 18:12:34,339 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:34,339 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:12:48,061 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:12:48,061 - app.services.connection_manager - INFO - User 3 disconnected from server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:48,061 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:12:48,062 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:12:48,602 - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:48.602112", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:48,602 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:48.602112", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:48,603 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:12:48,603 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-29 18:12:48,812 - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:48.812516", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:48,812 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:48.812516", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:48,815 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:48,816 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:48,817 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token_1': 'sPxrYCtb6pGy3EHZWDQanjTZ9coxZHY72IWWuK_aJFk', 'param_1': 1}
2025-03-29 18:12:48,819 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:12:48,819 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'refresh_token': 'DdOpP_spHTZKrkdOAtGXxUQNtpeBzLykzSy9kq9_jzA', 'user_devices_id': 14}
2025-03-29 18:12:48,820 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:48,825 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.004}
2025-03-29 18:12:48,825 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.004}
2025-03-29 18:12:48,977 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:12:48,977 - app.services.connection_manager - INFO - User 3 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:48,977 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:12:48,978 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:12:48,978 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:12:48,979 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:48,979 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:48,979 - sqlalchemy.engine.Engine - INFO - [cached since 14.84s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:48,980 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:48,980 - sqlalchemy.engine.Engine - INFO - [cached since 14.84s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 48, 980532), 'users_id': 3}
2025-03-29 18:12:48,980 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:48,981 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:12:49,558 - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:49.557036", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:49,558 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:49.557036", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:12:49,559 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 91b0aa76-a7a7-4823-ae6a-020c698533a4
2025-03-29 18:12:49,559 - app.services.secure_channel_service - INFO - Creating channel with ID: 91b0aa76-a7a7-4823-ae6a-020c698533a4
2025-03-29 18:12:49,562 - app.services.secure_channel_service - INFO - Channel 91b0aa76-a7a7-4823-ae6a-020c698533a4 saved to Redis with TTL 1800 seconds
2025-03-29 18:12:49,563 - app.api.v1.endpoints.auth - INFO - Channel 91b0aa76-a7a7-4823-ae6a-020c698533a4 initialized successfully
2025-03-29 18:12:49,563 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.004}
2025-03-29 18:12:49,563 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.004}
2025-03-29 18:12:49,737 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:12:49,737 - app.services.connection_manager - INFO - User 3 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:49,737 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:12:49,738 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:12:49,738 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:12:49,739 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:49,739 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:49,739 - sqlalchemy.engine.Engine - INFO - [cached since 15.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:12:49,740 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:49,740 - sqlalchemy.engine.Engine - INFO - [cached since 15.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 49, 740817), 'users_id': 3}
2025-03-29 18:12:49,741 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:49,746 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:12:55,641 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:12:55,642 - app.services.connection_manager - INFO - User 2 disconnected from server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:55,642 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:12:55,643 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:12:59,459 - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:59.459488", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:12:59,459 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:59.459488", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:12:59,460 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:12:59,460 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:12:59,898 - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:59.898587", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:12:59,898 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:12:59.898587", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:12:59,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:59,900 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:59,900 - sqlalchemy.engine.Engine - INFO - [cached since 11.08s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'aV0tqUtM3kuat_bA8ZhxtmaV1EtcSG0UI9gFbXxRytA', 'param_1': 1}
2025-03-29 18:12:59,901 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:12:59,901 - sqlalchemy.engine.Engine - INFO - [cached since 11.08s ago] {'refresh_token': 'PulVFqd0K5wnuUg2HBZXcKOBE9hyqcNh2m1GQHCZAXg', 'user_devices_id': 13}
2025-03-29 18:12:59,902 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:59,907 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 18:12:59,907 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-29 18:12:59,992 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:12:59,992 - app.services.connection_manager - INFO - User 2 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:12:59,992 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:12:59,993 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:12:59,993 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:12:59,993 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:12:59,994 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:12:59,994 - sqlalchemy.engine.Engine - INFO - [cached since 25.86s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:12:59,995 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:12:59,995 - sqlalchemy.engine.Engine - INFO - [cached since 25.86s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 12, 59, 994452), 'users_id': 2}
2025-03-29 18:12:59,995 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:12:59,996 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:13:00,888 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:13:00,888 - app.services.connection_manager - INFO - User 2 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:13:00,888 - app.services.connection_manager - INFO - Active connections after connect: ['3', '2']
2025-03-29 18:13:00,889 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:13:00,889 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:13:00,890 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:00,890 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:00,890 - sqlalchemy.engine.Engine - INFO - [cached since 26.75s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:00,891 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:00,891 - sqlalchemy.engine.Engine - INFO - [cached since 26.75s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 0, 891923), 'users_id': 2}
2025-03-29 18:13:00,891 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:00,892 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:13:01,684 - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:01.684393", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:13:01,684 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:01.684393", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:13:01,686 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0df73dbe-7925-47b5-b324-6158c913b9a0
2025-03-29 18:13:01,686 - app.services.secure_channel_service - INFO - Creating channel with ID: 0df73dbe-7925-47b5-b324-6158c913b9a0
2025-03-29 18:13:01,686 - app.services.secure_channel_service - INFO - Channel 0df73dbe-7925-47b5-b324-6158c913b9a0 saved to Redis with TTL 1800 seconds
2025-03-29 18:13:01,687 - app.api.v1.endpoints.auth - INFO - Channel 0df73dbe-7925-47b5-b324-6158c913b9a0 initialized successfully
2025-03-29 18:13:01,687 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:13:01,687 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:13:07,985 - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:07.985766", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:13:07,985 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:07.985766", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:13:07,987 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:07,987 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:07,987 - sqlalchemy.engine.Engine - INFO - [cached since 33.85s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:07,989 - app.api.v1.endpoints.users - INFO - Search request received, channel: 0df73dbe-7925-47b5-b324-6158c913b9a0
2025-03-29 18:13:07,989 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743262979}
2025-03-29 18:13:07,990 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-29 18:13:07,990 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-29 18:13:07,990 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-29 18:13:07,991 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:13:07,991 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-29 18:13:07,992 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:13:07,992 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:13:07,993 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:13:07,993 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:13:07,993 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:13:08,580 - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:08.580272", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:13:08,580 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:08.580272", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:13:08,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:08,582 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:08,582 - sqlalchemy.engine.Engine - INFO - [cached since 34.45s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:08,583 - app.api.v1.endpoints.users - INFO - Search request received, channel: 0df73dbe-7925-47b5-b324-6158c913b9a0
2025-03-29 18:13:08,583 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743262979}
2025-03-29 18:13:08,584 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-29 18:13:08,585 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-29 18:13:08,585 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-29 18:13:08,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:13:08,585 - sqlalchemy.engine.Engine - INFO - [cached since 0.5938s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-29 18:13:08,586 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:13:08,586 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:13:08,587 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:13:08,587 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:13:08,587 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:13:11,637 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:11,637 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:11,637 - sqlalchemy.engine.Engine - INFO - [cached since 37.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:11,638 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:11,639 - sqlalchemy.engine.Engine - INFO - [cached since 37.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 11, 638369), 'users_id': 2}
2025-03-29 18:13:11,639 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:11,644 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:11,644 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:11,644 - sqlalchemy.engine.Engine - INFO - [cached since 37.51s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:13:11,645 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:11,645 - sqlalchemy.engine.Engine - INFO - [cached since 37.51s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:11,646 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:13:11,646 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 9e4d7e0b-5630-403f-92b6-00995e363ba5 for users 2 and 3
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - Current active connections: ['3', '2']
2025-03-29 18:13:11,646 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:13:11,647 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:13:19,139 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:19,139 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:19,139 - sqlalchemy.engine.Engine - INFO - [cached since 45s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:13:19,141 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:19,141 - sqlalchemy.engine.Engine - INFO - [cached since 45s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 19, 140847), 'users_id': 3}
2025-03-29 18:13:19,141 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:19,610 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:19,611 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:19,611 - sqlalchemy.engine.Engine - INFO - [cached since 45.47s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:13:19,612 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:19,612 - sqlalchemy.engine.Engine - INFO - [cached since 45.47s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 19, 611690), 'users_id': 3}
2025-03-29 18:13:19,612 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:23,072 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:13:23,072 - app.services.connection_manager - INFO - User 3 disconnected from server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:13:23,072 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:13:23,074 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:13:27,867 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:13:27,867 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:13:27,867 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:13:27,867 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:13:29,030 - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:29.030393", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:13:29,030 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:29.030393", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:13:29,031 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9959999999999999}
2025-03-29 18:13:29,031 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9959999999999999}
2025-03-29 18:13:29,318 - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:29.317906", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:13:29,318 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:29.317906", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:13:29,319 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:29,319 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:29,319 - sqlalchemy.engine.Engine - INFO - [cached since 40.5s ago] {'device_id_1': '237a9b4a-3d78-4c0e-a66f-37a16bebe1d6', 'refresh_token_1': 'DdOpP_spHTZKrkdOAtGXxUQNtpeBzLykzSy9kq9_jzA', 'param_1': 1}
2025-03-29 18:13:29,321 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:13:29,321 - sqlalchemy.engine.Engine - INFO - [cached since 40.5s ago] {'refresh_token': 's8ddSCprgA83B4fZTMXLRYusvaXAHDUia0In0dVKlwg', 'user_devices_id': 14}
2025-03-29 18:13:29,322 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:29,327 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.003}
2025-03-29 18:13:29,327 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.003}
2025-03-29 18:13:29,445 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:13:29,445 - app.services.connection_manager - INFO - User 3 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:13:29,445 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:13:29,446 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:13:29,446 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:13:29,447 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:29,447 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:29,447 - sqlalchemy.engine.Engine - INFO - [cached since 55.31s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:13:29,448 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:29,448 - sqlalchemy.engine.Engine - INFO - [cached since 55.31s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 29, 448359), 'users_id': 3}
2025-03-29 18:13:29,449 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:29,449 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:13:29,991 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:29,992 - sqlalchemy.engine.Engine - INFO - [cached since 55.86s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:29,992 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:29,993 - sqlalchemy.engine.Engine - INFO - [cached since 55.85s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 29, 992317), 'users_id': 2}
2025-03-29 18:13:29,993 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:30,178 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:13:30,179 - app.services.connection_manager - INFO - User 3 connected to server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:13:30,179 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:13:30,179 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:13:30,180 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:13:30,180 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:30,180 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:30,180 - sqlalchemy.engine.Engine - INFO - [cached since 56.04s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:13:30,181 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:30,181 - sqlalchemy.engine.Engine - INFO - [cached since 56.04s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 30, 181088), 'users_id': 3}
2025-03-29 18:13:30,182 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:30,182 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:13:30,675 - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:30.675778", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:13:30,675 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:13:30.675778", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:13:30,677 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: a9b7c096-7493-4db6-8d83-a8fa7f8ac839
2025-03-29 18:13:30,677 - app.services.secure_channel_service - INFO - Creating channel with ID: a9b7c096-7493-4db6-8d83-a8fa7f8ac839
2025-03-29 18:13:30,678 - app.services.secure_channel_service - INFO - Channel a9b7c096-7493-4db6-8d83-a8fa7f8ac839 saved to Redis with TTL 1800 seconds
2025-03-29 18:13:30,678 - app.api.v1.endpoints.auth - INFO - Channel a9b7c096-7493-4db6-8d83-a8fa7f8ac839 initialized successfully
2025-03-29 18:13:30,678 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:13:30,678 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:13:30,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:13:30,800 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:13:30,800 - sqlalchemy.engine.Engine - INFO - [cached since 56.66s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:13:30,801 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:13:30,801 - sqlalchemy.engine.Engine - INFO - [cached since 56.66s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 13, 30, 801019), 'users_id': 2}
2025-03-29 18:13:30,802 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:13:39,730 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:13:39,730 - app.services.connection_manager - INFO - User 2 disconnected from server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:13:39,730 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-29 18:13:39,731 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:13:41,100 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:13:41,100 - app.services.connection_manager - INFO - User 3 disconnected from server 59878d51-adce-415e-a135-775ddb5a5673
2025-03-29 18:13:41,100 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:13:41,101 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:13:48,360 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:13:48,360 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:13:48,360 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:13:48,360 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:13:48,360 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:13:48,360 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:13:48,361 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:13:48,362 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:13:48,455 - app.main - INFO - Shutting down server...
2025-03-29 18:13:48,456 - app.main - INFO - Redis connections closed
2025-03-29 18:13:48,456 - app.main - INFO - Server shutdown completed
2025-03-29 18:14:35,296 - app.main - INFO - Starting up server...
2025-03-29 18:14:35,297 - app.main - INFO - Redis initialized
2025-03-29 18:14:35,334 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-29 18:14:35,334 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:14:35,335 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-29 18:14:35,335 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:14:35,335 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-29 18:14:35,335 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:14:35,338 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:35,338 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:14:35,338 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:14:35,340 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:14:35,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:35,342 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:14:35,342 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:14:35,342 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:14:35,342 - sqlalchemy.engine.Engine - INFO - [cached since 0.000818s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:14:35,343 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:14:35,343 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:35,344 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:14:35,344 - sqlalchemy.engine.Engine - INFO - [cached since 0.005517s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:14:35,344 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:14:35,344 - app.main - INFO - Database initialized
2025-03-29 18:14:35,479 - app.main - INFO - Server key pair generated
2025-03-29 18:14:35,479 - app.main - INFO - Server startup completed successfully
2025-03-29 18:14:36,765 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:14:36,765 - app.services.connection_manager - INFO - User 2 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:14:36,765 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:14:36,770 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:14:36,770 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:14:36,775 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:36,776 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:14:36,776 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'id_1': '2', 'param_1': 1}
2025-03-29 18:14:36,779 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:14:36,779 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'last_seen': datetime.datetime(2025, 3, 29, 15, 14, 36, 778433), 'users_id': 2}
2025-03-29 18:14:36,780 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:14:36,786 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:14:40,147 - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:40.147631", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:40,147 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:40.147631", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:40,148 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:14:40,148 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:14:47,206 - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:47.206139", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:47,206 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:47.206139", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:47,206 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:14:47,206 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:14:55,942 - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:55.942970", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:55,942 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:55.942970", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:55,944 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 56309f88-e893-4bb1-88e0-6b9507dd2b69
2025-03-29 18:14:55,944 - app.services.secure_channel_service - INFO - Creating channel with ID: 56309f88-e893-4bb1-88e0-6b9507dd2b69
2025-03-29 18:14:55,946 - app.services.secure_channel_service - INFO - Channel 56309f88-e893-4bb1-88e0-6b9507dd2b69 saved to Redis with TTL 1800 seconds
2025-03-29 18:14:55,946 - app.api.v1.endpoints.auth - INFO - Channel 56309f88-e893-4bb1-88e0-6b9507dd2b69 initialized successfully
2025-03-29 18:14:55,947 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:14:55,947 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:14:56,322 - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:56.322076", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:56,322 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:56.322076", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:56,324 - app.api.v1.endpoints.auth - INFO - Login request using channel: 56309f88-e893-4bb1-88e0-6b9507dd2b69
2025-03-29 18:14:56,325 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"4be0d0fc-f53e-4e2b-9ee5-72aa9e622d0d"}
2025-03-29 18:14:56,325 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '4be0d0fc-f53e-4e2b-9ee5-72aa9e622d0d'}
2025-03-29 18:14:56,326 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:56,326 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 18:14:56,327 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-29 18:14:56,544 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:14:56,544 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] {'user_id_1': 3, 'device_id_1': '4be0d0fc-f53e-4e2b-9ee5-72aa9e622d0d', 'param_1': 1}
2025-03-29 18:14:56,547 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 18:14:56,547 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'users_id': 3}
2025-03-29 18:14:56,548 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 18:14:56,548 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'user_id': 3, 'device_id': '4be0d0fc-f53e-4e2b-9ee5-72aa9e622d0d', 'refresh_token': None, 'last_login': None}
2025-03-29 18:14:56,549 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-29 18:14:56,550 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:14:56,550 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'refresh_token': 'dbfBNCV_ZQNUi87w2HpTPYGtjZXaqdF1bKSMocEw6uI', 'user_devices_id': 15}
2025-03-29 18:14:56,551 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:14:56,560 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 18:14:56,560 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 18:14:56,561 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 18:14:56,561 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 239.054}
2025-03-29 18:14:56,561 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 239.054}
2025-03-29 18:14:57,271 - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:57.270880", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:57,271 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:14:57.270880", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:14:57,271 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9eed5f3e-322b-4c85-b32b-efaf7d2cd742
2025-03-29 18:14:57,272 - app.services.secure_channel_service - INFO - Creating channel with ID: 9eed5f3e-322b-4c85-b32b-efaf7d2cd742
2025-03-29 18:14:57,272 - app.services.secure_channel_service - INFO - Channel 9eed5f3e-322b-4c85-b32b-efaf7d2cd742 saved to Redis with TTL 1800 seconds
2025-03-29 18:14:57,272 - app.api.v1.endpoints.auth - INFO - Channel 9eed5f3e-322b-4c85-b32b-efaf7d2cd742 initialized successfully
2025-03-29 18:14:57,273 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:14:57,273 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:14:57,276 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:14:57,277 - app.services.connection_manager - INFO - User 3 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:14:57,277 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:14:57,277 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:14:57,277 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:14:57,278 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:57,278 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:14:57,278 - sqlalchemy.engine.Engine - INFO - [cached since 20.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:14:57,279 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:14:57,279 - sqlalchemy.engine.Engine - INFO - [cached since 20.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 14, 57, 279882), 'users_id': 3}
2025-03-29 18:14:57,280 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:14:57,285 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:14:58,618 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:14:58,618 - app.services.connection_manager - INFO - User 3 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:14:58,618 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:14:58,619 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:14:58,619 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:14:58,620 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:58,620 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:14:58,620 - sqlalchemy.engine.Engine - INFO - [cached since 21.84s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:14:58,621 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:14:58,621 - sqlalchemy.engine.Engine - INFO - [cached since 21.84s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 14, 58, 621244), 'users_id': 3}
2025-03-29 18:14:58,622 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:14:58,627 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:14:59,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:14:59,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:14:59,710 - sqlalchemy.engine.Engine - INFO - [cached since 22.93s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:14:59,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:14:59,711 - sqlalchemy.engine.Engine - INFO - [cached since 22.93s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 14, 59, 711872), 'users_id': 2}
2025-03-29 18:14:59,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:07,885 - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:07.885654", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:07,885 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:07.885654", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:07,886 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9959999999999999}
2025-03-29 18:15:07,886 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9959999999999999}
2025-03-29 18:15:08,324 - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:08.324909", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:08,324 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:08.324909", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:08,326 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:08,327 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:08,327 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'PulVFqd0K5wnuUg2HBZXcKOBE9hyqcNh2m1GQHCZAXg', 'param_1': 1}
2025-03-29 18:15:08,329 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:15:08,329 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'zkjTDGEqHdvo8VtAlz2mW2wp-pF8ECVpNdv8PO1Kra8', 'user_devices_id': 13}
2025-03-29 18:15:08,329 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:08,336 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.002}
2025-03-29 18:15:08,336 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.002}
2025-03-29 18:15:08,427 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:15:08,427 - app.services.connection_manager - INFO - User 2 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:15:08,428 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:15:08,428 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:15:08,428 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:15:08,429 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:08,429 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:08,429 - sqlalchemy.engine.Engine - INFO - [cached since 31.65s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:08,430 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:08,430 - sqlalchemy.engine.Engine - INFO - [cached since 31.65s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 8, 430946), 'users_id': 2}
2025-03-29 18:15:08,430 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:08,431 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:15:09,322 - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:09.322973", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:09,322 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:09.322973", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:09,324 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e326f408-2aff-4e9d-ba47-911a56624845
2025-03-29 18:15:09,324 - app.services.secure_channel_service - INFO - Creating channel with ID: e326f408-2aff-4e9d-ba47-911a56624845
2025-03-29 18:15:09,324 - app.services.secure_channel_service - INFO - Channel e326f408-2aff-4e9d-ba47-911a56624845 saved to Redis with TTL 1800 seconds
2025-03-29 18:15:09,325 - app.api.v1.endpoints.auth - INFO - Channel e326f408-2aff-4e9d-ba47-911a56624845 initialized successfully
2025-03-29 18:15:09,325 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0140000000000002}
2025-03-29 18:15:09,325 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0140000000000002}
2025-03-29 18:15:11,854 - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:11.854974", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:11,854 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:11.854974", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:11,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:11,856 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:11,856 - sqlalchemy.engine.Engine - INFO - [cached since 35.08s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:11,857 - app.api.v1.endpoints.users - INFO - Search request received, channel: e326f408-2aff-4e9d-ba47-911a56624845
2025-03-29 18:15:11,857 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263108}
2025-03-29 18:15:11,858 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-29 18:15:11,858 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-29 18:15:11,858 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-29 18:15:11,859 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:15:11,859 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-29 18:15:11,860 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:15:11,861 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:15:11,861 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:15:11,862 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 18:15:11,862 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 18:15:12,358 - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:12.358871", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:12,358 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:15:12.358871", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:15:12,359 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:12,360 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:12,360 - sqlalchemy.engine.Engine - INFO - [cached since 35.58s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:12,361 - app.api.v1.endpoints.users - INFO - Search request received, channel: e326f408-2aff-4e9d-ba47-911a56624845
2025-03-29 18:15:12,361 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263108}
2025-03-29 18:15:12,362 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-29 18:15:12,362 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-29 18:15:12,362 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-29 18:15:12,363 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:15:12,363 - sqlalchemy.engine.Engine - INFO - [cached since 0.5033s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-29 18:15:12,363 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:15:12,364 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:15:12,364 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:15:12,365 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.989000000000001}
2025-03-29 18:15:12,365 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.989000000000001}
2025-03-29 18:15:13,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:13,939 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:13,939 - sqlalchemy.engine.Engine - INFO - [cached since 37.16s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:13,940 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:13,940 - sqlalchemy.engine.Engine - INFO - [cached since 37.16s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 13, 940772), 'users_id': 2}
2025-03-29 18:15:13,941 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:13,941 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:13,941 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:13,941 - sqlalchemy.engine.Engine - INFO - [cached since 37.17s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:15:13,942 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:13,942 - sqlalchemy.engine.Engine - INFO - [cached since 37.17s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:13,943 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:15:13,943 - app.api.v1.endpoints.websocket - INFO - Generated chat_id c4b2b08d-db31-453c-8c87-4ff6d056d385 for users 2 and 3
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:15:13,943 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:15:27,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:27,340 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:27,340 - sqlalchemy.engine.Engine - INFO - [cached since 50.56s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:15:27,342 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:27,342 - sqlalchemy.engine.Engine - INFO - [cached since 50.56s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 27, 342483), 'users_id': 3}
2025-03-29 18:15:27,343 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:28,576 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:28,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:28,576 - sqlalchemy.engine.Engine - INFO - [cached since 51.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:15:28,577 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:28,577 - sqlalchemy.engine.Engine - INFO - [cached since 51.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 28, 577767), 'users_id': 3}
2025-03-29 18:15:28,578 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:29,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:29,711 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:29,711 - sqlalchemy.engine.Engine - INFO - [cached since 52.93s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:29,712 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:29,712 - sqlalchemy.engine.Engine - INFO - [cached since 52.93s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 29, 711012), 'users_id': 2}
2025-03-29 18:15:29,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:38,423 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:38,424 - sqlalchemy.engine.Engine - INFO - [cached since 61.65s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:38,424 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:38,424 - sqlalchemy.engine.Engine - INFO - [cached since 61.65s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 38, 424005), 'users_id': 2}
2025-03-29 18:15:38,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:57,279 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:57,280 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:57,280 - sqlalchemy.engine.Engine - INFO - [cached since 80.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:15:57,281 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:57,281 - sqlalchemy.engine.Engine - INFO - [cached since 80.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 57, 281401), 'users_id': 3}
2025-03-29 18:15:57,281 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:58,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:58,487 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:58,487 - sqlalchemy.engine.Engine - INFO - [cached since 81.71s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:15:58,488 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:58,488 - sqlalchemy.engine.Engine - INFO - [cached since 81.71s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 58, 488724), 'users_id': 3}
2025-03-29 18:15:58,488 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:15:59,711 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:15:59,711 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:15:59,711 - sqlalchemy.engine.Engine - INFO - [cached since 82.93s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:15:59,712 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:15:59,712 - sqlalchemy.engine.Engine - INFO - [cached since 82.93s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 15, 59, 712006), 'users_id': 2}
2025-03-29 18:15:59,713 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:08,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:08,423 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:08,423 - sqlalchemy.engine.Engine - INFO - [cached since 91.65s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:16:08,423 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:08,424 - sqlalchemy.engine.Engine - INFO - [cached since 91.64s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 8, 423032), 'users_id': 2}
2025-03-29 18:16:08,424 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:27,284 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:27,285 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:27,285 - sqlalchemy.engine.Engine - INFO - [cached since 110.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:16:27,286 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:27,286 - sqlalchemy.engine.Engine - INFO - [cached since 110.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 27, 285037), 'users_id': 3}
2025-03-29 18:16:27,286 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:28,615 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:28,615 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:28,615 - sqlalchemy.engine.Engine - INFO - [cached since 111.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:16:28,616 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:28,616 - sqlalchemy.engine.Engine - INFO - [cached since 111.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 28, 616337), 'users_id': 3}
2025-03-29 18:16:28,617 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:29,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:29,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:29,710 - sqlalchemy.engine.Engine - INFO - [cached since 112.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:16:29,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:29,712 - sqlalchemy.engine.Engine - INFO - [cached since 112.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 29, 711799), 'users_id': 2}
2025-03-29 18:16:29,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:38,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:38,422 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:38,422 - sqlalchemy.engine.Engine - INFO - [cached since 121.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:16:38,423 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:38,423 - sqlalchemy.engine.Engine - INFO - [cached since 121.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 38, 423796), 'users_id': 2}
2025-03-29 18:16:38,423 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:57,289 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:57,290 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:57,290 - sqlalchemy.engine.Engine - INFO - [cached since 140.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:16:57,291 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:57,291 - sqlalchemy.engine.Engine - INFO - [cached since 140.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 57, 290420), 'users_id': 3}
2025-03-29 18:16:57,291 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:58,499 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:58,499 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:58,499 - sqlalchemy.engine.Engine - INFO - [cached since 141.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:16:58,500 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:58,500 - sqlalchemy.engine.Engine - INFO - [cached since 141.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 58, 500335), 'users_id': 3}
2025-03-29 18:16:58,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:16:59,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:16:59,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:16:59,709 - sqlalchemy.engine.Engine - INFO - [cached since 142.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:16:59,710 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:16:59,710 - sqlalchemy.engine.Engine - INFO - [cached since 142.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 16, 59, 710632), 'users_id': 2}
2025-03-29 18:16:59,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:08,423 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:08,423 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:08,423 - sqlalchemy.engine.Engine - INFO - [cached since 151.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:17:08,424 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:17:08,424 - sqlalchemy.engine.Engine - INFO - [cached since 151.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 17, 8, 424349), 'users_id': 2}
2025-03-29 18:17:08,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:21,113 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:17:21,113 - app.services.connection_manager - INFO - User 3 disconnected from server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:17:21,113 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:17:21,114 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:17:22,602 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:17:22,602 - app.services.connection_manager - INFO - User 2 disconnected from server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:17:22,602 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:17:22,604 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:17:28,484 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:28,484 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:28,484 - sqlalchemy.engine.Engine - INFO - [cached since 171.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:17:28,485 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:17:28,485 - sqlalchemy.engine.Engine - INFO - [cached since 171.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 17, 28, 485471), 'users_id': 3}
2025-03-29 18:17:28,486 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:29,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:29,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:29,710 - sqlalchemy.engine.Engine - INFO - [cached since 172.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:17:29,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:17:29,711 - sqlalchemy.engine.Engine - INFO - [cached since 172.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 17, 29, 710085), 'users_id': 2}
2025-03-29 18:17:29,711 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:51,858 - INFO - Incoming request: {"timestamp": "2025-03-29T15:17:51.858048", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:17:51,858 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:17:51.858048", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:17:51,858 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:17:51,858 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:17:52,219 - INFO - Incoming request: {"timestamp": "2025-03-29T15:17:52.219131", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:17:52,219 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:17:52.219131", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:17:52,221 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:52,221 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:52,221 - sqlalchemy.engine.Engine - INFO - [cached since 163.9s ago] {'device_id_1': '4be0d0fc-f53e-4e2b-9ee5-72aa9e622d0d', 'refresh_token_1': 'dbfBNCV_ZQNUi87w2HpTPYGtjZXaqdF1bKSMocEw6uI', 'param_1': 1}
2025-03-29 18:17:52,223 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:17:52,223 - sqlalchemy.engine.Engine - INFO - [cached since 163.9s ago] {'refresh_token': 'AiC7Xt7z2_Vy0zJrATdiJkKVdKHTYT_EgkzODtY70pY', 'user_devices_id': 15}
2025-03-29 18:17:52,224 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:52,224 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-03-29 18:17:52,224 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-03-29 18:17:52,326 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:17:52,326 - app.services.connection_manager - INFO - User 3 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:17:52,326 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:17:52,327 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:17:52,327 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:17:52,328 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:52,328 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:52,328 - sqlalchemy.engine.Engine - INFO - [cached since 195.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:17:52,329 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:17:52,329 - sqlalchemy.engine.Engine - INFO - [cached since 195.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 17, 52, 329156), 'users_id': 3}
2025-03-29 18:17:52,329 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:52,330 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:17:53,783 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:17:53,783 - app.services.connection_manager - INFO - User 3 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:17:53,783 - app.services.connection_manager - INFO - Active connections after connect: ['3']
2025-03-29 18:17:53,784 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:17:53,784 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:17:53,784 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:53,784 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:53,784 - sqlalchemy.engine.Engine - INFO - [cached since 197s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:17:53,785 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:17:53,785 - sqlalchemy.engine.Engine - INFO - [cached since 197s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 17, 53, 785274), 'users_id': 3}
2025-03-29 18:17:53,786 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:17:53,791 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:17:54,224 - INFO - Incoming request: {"timestamp": "2025-03-29T15:17:54.224373", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:17:54,224 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:17:54.224373", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:17:54,226 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 38282065-74ec-4cda-a4d2-b3e7ec9eee72
2025-03-29 18:17:54,226 - app.services.secure_channel_service - INFO - Creating channel with ID: 38282065-74ec-4cda-a4d2-b3e7ec9eee72
2025-03-29 18:17:54,226 - app.services.secure_channel_service - INFO - Channel 38282065-74ec-4cda-a4d2-b3e7ec9eee72 saved to Redis with TTL 1800 seconds
2025-03-29 18:17:54,226 - app.api.v1.endpoints.auth - INFO - Channel 38282065-74ec-4cda-a4d2-b3e7ec9eee72 initialized successfully
2025-03-29 18:17:54,227 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:17:54,227 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:17:55,675 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:17:55,675 - app.services.connection_manager - INFO - User 3 disconnected from server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:17:55,675 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:17:55,676 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:17:59,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:17:59,708 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:17:59,708 - sqlalchemy.engine.Engine - INFO - [cached since 202.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:17:59,709 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:17:59,709 - sqlalchemy.engine.Engine - INFO - [cached since 202.9s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 17, 59, 709868), 'users_id': 2}
2025-03-29 18:17:59,709 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:11,339 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:18:11,339 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:18:11,339 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:18:11,340 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:18:22,346 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:22,346 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:22,347 - sqlalchemy.engine.Engine - INFO - [cached since 225.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:18:22,347 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:18:22,348 - sqlalchemy.engine.Engine - INFO - [cached since 225.6s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 18, 22, 347120), 'users_id': 3}
2025-03-29 18:18:22,348 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:23,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:23,575 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:23,575 - sqlalchemy.engine.Engine - INFO - [cached since 226.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:18:23,576 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:18:23,576 - sqlalchemy.engine.Engine - INFO - [cached since 226.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 18, 23, 576421), 'users_id': 3}
2025-03-29 18:18:23,576 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:35,513 - INFO - Incoming request: {"timestamp": "2025-03-29T15:18:35.513016", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:18:35,513 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:18:35.513016", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:18:35,514 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:18:35,514 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:18:35,906 - INFO - Incoming request: {"timestamp": "2025-03-29T15:18:35.906512", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:18:35,906 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:18:35.906512", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:18:35,908 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:35,908 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:35,908 - sqlalchemy.engine.Engine - INFO - [cached since 207.6s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 'zkjTDGEqHdvo8VtAlz2mW2wp-pF8ECVpNdv8PO1Kra8', 'param_1': 1}
2025-03-29 18:18:35,909 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:18:35,909 - sqlalchemy.engine.Engine - INFO - [cached since 207.6s ago] {'refresh_token': 's4-cBgnBUQBJ8cdtBx9i5byka1oPgS0SQueWGIX7PkA', 'user_devices_id': 13}
2025-03-29 18:18:35,910 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:35,911 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:18:35,911 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:18:35,977 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:18:35,978 - app.services.connection_manager - INFO - User 2 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:18:35,978 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:18:35,978 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:18:35,979 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:18:35,979 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:35,979 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:35,979 - sqlalchemy.engine.Engine - INFO - [cached since 239.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:18:35,980 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:18:35,980 - sqlalchemy.engine.Engine - INFO - [cached since 239.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 18, 35, 980529), 'users_id': 2}
2025-03-29 18:18:35,980 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:35,981 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:18:37,513 - INFO - Incoming request: {"timestamp": "2025-03-29T15:18:37.513096", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:18:37,513 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:18:37.513096", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:18:37,514 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0b68b3fb-4b2e-4277-8090-3f1539d839fb
2025-03-29 18:18:37,514 - app.services.secure_channel_service - INFO - Creating channel with ID: 0b68b3fb-4b2e-4277-8090-3f1539d839fb
2025-03-29 18:18:37,515 - app.services.secure_channel_service - INFO - Channel 0b68b3fb-4b2e-4277-8090-3f1539d839fb saved to Redis with TTL 1800 seconds
2025-03-29 18:18:37,515 - app.api.v1.endpoints.auth - INFO - Channel 0b68b3fb-4b2e-4277-8090-3f1539d839fb initialized successfully
2025-03-29 18:18:37,516 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:18:37,516 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-29 18:18:37,543 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:18:37,543 - app.services.connection_manager - INFO - User 2 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:18:37,543 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:18:37,544 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:18:37,544 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:18:37,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:37,545 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:37,545 - sqlalchemy.engine.Engine - INFO - [cached since 240.8s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:18:37,546 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:18:37,546 - sqlalchemy.engine.Engine - INFO - [cached since 240.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 18, 37, 545103), 'users_id': 2}
2025-03-29 18:18:37,546 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:37,547 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:18:47,710 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:18:47,710 - app.services.connection_manager - INFO - User 2 disconnected from server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:18:47,710 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:18:47,712 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:18:52,314 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:52,315 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:52,315 - sqlalchemy.engine.Engine - INFO - [cached since 255.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:18:52,316 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:18:52,316 - sqlalchemy.engine.Engine - INFO - [cached since 255.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 18, 52, 315109), 'users_id': 3}
2025-03-29 18:18:52,316 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:18:53,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:18:53,545 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:18:53,545 - sqlalchemy.engine.Engine - INFO - [cached since 256.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:18:53,546 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:18:53,546 - sqlalchemy.engine.Engine - INFO - [cached since 256.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 18, 53, 546465), 'users_id': 3}
2025-03-29 18:18:53,547 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:07,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:07,489 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:07,489 - sqlalchemy.engine.Engine - INFO - [cached since 270.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:19:07,490 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:07,490 - sqlalchemy.engine.Engine - INFO - [cached since 270.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 7, 490182), 'users_id': 2}
2025-03-29 18:19:07,491 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:09,869 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:19:09,869 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:19:09,869 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:19:09,870 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:19:14,695 - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:14.694871", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:19:14,695 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:14.694871", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:19:14,695 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:19:14,695 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:19:15,103 - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:15.103097", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:19:15,103 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:15.103097", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:19:15,105 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:15,105 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:15,105 - sqlalchemy.engine.Engine - INFO - [cached since 246.8s ago] {'device_id_1': '7bafacd9-8c1e-4df4-99ff-50e0a10b3384', 'refresh_token_1': 's4-cBgnBUQBJ8cdtBx9i5byka1oPgS0SQueWGIX7PkA', 'param_1': 1}
2025-03-29 18:19:15,106 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:19:15,106 - sqlalchemy.engine.Engine - INFO - [cached since 246.8s ago] {'refresh_token': 'ptU1fzitGCRTzoUEWNOxEaT8NQsI9uKy9DHr9-R3Egk', 'user_devices_id': 13}
2025-03-29 18:19:15,107 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:15,114 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.001999999999999}
2025-03-29 18:19:15,114 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.001999999999999}
2025-03-29 18:19:15,254 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:19:15,254 - app.services.connection_manager - INFO - User 2 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:19:15,254 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:19:15,255 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:19:15,255 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:19:15,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:15,256 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:15,256 - sqlalchemy.engine.Engine - INFO - [cached since 278.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:19:15,257 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:15,257 - sqlalchemy.engine.Engine - INFO - [cached since 278.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 15, 256157), 'users_id': 2}
2025-03-29 18:19:15,257 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:15,258 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:19:16,905 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:19:16,905 - app.services.connection_manager - INFO - User 2 connected to server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:19:16,906 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:19:16,906 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:19:16,906 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:19:16,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:16,907 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:16,907 - sqlalchemy.engine.Engine - INFO - [cached since 280.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:19:16,908 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:16,909 - sqlalchemy.engine.Engine - INFO - [cached since 280.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 16, 908731), 'users_id': 2}
2025-03-29 18:19:16,909 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:16,914 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:19:17,001 - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:17.001832", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:19:17,001 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:17.001832", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:19:17,003 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: ff88ff1a-f5af-4a67-be7f-1511ef5af527
2025-03-29 18:19:17,004 - app.services.secure_channel_service - INFO - Creating channel with ID: ff88ff1a-f5af-4a67-be7f-1511ef5af527
2025-03-29 18:19:17,004 - app.services.secure_channel_service - INFO - Channel ff88ff1a-f5af-4a67-be7f-1511ef5af527 saved to Redis with TTL 1800 seconds
2025-03-29 18:19:17,005 - app.api.v1.endpoints.auth - INFO - Channel ff88ff1a-f5af-4a67-be7f-1511ef5af527 initialized successfully
2025-03-29 18:19:17,005 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.999}
2025-03-29 18:19:17,005 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.999}
2025-03-29 18:19:20,390 - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:20.390772", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:19:20,390 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:19:20.390772", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:19:20,394 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:20,394 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:20,394 - sqlalchemy.engine.Engine - INFO - [cached since 283.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:20,396 - app.api.v1.endpoints.users - INFO - Search request received, channel: 38282065-74ec-4cda-a4d2-b3e7ec9eee72
2025-03-29 18:19:20,396 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743263272}
2025-03-29 18:19:20,397 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 18:19:20,397 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 18:19:20,397 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-29 18:19:20,397 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:19:20,398 - sqlalchemy.engine.Engine - INFO - [cached since 248.5s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 18:19:20,398 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:19:20,399 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:19:20,399 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:19:20,400 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.986}
2025-03-29 18:19:20,400 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.986}
2025-03-29 18:19:22,507 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:22,508 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:22,508 - sqlalchemy.engine.Engine - INFO - [cached since 285.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:22,508 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:22,508 - sqlalchemy.engine.Engine - INFO - [cached since 285.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 22, 508194), 'users_id': 3}
2025-03-29 18:19:22,509 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:22,509 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:22,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:22,510 - sqlalchemy.engine.Engine - INFO - [cached since 285.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:19:22,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:22,510 - sqlalchemy.engine.Engine - INFO - [cached since 285.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:22,511 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 18:19:22,511 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 1d3751bf-1e38-44ce-abfe-2191a553fcfb for users 3 and 2
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 18:19:22,511 - app.services.connection_manager - INFO - User 3 not connected to this server, checking online status
2025-03-29 18:19:22,512 - app.services.connection_manager - INFO - User 3 is online but connected to another server
2025-03-29 18:19:22,512 - app.services.connection_manager - INFO - Would publish message to user 3 via Redis if implemented
2025-03-29 18:19:22,512 - app.services.connection_manager - WARNING - Failed to publish message via Redis
2025-03-29 18:19:22,513 - app.services.connection_manager - INFO - User 3 is offline or Redis publish failed, adding message to buffer
2025-03-29 18:19:22,513 - app.services.connection_manager - INFO - Message added to buffer for user 3
2025-03-29 18:19:22,527 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:22,527 - sqlalchemy.engine.Engine - INFO - [cached since 285.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:22,528 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:22,528 - sqlalchemy.engine.Engine - INFO - [cached since 285.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 22, 527199), 'users_id': 3}
2025-03-29 18:19:22,528 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:23,551 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:23,551 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:23,551 - sqlalchemy.engine.Engine - INFO - [cached since 286.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:23,552 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:23,552 - sqlalchemy.engine.Engine - INFO - [cached since 286.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 23, 552803), 'users_id': 3}
2025-03-29 18:19:23,552 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:45,180 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:45,181 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:45,181 - sqlalchemy.engine.Engine - INFO - [cached since 308.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:19:45,182 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:45,182 - sqlalchemy.engine.Engine - INFO - [cached since 308.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 45, 181154), 'users_id': 2}
2025-03-29 18:19:45,182 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:46,835 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:46,835 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:46,835 - sqlalchemy.engine.Engine - INFO - [cached since 310.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:19:46,836 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:46,837 - sqlalchemy.engine.Engine - INFO - [cached since 310.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 46, 836790), 'users_id': 2}
2025-03-29 18:19:46,837 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:52,314 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:52,315 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:52,315 - sqlalchemy.engine.Engine - INFO - [cached since 315.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:52,316 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:52,316 - sqlalchemy.engine.Engine - INFO - [cached since 315.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 52, 315328), 'users_id': 3}
2025-03-29 18:19:52,316 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:19:53,550 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:19:53,550 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:19:53,550 - sqlalchemy.engine.Engine - INFO - [cached since 316.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:19:53,551 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:19:53,551 - sqlalchemy.engine.Engine - INFO - [cached since 316.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 19, 53, 551549), 'users_id': 3}
2025-03-29 18:19:53,552 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:15,169 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:15,169 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:15,169 - sqlalchemy.engine.Engine - INFO - [cached since 338.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:15,170 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:15,170 - sqlalchemy.engine.Engine - INFO - [cached since 338.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 15, 170432), 'users_id': 2}
2025-03-29 18:20:15,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:16,826 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:16,827 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:16,827 - sqlalchemy.engine.Engine - INFO - [cached since 340.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:16,828 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:16,828 - sqlalchemy.engine.Engine - INFO - [cached since 340s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 16, 827175), 'users_id': 2}
2025-03-29 18:20:16,828 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:22,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:22,804 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:22,804 - sqlalchemy.engine.Engine - INFO - [cached since 346s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:20:22,805 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:22,805 - sqlalchemy.engine.Engine - INFO - [cached since 346s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 22, 804760), 'users_id': 3}
2025-03-29 18:20:22,805 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:22,810 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:22,810 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:22,810 - sqlalchemy.engine.Engine - INFO - [cached since 346s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:22,811 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:22,811 - sqlalchemy.engine.Engine - INFO - [cached since 346s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:20:22,812 - app.api.v1.endpoints.websocket - INFO - Initiator username: MiraiX
2025-03-29 18:20:22,812 - app.api.v1.endpoints.websocket - INFO - Generated chat_id d7ef6b28-1cd2-46ce-b24e-f0f67db27608 for users 3 and 2
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 18:20:22,812 - app.services.connection_manager - INFO - User 3 not connected to this server, checking online status
2025-03-29 18:20:22,813 - app.services.connection_manager - INFO - User 3 is online but connected to another server
2025-03-29 18:20:22,813 - app.services.connection_manager - INFO - Would publish message to user 3 via Redis if implemented
2025-03-29 18:20:22,814 - app.services.connection_manager - WARNING - Failed to publish message via Redis
2025-03-29 18:20:22,814 - app.services.connection_manager - INFO - User 3 is offline or Redis publish failed, adding message to buffer
2025-03-29 18:20:22,814 - app.services.connection_manager - INFO - Message added to buffer for user 3
2025-03-29 18:20:22,815 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:22,815 - sqlalchemy.engine.Engine - INFO - [cached since 346s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:20:22,816 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:22,816 - sqlalchemy.engine.Engine - INFO - [cached since 346s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 22, 815764), 'users_id': 3}
2025-03-29 18:20:22,816 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:23,554 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:23,555 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:23,555 - sqlalchemy.engine.Engine - INFO - [cached since 346.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:20:23,556 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:23,556 - sqlalchemy.engine.Engine - INFO - [cached since 346.8s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 23, 555460), 'users_id': 3}
2025-03-29 18:20:23,556 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:31,522 - INFO - Incoming request: {"timestamp": "2025-03-29T15:20:31.521778", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:20:31,522 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:20:31.521778", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:20:31,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:31,524 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:31,524 - sqlalchemy.engine.Engine - INFO - [cached since 354.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:31,525 - app.api.v1.endpoints.users - INFO - Search request received, channel: ff88ff1a-f5af-4a67-be7f-1511ef5af527
2025-03-29 18:20:31,525 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263355}
2025-03-29 18:20:31,526 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mirai","limit":10}
2025-03-29 18:20:31,526 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mirai', 'limit': 10}
2025-03-29 18:20:31,526 - app.api.v1.endpoints.users - INFO - Searching users with query 'mirai', excluding user 2
2025-03-29 18:20:31,527 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:20:31,527 - sqlalchemy.engine.Engine - INFO - [cached since 319.7s ago] {'id_1': '2', 'username_1': '%mirai%', 'email_1': '%mirai%', 'param_1': 10}
2025-03-29 18:20:31,527 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:20:31,528 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:20:31,529 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:20:31,529 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.989}
2025-03-29 18:20:31,529 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.989}
2025-03-29 18:20:33,001 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:33,001 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:33,001 - sqlalchemy.engine.Engine - INFO - [cached since 356.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:33,002 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:33,002 - sqlalchemy.engine.Engine - INFO - [cached since 356.2s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 33, 2468), 'users_id': 2}
2025-03-29 18:20:33,003 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:33,008 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:33,009 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:33,009 - sqlalchemy.engine.Engine - INFO - [cached since 356.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:20:33,010 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:33,010 - sqlalchemy.engine.Engine - INFO - [cached since 356.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:33,010 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:20:33,010 - app.api.v1.endpoints.websocket - INFO - Generated chat_id fc162bb5-a278-43f3-a169-416f38f618bb for users 2 and 3
2025-03-29 18:20:33,010 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:20:33,010 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:20:33,010 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 18:20:33,010 - app.services.connection_manager - INFO - User 3 not connected to this server, checking online status
2025-03-29 18:20:33,011 - app.services.connection_manager - INFO - User 3 is online but connected to another server
2025-03-29 18:20:33,011 - app.services.connection_manager - INFO - Would publish message to user 3 via Redis if implemented
2025-03-29 18:20:33,012 - app.services.connection_manager - WARNING - Failed to publish message via Redis
2025-03-29 18:20:33,012 - app.services.connection_manager - INFO - User 3 is offline or Redis publish failed, adding message to buffer
2025-03-29 18:20:33,012 - app.services.connection_manager - INFO - Message added to buffer for user 3
2025-03-29 18:20:33,012 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:20:33,012 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:20:33,012 - app.services.connection_manager - INFO - Current active connections: ['2']
2025-03-29 18:20:33,012 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:20:33,013 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:20:45,169 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:45,169 - sqlalchemy.engine.Engine - INFO - [cached since 368.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:45,170 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:45,170 - sqlalchemy.engine.Engine - INFO - [cached since 368.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 45, 170460), 'users_id': 2}
2025-03-29 18:20:45,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:45,677 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:20:45,677 - app.services.connection_manager - INFO - User 2 disconnected from server e746a1ef-89fe-44a3-b662-1d28e72ccab3
2025-03-29 18:20:45,677 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:20:45,679 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:20:46,827 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:20:46,827 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:20:46,827 - sqlalchemy.engine.Engine - INFO - [cached since 370.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:20:46,828 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:20:46,828 - sqlalchemy.engine.Engine - INFO - [cached since 370.1s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 20, 46, 828784), 'users_id': 2}
2025-03-29 18:20:46,829 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:20:46,973 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:20:46,973 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:20:46,973 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:20:46,974 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:20:49,424 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:20:49,424 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:20:49,424 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:20:49,425 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:20:58,532 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:20:58,532 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:20:58,532 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:20:58,533 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:21:00,404 - app.main - INFO - Shutting down server...
2025-03-29 18:21:00,405 - app.main - INFO - Redis connections closed
2025-03-29 18:21:00,405 - app.main - INFO - Server shutdown completed
2025-03-29 18:21:57,821 - app.main - INFO - Starting up server...
2025-03-29 18:21:57,822 - app.main - INFO - Redis initialized
2025-03-29 18:21:57,968 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-29 18:21:57,968 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:21:57,968 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-29 18:21:57,969 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:21:57,969 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-29 18:21:57,969 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-29 18:21:57,971 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:21:57,972 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:21:57,972 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:21:57,973 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:21:57,974 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:21:57,975 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:21:57,975 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:21:57,975 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:21:57,975 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007404s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-29 18:21:57,976 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:21:57,976 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:21:57,976 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-29 18:21:57,976 - sqlalchemy.engine.Engine - INFO - [cached since 0.005043s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-29 18:21:57,977 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:21:57,977 - app.main - INFO - Database initialized
2025-03-29 18:21:58,027 - app.main - INFO - Server key pair generated
2025-03-29 18:21:58,027 - app.main - INFO - Server startup completed successfully
2025-03-29 18:22:03,557 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:03.557538", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:03,557 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:03.557538", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:03,558 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:22:03,558 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:22:06,122 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:06.122780", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:06,122 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:06.122780", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:06,122 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:22:06,122 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-29 18:22:15,310 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:15.310905", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:15,310 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:15.310905", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:15,313 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 6909c0b6-3e32-49d7-9f7b-3ea02038b7f9
2025-03-29 18:22:15,313 - app.services.secure_channel_service - INFO - Creating channel with ID: 6909c0b6-3e32-49d7-9f7b-3ea02038b7f9
2025-03-29 18:22:15,314 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:15.314905", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:15,314 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:15.314905", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:15,316 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 5eeff8fe-cdae-4de6-bf73-bb3eead6f776
2025-03-29 18:22:15,316 - app.services.secure_channel_service - INFO - Creating channel with ID: 5eeff8fe-cdae-4de6-bf73-bb3eead6f776
2025-03-29 18:22:15,318 - app.services.secure_channel_service - INFO - Channel 6909c0b6-3e32-49d7-9f7b-3ea02038b7f9 saved to Redis with TTL 1800 seconds
2025-03-29 18:22:15,318 - app.api.v1.endpoints.auth - INFO - Channel 6909c0b6-3e32-49d7-9f7b-3ea02038b7f9 initialized successfully
2025-03-29 18:22:15,318 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:22:15,318 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-29 18:22:15,319 - app.services.secure_channel_service - INFO - Channel 5eeff8fe-cdae-4de6-bf73-bb3eead6f776 saved to Redis with TTL 1800 seconds
2025-03-29 18:22:15,319 - app.api.v1.endpoints.auth - INFO - Channel 5eeff8fe-cdae-4de6-bf73-bb3eead6f776 initialized successfully
2025-03-29 18:22:15,319 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:22:15,319 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-29 18:22:18,597 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:18.597894", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:18,597 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:18.597894", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:18,598 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 160bc47b-c92b-4614-96aa-40d91a41e698
2025-03-29 18:22:18,598 - app.services.secure_channel_service - INFO - Creating channel with ID: 160bc47b-c92b-4614-96aa-40d91a41e698
2025-03-29 18:22:18,599 - app.services.secure_channel_service - INFO - Channel 160bc47b-c92b-4614-96aa-40d91a41e698 saved to Redis with TTL 1800 seconds
2025-03-29 18:22:18,599 - app.api.v1.endpoints.auth - INFO - Channel 160bc47b-c92b-4614-96aa-40d91a41e698 initialized successfully
2025-03-29 18:22:18,600 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:22:18,600 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:22:18,682 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:18.682913", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:18,682 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:18.682913", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:18,684 - app.api.v1.endpoints.auth - INFO - Login request using channel: 160bc47b-c92b-4614-96aa-40d91a41e698
2025-03-29 18:22:18,685 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"023e4ee8-18a4-4f49-b209-736621137743"}
2025-03-29 18:22:18,685 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '023e4ee8-18a4-4f49-b209-736621137743'}
2025-03-29 18:22:18,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:22:18,691 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:18,691 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-29 18:22:18,911 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:18,911 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] {'user_id_1': 2, 'device_id_1': '023e4ee8-18a4-4f49-b209-736621137743', 'param_1': 1}
2025-03-29 18:22:18,914 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 18:22:18,914 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'users_id': 2}
2025-03-29 18:22:18,915 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 18:22:18,915 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'user_id': 2, 'device_id': '023e4ee8-18a4-4f49-b209-736621137743', 'refresh_token': None, 'last_login': None}
2025-03-29 18:22:18,916 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-29 18:22:18,917 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:22:18,917 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] {'refresh_token': 'o8xLcNJ6B9EJ3ObnW9e-PiQ6YG_JrMlckexKgL5Q-98', 'user_devices_id': 16}
2025-03-29 18:22:18,917 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:22:18,918 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 18:22:18,918 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 18:22:18,919 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 18:22:18,919 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 237.05599999999998}
2025-03-29 18:22:18,919 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 237.05599999999998}
2025-03-29 18:22:19,427 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:19.427200", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:19,427 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:19.427200", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:19,428 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 1689a1cd-4d89-4aee-b4f8-40366ba03f7b
2025-03-29 18:22:19,428 - app.services.secure_channel_service - INFO - Creating channel with ID: 1689a1cd-4d89-4aee-b4f8-40366ba03f7b
2025-03-29 18:22:19,429 - app.services.secure_channel_service - INFO - Channel 1689a1cd-4d89-4aee-b4f8-40366ba03f7b saved to Redis with TTL 1800 seconds
2025-03-29 18:22:19,429 - app.api.v1.endpoints.auth - INFO - Channel 1689a1cd-4d89-4aee-b4f8-40366ba03f7b initialized successfully
2025-03-29 18:22:19,429 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:22:19,429 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-29 18:22:19,593 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:22:19,593 - app.services.connection_manager - INFO - User 2 connected to server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:22:19,593 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:22:19,596 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:22:19,596 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:22:19,596 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:22:19,597 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:19,597 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '2', 'param_1': 1}
2025-03-29 18:22:19,598 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:22:19,598 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'last_seen': datetime.datetime(2025, 3, 29, 15, 22, 19, 598465), 'users_id': 2}
2025-03-29 18:22:19,599 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:22:19,604 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:22:20,947 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:22:20,947 - app.services.connection_manager - INFO - User 2 connected to server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:22:20,947 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:22:20,948 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:22:20,948 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:22:20,949 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:22:20,949 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:20,949 - sqlalchemy.engine.Engine - INFO - [cached since 1.353s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:22:20,950 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:22:20,950 - sqlalchemy.engine.Engine - INFO - [cached since 1.352s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 22, 20, 950683), 'users_id': 2}
2025-03-29 18:22:20,951 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:22:20,956 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:22:38,303 - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:38.303767", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:38,303 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:22:38.303767", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:22:38,306 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:22:38,306 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:38,307 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'device_id_1': '023e4ee8-18a4-4f49-b209-736621137743', 'refresh_token_1': 'o8xLcNJ6B9EJ3ObnW9e-PiQ6YG_JrMlckexKgL5Q-98', 'param_1': 1}
2025-03-29 18:22:38,308 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:22:38,308 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'i9S68WJCUzwX4PuaGm09yK3yPWttu-rcrW2OSlFdFAY', 'user_devices_id': 16}
2025-03-29 18:22:38,308 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:22:38,309 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-29 18:22:38,309 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-29 18:22:38,339 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-29 18:22:38,339 - app.services.connection_manager - INFO - User 2 connected to server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:22:38,339 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-29 18:22:38,340 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-29 18:22:38,340 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-29 18:22:38,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:22:38,341 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:38,341 - sqlalchemy.engine.Engine - INFO - [cached since 18.74s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:22:38,342 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:22:38,342 - sqlalchemy.engine.Engine - INFO - [cached since 18.74s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 22, 38, 341776), 'users_id': 2}
2025-03-29 18:22:38,342 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:22:38,342 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-29 18:22:50,918 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:22:50,918 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:22:50,918 - sqlalchemy.engine.Engine - INFO - [cached since 31.32s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:22:50,919 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:22:50,919 - sqlalchemy.engine.Engine - INFO - [cached since 31.32s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 22, 50, 919552), 'users_id': 2}
2025-03-29 18:22:50,919 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:08,362 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:08,363 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:08,363 - sqlalchemy.engine.Engine - INFO - [cached since 48.77s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:08,364 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:08,364 - sqlalchemy.engine.Engine - INFO - [cached since 48.77s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 8, 363521), 'users_id': 2}
2025-03-29 18:23:08,364 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:09,580 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:09.579546", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:09,580 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:09.579546", "method": "GET", "path": "/", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:09,580 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:23:09,580 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-29 18:23:18,053 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:18.053610", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:18,053 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:18.053610", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:18,054 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 960a5f68-1abb-4c08-9902-21f14cd02d89
2025-03-29 18:23:18,054 - app.services.secure_channel_service - INFO - Creating channel with ID: 960a5f68-1abb-4c08-9902-21f14cd02d89
2025-03-29 18:23:18,056 - app.services.secure_channel_service - INFO - Channel 960a5f68-1abb-4c08-9902-21f14cd02d89 saved to Redis with TTL 1800 seconds
2025-03-29 18:23:18,056 - app.api.v1.endpoints.auth - INFO - Channel 960a5f68-1abb-4c08-9902-21f14cd02d89 initialized successfully
2025-03-29 18:23:18,056 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:23:18,056 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-29 18:23:18,284 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:18.284704", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:18,284 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:18.284704", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:18,286 - app.api.v1.endpoints.auth - INFO - Login request using channel: 960a5f68-1abb-4c08-9902-21f14cd02d89
2025-03-29 18:23:18,287 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"bf665a75-398a-420a-a9be-a91704b4a46d"}
2025-03-29 18:23:18,287 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': 'bf665a75-398a-420a-a9be-a91704b4a46d'}
2025-03-29 18:23:18,287 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:18,287 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:18,288 - sqlalchemy.engine.Engine - INFO - [cached since 59.6s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-29 18:23:18,490 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:18,490 - sqlalchemy.engine.Engine - INFO - [cached since 59.58s ago] {'user_id_1': 3, 'device_id_1': 'bf665a75-398a-420a-a9be-a91704b4a46d', 'param_1': 1}
2025-03-29 18:23:18,492 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-29 18:23:18,492 - sqlalchemy.engine.Engine - INFO - [cached since 59.58s ago] {'users_id': 3}
2025-03-29 18:23:18,492 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-29 18:23:18,493 - sqlalchemy.engine.Engine - INFO - [cached since 59.58s ago] {'user_id': 3, 'device_id': 'bf665a75-398a-420a-a9be-a91704b4a46d', 'refresh_token': None, 'last_login': None}
2025-03-29 18:23:18,493 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-29 18:23:18,494 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-29 18:23:18,494 - sqlalchemy.engine.Engine - INFO - [cached since 59.58s ago] {'refresh_token': 'kp9q-BBAXxtTdrzqWFVt3bbuXfw4sr7k_nsMJGVTuYg', 'user_devices_id': 17}
2025-03-29 18:23:18,494 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:18,499 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-29 18:23:18,499 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-29 18:23:18,500 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-29 18:23:18,501 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 217.054}
2025-03-29 18:23:18,501 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 217.054}
2025-03-29 18:23:18,917 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:18.917859", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:18,917 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:18.917859", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.172.186"}
2025-03-29 18:23:18,919 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:23:18,919 - app.services.connection_manager - INFO - User 3 connected to server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:23:18,919 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:23:18,920 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:23:18,920 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:23:18,920 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:18,920 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:18,921 - sqlalchemy.engine.Engine - INFO - [cached since 59.32s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:18,921 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:18,922 - sqlalchemy.engine.Engine - INFO - [cached since 59.32s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 18, 921860), 'users_id': 3}
2025-03-29 18:23:18,922 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:18,922 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:23:18,923 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 6cf08233-8f48-4581-a092-aa3c9035ab30
2025-03-29 18:23:18,923 - app.services.secure_channel_service - INFO - Creating channel with ID: 6cf08233-8f48-4581-a092-aa3c9035ab30
2025-03-29 18:23:18,923 - app.services.secure_channel_service - INFO - Channel 6cf08233-8f48-4581-a092-aa3c9035ab30 saved to Redis with TTL 1800 seconds
2025-03-29 18:23:18,924 - app.api.v1.endpoints.auth - INFO - Channel 6cf08233-8f48-4581-a092-aa3c9035ab30 initialized successfully
2025-03-29 18:23:18,924 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:23:18,924 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:23:18,924 - app.services.message_buffer - INFO - Retrieved and cleared 6 messages for user 3
2025-03-29 18:23:18,925 - app.api.v1.endpoints.websocket - INFO - Delivering 6 buffered messages to user 3
2025-03-29 18:23:20,141 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-29 18:23:20,141 - app.services.connection_manager - INFO - User 3 connected to server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:23:20,141 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-29 18:23:20,142 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-29 18:23:20,142 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-29 18:23:20,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:20,143 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:20,143 - sqlalchemy.engine.Engine - INFO - [cached since 60.55s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:20,144 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:20,144 - sqlalchemy.engine.Engine - INFO - [cached since 60.55s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 20, 144242), 'users_id': 3}
2025-03-29 18:23:20,144 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:20,145 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-29 18:23:20,419 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:20,419 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:20,420 - sqlalchemy.engine.Engine - INFO - [cached since 60.82s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:20,421 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:20,421 - sqlalchemy.engine.Engine - INFO - [cached since 60.82s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 20, 420423), 'users_id': 3}
2025-03-29 18:23:20,422 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:20,427 - app.api.v1.endpoints.websocket - WARNING - Missing recipient_id in key exchange from user 3
2025-03-29 18:23:20,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:20,428 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:20,428 - sqlalchemy.engine.Engine - INFO - [cached since 60.83s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:20,429 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:20,429 - sqlalchemy.engine.Engine - INFO - [cached since 60.83s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 20, 429425), 'users_id': 3}
2025-03-29 18:23:20,430 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:20,430 - app.api.v1.endpoints.websocket - WARNING - Missing recipient_id in key exchange from user 3
2025-03-29 18:23:20,897 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:20,897 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:20,898 - sqlalchemy.engine.Engine - INFO - [cached since 61.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:20,898 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:20,898 - sqlalchemy.engine.Engine - INFO - [cached since 61.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 20, 898947), 'users_id': 2}
2025-03-29 18:23:20,899 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:31,295 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:31.294167", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:31,295 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:31.294167", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:31,296 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:31,296 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:31,296 - sqlalchemy.engine.Engine - INFO - [cached since 71.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:31,297 - app.api.v1.endpoints.users - INFO - Search request received, channel: 1689a1cd-4d89-4aee-b4f8-40366ba03f7b
2025-03-29 18:23:31,297 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263558}
2025-03-29 18:23:31,298 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-29 18:23:31,298 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-29 18:23:31,298 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 2
2025-03-29 18:23:31,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:23:31,300 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '2', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-29 18:23:31,300 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-03-29 18:23:31,300 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-03-29 18:23:31,301 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:23:31,301 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 18:23:31,301 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-29 18:23:33,647 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:33.647740", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:33,647 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:33.647740", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:33,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:33,649 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:33,649 - sqlalchemy.engine.Engine - INFO - [cached since 74.05s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:33,650 - app.api.v1.endpoints.users - INFO - Search request received, channel: 1689a1cd-4d89-4aee-b4f8-40366ba03f7b
2025-03-29 18:23:33,650 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263558}
2025-03-29 18:23:33,651 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"y","limit":10}
2025-03-29 18:23:33,651 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'y', 'limit': 10}
2025-03-29 18:23:33,651 - app.api.v1.endpoints.users - INFO - Searching users with query 'y', excluding user 2
2025-03-29 18:23:33,652 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:23:33,652 - sqlalchemy.engine.Engine - INFO - [cached since 2.353s ago] {'id_1': '2', 'username_1': '%y%', 'email_1': '%y%', 'param_1': 10}
2025-03-29 18:23:33,652 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-03-29 18:23:33,652 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-03-29 18:23:33,653 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:23:33,654 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:23:33,654 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:23:34,147 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:34.147400", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:34,147 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:34.147400", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:34,149 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:34,149 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:34,149 - sqlalchemy.engine.Engine - INFO - [cached since 74.55s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:34,150 - app.api.v1.endpoints.users - INFO - Search request received, channel: 1689a1cd-4d89-4aee-b4f8-40366ba03f7b
2025-03-29 18:23:34,150 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263558}
2025-03-29 18:23:34,151 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-29 18:23:34,151 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-29 18:23:34,152 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-29 18:23:34,152 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:23:34,152 - sqlalchemy.engine.Engine - INFO - [cached since 2.853s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-29 18:23:34,153 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:23:34,153 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:23:34,154 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:23:34,154 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:23:34,154 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-29 18:23:35,662 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:35,663 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:35,663 - sqlalchemy.engine.Engine - INFO - [cached since 76.07s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:35,664 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:35,664 - sqlalchemy.engine.Engine - INFO - [cached since 76.07s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 35, 663472), 'users_id': 2}
2025-03-29 18:23:35,664 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:35,670 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:35,670 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:35,671 - sqlalchemy.engine.Engine - INFO - [cached since 76.07s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:35,671 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:35,671 - sqlalchemy.engine.Engine - INFO - [cached since 76.07s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:35,672 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:23:35,672 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 4b459de5-675a-49f1-9628-50e0b84ce223 for users 2 and 3
2025-03-29 18:23:35,672 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:23:35,672 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:23:35,672 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:23:35,672 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:23:35,672 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:23:35,672 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:23:35,673 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:23:35,673 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:23:35,673 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:23:35,673 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:23:38,348 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:38,349 - sqlalchemy.engine.Engine - INFO - [cached since 78.75s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:38,350 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:38,350 - sqlalchemy.engine.Engine - INFO - [cached since 78.75s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 38, 349788), 'users_id': 2}
2025-03-29 18:23:38,350 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:48,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:48,916 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:48,917 - sqlalchemy.engine.Engine - INFO - [cached since 89.32s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:48,918 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:48,918 - sqlalchemy.engine.Engine - INFO - [cached since 89.32s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 48, 917707), 'users_id': 3}
2025-03-29 18:23:48,918 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:50,070 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:50,070 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:50,070 - sqlalchemy.engine.Engine - INFO - [cached since 90.47s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:23:50,071 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:50,071 - sqlalchemy.engine.Engine - INFO - [cached since 90.47s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 50, 71375), 'users_id': 3}
2025-03-29 18:23:50,072 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:50,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:50,885 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:50,885 - sqlalchemy.engine.Engine - INFO - [cached since 91.29s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:50,886 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:23:50,886 - sqlalchemy.engine.Engine - INFO - [cached since 91.29s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 23, 50, 886526), 'users_id': 2}
2025-03-29 18:23:50,887 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:23:59,284 - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:59.284042", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:59,284 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-29T15:23:59.284042", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.172.222"}
2025-03-29 18:23:59,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:23:59,286 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:23:59,287 - sqlalchemy.engine.Engine - INFO - [cached since 99.69s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:23:59,288 - app.api.v1.endpoints.users - INFO - Search request received, channel: 1689a1cd-4d89-4aee-b4f8-40366ba03f7b
2025-03-29 18:23:59,288 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743263558}
2025-03-29 18:23:59,289 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-03-29 18:23:59,289 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-03-29 18:23:59,289 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-03-29 18:23:59,289 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-29 18:23:59,290 - sqlalchemy.engine.Engine - INFO - [cached since 27.99s ago] {'id_1': '2', 'username_1': '%mir%', 'email_1': '%mir%', 'param_1': 10}
2025-03-29 18:23:59,290 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-29 18:23:59,290 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-29 18:23:59,291 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-29 18:23:59,292 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 18:23:59,292 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-29 18:24:01,271 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:01,271 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:01,271 - sqlalchemy.engine.Engine - INFO - [cached since 101.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:24:01,272 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:01,272 - sqlalchemy.engine.Engine - INFO - [cached since 101.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 1, 272039), 'users_id': 2}
2025-03-29 18:24:01,273 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:01,278 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:01,278 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:01,279 - sqlalchemy.engine.Engine - INFO - [cached since 101.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:24:01,280 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:01,280 - sqlalchemy.engine.Engine - INFO - [cached since 101.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:24:01,280 - app.api.v1.endpoints.websocket - INFO - Initiator username: YuDev
2025-03-29 18:24:01,280 - app.api.v1.endpoints.websocket - INFO - Generated chat_id 1ea52658-3251-450c-acdf-edbfb0101160 for users 2 and 3
2025-03-29 18:24:01,280 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-29 18:24:01,280 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-29 18:24:01,280 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:24:01,280 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-29 18:24:01,281 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-29 18:24:01,281 - app.services.connection_manager - INFO - Attempting to send personal message to user 2
2025-03-29 18:24:01,281 - app.services.connection_manager - INFO - Message type: chat.init.confirm
2025-03-29 18:24:01,281 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-29 18:24:01,281 - app.services.connection_manager - INFO - User 2 found in active connections, sending message directly
2025-03-29 18:24:01,281 - app.services.connection_manager - INFO - Message sent to user 2 on this server successfully
2025-03-29 18:24:08,338 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:08,339 - sqlalchemy.engine.Engine - INFO - [cached since 108.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:24:08,339 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:08,340 - sqlalchemy.engine.Engine - INFO - [cached since 108.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 8, 339072), 'users_id': 2}
2025-03-29 18:24:08,340 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:18,937 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:18,937 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:18,937 - sqlalchemy.engine.Engine - INFO - [cached since 119.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:24:18,938 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:18,939 - sqlalchemy.engine.Engine - INFO - [cached since 119.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 18, 938934), 'users_id': 3}
2025-03-29 18:24:18,939 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:20,083 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:20,084 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:20,084 - sqlalchemy.engine.Engine - INFO - [cached since 120.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:24:20,085 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:20,085 - sqlalchemy.engine.Engine - INFO - [cached since 120.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 20, 84582), 'users_id': 3}
2025-03-29 18:24:20,085 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:20,884 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:20,884 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:20,884 - sqlalchemy.engine.Engine - INFO - [cached since 121.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:24:20,885 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:20,885 - sqlalchemy.engine.Engine - INFO - [cached since 121.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 20, 885553), 'users_id': 2}
2025-03-29 18:24:20,886 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:38,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:38,340 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:38,340 - sqlalchemy.engine.Engine - INFO - [cached since 138.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:24:38,341 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:38,341 - sqlalchemy.engine.Engine - INFO - [cached since 138.7s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 38, 341124), 'users_id': 2}
2025-03-29 18:24:38,341 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:48,956 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:48,956 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:48,956 - sqlalchemy.engine.Engine - INFO - [cached since 149.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:24:48,957 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:48,957 - sqlalchemy.engine.Engine - INFO - [cached since 149.4s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 48, 957352), 'users_id': 3}
2025-03-29 18:24:48,958 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:50,100 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:50,100 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:50,100 - sqlalchemy.engine.Engine - INFO - [cached since 150.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-29 18:24:50,101 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:50,101 - sqlalchemy.engine.Engine - INFO - [cached since 150.5s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 50, 101092), 'users_id': 3}
2025-03-29 18:24:50,101 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:50,884 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-29 18:24:50,885 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-29 18:24:50,885 - sqlalchemy.engine.Engine - INFO - [cached since 151.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-29 18:24:50,886 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-29 18:24:50,886 - sqlalchemy.engine.Engine - INFO - [cached since 151.3s ago] {'last_seen': datetime.datetime(2025, 3, 29, 15, 24, 50, 885614), 'users_id': 2}
2025-03-29 18:24:50,886 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-29 18:24:51,842 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:24:51,842 - app.services.connection_manager - INFO - User 3 disconnected from server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:24:51,842 - app.services.connection_manager - INFO - Active connections after disconnect: ['2']
2025-03-29 18:24:51,843 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:24:54,621 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:24:54,621 - app.services.connection_manager - INFO - User 2 disconnected from server d6a8755c-f68f-4982-9c9f-8bd775ce26ce
2025-03-29 18:24:54,621 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:24:54,622 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:24:54,622 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:24:54,622 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:24:54,623 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:24:54,625 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:24:57,400 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-29 18:24:57,400 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-29 18:24:57,400 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:24:57,400 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-29 18:24:57,400 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-29 18:24:57,400 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-29 18:24:57,401 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-29 18:24:57,401 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-29 18:24:57,509 - app.main - INFO - Shutting down server...
2025-03-29 18:24:57,510 - app.main - INFO - Redis connections closed
2025-03-29 18:24:57,510 - app.main - INFO - Server shutdown completed
2025-03-30 18:44:10,902 - app.main - INFO - Starting up server...
2025-03-30 18:44:10,903 - app.main - INFO - Redis initialized
2025-03-30 18:44:10,962 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-30 18:44:10,963 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 18:44:10,964 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-30 18:44:10,964 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 18:44:10,964 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-30 18:44:10,964 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 18:44:10,967 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:44:10,967 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:44:10,967 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 18:44:10,976 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 18:44:10,976 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:44:10,978 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:44:10,978 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 18:44:10,978 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:44:10,978 - sqlalchemy.engine.Engine - INFO - [cached since 0.0008815s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 18:44:10,979 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:44:10,979 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:44:10,979 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:44:10,980 - sqlalchemy.engine.Engine - INFO - [cached since 0.01256s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 18:44:10,980 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 18:44:10,980 - app.main - INFO - Database initialized
2025-03-30 18:44:11,040 - app.main - INFO - Server key pair generated
2025-03-30 18:44:11,040 - app.main - INFO - Server startup completed successfully
2025-03-30 18:46:09,370 - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:09.370094", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:09,370 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:09.370094", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:09,371 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 18:46:09,371 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 18:46:18,437 - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:18.437653", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:18,437 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:18.437653", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:18,449 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0c4cb190-255a-4dca-9b2e-d56ade13da9c
2025-03-30 18:46:18,449 - app.services.secure_channel_service - INFO - Creating channel with ID: 0c4cb190-255a-4dca-9b2e-d56ade13da9c
2025-03-30 18:46:18,459 - app.services.secure_channel_service - INFO - Channel 0c4cb190-255a-4dca-9b2e-d56ade13da9c saved to Redis with TTL 1800 seconds
2025-03-30 18:46:18,462 - app.api.v1.endpoints.auth - INFO - Channel 0c4cb190-255a-4dca-9b2e-d56ade13da9c initialized successfully
2025-03-30 18:46:18,462 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 25.008}
2025-03-30 18:46:18,462 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 25.008}
2025-03-30 18:46:19,002 - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:19.002886", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:19,002 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:19.002886", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:19,006 - app.api.v1.endpoints.auth - INFO - Login request using channel: 0c4cb190-255a-4dca-9b2e-d56ade13da9c
2025-03-30 18:46:19,024 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"7ac62cfb-895f-4da8-a6f3-fa6b35d0b3a6"}
2025-03-30 18:46:19,024 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '7ac62cfb-895f-4da8-a6f3-fa6b35d0b3a6'}
2025-03-30 18:46:19,027 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:46:19,029 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 18:46:19,029 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-30 18:46:19,259 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:46:19,259 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'user_id_1': 2, 'device_id_1': '7ac62cfb-895f-4da8-a6f3-fa6b35d0b3a6', 'param_1': 1}
2025-03-30 18:46:19,274 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 18:46:19,274 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'users_id': 2}
2025-03-30 18:46:19,278 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 18:46:19,278 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'user_id': 2, 'device_id': '7ac62cfb-895f-4da8-a6f3-fa6b35d0b3a6', 'refresh_token': None, 'last_login': None}
2025-03-30 18:46:19,281 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-30 18:46:19,283 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 18:46:19,284 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'refresh_token': 'PMj3ESMrXXEvNsyTboZpJCPa9ZV1d885J4EZlsSqBhI', 'user_devices_id': 18}
2025-03-30 18:46:19,284 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:46:19,288 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 18:46:19,288 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 18:46:19,289 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 18:46:19,290 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 288.068}
2025-03-30 18:46:19,290 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 288.068}
2025-03-30 18:46:20,362 - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:20.362018", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:20,362 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:20.362018", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:20,364 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 16a6b4cc-ac6b-4a45-9ece-e04569810476
2025-03-30 18:46:20,364 - app.services.secure_channel_service - INFO - Creating channel with ID: 16a6b4cc-ac6b-4a45-9ece-e04569810476
2025-03-30 18:46:20,364 - app.services.secure_channel_service - INFO - Channel 16a6b4cc-ac6b-4a45-9ece-e04569810476 saved to Redis with TTL 1800 seconds
2025-03-30 18:46:20,365 - app.api.v1.endpoints.auth - INFO - Channel 16a6b4cc-ac6b-4a45-9ece-e04569810476 initialized successfully
2025-03-30 18:46:20,365 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 18:46:20,365 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 18:46:20,368 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 18:46:20,368 - app.services.connection_manager - INFO - User 2 connected to server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:46:20,368 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-30 18:46:20,383 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-30 18:46:20,383 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 18:46:20,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:46:20,384 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:46:20,385 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'id_1': '2', 'param_1': 1}
2025-03-30 18:46:20,386 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:46:20,386 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'last_seen': datetime.datetime(2025, 3, 30, 15, 46, 20, 385024), 'users_id': 2}
2025-03-30 18:46:20,387 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:46:20,387 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 18:46:22,203 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 18:46:22,203 - app.services.connection_manager - INFO - User 2 connected to server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:46:22,203 - app.services.connection_manager - INFO - Active connections after connect: ['2']
2025-03-30 18:46:22,204 - app.services.connection_manager - INFO - Publishing user event: connect for user 2
2025-03-30 18:46:22,204 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 18:46:22,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:46:22,205 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:46:22,205 - sqlalchemy.engine.Engine - INFO - [cached since 1.822s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 18:46:22,206 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:46:22,206 - sqlalchemy.engine.Engine - INFO - [cached since 1.821s ago] {'last_seen': datetime.datetime(2025, 3, 30, 15, 46, 22, 206982), 'users_id': 2}
2025-03-30 18:46:22,207 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:46:22,212 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 18:46:23,048 - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:23.048610", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:23,048 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:46:23.048610", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:46:23,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:46:23,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:46:23,050 - sqlalchemy.engine.Engine - INFO - [cached since 2.666s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 18:46:23,051 - app.api.v1.endpoints.users - INFO - Search request received, channel: 16a6b4cc-ac6b-4a45-9ece-e04569810476
2025-03-30 18:46:23,051 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743351379}
2025-03-30 18:46:23,052 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mirai","limit":10}
2025-03-30 18:46:23,052 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mirai', 'limit': 10}
2025-03-30 18:46:23,052 - app.api.v1.endpoints.users - INFO - Searching users with query 'mirai', excluding user 2
2025-03-30 18:46:23,053 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 18:46:23,053 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '2', 'username_1': '%mirai%', 'email_1': '%mirai%', 'param_1': 10}
2025-03-30 18:46:23,067 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 18:46:23,068 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': False}]
2025-03-30 18:46:23,069 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 18:46:23,069 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 21.003999999999998}
2025-03-30 18:46:23,069 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 21.003999999999998}
2025-03-30 18:46:50,355 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:46:52,103 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:47:20,344 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:47:22,062 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:47:50,344 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:47:52,059 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:48:10,935 - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:10.935003", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:10,935 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:10.935003", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:10,936 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-30 18:48:10,936 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-30 18:48:18,762 - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:18.762994", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:18,762 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:18.762994", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:18,764 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: f0e2f3d5-986e-43d8-8c44-0fe3a49d6e36
2025-03-30 18:48:18,764 - app.services.secure_channel_service - INFO - Creating channel with ID: f0e2f3d5-986e-43d8-8c44-0fe3a49d6e36
2025-03-30 18:48:18,765 - app.services.secure_channel_service - INFO - Channel f0e2f3d5-986e-43d8-8c44-0fe3a49d6e36 saved to Redis with TTL 1800 seconds
2025-03-30 18:48:18,765 - app.api.v1.endpoints.auth - INFO - Channel f0e2f3d5-986e-43d8-8c44-0fe3a49d6e36 initialized successfully
2025-03-30 18:48:18,765 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 18:48:18,765 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 18:48:19,437 - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:19.437636", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:19,437 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:19.437636", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:19,439 - app.api.v1.endpoints.auth - INFO - Login request using channel: f0e2f3d5-986e-43d8-8c44-0fe3a49d6e36
2025-03-30 18:48:19,440 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"9945cb24-390d-42b0-9725-edf6d7824a05"}
2025-03-30 18:48:19,440 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '9945cb24-390d-42b0-9725-edf6d7824a05'}
2025-03-30 18:48:19,441 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:19,441 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:19,441 - sqlalchemy.engine.Engine - INFO - [cached since 120.4s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-30 18:48:19,643 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:19,643 - sqlalchemy.engine.Engine - INFO - [cached since 120.4s ago] {'user_id_1': 3, 'device_id_1': '9945cb24-390d-42b0-9725-edf6d7824a05', 'param_1': 1}
2025-03-30 18:48:19,644 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 18:48:19,644 - sqlalchemy.engine.Engine - INFO - [cached since 120.4s ago] {'users_id': 3}
2025-03-30 18:48:19,645 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 18:48:19,645 - sqlalchemy.engine.Engine - INFO - [cached since 120.4s ago] {'user_id': 3, 'device_id': '9945cb24-390d-42b0-9725-edf6d7824a05', 'refresh_token': None, 'last_login': None}
2025-03-30 18:48:19,646 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-30 18:48:19,646 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 18:48:19,646 - sqlalchemy.engine.Engine - INFO - [cached since 120.4s ago] {'refresh_token': '9nVrXWJWHhtvA-8wlfl-cU8v3mzNjA736NYuOa9X6Zk', 'user_devices_id': 19}
2025-03-30 18:48:19,647 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:48:19,652 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 18:48:19,652 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 18:48:19,653 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 18:48:19,653 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 216.048}
2025-03-30 18:48:19,653 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 216.048}
2025-03-30 18:48:20,344 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:48:20,428 - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:20.428037", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:20,428 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:20.428037", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:20,429 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 18:48:20,429 - app.services.connection_manager - INFO - User 3 connected to server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:48:20,429 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-30 18:48:20,431 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 97a7f4e0-af2f-4ac5-a038-82a1e0c2a835
2025-03-30 18:48:20,431 - app.services.secure_channel_service - INFO - Creating channel with ID: 97a7f4e0-af2f-4ac5-a038-82a1e0c2a835
2025-03-30 18:48:20,431 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-30 18:48:20,431 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 18:48:20,432 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:20,432 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:20,432 - sqlalchemy.engine.Engine - INFO - [cached since 120s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 18:48:20,433 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:48:20,433 - sqlalchemy.engine.Engine - INFO - [cached since 120s ago] {'last_seen': datetime.datetime(2025, 3, 30, 15, 48, 20, 433038), 'users_id': 3}
2025-03-30 18:48:20,434 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:48:20,439 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 18:48:20,439 - app.services.secure_channel_service - INFO - Channel 97a7f4e0-af2f-4ac5-a038-82a1e0c2a835 saved to Redis with TTL 1800 seconds
2025-03-30 18:48:20,440 - app.api.v1.endpoints.auth - INFO - Channel 97a7f4e0-af2f-4ac5-a038-82a1e0c2a835 initialized successfully
2025-03-30 18:48:20,440 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.003}
2025-03-30 18:48:20,440 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.003}
2025-03-30 18:48:21,594 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 18:48:21,595 - app.services.connection_manager - INFO - User 3 connected to server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:48:21,595 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-30 18:48:21,596 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-30 18:48:21,596 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 18:48:21,596 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:21,596 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:21,596 - sqlalchemy.engine.Engine - INFO - [cached since 121.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 18:48:21,597 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:48:21,597 - sqlalchemy.engine.Engine - INFO - [cached since 121.2s ago] {'last_seen': datetime.datetime(2025, 3, 30, 15, 48, 21, 597377), 'users_id': 3}
2025-03-30 18:48:21,598 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:48:21,598 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 18:48:22,080 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:48:24,016 - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:24.016772", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:48:24,016 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:24.016772", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 18:48:24,017 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:24,018 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:24,018 - sqlalchemy.engine.Engine - INFO - [cached since 123.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 18:48:24,019 - app.api.v1.endpoints.users - INFO - Search request received, channel: 16a6b4cc-ac6b-4a45-9ece-e04569810476
2025-03-30 18:48:24,019 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743351379}
2025-03-30 18:48:24,020 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-30 18:48:24,020 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-30 18:48:24,020 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-30 18:48:24,020 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 18:48:24,021 - sqlalchemy.engine.Engine - INFO - [cached since 121s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-30 18:48:24,021 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 18:48:24,021 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 18:48:24,022 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 18:48:24,023 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-30 18:48:24,023 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-30 18:48:26,059 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-30 18:48:26,060 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:26,061 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 18:48:26,061 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'pk_1': 2}
2025-03-30 18:48:26,062 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:48:26,062 - sqlalchemy.engine.Engine - INFO - [cached since 125.7s ago] {'last_seen': datetime.datetime(2025, 3, 30, 15, 48, 26, 60625), 'users_id': 2}
2025-03-30 18:48:26,062 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:48:26,063 - app.services.connection_manager - INFO - Attempting to send personal message to user 3
2025-03-30 18:48:26,063 - app.services.connection_manager - INFO - Message type: chat.init
2025-03-30 18:48:26,063 - app.services.connection_manager - INFO - Current active connections: ['2', '3']
2025-03-30 18:48:26,063 - app.services.connection_manager - INFO - User 3 found in active connections, sending message directly
2025-03-30 18:48:26,063 - app.services.connection_manager - INFO - Message sent to user 3 on this server successfully
2025-03-30 18:48:26,063 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-30 18:48:26,081 - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:26.081630", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:26,081 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T15:48:26.081630", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 18:48:26,083 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:26,084 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:26,084 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'device_id_1': '9945cb24-390d-42b0-9725-edf6d7824a05', 'refresh_token_1': '9nVrXWJWHhtvA-8wlfl-cU8v3mzNjA736NYuOa9X6Zk', 'param_1': 1}
2025-03-30 18:48:26,085 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 18:48:26,085 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'refresh_token': 'uYX5iBhbnarV7Eb8jJwn8pOW-2nkXRxYp5epcaOoQHI', 'user_devices_id': 19}
2025-03-30 18:48:26,085 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:48:26,086 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 18:48:26,086 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 18:48:26,303 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 18:48:26,303 - app.services.connection_manager - INFO - User 3 connected to server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:48:26,303 - app.services.connection_manager - INFO - Active connections after connect: ['2', '3']
2025-03-30 18:48:26,304 - app.services.connection_manager - INFO - Publishing user event: connect for user 3
2025-03-30 18:48:26,304 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 18:48:26,305 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:48:26,305 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:48:26,305 - sqlalchemy.engine.Engine - INFO - [cached since 125.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 18:48:26,306 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:48:26,306 - sqlalchemy.engine.Engine - INFO - [cached since 125.9s ago] {'last_seen': datetime.datetime(2025, 3, 30, 15, 48, 26, 306687), 'users_id': 3}
2025-03-30 18:48:26,307 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:48:26,309 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 18:48:50,343 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:48:51,452 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 18:48:52,140 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:48:56,304 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 18:49:20,345 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:49:21,392 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 18:49:22,114 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 18:49:26,310 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 18:49:47,865 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 18:49:47,865 - app.services.connection_manager - INFO - User 2 disconnected from server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:49:47,865 - app.services.connection_manager - INFO - Active connections after disconnect: ['3']
2025-03-30 18:49:47,865 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 18:49:47,865 - app.services.connection_manager - INFO - User 3 disconnected from server 784df947-69f5-48d8-ac26-7e1178ff5438
2025-03-30 18:49:47,865 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-30 18:49:47,866 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 18:49:47,866 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-30 18:49:47,866 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-30 18:49:47,867 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 18:49:47,867 - app.services.connection_manager - WARNING - Disconnect called for user 3 who was not in active_connections
2025-03-30 18:49:47,867 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-30 18:49:47,867 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 18:49:47,867 - app.services.connection_manager - WARNING - Disconnect called for user 2 who was not in active_connections
2025-03-30 18:49:47,867 - app.services.connection_manager - INFO - Active connections after disconnect: []
2025-03-30 18:49:47,870 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-30 18:49:47,871 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-30 18:49:47,872 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 2
2025-03-30 18:49:47,872 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-30 18:49:47,872 - app.services.connection_manager - INFO - Publishing user event: disconnect for user 3
2025-03-30 18:49:47,974 - app.main - INFO - Shutting down server...
2025-03-30 18:49:47,975 - app.main - INFO - Redis connections closed
2025-03-30 18:49:47,975 - app.main - INFO - Server shutdown completed
2025-03-30 18:59:51,089 - app.main - INFO - Starting up server...
2025-03-30 18:59:51,090 - app.main - INFO - Redis initialized
2025-03-30 18:59:51,129 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-30 18:59:51,129 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 18:59:51,130 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-30 18:59:51,130 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 18:59:51,130 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-30 18:59:51,130 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 18:59:51,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:59:51,133 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:59:51,134 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 18:59:51,135 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 18:59:51,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:59:51,137 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:59:51,137 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 18:59:51,138 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:59:51,138 - sqlalchemy.engine.Engine - INFO - [cached since 0.001131s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 18:59:51,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:59:51,139 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:59:51,139 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 18:59:51,139 - sqlalchemy.engine.Engine - INFO - [cached since 0.006167s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 18:59:51,140 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 18:59:51,140 - app.main - INFO - Database initialized
2025-03-30 18:59:51,185 - app.main - INFO - Server key pair generated
2025-03-30 18:59:51,186 - app.main - INFO - Server startup completed successfully
2025-03-30 18:59:52,828 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 18:59:52,833 - app.services.connection_manager - INFO - User 2 connected to server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 18:59:52,833 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 18:59:52,837 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:59:52,839 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:59:52,839 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'id_1': '2', 'param_1': 1}
2025-03-30 18:59:52,841 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:59:52,841 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'last_seen': datetime.datetime(2025, 3, 30, 15, 59, 52, 840068), 'users_id': 2}
2025-03-30 18:59:52,842 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:59:52,843 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 18:59:58,197 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 18:59:58,198 - app.services.connection_manager - INFO - User 3 connected to server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 18:59:58,198 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 18:59:58,199 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 18:59:58,199 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 18:59:58,199 - sqlalchemy.engine.Engine - INFO - [cached since 5.361s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 18:59:58,200 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 18:59:58,200 - sqlalchemy.engine.Engine - INFO - [cached since 5.36s ago] {'last_seen': datetime.datetime(2025, 3, 30, 15, 59, 58, 200633), 'users_id': 3}
2025-03-30 18:59:58,201 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 18:59:58,206 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 18:59:58,258 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 18:59:58,266 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:00:07,392 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:00:23,593 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:00:37,348 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:01:07,389 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:01:13,709 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:01:13,710 - app.services.connection_manager - INFO - User 3 disconnected from server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 19:01:29,178 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:01:29,179 - app.services.connection_manager - INFO - User 2 disconnected from server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 19:01:33,472 - INFO - Incoming request: {"timestamp": "2025-03-30T16:01:33.472444", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:01:33,472 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:01:33.472444", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:01:33,473 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-30 19:01:33,473 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-30 19:01:33,882 - INFO - Incoming request: {"timestamp": "2025-03-30T16:01:33.882880", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:01:33,882 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:01:33.882880", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:01:33,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:01:33,886 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:01:33,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'device_id_1': '9945cb24-390d-42b0-9725-edf6d7824a05', 'refresh_token_1': 'uYX5iBhbnarV7Eb8jJwn8pOW-2nkXRxYp5epcaOoQHI', 'param_1': 1}
2025-03-30 19:01:33,889 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:01:33,889 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] {'refresh_token': 'ERj9vk5nk7DmWlisWi1rec0UAWPhCF5Niv5HPodd2v8', 'user_devices_id': 19}
2025-03-30 19:01:33,897 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:01:33,899 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.003999999999998}
2025-03-30 19:01:33,899 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.003999999999998}
2025-03-30 19:01:35,011 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:01:35,012 - app.services.connection_manager - INFO - User 3 connected to server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 19:01:35,012 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:01:35,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:01:35,012 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:01:35,013 - sqlalchemy.engine.Engine - INFO - [cached since 102.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:01:35,013 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:01:35,013 - sqlalchemy.engine.Engine - INFO - [cached since 102.2s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 1, 35, 13414), 'users_id': 3}
2025-03-30 19:01:35,014 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:01:35,019 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:01:35,154 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:01:35,155 - app.services.connection_manager - INFO - User 3 connected to server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 19:01:35,155 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:01:35,156 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:01:35,156 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:01:35,156 - sqlalchemy.engine.Engine - INFO - [cached since 102.3s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:01:35,157 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:01:35,157 - sqlalchemy.engine.Engine - INFO - [cached since 102.3s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 1, 35, 157449), 'users_id': 3}
2025-03-30 19:01:35,157 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:01:35,158 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:01:35,240 - INFO - Incoming request: {"timestamp": "2025-03-30T16:01:35.240407", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:01:35,240 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:01:35.240407", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:01:35,242 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: f3ee093b-4153-42b3-8064-377058c89168
2025-03-30 19:01:35,242 - app.services.secure_channel_service - INFO - Creating channel with ID: f3ee093b-4153-42b3-8064-377058c89168
2025-03-30 19:01:35,244 - app.services.secure_channel_service - INFO - Channel f3ee093b-4153-42b3-8064-377058c89168 saved to Redis with TTL 1800 seconds
2025-03-30 19:01:35,245 - app.api.v1.endpoints.auth - INFO - Channel f3ee093b-4153-42b3-8064-377058c89168 initialized successfully
2025-03-30 19:01:35,245 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.641}
2025-03-30 19:01:35,245 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.641}
2025-03-30 19:02:04,096 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:02:05,089 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:02:27,224 - INFO - Incoming request: {"timestamp": "2025-03-30T16:02:27.224243", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:02:27,224 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:02:27.224243", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:02:27,225 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-30 19:02:27,225 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-30 19:02:34,035 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:02:34,865 - INFO - Incoming request: {"timestamp": "2025-03-30T16:02:34.865725", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:02:34,865 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:02:34.865725", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:02:34,866 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 13ce9ba5-bb62-4b16-9032-d41b1b5e929a
2025-03-30 19:02:34,866 - app.services.secure_channel_service - INFO - Creating channel with ID: 13ce9ba5-bb62-4b16-9032-d41b1b5e929a
2025-03-30 19:02:34,867 - app.services.secure_channel_service - INFO - Channel 13ce9ba5-bb62-4b16-9032-d41b1b5e929a saved to Redis with TTL 1800 seconds
2025-03-30 19:02:34,867 - app.api.v1.endpoints.auth - INFO - Channel 13ce9ba5-bb62-4b16-9032-d41b1b5e929a initialized successfully
2025-03-30 19:02:34,868 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 19:02:34,868 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 19:02:35,156 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:02:59,321 - INFO - Incoming request: {"timestamp": "2025-03-30T16:02:59.321433", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:02:59,321 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:02:59.321433", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:02:59,322 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 23bf5823-7496-4661-a61a-28afb5372559
2025-03-30 19:02:59,322 - app.services.secure_channel_service - INFO - Creating channel with ID: 23bf5823-7496-4661-a61a-28afb5372559
2025-03-30 19:02:59,323 - app.services.secure_channel_service - INFO - Channel 23bf5823-7496-4661-a61a-28afb5372559 saved to Redis with TTL 1800 seconds
2025-03-30 19:02:59,323 - app.api.v1.endpoints.auth - INFO - Channel 23bf5823-7496-4661-a61a-28afb5372559 initialized successfully
2025-03-30 19:02:59,323 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-30 19:02:59,323 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-30 19:03:04,038 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:03:05,096 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:03:34,105 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:03:35,149 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:03:58,540 - INFO - Incoming request: {"timestamp": "2025-03-30T16:03:58.540855", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:03:58,540 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:03:58.540855", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:03:58,542 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9cf78338-3991-47bf-b257-8557ed6ac40a
2025-03-30 19:03:58,542 - app.services.secure_channel_service - INFO - Creating channel with ID: 9cf78338-3991-47bf-b257-8557ed6ac40a
2025-03-30 19:03:58,542 - app.services.secure_channel_service - INFO - Channel 9cf78338-3991-47bf-b257-8557ed6ac40a saved to Redis with TTL 1800 seconds
2025-03-30 19:03:58,543 - app.api.v1.endpoints.auth - INFO - Channel 9cf78338-3991-47bf-b257-8557ed6ac40a initialized successfully
2025-03-30 19:03:58,543 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 19:03:58,543 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 19:04:04,111 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:04:05,225 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:04:34,094 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:04:35,265 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:05:04,116 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:05:05,259 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:05:34,044 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:05:35,325 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:06:04,100 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:06:05,230 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:06:34,144 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:06:35,051 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:06:36,966 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:06:36,968 - app.services.connection_manager - INFO - User 3 disconnected from server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 19:07:05,067 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:07:35,093 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:07:39,267 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:07:39,268 - app.services.connection_manager - INFO - User 3 disconnected from server 3c37551f-9d8b-4f83-bb6b-49ee9b440276
2025-03-30 19:07:39,363 - app.main - INFO - Shutting down server...
2025-03-30 19:07:39,364 - app.main - INFO - Redis connections closed
2025-03-30 19:07:39,364 - app.main - INFO - Server shutdown completed
2025-03-30 19:09:33,791 - app.main - INFO - Starting up server...
2025-03-30 19:09:33,791 - app.main - INFO - Redis initialized
2025-03-30 19:09:33,829 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-30 19:09:33,829 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:09:33,830 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-30 19:09:33,830 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:09:33,830 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-30 19:09:33,830 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:09:33,833 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:09:33,833 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:09:33,833 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:09:33,835 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:09:33,835 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:09:33,836 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:09:33,836 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:09:33,837 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:09:33,837 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007939s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:09:33,837 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:09:33,838 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:09:33,838 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:09:33,838 - sqlalchemy.engine.Engine - INFO - [cached since 0.005546s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:09:33,839 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:09:33,839 - app.main - INFO - Database initialized
2025-03-30 19:09:33,856 - app.main - INFO - Server key pair generated
2025-03-30 19:09:33,856 - app.main - INFO - Server startup completed successfully
2025-03-30 19:09:47,012 - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:47.012223", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:47,012 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:47.012223", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:47,013 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:09:47,013 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:09:53,201 - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:53.201104", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:53,201 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:53.201104", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:53,205 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 3c8d2103-3d3d-4439-89d7-47b85a872fcf
2025-03-30 19:09:53,205 - app.services.secure_channel_service - INFO - Creating channel with ID: 3c8d2103-3d3d-4439-89d7-47b85a872fcf
2025-03-30 19:09:53,209 - app.services.secure_channel_service - INFO - Channel 3c8d2103-3d3d-4439-89d7-47b85a872fcf saved to Redis with TTL 1800 seconds
2025-03-30 19:09:53,209 - app.api.v1.endpoints.auth - INFO - Channel 3c8d2103-3d3d-4439-89d7-47b85a872fcf initialized successfully
2025-03-30 19:09:53,209 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.989}
2025-03-30 19:09:53,209 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.989}
2025-03-30 19:09:53,564 - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:53.564422", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:53,564 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:53.564422", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:53,566 - app.api.v1.endpoints.auth - INFO - Login request using channel: 3c8d2103-3d3d-4439-89d7-47b85a872fcf
2025-03-30 19:09:53,568 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"eda0e07a-57a5-4875-bb38-e549de99eb0d"}
2025-03-30 19:09:53,568 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': 'eda0e07a-57a5-4875-bb38-e549de99eb0d'}
2025-03-30 19:09:53,572 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:09:53,573 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 19:09:53,573 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-30 19:09:53,797 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:09:53,797 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] {'user_id_1': 2, 'device_id_1': 'eda0e07a-57a5-4875-bb38-e549de99eb0d', 'param_1': 1}
2025-03-30 19:09:53,800 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 19:09:53,800 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'users_id': 2}
2025-03-30 19:09:53,801 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 19:09:53,802 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'user_id': 2, 'device_id': 'eda0e07a-57a5-4875-bb38-e549de99eb0d', 'refresh_token': None, 'last_login': None}
2025-03-30 19:09:53,803 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-30 19:09:53,804 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:09:53,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'refresh_token': '4n27o-SOIj7JkF3qxmxsmLkN2ocrAOGRo1jNAPvwJWA', 'user_devices_id': 20}
2025-03-30 19:09:53,804 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:09:53,805 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 19:09:53,805 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 19:09:53,806 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 19:09:53,806 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 242.05499999999998}
2025-03-30 19:09:53,806 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 242.05499999999998}
2025-03-30 19:09:54,522 - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:54.522816", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:54,522 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:09:54.522816", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:09:54,523 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 64e9dc5a-f967-4df8-9902-43ec503e99f8
2025-03-30 19:09:54,524 - app.services.secure_channel_service - INFO - Creating channel with ID: 64e9dc5a-f967-4df8-9902-43ec503e99f8
2025-03-30 19:09:54,524 - app.services.secure_channel_service - INFO - Channel 64e9dc5a-f967-4df8-9902-43ec503e99f8 saved to Redis with TTL 1800 seconds
2025-03-30 19:09:54,524 - app.api.v1.endpoints.auth - INFO - Channel 64e9dc5a-f967-4df8-9902-43ec503e99f8 initialized successfully
2025-03-30 19:09:54,525 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 19:09:54,525 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 19:09:54,527 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:09:54,530 - app.services.connection_manager - INFO - User 2 connected to server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:09:54,530 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:09:54,530 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:09:54,531 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:09:54,531 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '2', 'param_1': 1}
2025-03-30 19:09:54,532 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:09:54,533 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'last_seen': datetime.datetime(2025, 3, 30, 16, 9, 54, 532818), 'users_id': 2}
2025-03-30 19:09:54,533 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:09:54,538 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:10:02,158 - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:02.158853", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:02,158 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:02.158853", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:02,158 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-30 19:10:02,158 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-30 19:10:09,808 - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:09.808673", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:09,808 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:09.808673", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:09,809 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 7c948fd5-ded6-45b0-b949-4c619926039d
2025-03-30 19:10:09,810 - app.services.secure_channel_service - INFO - Creating channel with ID: 7c948fd5-ded6-45b0-b949-4c619926039d
2025-03-30 19:10:09,810 - app.services.secure_channel_service - INFO - Channel 7c948fd5-ded6-45b0-b949-4c619926039d saved to Redis with TTL 1800 seconds
2025-03-30 19:10:09,810 - app.api.v1.endpoints.auth - INFO - Channel 7c948fd5-ded6-45b0-b949-4c619926039d initialized successfully
2025-03-30 19:10:09,810 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-30 19:10:09,810 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-30 19:10:10,132 - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:10.132870", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:10,132 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:10.132870", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:10,136 - app.api.v1.endpoints.auth - INFO - Login request using channel: 7c948fd5-ded6-45b0-b949-4c619926039d
2025-03-30 19:10:10,137 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"02425126-7f82-4c3e-b151-532b01f6b1da"}
2025-03-30 19:10:10,137 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '02425126-7f82-4c3e-b151-532b01f6b1da'}
2025-03-30 19:10:10,137 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:10,138 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:10,138 - sqlalchemy.engine.Engine - INFO - [cached since 16.56s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-30 19:10:10,336 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:10,337 - sqlalchemy.engine.Engine - INFO - [cached since 16.54s ago] {'user_id_1': 3, 'device_id_1': '02425126-7f82-4c3e-b151-532b01f6b1da', 'param_1': 1}
2025-03-30 19:10:10,338 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 19:10:10,338 - sqlalchemy.engine.Engine - INFO - [cached since 16.54s ago] {'users_id': 3}
2025-03-30 19:10:10,338 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 19:10:10,338 - sqlalchemy.engine.Engine - INFO - [cached since 16.54s ago] {'user_id': 3, 'device_id': '02425126-7f82-4c3e-b151-532b01f6b1da', 'refresh_token': None, 'last_login': None}
2025-03-30 19:10:10,339 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-30 19:10:10,339 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:10:10,339 - sqlalchemy.engine.Engine - INFO - [cached since 16.54s ago] {'refresh_token': 'LhvbfvBSQraZoTNYW-rLyJsHktER6SNdh7VG-EETOCw', 'user_devices_id': 21}
2025-03-30 19:10:10,340 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:10:10,345 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 19:10:10,345 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 19:10:10,346 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 19:10:10,347 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.04999999999998}
2025-03-30 19:10:10,347 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.04999999999998}
2025-03-30 19:10:10,881 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:10:10,882 - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:10.882179", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:10,882 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:10.882179", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:10:10,883 - app.services.connection_manager - INFO - User 3 connected to server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:10:10,883 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:10:10,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:10,883 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:10,884 - sqlalchemy.engine.Engine - INFO - [cached since 16.35s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:10:10,884 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:10:10,885 - sqlalchemy.engine.Engine - INFO - [cached since 16.35s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 10, 10, 884179), 'users_id': 3}
2025-03-30 19:10:10,885 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:10:10,890 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:10:10,891 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 16ed53b3-a082-4b61-820c-7eee8a298067
2025-03-30 19:10:10,891 - app.services.secure_channel_service - INFO - Creating channel with ID: 16ed53b3-a082-4b61-820c-7eee8a298067
2025-03-30 19:10:10,892 - app.services.secure_channel_service - INFO - Channel 16ed53b3-a082-4b61-820c-7eee8a298067 saved to Redis with TTL 1800 seconds
2025-03-30 19:10:10,892 - app.api.v1.endpoints.auth - INFO - Channel 16ed53b3-a082-4b61-820c-7eee8a298067 initialized successfully
2025-03-30 19:10:10,892 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-30 19:10:10,892 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-30 19:10:12,079 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:10:12,080 - app.services.connection_manager - INFO - User 3 connected to server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:10:12,080 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:10:12,080 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:12,080 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:12,080 - sqlalchemy.engine.Engine - INFO - [cached since 17.55s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:10:12,081 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:10:12,082 - sqlalchemy.engine.Engine - INFO - [cached since 17.55s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 10, 12, 81882), 'users_id': 3}
2025-03-30 19:10:12,082 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:10:12,087 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:10:13,932 - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:13.931271", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:10:13,932 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:13.931271", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:10:13,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:13,934 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:13,934 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'device_id_1': 'eda0e07a-57a5-4875-bb38-e549de99eb0d', 'refresh_token_1': '4n27o-SOIj7JkF3qxmxsmLkN2ocrAOGRo1jNAPvwJWA', 'param_1': 1}
2025-03-30 19:10:13,936 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:10:13,936 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'refresh_token': 'pvxYPDd12jE2EVVvdXUrnz1OUi384XrG5dBxhW8pSIw', 'user_devices_id': 20}
2025-03-30 19:10:13,936 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:10:13,937 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-30 19:10:13,937 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-30 19:10:14,013 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:10:14,014 - app.services.connection_manager - INFO - User 2 connected to server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:10:14,014 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:10:14,015 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:14,015 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:14,015 - sqlalchemy.engine.Engine - INFO - [cached since 19.48s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:10:14,016 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:10:14,016 - sqlalchemy.engine.Engine - INFO - [cached since 19.48s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 10, 14, 16093), 'users_id': 2}
2025-03-30 19:10:14,017 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:10:14,017 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:10:16,549 - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:16.549465", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:10:16,549 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:10:16.549465", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:10:16,551 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:16,551 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:10:16,551 - sqlalchemy.engine.Engine - INFO - [cached since 22.02s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:10:16,553 - app.api.v1.endpoints.users - INFO - Search request received, channel: 64e9dc5a-f967-4df8-9902-43ec503e99f8
2025-03-30 19:10:16,553 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743352813}
2025-03-30 19:10:16,554 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"Mi","limit":10}
2025-03-30 19:10:16,554 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'Mi', 'limit': 10}
2025-03-30 19:10:16,554 - app.api.v1.endpoints.users - INFO - Searching users with query 'Mi', excluding user 2
2025-03-30 19:10:16,555 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 19:10:16,555 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'id_1': '2', 'username_1': '%Mi%', 'email_1': '%Mi%', 'param_1': 10}
2025-03-30 19:10:16,555 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 19:10:16,556 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 19:10:16,557 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:10:16,557 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-30 19:10:16,557 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-30 19:10:18,370 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-30 19:10:18,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:10:18,373 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:10:18,373 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'pk_1': 2}
2025-03-30 19:10:18,374 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:10:18,374 - sqlalchemy.engine.Engine - INFO - [cached since 23.84s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 10, 18, 371048), 'users_id': 2}
2025-03-30 19:10:18,374 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:10:18,375 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-30 19:10:40,863 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:10:41,993 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:10:44,004 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:11:10,876 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:11:11,882 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:11:14,093 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:11:40,871 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:11:41,878 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:11:44,015 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:12:10,804 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:12:11,869 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:12:13,867 - INFO - Incoming request: {"timestamp": "2025-03-30T16:12:13.867546", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:12:13,867 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:12:13.867546", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:12:13,869 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:12:13,869 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:12:13,869 - sqlalchemy.engine.Engine - INFO - [cached since 119.9s ago] {'device_id_1': 'eda0e07a-57a5-4875-bb38-e549de99eb0d', 'refresh_token_1': 'pvxYPDd12jE2EVVvdXUrnz1OUi384XrG5dBxhW8pSIw', 'param_1': 1}
2025-03-30 19:12:13,870 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:12:13,870 - sqlalchemy.engine.Engine - INFO - [cached since 119.9s ago] {'refresh_token': 'qb0M34gtyxlRrG3rgTD4cLxcDdWr_d5d6ZZzXLEUiq8', 'user_devices_id': 20}
2025-03-30 19:12:13,871 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:12:13,876 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-30 19:12:13,876 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-30 19:12:13,931 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:12:13,932 - app.services.connection_manager - INFO - User 2 connected to server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:12:13,932 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:12:13,932 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:12:13,933 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:12:13,933 - sqlalchemy.engine.Engine - INFO - [cached since 139.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:12:13,934 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:12:13,934 - sqlalchemy.engine.Engine - INFO - [cached since 139.4s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 12, 13, 933583), 'users_id': 2}
2025-03-30 19:12:13,934 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:12:13,935 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:12:40,806 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:12:41,940 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:12:43,972 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:13:10,801 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:13:11,950 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:13:13,929 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:13:31,668 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-30 19:13:31,669 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:13:31,670 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:13:31,670 - sqlalchemy.engine.Engine - INFO - [cached since 193.3s ago] {'pk_1': 2}
2025-03-30 19:13:31,671 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:13:31,671 - sqlalchemy.engine.Engine - INFO - [cached since 217.1s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 13, 31, 669230), 'users_id': 2}
2025-03-30 19:13:31,671 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:13:31,672 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-30 19:13:40,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:13:41,913 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:13:43,937 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:14:11,044 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:14:11,912 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:14:13,930 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:14:35,058 - INFO - Incoming request: {"timestamp": "2025-03-30T16:14:35.058584", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:14:35,058 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:14:35.058584", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:14:35,060 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:14:35,060 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:14:35,060 - sqlalchemy.engine.Engine - INFO - [cached since 280.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:14:35,061 - app.api.v1.endpoints.users - INFO - Search request received, channel: 64e9dc5a-f967-4df8-9902-43ec503e99f8
2025-03-30 19:14:35,061 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743352933}
2025-03-30 19:14:35,062 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-30 19:14:35,062 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-30 19:14:35,062 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-30 19:14:35,063 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 19:14:35,063 - sqlalchemy.engine.Engine - INFO - [cached since 258.5s ago] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-30 19:14:35,063 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 19:14:35,064 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 19:14:35,065 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:14:35,065 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-30 19:14:35,065 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-30 19:14:38,007 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-30 19:14:38,009 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:14:38,009 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:14:38,009 - sqlalchemy.engine.Engine - INFO - [cached since 259.6s ago] {'pk_1': 2}
2025-03-30 19:14:38,010 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:14:38,010 - sqlalchemy.engine.Engine - INFO - [cached since 283.5s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 14, 38, 8269), 'users_id': 2}
2025-03-30 19:14:38,010 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:14:38,015 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-30 19:14:40,810 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:14:41,884 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:14:43,963 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:14:46,114 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:14:46,115 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:14:46,116 - app.services.connection_manager - INFO - User 3 disconnected from server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:14:46,118 - app.services.connection_manager - INFO - User 3 disconnected from server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:14:50,482 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-30 19:14:50,483 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:14:50,483 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:14:50,484 - sqlalchemy.engine.Engine - INFO - [cached since 272.1s ago] {'pk_1': 2}
2025-03-30 19:14:50,485 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:14:50,485 - sqlalchemy.engine.Engine - INFO - [cached since 296s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 14, 50, 483492), 'users_id': 2}
2025-03-30 19:14:50,485 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:14:50,487 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-30 19:15:05,927 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:15:05,928 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:15:05,928 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:15:05,929 - app.services.connection_manager - INFO - User 2 disconnected from server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:15:05,930 - app.services.connection_manager - INFO - User 2 disconnected from server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:15:05,931 - app.services.connection_manager - INFO - User 2 disconnected from server 4205052e-d8ee-4e0a-8317-4aab5926bbb5
2025-03-30 19:16:04,927 - app.main - INFO - Shutting down server...
2025-03-30 19:16:04,928 - app.main - INFO - Redis connections closed
2025-03-30 19:16:04,928 - app.main - INFO - Server shutdown completed
2025-03-30 19:16:26,203 - app.main - INFO - Starting up server...
2025-03-30 19:16:26,203 - app.main - INFO - Redis initialized
2025-03-30 19:16:26,354 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-30 19:16:26,354 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:16:26,354 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-30 19:16:26,354 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:16:26,355 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-30 19:16:26,355 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:16:26,357 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:26,358 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:16:26,358 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:16:26,359 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:16:26,360 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:26,361 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:16:26,361 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:16:26,362 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:16:26,362 - sqlalchemy.engine.Engine - INFO - [cached since 0.0008495s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:16:26,362 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:16:26,363 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:26,363 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:16:26,363 - sqlalchemy.engine.Engine - INFO - [cached since 0.005518s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:16:26,364 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:16:26,364 - app.main - INFO - Database initialized
2025-03-30 19:16:26,414 - app.main - INFO - Server key pair generated
2025-03-30 19:16:26,415 - app.main - INFO - Server startup completed successfully
2025-03-30 19:16:30,599 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:30.599359", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:30,599 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:30.599359", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:30,600 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:16:30,600 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:16:40,552 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:40.552634", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:40,552 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:40.552634", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:40,555 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 2e9d8cdc-8fe4-4876-991c-b114b9adfaa2
2025-03-30 19:16:40,556 - app.services.secure_channel_service - INFO - Creating channel with ID: 2e9d8cdc-8fe4-4876-991c-b114b9adfaa2
2025-03-30 19:16:40,559 - app.services.secure_channel_service - INFO - Channel 2e9d8cdc-8fe4-4876-991c-b114b9adfaa2 saved to Redis with TTL 1800 seconds
2025-03-30 19:16:40,560 - app.api.v1.endpoints.auth - INFO - Channel 2e9d8cdc-8fe4-4876-991c-b114b9adfaa2 initialized successfully
2025-03-30 19:16:40,560 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-30 19:16:40,560 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-30 19:16:41,185 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:41.185825", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:41,185 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:41.185825", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:41,187 - app.api.v1.endpoints.auth - INFO - Login request using channel: 2e9d8cdc-8fe4-4876-991c-b114b9adfaa2
2025-03-30 19:16:41,188 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"bfbd7126-fc34-40a2-8049-1d356421608c"}
2025-03-30 19:16:41,189 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': 'bfbd7126-fc34-40a2-8049-1d356421608c'}
2025-03-30 19:16:41,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:41,194 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:41,194 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-30 19:16:41,421 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:41,421 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'user_id_1': 3, 'device_id_1': 'bfbd7126-fc34-40a2-8049-1d356421608c', 'param_1': 1}
2025-03-30 19:16:41,426 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 19:16:41,426 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] {'users_id': 3}
2025-03-30 19:16:41,428 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 19:16:41,428 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'user_id': 3, 'device_id': 'bfbd7126-fc34-40a2-8049-1d356421608c', 'refresh_token': None, 'last_login': None}
2025-03-30 19:16:41,429 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-30 19:16:41,430 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:16:41,430 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'etDj0MsdkCUqpC5_JYkk0Ba957NCSHCgqpyLqaM5fo0', 'user_devices_id': 22}
2025-03-30 19:16:41,431 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:16:41,441 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 19:16:41,441 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 19:16:41,442 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 19:16:41,442 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 256.39}
2025-03-30 19:16:41,442 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 256.39}
2025-03-30 19:16:42,607 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:42.606434", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:42,607 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:42.606434", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:42,609 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:16:42,611 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0224888c-fdd1-4ae6-b826-3c36fa8ad459
2025-03-30 19:16:42,611 - app.services.secure_channel_service - INFO - Creating channel with ID: 0224888c-fdd1-4ae6-b826-3c36fa8ad459
2025-03-30 19:16:42,611 - app.services.secure_channel_service - INFO - Channel 0224888c-fdd1-4ae6-b826-3c36fa8ad459 saved to Redis with TTL 1800 seconds
2025-03-30 19:16:42,612 - app.api.v1.endpoints.auth - INFO - Channel 0224888c-fdd1-4ae6-b826-3c36fa8ad459 initialized successfully
2025-03-30 19:16:42,612 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-30 19:16:42,612 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-30 19:16:42,613 - app.services.connection_manager - INFO - User 3 connected to server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:16:42,613 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:16:42,613 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:42,614 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:42,614 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '3', 'param_1': 1}
2025-03-30 19:16:42,615 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:16:42,616 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'last_seen': datetime.datetime(2025, 3, 30, 16, 16, 42, 615436), 'users_id': 3}
2025-03-30 19:16:42,616 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:16:42,617 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:16:42,619 - app.services.message_buffer - INFO - Retrieved and cleared 1 messages for user 3
2025-03-30 19:16:42,619 - app.api.v1.endpoints.websocket - INFO - Delivering 1 buffered messages to user 3
2025-03-30 19:16:44,544 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:44.544993", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:44,544 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:44.544993", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:16:44,546 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:44,547 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:44,547 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'device_id_1': 'bfbd7126-fc34-40a2-8049-1d356421608c', 'refresh_token_1': 'etDj0MsdkCUqpC5_JYkk0Ba957NCSHCgqpyLqaM5fo0', 'param_1': 1}
2025-03-30 19:16:44,548 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:16:44,548 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'refresh_token': '5Kr_yHS9R1WIV7L5V0goCxy1Y04-nz3sHGHGDt0qdqA', 'user_devices_id': 22}
2025-03-30 19:16:44,549 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:16:44,554 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-30 19:16:44,554 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-30 19:16:44,885 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:16:44,886 - app.services.connection_manager - INFO - User 3 connected to server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:16:44,886 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:16:44,887 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:44,887 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:44,887 - sqlalchemy.engine.Engine - INFO - [cached since 2.273s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:16:44,888 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:16:44,888 - sqlalchemy.engine.Engine - INFO - [cached since 2.273s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 16, 44, 888841), 'users_id': 3}
2025-03-30 19:16:44,889 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:16:44,894 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:16:52,830 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:52.830473", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:16:52,830 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:52.830473", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:16:52,831 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-30 19:16:52,831 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-30 19:16:58,577 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:58.577421", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:16:58,577 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:58.577421", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:16:58,578 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: a3a8ba28-2088-4b10-831f-438c9bdad494
2025-03-30 19:16:58,578 - app.services.secure_channel_service - INFO - Creating channel with ID: a3a8ba28-2088-4b10-831f-438c9bdad494
2025-03-30 19:16:58,579 - app.services.secure_channel_service - INFO - Channel a3a8ba28-2088-4b10-831f-438c9bdad494 saved to Redis with TTL 1800 seconds
2025-03-30 19:16:58,579 - app.api.v1.endpoints.auth - INFO - Channel a3a8ba28-2088-4b10-831f-438c9bdad494 initialized successfully
2025-03-30 19:16:58,579 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-30 19:16:58,579 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-30 19:16:58,862 - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:58.862540", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:16:58,862 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:16:58.862540", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:16:58,864 - app.api.v1.endpoints.auth - INFO - Login request using channel: a3a8ba28-2088-4b10-831f-438c9bdad494
2025-03-30 19:16:58,865 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"cecddb77-8ad7-4650-9ec1-e8dd57ce7db2"}
2025-03-30 19:16:58,865 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2'}
2025-03-30 19:16:58,865 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:16:58,866 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:58,866 - sqlalchemy.engine.Engine - INFO - [cached since 17.67s ago] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-30 19:16:59,068 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:16:59,068 - sqlalchemy.engine.Engine - INFO - [cached since 17.65s ago] {'user_id_1': 2, 'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'param_1': 1}
2025-03-30 19:16:59,069 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 19:16:59,069 - sqlalchemy.engine.Engine - INFO - [cached since 17.64s ago] {'users_id': 2}
2025-03-30 19:16:59,070 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 19:16:59,070 - sqlalchemy.engine.Engine - INFO - [cached since 17.64s ago] {'user_id': 2, 'device_id': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token': None, 'last_login': None}
2025-03-30 19:16:59,071 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-30 19:16:59,071 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:16:59,071 - sqlalchemy.engine.Engine - INFO - [cached since 17.64s ago] {'refresh_token': 'SAoGDB5XMdCVGNgxamTagZpaRiTS0dSp6IjiAfkCmpo', 'user_devices_id': 23}
2025-03-30 19:16:59,072 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:16:59,072 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 19:16:59,072 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 19:16:59,073 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 19:16:59,074 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 211.313}
2025-03-30 19:16:59,074 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 211.313}
2025-03-30 19:17:01,813 - INFO - Incoming request: {"timestamp": "2025-03-30T16:17:01.813431", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:17:01,813 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:17:01.813431", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:17:01,814 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:17:01,815 - app.services.connection_manager - INFO - User 2 connected to server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:17:01,815 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:17:01,816 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:01,816 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:17:01,816 - sqlalchemy.engine.Engine - INFO - [cached since 19.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:17:01,817 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:17:01,817 - sqlalchemy.engine.Engine - INFO - [cached since 19.2s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 17, 1, 817432), 'users_id': 2}
2025-03-30 19:17:01,818 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:17:01,823 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:17:01,823 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e73171ac-d4b7-409a-bafb-77f6382df9ba
2025-03-30 19:17:01,824 - app.services.secure_channel_service - INFO - Creating channel with ID: e73171ac-d4b7-409a-bafb-77f6382df9ba
2025-03-30 19:17:01,824 - app.services.secure_channel_service - INFO - Channel e73171ac-d4b7-409a-bafb-77f6382df9ba saved to Redis with TTL 1800 seconds
2025-03-30 19:17:01,824 - app.api.v1.endpoints.auth - INFO - Channel e73171ac-d4b7-409a-bafb-77f6382df9ba initialized successfully
2025-03-30 19:17:01,824 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-03-30 19:17:01,824 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-03-30 19:17:03,446 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:17:03,447 - app.services.connection_manager - INFO - User 2 connected to server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:17:03,447 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:17:03,448 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:03,448 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:17:03,448 - sqlalchemy.engine.Engine - INFO - [cached since 20.83s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:17:03,449 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:17:03,449 - sqlalchemy.engine.Engine - INFO - [cached since 20.83s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 17, 3, 449463), 'users_id': 2}
2025-03-30 19:17:03,450 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:17:03,450 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:17:07,327 - INFO - Incoming request: {"timestamp": "2025-03-30T16:17:07.327084", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:17:07,327 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:17:07.327084", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:17:07,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:07,329 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:17:07,329 - sqlalchemy.engine.Engine - INFO - [cached since 24.71s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:17:07,330 - app.api.v1.endpoints.users - INFO - Search request received, channel: 0224888c-fdd1-4ae6-b826-3c36fa8ad459
2025-03-30 19:17:07,330 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743353204}
2025-03-30 19:17:07,331 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-30 19:17:07,331 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-30 19:17:07,331 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-30 19:17:07,333 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 19:17:07,333 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-30 19:17:07,333 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 19:17:07,334 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 19:17:07,335 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:17:07,335 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-30 19:17:07,335 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-30 19:17:09,709 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-30 19:17:09,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:09,712 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:17:09,712 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'pk_1': 3}
2025-03-30 19:17:09,712 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:17:09,713 - sqlalchemy.engine.Engine - INFO - [cached since 27.1s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 17, 9, 710536), 'users_id': 3}
2025-03-30 19:17:09,713 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:17:09,714 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-30 19:17:13,779 - INFO - Incoming request: {"timestamp": "2025-03-30T16:17:13.778473", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:17:13,779 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:17:13.778473", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:17:13,780 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:13,781 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:17:13,781 - sqlalchemy.engine.Engine - INFO - [cached since 29.23s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'SAoGDB5XMdCVGNgxamTagZpaRiTS0dSp6IjiAfkCmpo', 'param_1': 1}
2025-03-30 19:17:13,782 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:17:13,782 - sqlalchemy.engine.Engine - INFO - [cached since 29.23s ago] {'refresh_token': 'Et1E2qHNA-ao1F0uMsbiFTkIQQzjzvpP1y3FzhckA7c', 'user_devices_id': 23}
2025-03-30 19:17:13,782 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:17:13,783 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:17:13,783 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:17:13,907 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:17:13,908 - app.services.connection_manager - INFO - User 2 connected to server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:17:13,908 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:17:13,908 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:13,909 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:17:13,909 - sqlalchemy.engine.Engine - INFO - [cached since 31.29s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:17:13,910 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:17:13,910 - sqlalchemy.engine.Engine - INFO - [cached since 31.29s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 17, 13, 909503), 'users_id': 2}
2025-03-30 19:17:13,910 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:17:13,911 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:17:14,728 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:17:25,150 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-30 19:17:25,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:17:25,152 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:17:25,152 - sqlalchemy.engine.Engine - INFO - [cached since 15.44s ago] {'pk_1': 3}
2025-03-30 19:17:25,153 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:17:25,153 - sqlalchemy.engine.Engine - INFO - [cached since 42.54s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 17, 25, 151827), 'users_id': 3}
2025-03-30 19:17:25,154 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:17:25,159 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-30 19:17:33,330 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:17:43,835 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:17:44,751 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:18:03,305 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:18:13,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:18:14,841 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:18:20,670 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:18:20,671 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:18:20,672 - app.services.connection_manager - INFO - User 2 disconnected from server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:18:20,673 - app.services.connection_manager - INFO - User 2 disconnected from server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:18:23,880 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:18:23,880 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:18:23,882 - app.services.connection_manager - INFO - User 3 disconnected from server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:18:23,882 - app.services.connection_manager - INFO - User 3 disconnected from server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:18:27,293 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:18:27,294 - app.services.connection_manager - INFO - User 2 disconnected from server 00c43436-03c0-4e64-88ea-94104572ba8a
2025-03-30 19:18:27,405 - app.main - INFO - Shutting down server...
2025-03-30 19:18:27,406 - app.main - INFO - Redis connections closed
2025-03-30 19:18:27,406 - app.main - INFO - Server shutdown completed
2025-03-30 19:24:05,808 - app.main - INFO - Starting up server...
2025-03-30 19:24:05,808 - app.main - INFO - Redis initialized
2025-03-30 19:24:05,846 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-30 19:24:05,846 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:24:05,847 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-30 19:24:05,847 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:24:05,847 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-30 19:24:05,848 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:24:05,850 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:05,850 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:24:05,850 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:24:05,852 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:24:05,852 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:05,853 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:24:05,853 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:24:05,854 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:24:05,854 - sqlalchemy.engine.Engine - INFO - [cached since 0.0006863s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:24:05,854 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:24:05,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:05,855 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:24:05,855 - sqlalchemy.engine.Engine - INFO - [cached since 0.004766s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:24:05,856 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:24:05,856 - app.main - INFO - Database initialized
2025-03-30 19:24:05,904 - app.main - INFO - Server key pair generated
2025-03-30 19:24:05,904 - app.main - INFO - Server startup completed successfully
2025-03-30 19:24:29,962 - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:29.962127", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:29,962 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:29.962127", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:29,963 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:24:29,963 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:24:30,336 - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:30.336359", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:30,336 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:30.336359", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:30,343 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:30,345 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:24:30,345 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'Et1E2qHNA-ao1F0uMsbiFTkIQQzjzvpP1y3FzhckA7c', 'param_1': 1}
2025-03-30 19:24:30,348 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:24:30,348 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'RQ4sPxpN34cH4_Tkn9vJ6FhbS9qmVyp9KNkyDvskCNQ', 'user_devices_id': 23}
2025-03-30 19:24:30,349 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:24:30,358 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 22.003999999999998}
2025-03-30 19:24:30,358 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 22.003999999999998}
2025-03-30 19:24:31,797 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:24:31,802 - app.services.connection_manager - INFO - User 2 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:24:31,802 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:24:31,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:31,804 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:24:31,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '2', 'param_1': 1}
2025-03-30 19:24:31,806 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:24:31,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'last_seen': datetime.datetime(2025, 3, 30, 16, 24, 31, 805769), 'users_id': 2}
2025-03-30 19:24:31,807 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:24:31,807 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:24:31,970 - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:31.970981", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:31,970 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:31.970981", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:31,971 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 8f37ac09-b0f4-4241-b5d2-fe605de47451
2025-03-30 19:24:31,971 - app.services.secure_channel_service - INFO - Creating channel with ID: 8f37ac09-b0f4-4241-b5d2-fe605de47451
2025-03-30 19:24:31,973 - app.services.secure_channel_service - INFO - Channel 8f37ac09-b0f4-4241-b5d2-fe605de47451 saved to Redis with TTL 1800 seconds
2025-03-30 19:24:31,974 - app.api.v1.endpoints.auth - INFO - Channel 8f37ac09-b0f4-4241-b5d2-fe605de47451 initialized successfully
2025-03-30 19:24:31,974 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9240000000000004}
2025-03-30 19:24:31,974 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9240000000000004}
2025-03-30 19:24:32,733 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:24:32,734 - app.services.connection_manager - INFO - User 2 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:24:32,734 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:24:32,735 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:32,735 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:24:32,735 - sqlalchemy.engine.Engine - INFO - [cached since 0.9304s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:24:32,736 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:24:32,736 - sqlalchemy.engine.Engine - INFO - [cached since 0.9296s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 24, 32, 736003), 'users_id': 2}
2025-03-30 19:24:32,737 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:24:32,737 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:24:36,046 - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:36.046894", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:36,046 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:24:36.046894", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:24:36,048 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:36,048 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:24:36,048 - sqlalchemy.engine.Engine - INFO - [cached since 5.704s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'RQ4sPxpN34cH4_Tkn9vJ6FhbS9qmVyp9KNkyDvskCNQ', 'param_1': 1}
2025-03-30 19:24:36,049 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:24:36,050 - sqlalchemy.engine.Engine - INFO - [cached since 5.702s ago] {'refresh_token': 'rQAF_SPYFmgijqra7SaCWhEgfAkHNo7F4M5LqAt5Yzo', 'user_devices_id': 23}
2025-03-30 19:24:36,050 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:24:36,051 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:24:36,051 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:24:36,151 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:24:36,152 - app.services.connection_manager - INFO - User 2 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:24:36,152 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:24:36,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:24:36,153 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:24:36,153 - sqlalchemy.engine.Engine - INFO - [cached since 4.348s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:24:36,153 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:24:36,154 - sqlalchemy.engine.Engine - INFO - [cached since 4.347s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 24, 36, 153159), 'users_id': 2}
2025-03-30 19:24:36,154 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:24:36,154 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:25:02,234 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:25:03,567 - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:03.566372", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:25:03,567 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:03.566372", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:25:03,567 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:25:03,567 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:25:03,812 - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:03.812524", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:25:03,812 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:03.812524", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:25:03,813 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:25:03,813 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:25:03,813 - sqlalchemy.engine.Engine - INFO - [cached since 33.47s ago] {'device_id_1': 'bfbd7126-fc34-40a2-8049-1d356421608c', 'refresh_token_1': '5Kr_yHS9R1WIV7L5V0goCxy1Y04-nz3sHGHGDt0qdqA', 'param_1': 1}
2025-03-30 19:25:03,814 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:25:03,815 - sqlalchemy.engine.Engine - INFO - [cached since 33.47s ago] {'refresh_token': 'jkVW0IcxHQrmKowaStd2JWUi4kqLVwAAcqVYwNQzir0', 'user_devices_id': 22}
2025-03-30 19:25:03,815 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:25:03,821 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.185}
2025-03-30 19:25:03,821 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.185}
2025-03-30 19:25:04,082 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:25:04,083 - app.services.connection_manager - INFO - User 3 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:25:04,083 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:25:04,083 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:25:04,084 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:25:04,084 - sqlalchemy.engine.Engine - INFO - [cached since 32.28s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:25:04,085 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:25:04,085 - sqlalchemy.engine.Engine - INFO - [cached since 32.28s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 25, 4, 85769), 'users_id': 3}
2025-03-30 19:25:04,086 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:25:04,087 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:25:04,715 - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:04.715937", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:25:04,715 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:04.715937", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:25:04,716 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 7a91e6b1-cd17-47dc-8536-371dfa287be1
2025-03-30 19:25:04,716 - app.services.secure_channel_service - INFO - Creating channel with ID: 7a91e6b1-cd17-47dc-8536-371dfa287be1
2025-03-30 19:25:04,717 - app.services.secure_channel_service - INFO - Channel 7a91e6b1-cd17-47dc-8536-371dfa287be1 saved to Redis with TTL 1800 seconds
2025-03-30 19:25:04,717 - app.api.v1.endpoints.auth - INFO - Channel 7a91e6b1-cd17-47dc-8536-371dfa287be1 initialized successfully
2025-03-30 19:25:04,717 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-30 19:25:04,717 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-30 19:25:05,349 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:25:05,350 - app.services.connection_manager - INFO - User 3 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:25:05,350 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:25:05,350 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:25:05,351 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:25:05,351 - sqlalchemy.engine.Engine - INFO - [cached since 33.55s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:25:05,352 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:25:05,352 - sqlalchemy.engine.Engine - INFO - [cached since 33.55s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 25, 5, 352081), 'users_id': 3}
2025-03-30 19:25:05,353 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:25:05,358 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:25:06,216 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:25:11,022 - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:11.022434", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:25:11,022 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:25:11.022434", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:25:11,024 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:25:11,024 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:25:11,024 - sqlalchemy.engine.Engine - INFO - [cached since 39.22s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:25:11,026 - app.api.v1.endpoints.users - INFO - Search request received, channel: 8f37ac09-b0f4-4241-b5d2-fe605de47451
2025-03-30 19:25:11,026 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743353676}
2025-03-30 19:25:11,027 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mira","limit":10}
2025-03-30 19:25:11,027 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mira', 'limit': 10}
2025-03-30 19:25:11,027 - app.api.v1.endpoints.users - INFO - Searching users with query 'mira', excluding user 2
2025-03-30 19:25:11,028 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 19:25:11,028 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'id_1': '2', 'username_1': '%mira%', 'email_1': '%mira%', 'param_1': 10}
2025-03-30 19:25:11,029 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 19:25:11,029 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 19:25:11,030 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:25:11,031 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-30 19:25:11,031 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-30 19:25:12,766 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-30 19:25:12,766 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:25:12,768 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:25:12,768 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] {'pk_1': 2}
2025-03-30 19:25:12,768 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:25:12,768 - sqlalchemy.engine.Engine - INFO - [cached since 40.96s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 25, 12, 766565), 'users_id': 2}
2025-03-30 19:25:12,769 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:25:12,774 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-30 19:25:32,192 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:25:34,121 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:25:35,106 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:25:36,148 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:25:57,122 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-30 19:25:57,123 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:25:57,124 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:25:57,124 - sqlalchemy.engine.Engine - INFO - [cached since 44.36s ago] {'pk_1': 2}
2025-03-30 19:25:57,124 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:25:57,124 - sqlalchemy.engine.Engine - INFO - [cached since 85.32s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 25, 57, 123757), 'users_id': 2}
2025-03-30 19:25:57,125 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:25:57,130 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-30 19:26:02,193 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:26:04,094 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:26:05,180 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:26:06,206 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:26:29,383 - INFO - Incoming request: {"timestamp": "2025-03-30T16:26:29.383448", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:26:29,383 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:26:29.383448", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:26:29,385 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:26:29,385 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:26:29,385 - sqlalchemy.engine.Engine - INFO - [cached since 119s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'rQAF_SPYFmgijqra7SaCWhEgfAkHNo7F4M5LqAt5Yzo', 'param_1': 1}
2025-03-30 19:26:29,386 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:26:29,387 - sqlalchemy.engine.Engine - INFO - [cached since 119s ago] {'refresh_token': 'oRRMRQxRsJNEpvxHcI89_-dvy5HmVfHS3TYA6iBI5bs', 'user_devices_id': 23}
2025-03-30 19:26:29,387 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:26:29,392 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.991000000000001}
2025-03-30 19:26:29,392 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.991000000000001}
2025-03-30 19:26:29,574 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:26:29,576 - app.services.connection_manager - INFO - User 2 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:26:29,576 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:26:29,576 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:26:29,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:26:29,577 - sqlalchemy.engine.Engine - INFO - [cached since 117.8s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:26:29,577 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:26:29,578 - sqlalchemy.engine.Engine - INFO - [cached since 117.8s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 26, 29, 577988), 'users_id': 2}
2025-03-30 19:26:29,578 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:26:29,579 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:26:32,189 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:26:34,105 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:26:35,148 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:26:59,472 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:27:02,193 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:27:04,042 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:27:05,188 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:27:29,532 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:27:32,199 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:27:34,069 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:27:35,109 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:27:59,517 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:28:02,196 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:28:04,457 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:28:05,085 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:28:29,498 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:28:32,212 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:28:34,088 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:28:35,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:28:59,489 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:29:02,243 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:29:04,145 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:29:05,147 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:29:29,490 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:29:32,193 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:29:34,043 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:29:35,141 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:29:55,266 - INFO - Incoming request: {"timestamp": "2025-03-30T16:29:55.266691", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:29:55,266 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:29:55.266691", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:29:55,269 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:29:55,270 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:29:55,270 - sqlalchemy.engine.Engine - INFO - [cached since 324.9s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'oRRMRQxRsJNEpvxHcI89_-dvy5HmVfHS3TYA6iBI5bs', 'param_1': 1}
2025-03-30 19:29:55,271 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:29:55,271 - sqlalchemy.engine.Engine - INFO - [cached since 324.9s ago] {'refresh_token': '6p6K9PWVl7kACYKMDks7JlzgvAJ84yDii_yCxiYux-I', 'user_devices_id': 23}
2025-03-30 19:29:55,271 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:29:55,280 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.007}
2025-03-30 19:29:55,280 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.007}
2025-03-30 19:29:55,422 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:29:55,423 - app.services.connection_manager - INFO - User 2 connected to server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:29:55,423 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:29:55,424 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:29:55,424 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:29:55,424 - sqlalchemy.engine.Engine - INFO - [cached since 323.6s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:29:55,425 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:29:55,425 - sqlalchemy.engine.Engine - INFO - [cached since 323.6s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 29, 55, 425429), 'users_id': 2}
2025-03-30 19:29:55,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:29:55,426 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:30:01,869 - INFO - Incoming request: {"timestamp": "2025-03-30T16:30:01.869449", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:30:01,869 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:30:01.869449", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:30:01,871 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e834a54d-437f-405e-9bf6-d537b117f38a
2025-03-30 19:30:01,871 - app.services.secure_channel_service - INFO - Creating channel with ID: e834a54d-437f-405e-9bf6-d537b117f38a
2025-03-30 19:30:01,872 - app.services.secure_channel_service - INFO - Channel e834a54d-437f-405e-9bf6-d537b117f38a saved to Redis with TTL 1800 seconds
2025-03-30 19:30:01,872 - app.api.v1.endpoints.auth - INFO - Channel e834a54d-437f-405e-9bf6-d537b117f38a initialized successfully
2025-03-30 19:30:01,873 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-30 19:30:01,873 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-30 19:30:01,962 - INFO - Incoming request: {"timestamp": "2025-03-30T16:30:01.962450", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:30:01,962 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:30:01.962450", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:30:01,963 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:30:01,964 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:30:01,964 - sqlalchemy.engine.Engine - INFO - [cached since 330.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:30:01,965 - app.api.v1.endpoints.users - INFO - Search request received, channel: e834a54d-437f-405e-9bf6-d537b117f38a
2025-03-30 19:30:01,965 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743353995}
2025-03-30 19:30:01,966 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"m","limit":10}
2025-03-30 19:30:01,966 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'm', 'limit': 10}
2025-03-30 19:30:01,966 - app.api.v1.endpoints.users - INFO - Searching users with query 'm', excluding user 2
2025-03-30 19:30:01,967 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 19:30:01,967 - sqlalchemy.engine.Engine - INFO - [cached since 290.9s ago] {'id_1': '2', 'username_1': '%m%', 'email_1': '%m%', 'param_1': 10}
2025-03-30 19:30:01,967 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 19:30:01,968 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 19:30:01,969 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:30:01,969 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.708}
2025-03-30 19:30:01,969 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.708}
2025-03-30 19:30:02,212 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:30:04,086 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:30:04,297 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-30 19:30:04,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:30:04,298 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:30:04,298 - sqlalchemy.engine.Engine - INFO - [cached since 291.5s ago] {'pk_1': 2}
2025-03-30 19:30:04,299 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:30:04,299 - sqlalchemy.engine.Engine - INFO - [cached since 332.5s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 30, 4, 298392), 'users_id': 2}
2025-03-30 19:30:04,299 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:30:04,305 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-30 19:30:05,184 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:30:25,375 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:30:32,229 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:30:34,091 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:30:35,098 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:30:41,952 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:30:41,954 - app.services.connection_manager - INFO - User 2 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:30:41,958 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:30:41,959 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:30:41,959 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:30:41,961 - app.services.connection_manager - INFO - User 2 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:30:41,962 - app.services.connection_manager - INFO - User 2 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:30:41,962 - app.services.connection_manager - INFO - User 2 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:30:43,087 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:30:43,088 - app.services.connection_manager - INFO - User 3 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:30:55,302 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:30:55,303 - app.services.connection_manager - INFO - User 2 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:31:27,761 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:31:27,762 - app.services.connection_manager - INFO - User 3 disconnected from server 2e6fe5e4-388d-4e1a-8e47-8391a5c9ec65
2025-03-30 19:32:26,892 - app.main - INFO - Shutting down server...
2025-03-30 19:32:26,893 - app.main - INFO - Redis connections closed
2025-03-30 19:32:26,893 - app.main - INFO - Server shutdown completed
2025-03-30 19:56:24,448 - app.main - INFO - Starting up server...
2025-03-30 19:56:24,448 - app.main - INFO - Redis initialized
2025-03-30 19:56:24,485 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-30 19:56:24,486 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:56:24,486 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-30 19:56:24,486 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:56:24,487 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-30 19:56:24,487 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-30 19:56:24,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:24,490 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:56:24,490 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:56:24,492 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:56:24,492 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:24,493 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:56:24,494 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:56:24,494 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:56:24,494 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007868s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-30 19:56:24,495 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:56:24,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:24,495 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-30 19:56:24,495 - sqlalchemy.engine.Engine - INFO - [cached since 0.005727s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-30 19:56:24,496 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:56:24,496 - app.main - INFO - Database initialized
2025-03-30 19:56:24,524 - app.main - INFO - Server key pair generated
2025-03-30 19:56:24,525 - app.main - INFO - Server startup completed successfully
2025-03-30 19:56:33,659 - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:33.659016", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:33,659 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:33.659016", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:33,660 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-30 19:56:33,660 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-30 19:56:39,294 - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:39.294222", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:39,294 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:39.294222", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:39,295 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:56:39,295 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:56:43,008 - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:43.008429", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:43,008 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:43.008429", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:43,011 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 86381c21-6000-4767-a591-342a1c9cd176
2025-03-30 19:56:43,011 - app.services.secure_channel_service - INFO - Creating channel with ID: 86381c21-6000-4767-a591-342a1c9cd176
2025-03-30 19:56:43,016 - app.services.secure_channel_service - INFO - Channel 86381c21-6000-4767-a591-342a1c9cd176 saved to Redis with TTL 1800 seconds
2025-03-30 19:56:43,016 - app.api.v1.endpoints.auth - INFO - Channel 86381c21-6000-4767-a591-342a1c9cd176 initialized successfully
2025-03-30 19:56:43,016 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-30 19:56:43,016 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-30 19:56:43,565 - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:43.565640", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:43,565 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:43.565640", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:43,579 - app.api.v1.endpoints.auth - INFO - Login request using channel: 86381c21-6000-4767-a591-342a1c9cd176
2025-03-30 19:56:43,580 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"679cc3f8-3523-4afa-91df-5801939736da"}
2025-03-30 19:56:43,580 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '679cc3f8-3523-4afa-91df-5801939736da'}
2025-03-30 19:56:43,584 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:43,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-30 19:56:43,585 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-30 19:56:43,804 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:56:43,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] {'user_id_1': 3, 'device_id_1': '679cc3f8-3523-4afa-91df-5801939736da', 'param_1': 1}
2025-03-30 19:56:43,807 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-30 19:56:43,807 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'users_id': 3}
2025-03-30 19:56:43,808 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-30 19:56:43,808 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'user_id': 3, 'device_id': '679cc3f8-3523-4afa-91df-5801939736da', 'refresh_token': None, 'last_login': None}
2025-03-30 19:56:43,809 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-30 19:56:43,810 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:56:43,811 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'FWmmv4sl_gawQH6hH14gmHQoC2CXBYGqvehxZI1Hd5U', 'user_devices_id': 24}
2025-03-30 19:56:43,811 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:56:43,812 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-30 19:56:43,812 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-30 19:56:43,812 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-30 19:56:43,813 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 247.988}
2025-03-30 19:56:43,813 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 247.988}
2025-03-30 19:56:44,487 - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:44.487993", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:44,487 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:44.487993", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:44,489 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:56:44,491 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 5578fde1-879b-484e-a7eb-cb52d1ab74a3
2025-03-30 19:56:44,491 - app.services.secure_channel_service - INFO - Creating channel with ID: 5578fde1-879b-484e-a7eb-cb52d1ab74a3
2025-03-30 19:56:44,491 - app.services.secure_channel_service - INFO - Channel 5578fde1-879b-484e-a7eb-cb52d1ab74a3 saved to Redis with TTL 1800 seconds
2025-03-30 19:56:44,492 - app.api.v1.endpoints.auth - INFO - Channel 5578fde1-879b-484e-a7eb-cb52d1ab74a3 initialized successfully
2025-03-30 19:56:44,492 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:56:44,492 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:56:44,493 - app.services.connection_manager - INFO - User 3 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:56:44,493 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:56:44,493 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:44,494 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:56:44,494 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'id_1': '3', 'param_1': 1}
2025-03-30 19:56:44,495 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:56:44,495 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] {'last_seen': datetime.datetime(2025, 3, 30, 16, 56, 44, 495995), 'users_id': 3}
2025-03-30 19:56:44,496 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:56:44,496 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:56:59,405 - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:59.405326", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:59,405 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:56:59.405326", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:56:59,407 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:59,408 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:56:59,408 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'device_id_1': '679cc3f8-3523-4afa-91df-5801939736da', 'refresh_token_1': 'FWmmv4sl_gawQH6hH14gmHQoC2CXBYGqvehxZI1Hd5U', 'param_1': 1}
2025-03-30 19:56:59,409 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:56:59,409 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'refresh_token': 'd8fHoNqHNpKqWih_h2jUHNGTtX2NkTw8f5FHshz8VpM', 'user_devices_id': 24}
2025-03-30 19:56:59,409 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:56:59,410 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:56:59,410 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-30 19:56:59,508 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 19:56:59,509 - app.services.connection_manager - INFO - User 3 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:56:59,509 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 19:56:59,510 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:56:59,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:56:59,510 - sqlalchemy.engine.Engine - INFO - [cached since 15.02s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:56:59,511 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:56:59,511 - sqlalchemy.engine.Engine - INFO - [cached since 15.02s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 56, 59, 511538), 'users_id': 3}
2025-03-30 19:56:59,512 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:56:59,512 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 19:57:00,128 - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:00.128826", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:57:00,128 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:00.128826", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:57:00,129 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:57:00,129 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 19:57:00,308 - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:00.308721", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:57:00,308 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:00.308721", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:57:00,310 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:57:00,310 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 19:57:00,311 - sqlalchemy.engine.Engine - INFO - [cached since 0.9035s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': '6p6K9PWVl7kACYKMDks7JlzgvAJ84yDii_yCxiYux-I', 'param_1': 1}
2025-03-30 19:57:00,312 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 19:57:00,312 - sqlalchemy.engine.Engine - INFO - [cached since 0.9032s ago] {'refresh_token': 'HqqJffaeRcJF5IUIUPh19VqiWdzr2NA9mcOCKzbjxxw', 'user_devices_id': 23}
2025-03-30 19:57:00,312 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:57:00,317 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.963000000000001}
2025-03-30 19:57:00,317 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.963000000000001}
2025-03-30 19:57:01,727 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:57:01,728 - app.services.connection_manager - INFO - User 2 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:57:01,728 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:57:01,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:57:01,729 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:57:01,729 - sqlalchemy.engine.Engine - INFO - [cached since 17.23s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:57:01,730 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:57:01,730 - sqlalchemy.engine.Engine - INFO - [cached since 17.23s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 57, 1, 729293), 'users_id': 2}
2025-03-30 19:57:01,730 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:57:01,735 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:57:02,331 - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:02.331429", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:57:02,331 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:02.331429", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 19:57:02,332 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 45d2c736-e998-440e-9510-aafcffded9da
2025-03-30 19:57:02,333 - app.services.secure_channel_service - INFO - Creating channel with ID: 45d2c736-e998-440e-9510-aafcffded9da
2025-03-30 19:57:02,333 - app.services.secure_channel_service - INFO - Channel 45d2c736-e998-440e-9510-aafcffded9da saved to Redis with TTL 1800 seconds
2025-03-30 19:57:02,333 - app.api.v1.endpoints.auth - INFO - Channel 45d2c736-e998-440e-9510-aafcffded9da initialized successfully
2025-03-30 19:57:02,334 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 19:57:02,334 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 19:57:03,342 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 19:57:03,343 - app.services.connection_manager - INFO - User 2 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:57:03,343 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 19:57:03,343 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:57:03,343 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:57:03,343 - sqlalchemy.engine.Engine - INFO - [cached since 18.85s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 19:57:03,344 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:57:03,345 - sqlalchemy.engine.Engine - INFO - [cached since 18.85s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 57, 3, 344467), 'users_id': 2}
2025-03-30 19:57:03,345 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:57:03,350 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 19:57:05,669 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-30 19:57:05,670 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:57:05,672 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:57:05,672 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'pk_1': 2}
2025-03-30 19:57:05,672 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:57:05,673 - sqlalchemy.engine.Engine - INFO - [cached since 21.18s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 57, 5, 670489), 'users_id': 2}
2025-03-30 19:57:05,673 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:57:05,674 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-30 19:57:09,033 - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:09.033786", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:57:09,033 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T16:57:09.033786", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.186"}
2025-03-30 19:57:09,035 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:57:09,036 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 19:57:09,036 - sqlalchemy.engine.Engine - INFO - [cached since 24.54s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 19:57:09,037 - app.api.v1.endpoints.users - INFO - Search request received, channel: 5578fde1-879b-484e-a7eb-cb52d1ab74a3
2025-03-30 19:57:09,037 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743355619}
2025-03-30 19:57:09,038 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-30 19:57:09,038 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-30 19:57:09,038 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-30 19:57:09,039 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 19:57:09,039 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-30 19:57:09,040 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 19:57:09,041 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 19:57:09,041 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 19:57:09,042 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-30 19:57:09,042 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-30 19:57:14,297 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-30 19:57:14,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:57:14,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:57:14,299 - sqlalchemy.engine.Engine - INFO - [cached since 8.627s ago] {'pk_1': 3}
2025-03-30 19:57:14,299 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:57:14,299 - sqlalchemy.engine.Engine - INFO - [cached since 29.8s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 57, 14, 298282), 'users_id': 3}
2025-03-30 19:57:14,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:57:14,305 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-30 19:57:29,464 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:57:30,689 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:57:33,278 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:57:59,501 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:58:00,767 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:58:03,206 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:58:13,116 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-30 19:58:13,118 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 19:58:13,118 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 19:58:13,118 - sqlalchemy.engine.Engine - INFO - [cached since 67.45s ago] {'pk_1': 3}
2025-03-30 19:58:13,119 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 19:58:13,119 - sqlalchemy.engine.Engine - INFO - [cached since 88.62s ago] {'last_seen': datetime.datetime(2025, 3, 30, 16, 58, 13, 117210), 'users_id': 3}
2025-03-30 19:58:13,120 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 19:58:13,123 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-30 19:58:29,472 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 19:58:30,684 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:58:33,282 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 19:58:52,162 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:58:52,164 - app.services.connection_manager - INFO - User 2 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:58:53,334 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:58:53,335 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 19:58:53,336 - app.services.connection_manager - INFO - User 3 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:58:53,338 - app.services.connection_manager - INFO - User 3 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 19:58:58,941 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 19:58:58,942 - app.services.connection_manager - INFO - User 2 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:06:47,617 - INFO - Incoming request: {"timestamp": "2025-03-30T17:06:47.617647", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:06:47,617 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:06:47.617647", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:06:47,618 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 20:06:47,618 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 20:06:48,115 - INFO - Incoming request: {"timestamp": "2025-03-30T17:06:48.115785", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:06:48,115 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:06:48.115785", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:06:48,117 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:06:48,117 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 20:06:48,117 - sqlalchemy.engine.Engine - INFO - [cached since 588.7s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'HqqJffaeRcJF5IUIUPh19VqiWdzr2NA9mcOCKzbjxxw', 'param_1': 1}
2025-03-30 20:06:48,119 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 20:06:48,119 - sqlalchemy.engine.Engine - INFO - [cached since 588.7s ago] {'refresh_token': 'IwyKD-NdoTzUnSUvGhtQ_hTwigTw7aMk7OBizjzIcls', 'user_devices_id': 23}
2025-03-30 20:06:48,119 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:06:48,124 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.007}
2025-03-30 20:06:48,124 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.007}
2025-03-30 20:06:48,208 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 20:06:48,209 - app.services.connection_manager - INFO - User 2 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:06:48,209 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 20:06:48,210 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:06:48,210 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:06:48,210 - sqlalchemy.engine.Engine - INFO - [cached since 603.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 20:06:48,211 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:06:48,211 - sqlalchemy.engine.Engine - INFO - [cached since 603.7s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 6, 48, 211812), 'users_id': 2}
2025-03-30 20:06:48,211 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:06:48,212 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 20:06:48,991 - INFO - Incoming request: {"timestamp": "2025-03-30T17:06:48.991348", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:06:48,991 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:06:48.991348", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:06:48,993 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 99bf2b51-0e88-4603-8c1f-3160cee3e1ad
2025-03-30 20:06:48,993 - app.services.secure_channel_service - INFO - Creating channel with ID: 99bf2b51-0e88-4603-8c1f-3160cee3e1ad
2025-03-30 20:06:48,993 - app.services.secure_channel_service - INFO - Channel 99bf2b51-0e88-4603-8c1f-3160cee3e1ad saved to Redis with TTL 1800 seconds
2025-03-30 20:06:48,994 - app.api.v1.endpoints.auth - INFO - Channel 99bf2b51-0e88-4603-8c1f-3160cee3e1ad initialized successfully
2025-03-30 20:06:48,994 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 20:06:48,994 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 20:06:50,004 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 20:06:50,005 - app.services.connection_manager - INFO - User 2 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:06:50,005 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 20:06:50,006 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:06:50,006 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:06:50,006 - sqlalchemy.engine.Engine - INFO - [cached since 605.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 20:06:50,007 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:06:50,007 - sqlalchemy.engine.Engine - INFO - [cached since 605.5s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 6, 50, 6566), 'users_id': 2}
2025-03-30 20:06:50,007 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:06:50,013 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 20:07:18,215 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:07:18,958 - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:18.957333", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:07:18,958 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:18.957333", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:07:18,958 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 20:07:18,958 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 20:07:19,402 - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:19.402929", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:07:19,402 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:19.402929", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:07:19,404 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:19,404 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 20:07:19,404 - sqlalchemy.engine.Engine - INFO - [cached since 620s ago] {'device_id_1': '679cc3f8-3523-4afa-91df-5801939736da', 'refresh_token_1': 'd8fHoNqHNpKqWih_h2jUHNGTtX2NkTw8f5FHshz8VpM', 'param_1': 1}
2025-03-30 20:07:19,405 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 20:07:19,406 - sqlalchemy.engine.Engine - INFO - [cached since 620s ago] {'refresh_token': '2CcG2CXWk_KVKWhMz9_A4A3cN6oi-jpsBF-7AxQugMU', 'user_devices_id': 24}
2025-03-30 20:07:19,406 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:07:19,407 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-30 20:07:19,407 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-30 20:07:19,515 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 20:07:19,516 - app.services.connection_manager - INFO - User 3 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:07:19,516 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 20:07:19,517 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:19,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:07:19,517 - sqlalchemy.engine.Engine - INFO - [cached since 635s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 20:07:19,518 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:07:19,518 - sqlalchemy.engine.Engine - INFO - [cached since 635s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 7, 19, 518024), 'users_id': 3}
2025-03-30 20:07:19,519 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:07:19,519 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 20:07:19,976 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:07:20,267 - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:20.267884", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:07:20,267 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:20.267884", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:07:20,268 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: d4f0c285-ad61-4b62-8c59-e7d6ab66dd4c
2025-03-30 20:07:20,269 - app.services.secure_channel_service - INFO - Creating channel with ID: d4f0c285-ad61-4b62-8c59-e7d6ab66dd4c
2025-03-30 20:07:20,269 - app.services.secure_channel_service - INFO - Channel d4f0c285-ad61-4b62-8c59-e7d6ab66dd4c saved to Redis with TTL 1800 seconds
2025-03-30 20:07:20,270 - app.api.v1.endpoints.auth - INFO - Channel d4f0c285-ad61-4b62-8c59-e7d6ab66dd4c initialized successfully
2025-03-30 20:07:20,270 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 20:07:20,270 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-30 20:07:20,586 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 20:07:20,587 - app.services.connection_manager - INFO - User 3 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:07:20,587 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 20:07:20,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:20,587 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:07:20,587 - sqlalchemy.engine.Engine - INFO - [cached since 636.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 20:07:20,588 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:07:20,588 - sqlalchemy.engine.Engine - INFO - [cached since 636.1s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 7, 20, 588879), 'users_id': 3}
2025-03-30 20:07:20,589 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:07:20,589 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 20:07:23,695 - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:23.695276", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:07:23,695 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:07:23.695276", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:07:23,696 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:23,697 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:07:23,697 - sqlalchemy.engine.Engine - INFO - [cached since 639.2s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 20:07:23,698 - app.api.v1.endpoints.users - INFO - Search request received, channel: 99bf2b51-0e88-4603-8c1f-3160cee3e1ad
2025-03-30 20:07:23,698 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743356208}
2025-03-30 20:07:23,699 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-30 20:07:23,699 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-30 20:07:23,699 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-30 20:07:23,700 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-30 20:07:23,700 - sqlalchemy.engine.Engine - INFO - [cached since 614.7s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-30 20:07:23,700 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-30 20:07:23,701 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-30 20:07:23,701 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-30 20:07:23,702 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.003}
2025-03-30 20:07:23,702 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.003}
2025-03-30 20:07:25,889 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-30 20:07:25,890 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:25,891 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:07:25,891 - sqlalchemy.engine.Engine - INFO - [cached since 620.2s ago] {'pk_1': 2}
2025-03-30 20:07:25,892 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:07:25,892 - sqlalchemy.engine.Engine - INFO - [cached since 641.4s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 7, 25, 890089), 'users_id': 2}
2025-03-30 20:07:25,892 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:07:25,897 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-30 20:07:26,989 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-30 20:07:26,990 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:26,991 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:07:26,991 - sqlalchemy.engine.Engine - INFO - [cached since 621.3s ago] {'pk_1': 3}
2025-03-30 20:07:26,991 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:07:26,991 - sqlalchemy.engine.Engine - INFO - [cached since 642.5s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 7, 26, 990742), 'users_id': 3}
2025-03-30 20:07:26,992 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:07:26,997 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-30 20:07:26,997 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-30 20:07:26,998 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:07:26,998 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:07:26,999 - sqlalchemy.engine.Engine - INFO - [cached since 621.3s ago] {'pk_1': 3}
2025-03-30 20:07:26,999 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:07:26,999 - sqlalchemy.engine.Engine - INFO - [cached since 642.5s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 7, 26, 998746), 'users_id': 3}
2025-03-30 20:07:27,000 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:07:27,000 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-30 20:07:48,204 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:07:49,520 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 20:07:49,918 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:07:50,502 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 20:07:55,424 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 20:07:55,425 - app.services.connection_manager - INFO - User 3 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:00,525 - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:00.525080", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:08:00,525 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:00.525080", "method": "GET", "path": "/", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:08:00,526 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 20:08:00,526 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-30 20:08:00,585 - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:00.585224", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:08:00,585 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:00.585224", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:08:00,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:00,587 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 20:08:00,587 - sqlalchemy.engine.Engine - INFO - [cached since 661.2s ago] {'device_id_1': '679cc3f8-3523-4afa-91df-5801939736da', 'refresh_token_1': '2CcG2CXWk_KVKWhMz9_A4A3cN6oi-jpsBF-7AxQugMU', 'param_1': 1}
2025-03-30 20:08:00,588 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 20:08:00,588 - sqlalchemy.engine.Engine - INFO - [cached since 661.2s ago] {'refresh_token': 'ZeMpUwryMdH86yZNE763NddY4yDACyoEgj2wszwJevY', 'user_devices_id': 24}
2025-03-30 20:08:00,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:00,589 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-30 20:08:00,589 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-30 20:08:01,932 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-30 20:08:01,933 - app.services.connection_manager - INFO - User 3 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:01,933 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-30 20:08:01,933 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:01,933 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:08:01,933 - sqlalchemy.engine.Engine - INFO - [cached since 677.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-30 20:08:01,934 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:01,935 - sqlalchemy.engine.Engine - INFO - [cached since 677.4s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 1, 934354), 'users_id': 3}
2025-03-30 20:08:01,935 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:01,935 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-30 20:08:01,937 - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:01.936355", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:08:01,937 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:01.936355", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.215.186"}
2025-03-30 20:08:01,938 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: ab84ee14-dfff-4be7-b70c-182aa53f90b1
2025-03-30 20:08:01,938 - app.services.secure_channel_service - INFO - Creating channel with ID: ab84ee14-dfff-4be7-b70c-182aa53f90b1
2025-03-30 20:08:01,938 - app.services.secure_channel_service - INFO - Channel ab84ee14-dfff-4be7-b70c-182aa53f90b1 saved to Redis with TTL 1800 seconds
2025-03-30 20:08:01,938 - app.api.v1.endpoints.auth - INFO - Channel ab84ee14-dfff-4be7-b70c-182aa53f90b1 initialized successfully
2025-03-30 20:08:01,939 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 20:08:01,939 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-30 20:08:06,824 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-30 20:08:06,825 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:06,826 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:06,826 - sqlalchemy.engine.Engine - INFO - [cached since 661.2s ago] {'pk_1': 3}
2025-03-30 20:08:06,827 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:06,827 - sqlalchemy.engine.Engine - INFO - [cached since 682.3s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 6, 825712), 'users_id': 3}
2025-03-30 20:08:06,827 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:06,828 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-30 20:08:08,046 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-30 20:08:08,047 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:08,047 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:08,047 - sqlalchemy.engine.Engine - INFO - [cached since 662.4s ago] {'pk_1': 2}
2025-03-30 20:08:08,048 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:08,048 - sqlalchemy.engine.Engine - INFO - [cached since 683.6s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 8, 46219), 'users_id': 2}
2025-03-30 20:08:08,049 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:08,049 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-30 20:08:08,050 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-30 20:08:08,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:08,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:08,051 - sqlalchemy.engine.Engine - INFO - [cached since 662.4s ago] {'pk_1': 2}
2025-03-30 20:08:08,051 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:08,051 - sqlalchemy.engine.Engine - INFO - [cached since 683.6s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 8, 50220), 'users_id': 2}
2025-03-30 20:08:08,052 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:08,052 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-30 20:08:08,345 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-30 20:08:08,346 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:08,346 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:08,346 - sqlalchemy.engine.Engine - INFO - [cached since 662.7s ago] {'pk_1': 3}
2025-03-30 20:08:08,347 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:08,347 - sqlalchemy.engine.Engine - INFO - [cached since 683.9s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 8, 345293), 'users_id': 3}
2025-03-30 20:08:08,348 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:08,353 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-30 20:08:08,353 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-30 20:08:08,354 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:08,354 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:08,354 - sqlalchemy.engine.Engine - INFO - [cached since 662.7s ago] {'pk_1': 3}
2025-03-30 20:08:08,355 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:08,355 - sqlalchemy.engine.Engine - INFO - [cached since 683.9s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 8, 353291), 'users_id': 3}
2025-03-30 20:08:08,355 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:08,356 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-30 20:08:18,193 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:08:19,918 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:08:20,504 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 20:08:30,648 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 20:08:35,203 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 3 to 2
2025-03-30 20:08:35,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:35,205 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:35,205 - sqlalchemy.engine.Engine - INFO - [cached since 689.5s ago] {'pk_1': 3}
2025-03-30 20:08:35,205 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:35,206 - sqlalchemy.engine.Engine - INFO - [cached since 710.7s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 35, 204534), 'users_id': 3}
2025-03-30 20:08:35,206 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:35,211 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 3 to 2
2025-03-30 20:08:35,230 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-30 20:08:35,232 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:35,232 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:35,232 - sqlalchemy.engine.Engine - INFO - [cached since 689.6s ago] {'pk_1': 2}
2025-03-30 20:08:35,233 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:35,233 - sqlalchemy.engine.Engine - INFO - [cached since 710.7s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 35, 231621), 'users_id': 2}
2025-03-30 20:08:35,233 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:35,234 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-30 20:08:35,284 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-30 20:08:35,285 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:35,286 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:35,286 - sqlalchemy.engine.Engine - INFO - [cached since 689.6s ago] {'pk_1': 2}
2025-03-30 20:08:35,286 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:35,286 - sqlalchemy.engine.Engine - INFO - [cached since 710.8s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 35, 285633), 'users_id': 2}
2025-03-30 20:08:35,287 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:35,287 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-30 20:08:37,159 - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:37.158021", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:08:37,159 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:37.158021", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:08:37,160 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:37,162 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 20:08:37,162 - sqlalchemy.engine.Engine - INFO - [cached since 697.8s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': 'IwyKD-NdoTzUnSUvGhtQ_hTwigTw7aMk7OBizjzIcls', 'param_1': 1}
2025-03-30 20:08:37,163 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 20:08:37,163 - sqlalchemy.engine.Engine - INFO - [cached since 697.8s ago] {'refresh_token': '4hFdTeQ7W-IJILD7eLYolRBHxE0dNrj3tiDWSgeovwg', 'user_devices_id': 23}
2025-03-30 20:08:37,163 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:37,172 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.003}
2025-03-30 20:08:37,172 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.003}
2025-03-30 20:08:37,213 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 20:08:37,213 - app.services.connection_manager - INFO - User 2 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:37,213 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 20:08:37,214 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:37,214 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:08:37,214 - sqlalchemy.engine.Engine - INFO - [cached since 712.7s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 20:08:37,215 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:37,215 - sqlalchemy.engine.Engine - INFO - [cached since 712.7s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 37, 215034), 'users_id': 2}
2025-03-30 20:08:37,215 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:37,216 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 20:08:40,645 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 3 to 2
2025-03-30 20:08:40,646 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:40,646 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:40,646 - sqlalchemy.engine.Engine - INFO - [cached since 695s ago] {'pk_1': 3}
2025-03-30 20:08:40,647 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:40,647 - sqlalchemy.engine.Engine - INFO - [cached since 716.2s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 40, 645502), 'users_id': 3}
2025-03-30 20:08:40,648 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:40,648 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 3 to 2
2025-03-30 20:08:45,377 - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:45.377368", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:08:45,377 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-30T17:08:45.377368", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.215.176"}
2025-03-30 20:08:45,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:45,379 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-30 20:08:45,379 - sqlalchemy.engine.Engine - INFO - [cached since 706s ago] {'device_id_1': 'cecddb77-8ad7-4650-9ec1-e8dd57ce7db2', 'refresh_token_1': '4hFdTeQ7W-IJILD7eLYolRBHxE0dNrj3tiDWSgeovwg', 'param_1': 1}
2025-03-30 20:08:45,380 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-30 20:08:45,380 - sqlalchemy.engine.Engine - INFO - [cached since 706s ago] {'refresh_token': 'y2PKlDIk_3de2QSVL9ZQ6zQpW5__lOMVoNWKR81HGhE', 'user_devices_id': 23}
2025-03-30 20:08:45,381 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:45,386 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-30 20:08:45,386 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-30 20:08:45,422 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-30 20:08:45,423 - app.services.connection_manager - INFO - User 2 connected to server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:45,423 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-30 20:08:45,423 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:45,424 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-30 20:08:45,424 - sqlalchemy.engine.Engine - INFO - [cached since 720.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-30 20:08:45,424 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:45,425 - sqlalchemy.engine.Engine - INFO - [cached since 720.9s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 45, 424384), 'users_id': 2}
2025-03-30 20:08:45,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:45,425 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-30 20:08:48,153 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-30 20:08:48,154 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:48,155 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:48,155 - sqlalchemy.engine.Engine - INFO - [cached since 702.5s ago] {'pk_1': 2}
2025-03-30 20:08:48,155 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:48,156 - sqlalchemy.engine.Engine - INFO - [cached since 723.7s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 48, 154981), 'users_id': 2}
2025-03-30 20:08:48,156 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:48,157 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-30 20:08:49,919 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-30 20:08:50,522 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-30 20:08:50,522 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-30 20:08:50,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-30 20:08:50,523 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-30 20:08:50,523 - sqlalchemy.engine.Engine - INFO - [cached since 704.9s ago] {'pk_1': 3}
2025-03-30 20:08:50,524 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-30 20:08:50,524 - sqlalchemy.engine.Engine - INFO - [cached since 726s ago] {'last_seen': datetime.datetime(2025, 3, 30, 17, 8, 50, 523690), 'users_id': 3}
2025-03-30 20:08:50,524 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-30 20:08:50,525 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-30 20:08:53,300 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 20:08:53,300 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 20:08:53,301 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 20:08:53,301 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 20:08:53,302 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-30 20:08:53,302 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-30 20:08:53,305 - app.services.connection_manager - INFO - User 2 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:53,305 - app.services.connection_manager - INFO - User 2 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:53,306 - app.services.connection_manager - INFO - User 3 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:53,306 - app.services.connection_manager - INFO - User 3 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:53,306 - app.services.connection_manager - INFO - User 2 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:53,307 - app.services.connection_manager - INFO - User 2 disconnected from server 4b1f9690-53b8-4c72-a430-b5f5d90b0881
2025-03-30 20:08:53,393 - app.main - INFO - Shutting down server...
2025-03-30 20:08:53,394 - app.main - INFO - Redis connections closed
2025-03-30 20:08:53,394 - app.main - INFO - Server shutdown completed
2025-03-31 12:46:04,885 - app.main - INFO - Starting up server...
2025-03-31 12:46:04,885 - app.main - INFO - Redis initialized
2025-03-31 12:46:05,048 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-31 12:46:05,048 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 12:46:05,049 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-31 12:46:05,049 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 12:46:05,050 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-31 12:46:05,050 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 12:46:05,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:46:05,053 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 12:46:05,053 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-31 12:46:05,062 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 12:46:05,062 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:46:05,064 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 12:46:05,064 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-31 12:46:05,064 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 12:46:05,064 - sqlalchemy.engine.Engine - INFO - [cached since 0.0009119s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-31 12:46:05,065 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:46:05,065 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:46:05,066 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 12:46:05,066 - sqlalchemy.engine.Engine - INFO - [cached since 0.01304s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-31 12:46:05,066 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 12:46:05,066 - app.main - INFO - Database initialized
2025-03-31 12:46:05,134 - app.main - INFO - Server key pair generated
2025-03-31 12:46:05,134 - app.main - INFO - Server startup completed successfully
2025-03-31 12:48:02,596 - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:02.596287", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:02,596 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:02.596287", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:02,597 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 12:48:02,597 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 12:48:09,035 - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:09.035260", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:09,035 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:09.035260", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:09,046 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: eace5c12-eb15-4a51-8fc0-a4b4b55ec71a
2025-03-31 12:48:09,046 - app.services.secure_channel_service - INFO - Creating channel with ID: eace5c12-eb15-4a51-8fc0-a4b4b55ec71a
2025-03-31 12:48:09,062 - app.services.secure_channel_service - INFO - Channel eace5c12-eb15-4a51-8fc0-a4b4b55ec71a saved to Redis with TTL 1800 seconds
2025-03-31 12:48:09,064 - app.api.v1.endpoints.auth - INFO - Channel eace5c12-eb15-4a51-8fc0-a4b4b55ec71a initialized successfully
2025-03-31 12:48:09,064 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 29.007}
2025-03-31 12:48:09,064 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 29.007}
2025-03-31 12:48:09,403 - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:09.403343", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:09,403 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:09.403343", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:09,405 - app.api.v1.endpoints.auth - INFO - Login request using channel: eace5c12-eb15-4a51-8fc0-a4b4b55ec71a
2025-03-31 12:48:09,407 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"91fab616-6958-4d35-be8f-ee9dc2972d2d"}
2025-03-31 12:48:09,408 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '91fab616-6958-4d35-be8f-ee9dc2972d2d'}
2025-03-31 12:48:09,411 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:48:09,413 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 12:48:09,413 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-31 12:48:09,652 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:48:09,652 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'user_id_1': 2, 'device_id_1': '91fab616-6958-4d35-be8f-ee9dc2972d2d', 'param_1': 1}
2025-03-31 12:48:09,667 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 12:48:09,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] {'users_id': 2}
2025-03-31 12:48:09,676 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 12:48:09,676 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] {'user_id': 2, 'device_id': '91fab616-6958-4d35-be8f-ee9dc2972d2d', 'refresh_token': None, 'last_login': None}
2025-03-31 12:48:09,680 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-31 12:48:09,682 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 12:48:09,682 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] {'refresh_token': 'C90_nvR345F9XhgGGzpQlU5YpRceYbxvLBGD3QVSSFw', 'user_devices_id': 25}
2025-03-31 12:48:09,683 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:48:09,688 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 12:48:09,688 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 12:48:09,689 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 12:48:09,690 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 287.065}
2025-03-31 12:48:09,690 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 287.065}
2025-03-31 12:48:11,037 - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:11.037633", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:11,037 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:11.037633", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:11,038 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 4bb197c3-170e-4494-8600-f83304c62fa5
2025-03-31 12:48:11,039 - app.services.secure_channel_service - INFO - Creating channel with ID: 4bb197c3-170e-4494-8600-f83304c62fa5
2025-03-31 12:48:11,039 - app.services.secure_channel_service - INFO - Channel 4bb197c3-170e-4494-8600-f83304c62fa5 saved to Redis with TTL 1800 seconds
2025-03-31 12:48:11,039 - app.api.v1.endpoints.auth - INFO - Channel 4bb197c3-170e-4494-8600-f83304c62fa5 initialized successfully
2025-03-31 12:48:11,040 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 12:48:11,040 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 12:48:11,044 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 12:48:11,056 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:48:11,056 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 12:48:11,056 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:48:11,057 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:48:11,057 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'id_1': '2', 'param_1': 1}
2025-03-31 12:48:11,058 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:48:11,058 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'last_seen': datetime.datetime(2025, 3, 31, 9, 48, 11, 58380), 'users_id': 2}
2025-03-31 12:48:11,059 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:48:11,060 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 12:48:13,439 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 12:48:13,440 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:48:13,440 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 12:48:13,440 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:48:13,440 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:48:13,441 - sqlalchemy.engine.Engine - INFO - [cached since 2.383s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 12:48:13,441 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:48:13,442 - sqlalchemy.engine.Engine - INFO - [cached since 2.383s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 48, 13, 441314), 'users_id': 2}
2025-03-31 12:48:13,442 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:48:13,442 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 12:48:16,652 - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:16.652799", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:16,652 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:48:16.652799", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:48:16,654 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:48:16,654 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:48:16,654 - sqlalchemy.engine.Engine - INFO - [cached since 5.597s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 12:48:16,655 - app.api.v1.endpoints.users - INFO - Search request received, channel: 4bb197c3-170e-4494-8600-f83304c62fa5
2025-03-31 12:48:16,655 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743416289}
2025-03-31 12:48:16,656 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-03-31 12:48:16,656 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-03-31 12:48:16,656 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-03-31 12:48:16,657 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 12:48:16,657 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'id_1': '2', 'username_1': '%mir%', 'email_1': '%mir%', 'param_1': 10}
2025-03-31 12:48:16,673 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 12:48:16,674 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': False}]
2025-03-31 12:48:16,675 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 12:48:16,675 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 22.349999999999998}
2025-03-31 12:48:16,675 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 22.349999999999998}
2025-03-31 12:48:41,064 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:48:43,331 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:49:11,027 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:49:13,318 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:49:41,027 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:49:43,316 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:50:11,028 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:50:13,317 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:50:41,028 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:50:43,316 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:51:11,048 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:51:13,316 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:51:41,053 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:51:43,316 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:52:11,056 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:52:13,318 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:52:41,136 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:52:43,320 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:53:11,030 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:53:13,317 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:53:41,030 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:53:43,319 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:54:11,029 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:54:13,317 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:54:31,058 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:31.058658", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:31,058 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:31.058658", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:31,059 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 12:54:31,059 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 12:54:41,062 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:54:43,319 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:54:46,759 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:46.759647", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:46,759 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:46.759647", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:46,760 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c2b3e1d7-52b8-48f8-82d1-971ff3d791b8
2025-03-31 12:54:46,760 - app.services.secure_channel_service - INFO - Creating channel with ID: c2b3e1d7-52b8-48f8-82d1-971ff3d791b8
2025-03-31 12:54:46,761 - app.services.secure_channel_service - INFO - Channel c2b3e1d7-52b8-48f8-82d1-971ff3d791b8 saved to Redis with TTL 1800 seconds
2025-03-31 12:54:46,761 - app.api.v1.endpoints.auth - INFO - Channel c2b3e1d7-52b8-48f8-82d1-971ff3d791b8 initialized successfully
2025-03-31 12:54:46,761 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 12:54:46,761 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 12:54:47,188 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:47.188955", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:47,188 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:47.188955", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:47,190 - app.api.v1.endpoints.auth - INFO - Login request using channel: c2b3e1d7-52b8-48f8-82d1-971ff3d791b8
2025-03-31 12:54:47,191 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"56d771c6-1ada-4788-bb5a-e06bb5bbc23a"}
2025-03-31 12:54:47,191 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '56d771c6-1ada-4788-bb5a-e06bb5bbc23a'}
2025-03-31 12:54:47,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:47,192 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 12:54:47,192 - sqlalchemy.engine.Engine - INFO - [cached since 397.8s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-31 12:54:47,400 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:54:47,400 - sqlalchemy.engine.Engine - INFO - [cached since 397.7s ago] {'user_id_1': 3, 'device_id_1': '56d771c6-1ada-4788-bb5a-e06bb5bbc23a', 'param_1': 1}
2025-03-31 12:54:47,401 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 12:54:47,401 - sqlalchemy.engine.Engine - INFO - [cached since 397.7s ago] {'users_id': 3}
2025-03-31 12:54:47,402 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 12:54:47,402 - sqlalchemy.engine.Engine - INFO - [cached since 397.7s ago] {'user_id': 3, 'device_id': '56d771c6-1ada-4788-bb5a-e06bb5bbc23a', 'refresh_token': None, 'last_login': None}
2025-03-31 12:54:47,403 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-31 12:54:47,403 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 12:54:47,403 - sqlalchemy.engine.Engine - INFO - [cached since 397.7s ago] {'refresh_token': 'yDlxPMZx8vDXHsjU2-7pU4eA13hvT_ruVBKNbjldhGk', 'user_devices_id': 26}
2025-03-31 12:54:47,404 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:54:47,405 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 12:54:47,405 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 12:54:47,406 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 12:54:47,406 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 217.40300000000002}
2025-03-31 12:54:47,406 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 217.40300000000002}
2025-03-31 12:54:48,290 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:48.290588", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:48,290 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:48.290588", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:54:48,291 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 937425b7-9030-4032-ae45-fe8183211a84
2025-03-31 12:54:48,291 - app.services.secure_channel_service - INFO - Creating channel with ID: 937425b7-9030-4032-ae45-fe8183211a84
2025-03-31 12:54:48,292 - app.services.secure_channel_service - INFO - Channel 937425b7-9030-4032-ae45-fe8183211a84 saved to Redis with TTL 1800 seconds
2025-03-31 12:54:48,292 - app.api.v1.endpoints.auth - INFO - Channel 937425b7-9030-4032-ae45-fe8183211a84 initialized successfully
2025-03-31 12:54:48,292 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.916}
2025-03-31 12:54:48,292 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.916}
2025-03-31 12:54:48,585 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 12:54:48,586 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:54:48,586 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 12:54:48,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:48,587 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:54:48,587 - sqlalchemy.engine.Engine - INFO - [cached since 397.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 12:54:48,588 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:54:48,588 - sqlalchemy.engine.Engine - INFO - [cached since 397.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 54, 48, 588571), 'users_id': 3}
2025-03-31 12:54:48,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:54:48,594 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 12:54:50,132 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 12:54:50,133 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:54:50,133 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 12:54:50,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:50,134 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:54:50,134 - sqlalchemy.engine.Engine - INFO - [cached since 399.1s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 12:54:50,134 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:54:50,135 - sqlalchemy.engine.Engine - INFO - [cached since 399.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 54, 50, 134148), 'users_id': 3}
2025-03-31 12:54:50,135 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:54:50,135 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 12:54:55,754 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:55.753721", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:54:55,754 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:55.753721", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:54:55,761 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae
2025-03-31 12:54:55,761 - app.services.secure_channel_service - INFO - Creating channel with ID: 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae
2025-03-31 12:54:55,762 - app.services.secure_channel_service - INFO - Channel 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae saved to Redis with TTL 1800 seconds
2025-03-31 12:54:55,762 - app.api.v1.endpoints.auth - INFO - Channel 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae initialized successfully
2025-03-31 12:54:55,762 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 12:54:55,762 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 12:54:55,845 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:55.845844", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:54:55,845 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:55.845844", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:54:55,852 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:55,852 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:54:55,852 - sqlalchemy.engine.Engine - INFO - [cached since 404.8s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 12:54:55,853 - app.api.v1.endpoints.users - INFO - Search request received, channel: 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae
2025-03-31 12:54:55,853 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743416289}
2025-03-31 12:54:55,854 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 12:54:55,854 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 12:54:55,854 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 12:54:55,855 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 12:54:55,855 - sqlalchemy.engine.Engine - INFO - [cached since 399.2s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 12:54:55,855 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 12:54:55,856 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 12:54:55,856 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 12:54:55,857 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.002}
2025-03-31 12:54:55,857 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 12.002}
2025-03-31 12:54:56,408 - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:56.408540", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:54:56,408 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:54:56.408540", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:54:56,409 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:56,410 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:54:56,410 - sqlalchemy.engine.Engine - INFO - [cached since 405.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 12:54:56,411 - app.api.v1.endpoints.users - INFO - Search request received, channel: 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae
2025-03-31 12:54:56,411 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743416289}
2025-03-31 12:54:56,411 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-03-31 12:54:56,411 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-03-31 12:54:56,412 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-03-31 12:54:56,412 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 12:54:56,412 - sqlalchemy.engine.Engine - INFO - [cached since 399.8s ago] {'id_1': '2', 'username_1': '%mir%', 'email_1': '%mir%', 'param_1': 10}
2025-03-31 12:54:56,413 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 12:54:56,413 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 12:54:56,413 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 12:54:56,414 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-31 12:54:56,414 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-31 12:54:57,893 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 12:54:57,894 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:57,896 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:54:57,896 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'pk_1': 2}
2025-03-31 12:54:57,896 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:54:57,897 - sqlalchemy.engine.Engine - INFO - [cached since 406.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 54, 57, 894431), 'users_id': 2}
2025-03-31 12:54:57,897 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:54:57,898 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 12:54:58,797 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 12:54:58,799 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:58,799 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:54:58,799 - sqlalchemy.engine.Engine - INFO - [cached since 0.9038s ago] {'pk_1': 3}
2025-03-31 12:54:58,800 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:54:58,800 - sqlalchemy.engine.Engine - INFO - [cached since 407.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 54, 58, 798672), 'users_id': 3}
2025-03-31 12:54:58,800 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:54:58,805 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 12:54:58,805 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 12:54:58,806 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:54:58,806 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:54:58,806 - sqlalchemy.engine.Engine - INFO - [cached since 0.911s ago] {'pk_1': 3}
2025-03-31 12:54:58,807 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:54:58,807 - sqlalchemy.engine.Engine - INFO - [cached since 407.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 54, 58, 806672), 'users_id': 3}
2025-03-31 12:54:58,807 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:54:58,808 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 12:55:11,030 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:55:13,318 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:55:18,317 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:55:20,089 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:55:41,031 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:55:43,322 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:55:47,062 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 12:55:47,064 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:55:49,960 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:55:50,312 - INFO - Incoming request: {"timestamp": "2025-03-31T09:55:50.312723", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:55:50,312 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:55:50.312723", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:55:50,313 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 12:55:50,313 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 12:55:50,615 - INFO - Incoming request: {"timestamp": "2025-03-31T09:55:50.615210", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:55:50,615 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:55:50.615210", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:55:50,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:55:50,618 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 12:55:50,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'device_id_1': '56d771c6-1ada-4788-bb5a-e06bb5bbc23a', 'refresh_token_1': 'yDlxPMZx8vDXHsjU2-7pU4eA13hvT_ruVBKNbjldhGk', 'param_1': 1}
2025-03-31 12:55:50,620 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 12:55:50,620 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'refresh_token': '98xTfxM-NXHtk3WDtAS9Juwl1DaMuibv_S0sYvBfZxE', 'user_devices_id': 26}
2025-03-31 12:55:50,620 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:55:50,621 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 12:55:50,621 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 12:55:50,750 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 12:55:50,751 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:55:50,751 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 12:55:50,751 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:55:50,751 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:55:50,751 - sqlalchemy.engine.Engine - INFO - [cached since 459.7s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 12:55:50,752 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:55:50,752 - sqlalchemy.engine.Engine - INFO - [cached since 459.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 55, 50, 752259), 'users_id': 3}
2025-03-31 12:55:50,753 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:55:50,753 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 12:55:52,202 - INFO - Incoming request: {"timestamp": "2025-03-31T09:55:52.202623", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:55:52,202 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:55:52.202623", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:55:52,203 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 714ca525-4bac-4f4c-86d3-090b888cb310
2025-03-31 12:55:52,203 - app.services.secure_channel_service - INFO - Creating channel with ID: 714ca525-4bac-4f4c-86d3-090b888cb310
2025-03-31 12:55:52,204 - app.services.secure_channel_service - INFO - Channel 714ca525-4bac-4f4c-86d3-090b888cb310 saved to Redis with TTL 1800 seconds
2025-03-31 12:55:52,204 - app.api.v1.endpoints.auth - INFO - Channel 714ca525-4bac-4f4c-86d3-090b888cb310 initialized successfully
2025-03-31 12:55:52,205 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 12:55:52,205 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 12:55:58,490 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-31 12:55:58,491 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:55:58,491 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:55:58,491 - sqlalchemy.engine.Engine - INFO - [cached since 60.6s ago] {'pk_1': 3}
2025-03-31 12:55:58,492 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:55:58,492 - sqlalchemy.engine.Engine - INFO - [cached since 467.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 55, 58, 490920), 'users_id': 3}
2025-03-31 12:55:58,493 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:55:58,493 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-31 12:56:00,746 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 12:56:00,748 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:00,748 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:00,748 - sqlalchemy.engine.Engine - INFO - [cached since 62.85s ago] {'pk_1': 2}
2025-03-31 12:56:00,749 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:00,749 - sqlalchemy.engine.Engine - INFO - [cached since 469.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 0, 747548), 'users_id': 2}
2025-03-31 12:56:00,750 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:00,750 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 12:56:00,750 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 12:56:00,751 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:00,751 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:00,752 - sqlalchemy.engine.Engine - INFO - [cached since 62.86s ago] {'pk_1': 2}
2025-03-31 12:56:00,752 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:00,752 - sqlalchemy.engine.Engine - INFO - [cached since 469.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 0, 751549), 'users_id': 2}
2025-03-31 12:56:00,752 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:00,753 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 12:56:01,003 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 12:56:01,004 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:01,004 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:01,005 - sqlalchemy.engine.Engine - INFO - [cached since 63.11s ago] {'pk_1': 3}
2025-03-31 12:56:01,005 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:01,005 - sqlalchemy.engine.Engine - INFO - [cached since 469.9s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 1, 4607), 'users_id': 3}
2025-03-31 12:56:01,006 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:01,007 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 12:56:01,007 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 12:56:01,008 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:01,008 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:01,008 - sqlalchemy.engine.Engine - INFO - [cached since 63.11s ago] {'pk_1': 3}
2025-03-31 12:56:01,009 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:01,009 - sqlalchemy.engine.Engine - INFO - [cached since 470s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 1, 7607), 'users_id': 3}
2025-03-31 12:56:01,010 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:01,010 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 12:56:01,010 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 12:56:01,011 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:01,012 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:01,012 - sqlalchemy.engine.Engine - INFO - [cached since 63.12s ago] {'pk_1': 3}
2025-03-31 12:56:01,012 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:01,013 - sqlalchemy.engine.Engine - INFO - [cached since 470s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 1, 11608), 'users_id': 3}
2025-03-31 12:56:01,013 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:01,014 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 12:56:01,014 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 12:56:01,014 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:01,015 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:01,015 - sqlalchemy.engine.Engine - INFO - [cached since 63.12s ago] {'pk_1': 3}
2025-03-31 12:56:01,016 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:01,016 - sqlalchemy.engine.Engine - INFO - [cached since 470s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 1, 14609), 'users_id': 3}
2025-03-31 12:56:01,016 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:01,017 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 12:56:11,032 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:56:13,317 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:56:19,975 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:56:20,681 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:56:28,045 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 12:56:28,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:28,047 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:28,047 - sqlalchemy.engine.Engine - INFO - [cached since 90.15s ago] {'pk_1': 2}
2025-03-31 12:56:28,048 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:28,048 - sqlalchemy.engine.Engine - INFO - [cached since 497s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 28, 46602), 'users_id': 2}
2025-03-31 12:56:28,048 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:28,053 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 12:56:35,812 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 12:56:35,813 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:35,814 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:56:35,814 - sqlalchemy.engine.Engine - INFO - [cached since 97.92s ago] {'pk_1': 3}
2025-03-31 12:56:35,814 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:35,815 - sqlalchemy.engine.Engine - INFO - [cached since 504.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 35, 813615), 'users_id': 3}
2025-03-31 12:56:35,815 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:35,816 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 12:56:37,732 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 12:56:37,733 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:56:41,040 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:56:43,331 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:56:43,971 - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:43.971583", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:56:43,971 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:43.971583", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:56:43,971 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 12:56:43,971 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 12:56:44,230 - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:44.230703", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:56:44,230 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:44.230703", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:56:44,233 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:44,233 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 12:56:44,233 - sqlalchemy.engine.Engine - INFO - [cached since 53.62s ago] {'device_id_1': '56d771c6-1ada-4788-bb5a-e06bb5bbc23a', 'refresh_token_1': '98xTfxM-NXHtk3WDtAS9Juwl1DaMuibv_S0sYvBfZxE', 'param_1': 1}
2025-03-31 12:56:44,234 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 12:56:44,234 - sqlalchemy.engine.Engine - INFO - [cached since 53.62s ago] {'refresh_token': '44ab6g7xkVhD98gZxhIXwxU4toxSpw-6revpnKMYYYY', 'user_devices_id': 26}
2025-03-31 12:56:44,235 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:44,240 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-31 12:56:44,240 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-31 12:56:44,438 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 12:56:44,439 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:56:44,439 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 12:56:44,440 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:44,440 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:56:44,440 - sqlalchemy.engine.Engine - INFO - [cached since 513.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 12:56:44,441 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:56:44,441 - sqlalchemy.engine.Engine - INFO - [cached since 513.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 56, 44, 441752), 'users_id': 3}
2025-03-31 12:56:44,442 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:56:44,443 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 12:56:44,955 - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:44.954878", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:56:44,955 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:44.954878", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 12:56:44,957 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: f1a0bfdd-813d-45f6-ab80-24f526bd677f
2025-03-31 12:56:44,957 - app.services.secure_channel_service - INFO - Creating channel with ID: f1a0bfdd-813d-45f6-ab80-24f526bd677f
2025-03-31 12:56:44,957 - app.services.secure_channel_service - INFO - Channel f1a0bfdd-813d-45f6-ab80-24f526bd677f saved to Redis with TTL 1800 seconds
2025-03-31 12:56:44,958 - app.api.v1.endpoints.auth - INFO - Channel f1a0bfdd-813d-45f6-ab80-24f526bd677f initialized successfully
2025-03-31 12:56:44,958 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9899999999999998}
2025-03-31 12:56:44,958 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9899999999999998}
2025-03-31 12:56:49,987 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:56:59,907 - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:59.907964", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:56:59,907 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T09:56:59.907964", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 12:56:59,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:56:59,909 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 12:56:59,909 - sqlalchemy.engine.Engine - INFO - [cached since 528.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 12:56:59,910 - app.api.v1.endpoints.users - INFO - Search request received, channel: 65dd4b7e-93c5-4253-8df3-f4ecc3adc7ae
2025-03-31 12:56:59,910 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743416289}
2025-03-31 12:56:59,911 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 12:56:59,911 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 12:56:59,912 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 12:56:59,912 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 12:56:59,912 - sqlalchemy.engine.Engine - INFO - [cached since 523.3s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 12:56:59,913 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 12:56:59,913 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 12:56:59,914 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 12:56:59,914 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-31 12:56:59,914 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-31 12:57:03,841 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 12:57:03,842 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:57:03,842 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:57:03,843 - sqlalchemy.engine.Engine - INFO - [cached since 125.9s ago] {'pk_1': 2}
2025-03-31 12:57:03,843 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:57:03,843 - sqlalchemy.engine.Engine - INFO - [cached since 532.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 57, 3, 842537), 'users_id': 2}
2025-03-31 12:57:03,844 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:57:03,844 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 12:57:05,782 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 12:57:05,783 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:57:05,784 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:57:05,784 - sqlalchemy.engine.Engine - INFO - [cached since 127.9s ago] {'pk_1': 3}
2025-03-31 12:57:05,784 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:57:05,785 - sqlalchemy.engine.Engine - INFO - [cached since 534.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 57, 5, 783523), 'users_id': 3}
2025-03-31 12:57:05,785 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:57:05,786 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 12:57:05,833 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 12:57:05,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 12:57:05,834 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 12:57:05,835 - sqlalchemy.engine.Engine - INFO - [cached since 127.9s ago] {'pk_1': 3}
2025-03-31 12:57:05,835 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 12:57:05,835 - sqlalchemy.engine.Engine - INFO - [cached since 534.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 9, 57, 5, 834534), 'users_id': 3}
2025-03-31 12:57:05,836 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 12:57:05,836 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 12:57:11,031 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:57:13,319 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:57:14,305 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:57:19,960 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:57:41,031 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:57:43,319 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:57:44,319 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:57:49,972 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:58:11,032 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:58:13,318 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:58:14,301 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:58:19,963 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 12:58:38,266 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 12:58:38,267 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:58:38,281 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 12:58:38,282 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:58:41,925 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 12:58:41,927 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 12:58:43,318 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 12:58:46,838 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 12:58:46,840 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:00:01,469 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:01.469501", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:01,469 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:01.469501", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:01,470 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:00:01,470 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:00:09,454 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:09.454237", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:09,454 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:09.454237", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:09,455 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 5c297760-fe73-45b7-ab24-d29fa2529c82
2025-03-31 13:00:09,455 - app.services.secure_channel_service - INFO - Creating channel with ID: 5c297760-fe73-45b7-ab24-d29fa2529c82
2025-03-31 13:00:09,456 - app.services.secure_channel_service - INFO - Channel 5c297760-fe73-45b7-ab24-d29fa2529c82 saved to Redis with TTL 1800 seconds
2025-03-31 13:00:09,456 - app.api.v1.endpoints.auth - INFO - Channel 5c297760-fe73-45b7-ab24-d29fa2529c82 initialized successfully
2025-03-31 13:00:09,456 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 13:00:09,456 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 13:00:09,675 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:09.675288", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:09,675 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:09.675288", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:09,677 - app.api.v1.endpoints.auth - INFO - Login request using channel: 5c297760-fe73-45b7-ab24-d29fa2529c82
2025-03-31 13:00:09,678 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"15c79036-423a-41fb-b455-22f2ca083c86"}
2025-03-31 13:00:09,678 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '15c79036-423a-41fb-b455-22f2ca083c86'}
2025-03-31 13:00:09,679 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:09,679 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:09,679 - sqlalchemy.engine.Engine - INFO - [cached since 720.3s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-31 13:00:09,885 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:09,885 - sqlalchemy.engine.Engine - INFO - [cached since 720.2s ago] {'user_id_1': 3, 'device_id_1': '15c79036-423a-41fb-b455-22f2ca083c86', 'param_1': 1}
2025-03-31 13:00:09,887 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 13:00:09,887 - sqlalchemy.engine.Engine - INFO - [cached since 720.2s ago] {'users_id': 3}
2025-03-31 13:00:09,888 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 13:00:09,888 - sqlalchemy.engine.Engine - INFO - [cached since 720.2s ago] {'user_id': 3, 'device_id': '15c79036-423a-41fb-b455-22f2ca083c86', 'refresh_token': None, 'last_login': None}
2025-03-31 13:00:09,889 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-31 13:00:09,889 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:00:09,889 - sqlalchemy.engine.Engine - INFO - [cached since 720.2s ago] {'refresh_token': 'NOYN0wigV3FvleOPtQDg9SJ5ui37R8_Y6u1AYhnX1Bc', 'user_devices_id': 27}
2025-03-31 13:00:09,890 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:09,891 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 13:00:09,891 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 13:00:09,891 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 13:00:09,892 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 216.771}
2025-03-31 13:00:09,892 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 216.771}
2025-03-31 13:00:10,522 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:00:10,522 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:10.522630", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:10,522 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:10.522630", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:10,524 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:00:10,524 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:00:10,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:10,524 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:10,524 - sqlalchemy.engine.Engine - INFO - [cached since 719.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:00:10,525 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:10,525 - sqlalchemy.engine.Engine - INFO - [cached since 719.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 10, 525630), 'users_id': 3}
2025-03-31 13:00:10,526 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:10,526 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:00:10,527 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: ed74b1a9-13de-47b7-b0a5-58083a6c6f48
2025-03-31 13:00:10,527 - app.services.secure_channel_service - INFO - Creating channel with ID: ed74b1a9-13de-47b7-b0a5-58083a6c6f48
2025-03-31 13:00:10,527 - app.services.secure_channel_service - INFO - Channel ed74b1a9-13de-47b7-b0a5-58083a6c6f48 saved to Redis with TTL 1800 seconds
2025-03-31 13:00:10,528 - app.api.v1.endpoints.auth - INFO - Channel ed74b1a9-13de-47b7-b0a5-58083a6c6f48 initialized successfully
2025-03-31 13:00:10,528 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 13:00:10,528 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 13:00:11,926 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:11.926148", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:11,926 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:11.926148", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:00:11,928 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:11,928 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:11,928 - sqlalchemy.engine.Engine - INFO - [cached since 261.3s ago] {'device_id_1': '15c79036-423a-41fb-b455-22f2ca083c86', 'refresh_token_1': 'NOYN0wigV3FvleOPtQDg9SJ5ui37R8_Y6u1AYhnX1Bc', 'param_1': 1}
2025-03-31 13:00:11,930 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:00:11,930 - sqlalchemy.engine.Engine - INFO - [cached since 261.3s ago] {'refresh_token': 'BBfHkKpBMik3Bl-nS2E8TtwTkpwPnv5-qnPqfNlw4Ek', 'user_devices_id': 27}
2025-03-31 13:00:11,930 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:11,931 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 13:00:11,931 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 13:00:12,022 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:00:12,023 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:00:12,023 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:00:12,023 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:12,024 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:12,024 - sqlalchemy.engine.Engine - INFO - [cached since 721s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:00:12,025 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:12,025 - sqlalchemy.engine.Engine - INFO - [cached since 721s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 12, 24272), 'users_id': 3}
2025-03-31 13:00:12,025 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:12,026 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:00:27,474 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:27.474809", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:27,474 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:27.474809", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:27,475 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 13:00:27,475 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 13:00:35,839 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:35.839795", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:35,839 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:35.839795", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:35,841 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 1b4761ee-a956-475c-9134-33988a3c7f2b
2025-03-31 13:00:35,842 - app.services.secure_channel_service - INFO - Creating channel with ID: 1b4761ee-a956-475c-9134-33988a3c7f2b
2025-03-31 13:00:35,842 - app.services.secure_channel_service - INFO - Channel 1b4761ee-a956-475c-9134-33988a3c7f2b saved to Redis with TTL 1800 seconds
2025-03-31 13:00:35,842 - app.api.v1.endpoints.auth - INFO - Channel 1b4761ee-a956-475c-9134-33988a3c7f2b initialized successfully
2025-03-31 13:00:35,842 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:00:35,842 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:00:36,076 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:36.076849", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:36,076 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:36.076849", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:36,077 - app.api.v1.endpoints.auth - INFO - Login request using channel: 1b4761ee-a956-475c-9134-33988a3c7f2b
2025-03-31 13:00:36,079 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"c086f890-d4a8-4c18-a591-c1132ad29a4e"}
2025-03-31 13:00:36,079 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': 'c086f890-d4a8-4c18-a591-c1132ad29a4e'}
2025-03-31 13:00:36,079 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:36,079 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:36,079 - sqlalchemy.engine.Engine - INFO - [cached since 746.7s ago] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-31 13:00:36,284 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:36,284 - sqlalchemy.engine.Engine - INFO - [cached since 746.6s ago] {'user_id_1': 2, 'device_id_1': 'c086f890-d4a8-4c18-a591-c1132ad29a4e', 'param_1': 1}
2025-03-31 13:00:36,286 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 13:00:36,287 - sqlalchemy.engine.Engine - INFO - [cached since 746.6s ago] {'users_id': 2}
2025-03-31 13:00:36,287 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 13:00:36,287 - sqlalchemy.engine.Engine - INFO - [cached since 746.6s ago] {'user_id': 2, 'device_id': 'c086f890-d4a8-4c18-a591-c1132ad29a4e', 'refresh_token': None, 'last_login': None}
2025-03-31 13:00:36,288 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-31 13:00:36,288 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:00:36,288 - sqlalchemy.engine.Engine - INFO - [cached since 746.6s ago] {'refresh_token': '_nbHMAUdzcwFkvatzQuYFP_VLgIdhpvgc0nr8L2_Q10', 'user_devices_id': 28}
2025-03-31 13:00:36,289 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:36,289 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 13:00:36,289 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 13:00:36,290 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 13:00:36,291 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.048}
2025-03-31 13:00:36,291 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.048}
2025-03-31 13:00:37,338 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:37.338136", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:37,338 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:37.338136", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:37,340 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: b9089fe4-bca5-4b8a-ab4a-5b74e46661df
2025-03-31 13:00:37,340 - app.services.secure_channel_service - INFO - Creating channel with ID: b9089fe4-bca5-4b8a-ab4a-5b74e46661df
2025-03-31 13:00:37,340 - app.services.secure_channel_service - INFO - Channel b9089fe4-bca5-4b8a-ab4a-5b74e46661df saved to Redis with TTL 1800 seconds
2025-03-31 13:00:37,341 - app.api.v1.endpoints.auth - INFO - Channel b9089fe4-bca5-4b8a-ab4a-5b74e46661df initialized successfully
2025-03-31 13:00:37,341 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:00:37,341 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:00:37,346 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:00:37,347 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:00:37,347 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:00:37,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:37,347 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:37,348 - sqlalchemy.engine.Engine - INFO - [cached since 746.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:00:37,348 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:37,348 - sqlalchemy.engine.Engine - INFO - [cached since 746.3s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 37, 348138), 'users_id': 2}
2025-03-31 13:00:37,349 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:37,354 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:00:39,454 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:00:39,455 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:00:39,455 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:00:39,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:39,456 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:39,456 - sqlalchemy.engine.Engine - INFO - [cached since 748.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:00:39,457 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:39,457 - sqlalchemy.engine.Engine - INFO - [cached since 748.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 39, 457617), 'users_id': 2}
2025-03-31 13:00:39,457 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:39,463 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:00:40,480 - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:40.480199", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:40,480 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:00:40.480199", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:00:40,481 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:40,482 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:00:40,482 - sqlalchemy.engine.Engine - INFO - [cached since 749.4s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:00:40,483 - app.api.v1.endpoints.users - INFO - Search request received, channel: b9089fe4-bca5-4b8a-ab4a-5b74e46661df
2025-03-31 13:00:40,483 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743417036}
2025-03-31 13:00:40,484 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-03-31 13:00:40,484 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-03-31 13:00:40,484 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-03-31 13:00:40,484 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 13:00:40,484 - sqlalchemy.engine.Engine - INFO - [cached since 743.8s ago] {'id_1': '2', 'username_1': '%mir%', 'email_1': '%mir%', 'param_1': 10}
2025-03-31 13:00:40,485 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 13:00:40,485 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 13:00:40,486 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 13:00:40,486 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-31 13:00:40,486 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-31 13:00:42,004 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:00:42,473 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 13:00:42,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:42,475 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:00:42,475 - sqlalchemy.engine.Engine - INFO - [cached since 344.6s ago] {'pk_1': 2}
2025-03-31 13:00:42,475 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:42,476 - sqlalchemy.engine.Engine - INFO - [cached since 751.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 42, 474806), 'users_id': 2}
2025-03-31 13:00:42,476 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:42,477 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 13:00:43,663 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 13:00:43,664 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:43,665 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:00:43,665 - sqlalchemy.engine.Engine - INFO - [cached since 345.8s ago] {'pk_1': 3}
2025-03-31 13:00:43,666 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:43,666 - sqlalchemy.engine.Engine - INFO - [cached since 752.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 43, 664479), 'users_id': 3}
2025-03-31 13:00:43,666 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:43,667 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 13:00:43,686 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 13:00:43,687 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:00:43,687 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:00:43,687 - sqlalchemy.engine.Engine - INFO - [cached since 345.8s ago] {'pk_1': 3}
2025-03-31 13:00:43,688 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:00:43,688 - sqlalchemy.engine.Engine - INFO - [cached since 752.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 0, 43, 687484), 'users_id': 3}
2025-03-31 13:00:43,688 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:00:43,689 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 13:01:07,329 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:01:09,342 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:01:11,996 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:01:37,360 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:01:39,325 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:01:41,979 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:01:57,688 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 13:01:57,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:01:57,690 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:01:57,690 - sqlalchemy.engine.Engine - INFO - [cached since 419.8s ago] {'pk_1': 3}
2025-03-31 13:01:57,691 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:01:57,691 - sqlalchemy.engine.Engine - INFO - [cached since 826.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 1, 57, 689282), 'users_id': 3}
2025-03-31 13:01:57,691 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:01:57,696 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 13:01:59,849 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 13:01:59,850 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:01:59,850 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:01:59,850 - sqlalchemy.engine.Engine - INFO - [cached since 422s ago] {'pk_1': 2}
2025-03-31 13:01:59,851 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:01:59,851 - sqlalchemy.engine.Engine - INFO - [cached since 828.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 1, 59, 849840), 'users_id': 2}
2025-03-31 13:01:59,852 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:01:59,858 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 13:02:02,118 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:02:02,118 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:02:02,120 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:02:02,121 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:02:05,889 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:02:05,890 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:02:09,325 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:02:10,929 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:02:10,930 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:03:38,098 - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:38.097955", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:38,098 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:38.097955", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:38,098 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 13:03:38,098 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 13:03:46,156 - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:46.156659", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:46,156 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:46.156659", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:46,157 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 89a7b4ef-93e7-432b-995d-9dd64bc18f62
2025-03-31 13:03:46,158 - app.services.secure_channel_service - INFO - Creating channel with ID: 89a7b4ef-93e7-432b-995d-9dd64bc18f62
2025-03-31 13:03:46,158 - app.services.secure_channel_service - INFO - Channel 89a7b4ef-93e7-432b-995d-9dd64bc18f62 saved to Redis with TTL 1800 seconds
2025-03-31 13:03:46,159 - app.api.v1.endpoints.auth - INFO - Channel 89a7b4ef-93e7-432b-995d-9dd64bc18f62 initialized successfully
2025-03-31 13:03:46,159 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 13:03:46,159 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 13:03:46,356 - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:46.355704", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:46,356 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:46.355704", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:46,357 - app.api.v1.endpoints.auth - INFO - Login request using channel: 89a7b4ef-93e7-432b-995d-9dd64bc18f62
2025-03-31 13:03:46,358 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"4b1ebe23-0e49-430f-bc00-e008679b4756"}
2025-03-31 13:03:46,358 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '4b1ebe23-0e49-430f-bc00-e008679b4756'}
2025-03-31 13:03:46,359 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:03:46,359 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 13:03:46,359 - sqlalchemy.engine.Engine - INFO - [cached since 936.9s ago] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-31 13:03:46,566 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:03:46,566 - sqlalchemy.engine.Engine - INFO - [cached since 936.9s ago] {'user_id_1': 2, 'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'param_1': 1}
2025-03-31 13:03:46,568 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 13:03:46,568 - sqlalchemy.engine.Engine - INFO - [cached since 936.9s ago] {'users_id': 2}
2025-03-31 13:03:46,568 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 13:03:46,568 - sqlalchemy.engine.Engine - INFO - [cached since 936.9s ago] {'user_id': 2, 'device_id': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token': None, 'last_login': None}
2025-03-31 13:03:46,569 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-31 13:03:46,569 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:03:46,570 - sqlalchemy.engine.Engine - INFO - [cached since 936.9s ago] {'refresh_token': 'N-ruhoT0MbaeNYlQ6VO5Th2Uhgex_GdVfq_arczNfHM', 'user_devices_id': 29}
2025-03-31 13:03:46,570 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:03:46,578 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 13:03:46,578 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 13:03:46,579 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 13:03:46,580 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 225.082}
2025-03-31 13:03:46,580 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 225.082}
2025-03-31 13:03:47,401 - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:47.401732", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:47,401 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:47.401732", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:03:47,402 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 5e05b439-11b2-4e7c-b6de-6c9a6d60f603
2025-03-31 13:03:47,402 - app.services.secure_channel_service - INFO - Creating channel with ID: 5e05b439-11b2-4e7c-b6de-6c9a6d60f603
2025-03-31 13:03:47,403 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:03:47,403 - app.services.secure_channel_service - INFO - Channel 5e05b439-11b2-4e7c-b6de-6c9a6d60f603 saved to Redis with TTL 1800 seconds
2025-03-31 13:03:47,404 - app.api.v1.endpoints.auth - INFO - Channel 5e05b439-11b2-4e7c-b6de-6c9a6d60f603 initialized successfully
2025-03-31 13:03:47,404 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 13:03:47,404 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 13:03:47,404 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:03:47,404 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:03:47,405 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:03:47,405 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:03:47,405 - sqlalchemy.engine.Engine - INFO - [cached since 936.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:03:47,406 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:03:47,406 - sqlalchemy.engine.Engine - INFO - [cached since 936.3s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 3, 47, 406812), 'users_id': 2}
2025-03-31 13:03:47,407 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:03:47,412 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:03:56,197 - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:56.197455", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:03:56,197 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:03:56.197455", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:03:56,198 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 13:03:56,198 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 13:04:02,731 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:02.731815", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:02,731 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:02.731815", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:02,732 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 49aac606-1ea8-4533-8a65-a4e4d5a2d039
2025-03-31 13:04:02,732 - app.services.secure_channel_service - INFO - Creating channel with ID: 49aac606-1ea8-4533-8a65-a4e4d5a2d039
2025-03-31 13:04:02,733 - app.services.secure_channel_service - INFO - Channel 49aac606-1ea8-4533-8a65-a4e4d5a2d039 saved to Redis with TTL 1800 seconds
2025-03-31 13:04:02,733 - app.api.v1.endpoints.auth - INFO - Channel 49aac606-1ea8-4533-8a65-a4e4d5a2d039 initialized successfully
2025-03-31 13:04:02,733 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 13:04:02,733 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 13:04:02,978 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:02.978871", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:02,978 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:02.978871", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:02,979 - app.api.v1.endpoints.auth - INFO - Login request using channel: 49aac606-1ea8-4533-8a65-a4e4d5a2d039
2025-03-31 13:04:02,980 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"5324195c-08e4-40cb-bd7b-4de2004fff85"}
2025-03-31 13:04:02,980 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '5324195c-08e4-40cb-bd7b-4de2004fff85'}
2025-03-31 13:04:02,981 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:02,981 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:02,981 - sqlalchemy.engine.Engine - INFO - [cached since 953.6s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-31 13:04:03,188 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:03,188 - sqlalchemy.engine.Engine - INFO - [cached since 953.5s ago] {'user_id_1': 3, 'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'param_1': 1}
2025-03-31 13:04:03,189 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 13:04:03,189 - sqlalchemy.engine.Engine - INFO - [cached since 953.5s ago] {'users_id': 3}
2025-03-31 13:04:03,190 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 13:04:03,190 - sqlalchemy.engine.Engine - INFO - [cached since 953.5s ago] {'user_id': 3, 'device_id': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token': None, 'last_login': None}
2025-03-31 13:04:03,191 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-31 13:04:03,191 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:04:03,191 - sqlalchemy.engine.Engine - INFO - [cached since 953.5s ago] {'refresh_token': 'bEp4f4vhAaSYmTTslQel0ywmT_By0XeSMrVoZAJ2PuA', 'user_devices_id': 30}
2025-03-31 13:04:03,192 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:03,192 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 13:04:03,192 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 13:04:03,193 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 13:04:03,194 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.166}
2025-03-31 13:04:03,194 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.166}
2025-03-31 13:04:03,846 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:03.846507", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:03,846 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:03.846507", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:03,847 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 363da3dc-9b49-4412-adcf-cb001565a1c1
2025-03-31 13:04:03,847 - app.services.secure_channel_service - INFO - Creating channel with ID: 363da3dc-9b49-4412-adcf-cb001565a1c1
2025-03-31 13:04:03,848 - app.services.secure_channel_service - INFO - Channel 363da3dc-9b49-4412-adcf-cb001565a1c1 saved to Redis with TTL 1800 seconds
2025-03-31 13:04:03,848 - app.api.v1.endpoints.auth - INFO - Channel 363da3dc-9b49-4412-adcf-cb001565a1c1 initialized successfully
2025-03-31 13:04:03,849 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:04:03,849 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:04:03,850 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:04:03,851 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:04:03,851 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:04:03,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:03,851 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:03,852 - sqlalchemy.engine.Engine - INFO - [cached since 952.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:04:03,852 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:03,853 - sqlalchemy.engine.Engine - INFO - [cached since 952.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 3, 852508), 'users_id': 3}
2025-03-31 13:04:03,853 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:03,858 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:04:04,926 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:04:04,927 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:04:04,927 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:04:04,928 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:04,928 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:04,928 - sqlalchemy.engine.Engine - INFO - [cached since 953.9s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:04:04,929 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:04,929 - sqlalchemy.engine.Engine - INFO - [cached since 953.9s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 4, 928243), 'users_id': 3}
2025-03-31 13:04:04,929 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:04,930 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:04:05,438 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:05.438632", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:05,438 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:05.438632", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:04:05,440 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:05,440 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:05,440 - sqlalchemy.engine.Engine - INFO - [cached since 494.8s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'bEp4f4vhAaSYmTTslQel0ywmT_By0XeSMrVoZAJ2PuA', 'param_1': 1}
2025-03-31 13:04:05,442 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:04:05,442 - sqlalchemy.engine.Engine - INFO - [cached since 494.8s ago] {'refresh_token': 'EpASpF5v9dTKCjx2mhBL7Tna8i6tp0HvCVi3h-xCjHA', 'user_devices_id': 30}
2025-03-31 13:04:05,442 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:05,443 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 13:04:05,443 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 13:04:05,498 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:04:05,499 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:04:05,499 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:04:05,499 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:05,500 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:05,500 - sqlalchemy.engine.Engine - INFO - [cached since 954.4s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:04:05,501 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:05,501 - sqlalchemy.engine.Engine - INFO - [cached since 954.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 5, 500646), 'users_id': 3}
2025-03-31 13:04:05,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:05,502 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:04:07,069 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:07.069199", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:04:07,069 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:07.069199", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:04:07,071 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:07,071 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:07,071 - sqlalchemy.engine.Engine - INFO - [cached since 496.5s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'N-ruhoT0MbaeNYlQ6VO5Th2Uhgex_GdVfq_arczNfHM', 'param_1': 1}
2025-03-31 13:04:07,072 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:04:07,072 - sqlalchemy.engine.Engine - INFO - [cached since 496.5s ago] {'refresh_token': 'vW00sqqcMqYaP-f39vmBGfqrRjj47Q7h1qTzQ7GJ0KU', 'user_devices_id': 29}
2025-03-31 13:04:07,072 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:07,077 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-31 13:04:07,077 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.003}
2025-03-31 13:04:07,151 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:04:07,152 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:04:07,152 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:04:07,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:07,153 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:07,153 - sqlalchemy.engine.Engine - INFO - [cached since 956.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:04:07,154 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:07,154 - sqlalchemy.engine.Engine - INFO - [cached since 956.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 7, 153219), 'users_id': 2}
2025-03-31 13:04:07,154 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:07,154 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:04:19,394 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:19.394941", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:04:19,394 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:19.394941", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:04:19,396 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:19,397 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:19,397 - sqlalchemy.engine.Engine - INFO - [cached since 968.3s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:04:19,398 - app.api.v1.endpoints.users - INFO - Search request received, channel: 5e05b439-11b2-4e7c-b6de-6c9a6d60f603
2025-03-31 13:04:19,398 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743417247}
2025-03-31 13:04:19,399 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 13:04:19,399 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 13:04:19,399 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 13:04:19,400 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 13:04:19,400 - sqlalchemy.engine.Engine - INFO - [cached since 962.7s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 13:04:19,400 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 13:04:19,401 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 13:04:19,402 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 13:04:19,402 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-31 13:04:19,402 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-03-31 13:04:19,960 - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:19.960177", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:04:19,960 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:04:19.960177", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:04:19,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:19,962 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:04:19,962 - sqlalchemy.engine.Engine - INFO - [cached since 968.9s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:04:19,963 - app.api.v1.endpoints.users - INFO - Search request received, channel: 5e05b439-11b2-4e7c-b6de-6c9a6d60f603
2025-03-31 13:04:19,963 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743417247}
2025-03-31 13:04:19,965 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-03-31 13:04:19,965 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-03-31 13:04:19,965 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-03-31 13:04:19,965 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 13:04:19,965 - sqlalchemy.engine.Engine - INFO - [cached since 963.3s ago] {'id_1': '2', 'username_1': '%mir%', 'email_1': '%mir%', 'param_1': 10}
2025-03-31 13:04:19,966 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 13:04:19,966 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 13:04:19,967 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 13:04:19,968 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 13:04:19,968 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 13:04:25,088 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 13:04:25,090 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:25,090 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:25,090 - sqlalchemy.engine.Engine - INFO - [cached since 567.2s ago] {'pk_1': 2}
2025-03-31 13:04:25,091 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:25,091 - sqlalchemy.engine.Engine - INFO - [cached since 974s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 25, 89890), 'users_id': 2}
2025-03-31 13:04:25,092 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:25,092 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 13:04:26,138 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 13:04:26,139 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:26,140 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:26,140 - sqlalchemy.engine.Engine - INFO - [cached since 568.2s ago] {'pk_1': 3}
2025-03-31 13:04:26,140 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:26,141 - sqlalchemy.engine.Engine - INFO - [cached since 975.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 26, 139040), 'users_id': 3}
2025-03-31 13:04:26,141 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:26,146 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 13:04:26,146 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 13:04:26,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:26,147 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:26,147 - sqlalchemy.engine.Engine - INFO - [cached since 568.3s ago] {'pk_1': 3}
2025-03-31 13:04:26,148 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:26,148 - sqlalchemy.engine.Engine - INFO - [cached since 975.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 26, 147041), 'users_id': 3}
2025-03-31 13:04:26,148 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:26,149 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 13:04:26,399 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:04:26,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:26,401 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:26,401 - sqlalchemy.engine.Engine - INFO - [cached since 568.5s ago] {'pk_1': 2}
2025-03-31 13:04:26,402 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:26,402 - sqlalchemy.engine.Engine - INFO - [cached since 975.3s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 26, 400275), 'users_id': 2}
2025-03-31 13:04:26,402 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:26,407 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:04:26,416 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:04:26,417 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:26,418 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:26,418 - sqlalchemy.engine.Engine - INFO - [cached since 568.5s ago] {'pk_1': 2}
2025-03-31 13:04:26,419 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:26,419 - sqlalchemy.engine.Engine - INFO - [cached since 975.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 26, 417791), 'users_id': 2}
2025-03-31 13:04:26,419 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:26,420 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:04:26,614 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:04:26,616 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:26,616 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:26,617 - sqlalchemy.engine.Engine - INFO - [cached since 568.7s ago] {'pk_1': 2}
2025-03-31 13:04:26,617 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:26,617 - sqlalchemy.engine.Engine - INFO - [cached since 975.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 26, 615835), 'users_id': 2}
2025-03-31 13:04:26,618 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:26,618 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:04:26,619 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:04:26,620 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:26,620 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:26,620 - sqlalchemy.engine.Engine - INFO - [cached since 568.7s ago] {'pk_1': 2}
2025-03-31 13:04:26,621 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:26,621 - sqlalchemy.engine.Engine - INFO - [cached since 975.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 26, 619837), 'users_id': 2}
2025-03-31 13:04:26,622 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:26,622 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:04:34,875 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:04:35,494 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:04:37,124 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:04:56,980 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 3 to 2
2025-03-31 13:04:56,982 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:56,982 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:56,982 - sqlalchemy.engine.Engine - INFO - [cached since 599.1s ago] {'pk_1': 3}
2025-03-31 13:04:56,983 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:56,983 - sqlalchemy.engine.Engine - INFO - [cached since 1006s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 56, 981766), 'users_id': 3}
2025-03-31 13:04:56,984 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:56,989 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 3 to 2
2025-03-31 13:04:57,053 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-31 13:04:57,054 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:57,055 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:57,055 - sqlalchemy.engine.Engine - INFO - [cached since 599.2s ago] {'pk_1': 2}
2025-03-31 13:04:57,055 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:57,055 - sqlalchemy.engine.Engine - INFO - [cached since 1006s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 57, 54782), 'users_id': 2}
2025-03-31 13:04:57,056 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:57,056 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-31 13:04:57,060 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-31 13:04:57,061 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:57,062 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:57,062 - sqlalchemy.engine.Engine - INFO - [cached since 599.2s ago] {'pk_1': 2}
2025-03-31 13:04:57,062 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:57,063 - sqlalchemy.engine.Engine - INFO - [cached since 1006s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 57, 61784), 'users_id': 2}
2025-03-31 13:04:57,063 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:57,063 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-31 13:04:57,405 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-31 13:04:57,406 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:04:57,407 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:04:57,407 - sqlalchemy.engine.Engine - INFO - [cached since 599.5s ago] {'pk_1': 2}
2025-03-31 13:04:57,408 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:04:57,408 - sqlalchemy.engine.Engine - INFO - [cached since 1006s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 4, 57, 406199), 'users_id': 2}
2025-03-31 13:04:57,408 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:04:57,409 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-31 13:05:00,963 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 2 to 3
2025-03-31 13:05:00,964 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:00,965 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:05:00,965 - sqlalchemy.engine.Engine - INFO - [cached since 603.1s ago] {'pk_1': 2}
2025-03-31 13:05:00,966 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:00,966 - sqlalchemy.engine.Engine - INFO - [cached since 1010s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 0, 964431), 'users_id': 2}
2025-03-31 13:05:00,966 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:00,967 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 2 to 3
2025-03-31 13:05:01,101 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 13:05:01,101 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:01,102 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:05:01,102 - sqlalchemy.engine.Engine - INFO - [cached since 603.2s ago] {'pk_1': 3}
2025-03-31 13:05:01,103 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:01,103 - sqlalchemy.engine.Engine - INFO - [cached since 1010s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 1, 101462), 'users_id': 3}
2025-03-31 13:05:01,103 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:01,104 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 13:05:01,111 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 13:05:01,112 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:01,113 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:05:01,113 - sqlalchemy.engine.Engine - INFO - [cached since 603.2s ago] {'pk_1': 3}
2025-03-31 13:05:01,113 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:01,113 - sqlalchemy.engine.Engine - INFO - [cached since 1010s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 1, 112465), 'users_id': 3}
2025-03-31 13:05:01,114 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:01,115 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 13:05:01,274 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 13:05:01,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:01,276 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:05:01,276 - sqlalchemy.engine.Engine - INFO - [cached since 603.4s ago] {'pk_1': 3}
2025-03-31 13:05:01,276 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:01,276 - sqlalchemy.engine.Engine - INFO - [cached since 1010s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 1, 275503), 'users_id': 3}
2025-03-31 13:05:01,277 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:01,277 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 13:05:04,824 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:05:05,564 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:05:07,119 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:05:27,184 - INFO - Incoming request: {"timestamp": "2025-03-31T10:05:27.184946", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:05:27,184 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:05:27.184946", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:05:27,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:27,186 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:05:27,186 - sqlalchemy.engine.Engine - INFO - [cached since 576.6s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'vW00sqqcMqYaP-f39vmBGfqrRjj47Q7h1qTzQ7GJ0KU', 'param_1': 1}
2025-03-31 13:05:27,187 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:05:27,187 - sqlalchemy.engine.Engine - INFO - [cached since 576.6s ago] {'refresh_token': 'fP7SFBGeAtxPAlVYsOLZ_ei6RYHbyRhsTw8-b8_WVRA', 'user_devices_id': 29}
2025-03-31 13:05:27,187 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:27,192 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.0}
2025-03-31 13:05:27,192 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.0}
2025-03-31 13:05:27,281 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:05:27,282 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:05:27,282 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:05:27,282 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:27,282 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:05:27,283 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:05:27,283 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:27,284 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 27, 283967), 'users_id': 2}
2025-03-31 13:05:27,284 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:27,284 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:05:29,047 - INFO - Incoming request: {"timestamp": "2025-03-31T10:05:29.047893", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:05:29,047 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:05:29.047893", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:05:29,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:29,049 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:05:29,049 - sqlalchemy.engine.Engine - INFO - [cached since 578.4s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'fP7SFBGeAtxPAlVYsOLZ_ei6RYHbyRhsTw8-b8_WVRA', 'param_1': 1}
2025-03-31 13:05:29,050 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:05:29,050 - sqlalchemy.engine.Engine - INFO - [cached since 578.4s ago] {'refresh_token': 'ifhg7_gQVlf7oGchpwwgIqWGquJF6MmyoaXTNHMyc3o', 'user_devices_id': 29}
2025-03-31 13:05:29,051 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:29,056 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 13:05:29,056 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 13:05:29,105 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:05:29,106 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:05:29,106 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:05:29,106 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:29,107 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:05:29,107 - sqlalchemy.engine.Engine - INFO - [cached since 1038s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:05:29,108 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:29,108 - sqlalchemy.engine.Engine - INFO - [cached since 1038s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 29, 107913), 'users_id': 2}
2025-03-31 13:05:29,108 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:29,109 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:05:32,572 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 13:05:32,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:32,573 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:05:32,573 - sqlalchemy.engine.Engine - INFO - [cached since 634.7s ago] {'pk_1': 2}
2025-03-31 13:05:32,574 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:32,574 - sqlalchemy.engine.Engine - INFO - [cached since 1042s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 32, 572543), 'users_id': 2}
2025-03-31 13:05:32,574 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:32,583 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 13:05:34,854 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:05:35,585 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:05:37,494 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 13:05:37,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:05:37,496 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:05:37,496 - sqlalchemy.engine.Engine - INFO - [cached since 639.6s ago] {'pk_1': 3}
2025-03-31 13:05:37,496 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:05:37,497 - sqlalchemy.engine.Engine - INFO - [cached since 1046s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 5, 37, 495487), 'users_id': 3}
2025-03-31 13:05:37,497 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:05:37,502 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 13:05:44,808 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:05:44,809 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:05:44,810 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:05:44,811 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:05:59,099 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:06:06,668 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:06:06,668 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:06:06,669 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:06:06,669 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:06:06,671 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:06,671 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:06,673 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:06,673 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:15,190 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:06:15,191 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:16,384 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:16.384023", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:16,384 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:16.384023", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:16,385 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:06:16,385 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:06:16,668 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:16.668087", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:16,668 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:16.668087", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:16,670 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:16,670 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:16,670 - sqlalchemy.engine.Engine - INFO - [cached since 626.1s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'EpASpF5v9dTKCjx2mhBL7Tna8i6tp0HvCVi3h-xCjHA', 'param_1': 1}
2025-03-31 13:06:16,671 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:06:16,671 - sqlalchemy.engine.Engine - INFO - [cached since 626.1s ago] {'refresh_token': '9hIfWykepcUKMtKLK9KzCsUAgBxPA2DpI4Xm4Frk0Mg', 'user_devices_id': 30}
2025-03-31 13:06:16,671 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:16,676 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.011000000000001}
2025-03-31 13:06:16,676 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.011000000000001}
2025-03-31 13:06:16,743 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:06:16,744 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:16,744 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:06:16,744 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:16,745 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:16,745 - sqlalchemy.engine.Engine - INFO - [cached since 1086s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:06:16,746 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:16,746 - sqlalchemy.engine.Engine - INFO - [cached since 1086s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 16, 745107), 'users_id': 3}
2025-03-31 13:06:16,746 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:16,747 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:06:17,551 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:06:17,552 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:17,552 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:06:17,553 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:17,553 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:17,553 - sqlalchemy.engine.Engine - INFO - [cached since 1086s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:06:17,554 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:17,554 - sqlalchemy.engine.Engine - INFO - [cached since 1086s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 17, 554348), 'users_id': 3}
2025-03-31 13:06:17,554 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:17,560 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:06:17,765 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:17.765396", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:17,765 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:17.765396", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:17,766 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9c06a42e-fee5-47da-9f67-7f97cdecd820
2025-03-31 13:06:17,766 - app.services.secure_channel_service - INFO - Creating channel with ID: 9c06a42e-fee5-47da-9f67-7f97cdecd820
2025-03-31 13:06:17,767 - app.services.secure_channel_service - INFO - Channel 9c06a42e-fee5-47da-9f67-7f97cdecd820 saved to Redis with TTL 1800 seconds
2025-03-31 13:06:17,768 - app.api.v1.endpoints.auth - INFO - Channel 9c06a42e-fee5-47da-9f67-7f97cdecd820 initialized successfully
2025-03-31 13:06:17,768 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 13:06:17,768 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 13:06:24,427 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:06:24,428 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:33,061 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:06:33,062 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:33,894 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:33.894849", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:33,894 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:33.894849", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:33,895 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 13:06:33,895 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 13:06:34,257 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:34.257628", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:34,257 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:34.257628", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:34,259 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:34,259 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:34,259 - sqlalchemy.engine.Engine - INFO - [cached since 643.6s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': '9hIfWykepcUKMtKLK9KzCsUAgBxPA2DpI4Xm4Frk0Mg', 'param_1': 1}
2025-03-31 13:06:34,260 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:06:34,260 - sqlalchemy.engine.Engine - INFO - [cached since 643.6s ago] {'refresh_token': 'D785zE4nY26893RQ-5tt8km-r1iRUYkc-GiP6dHodaU', 'user_devices_id': 30}
2025-03-31 13:06:34,261 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:34,266 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 13:06:34,266 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 13:06:35,246 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:06:35,247 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:35,247 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:06:35,248 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:35,248 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:35,248 - sqlalchemy.engine.Engine - INFO - [cached since 1104s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:06:35,249 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:35,249 - sqlalchemy.engine.Engine - INFO - [cached since 1104s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 35, 249790), 'users_id': 3}
2025-03-31 13:06:35,250 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:35,255 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:06:35,300 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:06:35,301 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:35,301 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:06:35,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:35,301 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:35,302 - sqlalchemy.engine.Engine - INFO - [cached since 1104s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:06:35,302 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:35,303 - sqlalchemy.engine.Engine - INFO - [cached since 1104s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 35, 302802), 'users_id': 3}
2025-03-31 13:06:35,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:35,303 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:06:35,350 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:35.350812", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:35,350 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:35.350812", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:35,351 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 84450875-6c13-424f-a070-f3c0e9d0d8ce
2025-03-31 13:06:35,351 - app.services.secure_channel_service - INFO - Creating channel with ID: 84450875-6c13-424f-a070-f3c0e9d0d8ce
2025-03-31 13:06:35,352 - app.services.secure_channel_service - INFO - Channel 84450875-6c13-424f-a070-f3c0e9d0d8ce saved to Redis with TTL 1800 seconds
2025-03-31 13:06:35,352 - app.api.v1.endpoints.auth - INFO - Channel 84450875-6c13-424f-a070-f3c0e9d0d8ce initialized successfully
2025-03-31 13:06:35,353 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 13:06:35,353 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 13:06:40,394 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:40.394216", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:06:40,394 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:40.394216", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:06:40,394 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:06:40,394 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:06:42,103 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:42.103817", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:06:42,103 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:42.103817", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:06:42,105 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:42,105 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:42,105 - sqlalchemy.engine.Engine - INFO - [cached since 651.5s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'ifhg7_gQVlf7oGchpwwgIqWGquJF6MmyoaXTNHMyc3o', 'param_1': 1}
2025-03-31 13:06:42,106 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:06:42,106 - sqlalchemy.engine.Engine - INFO - [cached since 651.5s ago] {'refresh_token': 'wrW3i-iPCGHou59EQyawN0kSUy9nXRuvDPu56JoLRZY', 'user_devices_id': 29}
2025-03-31 13:06:42,107 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:42,112 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.109}
2025-03-31 13:06:42,112 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.109}
2025-03-31 13:06:42,375 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:06:42,378 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:42,378 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:06:42,378 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:42,378 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:42,378 - sqlalchemy.engine.Engine - INFO - [cached since 1111s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:06:42,378 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:42,379 - sqlalchemy.engine.Engine - INFO - [cached since 1111s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 42, 378985), 'users_id': 2}
2025-03-31 13:06:42,379 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:42,380 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:06:45,130 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:06:45,131 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:06:45,131 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:06:45,131 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:45,131 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:45,132 - sqlalchemy.engine.Engine - INFO - [cached since 1114s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:06:45,132 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:45,133 - sqlalchemy.engine.Engine - INFO - [cached since 1114s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 45, 132889), 'users_id': 2}
2025-03-31 13:06:45,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:45,138 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:06:48,741 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:48.740595", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:06:48,741 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:48.740595", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:06:48,742 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 7cae899b-2e53-423f-a6ec-8395db6dedb9
2025-03-31 13:06:48,742 - app.services.secure_channel_service - INFO - Creating channel with ID: 7cae899b-2e53-423f-a6ec-8395db6dedb9
2025-03-31 13:06:48,742 - app.services.secure_channel_service - INFO - Channel 7cae899b-2e53-423f-a6ec-8395db6dedb9 saved to Redis with TTL 1800 seconds
2025-03-31 13:06:48,743 - app.api.v1.endpoints.auth - INFO - Channel 7cae899b-2e53-423f-a6ec-8395db6dedb9 initialized successfully
2025-03-31 13:06:48,743 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:06:48,743 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 13:06:52,859 - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:52.859890", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:52,859 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:06:52.859890", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:06:52,861 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:52,861 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:06:52,861 - sqlalchemy.engine.Engine - INFO - [cached since 1122s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:06:52,862 - app.api.v1.endpoints.users - INFO - Search request received, channel: 84450875-6c13-424f-a070-f3c0e9d0d8ce
2025-03-31 13:06:52,862 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743417394}
2025-03-31 13:06:52,863 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-31 13:06:52,864 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-31 13:06:52,864 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-31 13:06:52,864 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 13:06:52,864 - sqlalchemy.engine.Engine - INFO - [cached since 1116s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-31 13:06:52,865 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 13:06:52,865 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 13:06:52,866 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 13:06:52,866 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.004}
2025-03-31 13:06:52,866 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.004}
2025-03-31 13:06:57,018 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-31 13:06:57,019 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:06:57,019 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:06:57,019 - sqlalchemy.engine.Engine - INFO - [cached since 719.1s ago] {'pk_1': 3}
2025-03-31 13:06:57,020 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:06:57,020 - sqlalchemy.engine.Engine - INFO - [cached since 1126s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 6, 57, 19836), 'users_id': 3}
2025-03-31 13:06:57,020 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:06:57,021 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-31 13:07:03,242 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 13:07:03,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:03,243 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:03,244 - sqlalchemy.engine.Engine - INFO - [cached since 725.3s ago] {'pk_1': 2}
2025-03-31 13:07:03,244 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:03,244 - sqlalchemy.engine.Engine - INFO - [cached since 1132s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 3, 243659), 'users_id': 2}
2025-03-31 13:07:03,245 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:03,250 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 13:07:03,250 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 13:07:03,251 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:03,252 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:03,252 - sqlalchemy.engine.Engine - INFO - [cached since 725.4s ago] {'pk_1': 2}
2025-03-31 13:07:03,252 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:03,252 - sqlalchemy.engine.Engine - INFO - [cached since 1132s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 3, 251660), 'users_id': 2}
2025-03-31 13:07:03,253 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:03,253 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 13:07:04,397 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:07:05,118 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:07:12,417 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:07:14,857 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:07:16,783 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 13:07:16,784 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:16,785 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:16,785 - sqlalchemy.engine.Engine - INFO - [cached since 738.9s ago] {'pk_1': 3}
2025-03-31 13:07:16,785 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:16,785 - sqlalchemy.engine.Engine - INFO - [cached since 1146s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 16, 784528), 'users_id': 3}
2025-03-31 13:07:16,786 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:16,791 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 13:07:21,733 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:07:21,734 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:07:30,934 - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:30.934229", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:30,934 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:30.934229", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:30,934 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:07:30,934 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:07:32,566 - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:32.566983", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:32,566 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:32.566983", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:32,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:32,569 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:07:32,569 - sqlalchemy.engine.Engine - INFO - [cached since 702s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'wrW3i-iPCGHou59EQyawN0kSUy9nXRuvDPu56JoLRZY', 'param_1': 1}
2025-03-31 13:07:32,570 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:07:32,570 - sqlalchemy.engine.Engine - INFO - [cached since 702s ago] {'refresh_token': '4XQoJR1iwC0mTo8viI7EcnTGaMgj_fpsmYPY_geKfbY', 'user_devices_id': 29}
2025-03-31 13:07:32,571 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:32,576 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-31 13:07:32,576 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-31 13:07:32,841 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:07:32,842 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:07:32,842 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:07:32,842 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:32,843 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:07:32,843 - sqlalchemy.engine.Engine - INFO - [cached since 1162s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:07:32,844 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:32,844 - sqlalchemy.engine.Engine - INFO - [cached since 1162s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 32, 843125), 'users_id': 2}
2025-03-31 13:07:32,844 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:32,849 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:07:34,394 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:07:35,099 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:07:36,198 - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:36.198177", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:36,198 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:36.198177", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:36,200 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 8518a111-f175-40c9-997b-e74817018dba
2025-03-31 13:07:36,200 - app.services.secure_channel_service - INFO - Creating channel with ID: 8518a111-f175-40c9-997b-e74817018dba
2025-03-31 13:07:36,200 - app.services.secure_channel_service - INFO - Channel 8518a111-f175-40c9-997b-e74817018dba saved to Redis with TTL 1800 seconds
2025-03-31 13:07:36,201 - app.api.v1.endpoints.auth - INFO - Channel 8518a111-f175-40c9-997b-e74817018dba initialized successfully
2025-03-31 13:07:36,201 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.002}
2025-03-31 13:07:36,201 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.002}
2025-03-31 13:07:43,648 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 13:07:43,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:43,650 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:43,650 - sqlalchemy.engine.Engine - INFO - [cached since 765.8s ago] {'pk_1': 2}
2025-03-31 13:07:43,650 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:43,650 - sqlalchemy.engine.Engine - INFO - [cached since 1173s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 43, 649748), 'users_id': 2}
2025-03-31 13:07:43,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:43,652 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 13:07:44,851 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:07:46,440 - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:46.440207", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:46,440 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:07:46.440207", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:07:46,441 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:46,442 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:07:46,442 - sqlalchemy.engine.Engine - INFO - [cached since 1175s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:07:46,443 - app.api.v1.endpoints.users - INFO - Search request received, channel: 8518a111-f175-40c9-997b-e74817018dba
2025-03-31 13:07:46,443 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743417452}
2025-03-31 13:07:46,444 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 13:07:46,444 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 13:07:46,444 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 13:07:46,445 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 13:07:46,445 - sqlalchemy.engine.Engine - INFO - [cached since 1170s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 13:07:46,445 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 13:07:46,446 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 13:07:46,447 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 13:07:46,447 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.003}
2025-03-31 13:07:46,447 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.003}
2025-03-31 13:07:50,003 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 13:07:50,004 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:50,005 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:50,005 - sqlalchemy.engine.Engine - INFO - [cached since 772.1s ago] {'pk_1': 2}
2025-03-31 13:07:50,005 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:50,005 - sqlalchemy.engine.Engine - INFO - [cached since 1179s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 50, 4247), 'users_id': 2}
2025-03-31 13:07:50,006 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:50,011 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 13:07:50,952 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 13:07:50,953 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:50,953 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:50,954 - sqlalchemy.engine.Engine - INFO - [cached since 773.1s ago] {'pk_1': 3}
2025-03-31 13:07:50,954 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:50,954 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 50, 953243), 'users_id': 3}
2025-03-31 13:07:50,955 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:50,955 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 13:07:50,955 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 13:07:50,956 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:50,956 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:50,956 - sqlalchemy.engine.Engine - INFO - [cached since 773.1s ago] {'pk_1': 3}
2025-03-31 13:07:50,957 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:50,957 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 50, 956244), 'users_id': 3}
2025-03-31 13:07:50,957 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:50,958 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 13:07:51,356 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:07:51,357 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:51,357 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:51,357 - sqlalchemy.engine.Engine - INFO - [cached since 773.5s ago] {'pk_1': 2}
2025-03-31 13:07:51,358 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:51,358 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 51, 356244), 'users_id': 2}
2025-03-31 13:07:51,358 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:51,359 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:07:51,381 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:07:51,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:51,382 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:51,383 - sqlalchemy.engine.Engine - INFO - [cached since 773.5s ago] {'pk_1': 2}
2025-03-31 13:07:51,383 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:51,383 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 51, 382251), 'users_id': 2}
2025-03-31 13:07:51,384 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:51,384 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:07:51,547 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:07:51,548 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:51,549 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:51,549 - sqlalchemy.engine.Engine - INFO - [cached since 773.7s ago] {'pk_1': 2}
2025-03-31 13:07:51,549 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:51,550 - sqlalchemy.engine.Engine - INFO - [cached since 1180s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 51, 548318), 'users_id': 2}
2025-03-31 13:07:51,550 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:51,551 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:07:51,569 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 13:07:51,570 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:07:51,571 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:07:51,571 - sqlalchemy.engine.Engine - INFO - [cached since 773.7s ago] {'pk_1': 2}
2025-03-31 13:07:51,572 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:07:51,572 - sqlalchemy.engine.Engine - INFO - [cached since 1181s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 7, 51, 570324), 'users_id': 2}
2025-03-31 13:07:51,572 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:07:51,573 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 13:08:02,772 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:08:04,391 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:08:05,096 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:08:06,290 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:08:06,291 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:08:08,786 - INFO - Incoming request: {"timestamp": "2025-03-31T10:08:08.786825", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:08:08,786 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:08:08.786825", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:08:08,786 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:08:08,786 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 13:08:09,146 - INFO - Incoming request: {"timestamp": "2025-03-31T10:08:09.146809", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:08:09,146 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:08:09.146809", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:08:09,150 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:08:09,150 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:08:09,150 - sqlalchemy.engine.Engine - INFO - [cached since 738.5s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'D785zE4nY26893RQ-5tt8km-r1iRUYkc-GiP6dHodaU', 'param_1': 1}
2025-03-31 13:08:09,151 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:08:09,151 - sqlalchemy.engine.Engine - INFO - [cached since 738.5s ago] {'refresh_token': '2Dok502Tom2uaQXg3fouZyN-iRbZD4QqnhSaV9S7Obk', 'user_devices_id': 30}
2025-03-31 13:08:09,152 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:08:09,157 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.925}
2025-03-31 13:08:09,157 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.925}
2025-03-31 13:08:09,602 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 13:08:09,603 - app.services.connection_manager - INFO - User 3 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:08:09,603 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 13:08:09,604 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:08:09,604 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:08:09,604 - sqlalchemy.engine.Engine - INFO - [cached since 1199s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 13:08:09,605 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:08:09,605 - sqlalchemy.engine.Engine - INFO - [cached since 1199s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 8, 9, 605771), 'users_id': 3}
2025-03-31 13:08:09,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:08:09,611 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 13:08:09,892 - INFO - Incoming request: {"timestamp": "2025-03-31T10:08:09.892168", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:08:09,892 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:08:09.892168", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 13:08:09,893 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0aa01adc-8c92-4647-be8c-4f14fe0c94f5
2025-03-31 13:08:09,893 - app.services.secure_channel_service - INFO - Creating channel with ID: 0aa01adc-8c92-4647-be8c-4f14fe0c94f5
2025-03-31 13:08:09,893 - app.services.secure_channel_service - INFO - Channel 0aa01adc-8c92-4647-be8c-4f14fe0c94f5 saved to Redis with TTL 1800 seconds
2025-03-31 13:08:09,893 - app.api.v1.endpoints.auth - INFO - Channel 0aa01adc-8c92-4647-be8c-4f14fe0c94f5 initialized successfully
2025-03-31 13:08:09,894 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 13:08:09,894 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 13:08:14,853 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:08:23,760 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 3 to 2
2025-03-31 13:08:23,761 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:08:23,762 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:08:23,762 - sqlalchemy.engine.Engine - INFO - [cached since 805.9s ago] {'pk_1': 3}
2025-03-31 13:08:23,763 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:08:23,763 - sqlalchemy.engine.Engine - INFO - [cached since 1213s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 8, 23, 761001), 'users_id': 3}
2025-03-31 13:08:23,763 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:08:23,764 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 3 to 2
2025-03-31 13:08:23,827 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-31 13:08:23,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:08:23,828 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:08:23,828 - sqlalchemy.engine.Engine - INFO - [cached since 805.9s ago] {'pk_1': 2}
2025-03-31 13:08:23,829 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:08:23,829 - sqlalchemy.engine.Engine - INFO - [cached since 1213s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 8, 23, 827032), 'users_id': 2}
2025-03-31 13:08:23,829 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:08:23,830 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-31 13:08:23,831 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-31 13:08:23,831 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:08:23,832 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:08:23,832 - sqlalchemy.engine.Engine - INFO - [cached since 805.9s ago] {'pk_1': 2}
2025-03-31 13:08:23,832 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:08:23,832 - sqlalchemy.engine.Engine - INFO - [cached since 1213s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 8, 23, 831033), 'users_id': 2}
2025-03-31 13:08:23,833 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:08:23,833 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-31 13:08:23,878 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 2 to 3
2025-03-31 13:08:23,879 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:08:23,880 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:08:23,880 - sqlalchemy.engine.Engine - INFO - [cached since 806s ago] {'pk_1': 2}
2025-03-31 13:08:23,881 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:08:23,881 - sqlalchemy.engine.Engine - INFO - [cached since 1213s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 8, 23, 879043), 'users_id': 2}
2025-03-31 13:08:23,881 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:08:23,881 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 2 to 3
2025-03-31 13:08:32,800 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:08:35,098 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:08:39,266 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:08:44,854 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:09:02,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:09:05,098 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:09:09,238 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:09:14,855 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:09:32,772 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:09:35,086 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:09:39,230 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:09:44,858 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:10:02,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:10:05,110 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:10:09,230 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:10:14,856 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:10:32,774 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:10:35,101 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:10:39,228 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:10:44,877 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:11:02,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:11:05,094 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:11:09,228 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:11:14,855 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:11:32,775 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:11:35,095 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:11:39,241 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:11:44,852 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:12:02,775 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:12:05,273 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:12:09,264 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:12:14,855 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:12:32,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:12:35,118 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:12:39,289 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:12:44,855 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:13:02,774 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:13:05,121 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:13:09,301 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:13:14,858 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:13:32,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:13:35,141 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:13:39,316 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:13:44,855 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:14:02,774 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:14:05,100 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:14:09,239 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:14:14,856 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:14:32,772 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:14:35,116 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:14:36,115 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 13:14:36,116 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:14:36,117 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:14:36,117 - sqlalchemy.engine.Engine - INFO - [cached since 1178s ago] {'pk_1': 3}
2025-03-31 13:14:36,117 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:14:36,118 - sqlalchemy.engine.Engine - INFO - [cached since 1585s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 14, 36, 116351), 'users_id': 3}
2025-03-31 13:14:36,118 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:14:36,119 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 13:14:38,319 - INFO - Incoming request: {"timestamp": "2025-03-31T10:14:38.319970", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:14:38,319 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T10:14:38.319970", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 13:14:38,321 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:14:38,321 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 13:14:38,321 - sqlalchemy.engine.Engine - INFO - [cached since 1128s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': '4XQoJR1iwC0mTo8viI7EcnTGaMgj_fpsmYPY_geKfbY', 'param_1': 1}
2025-03-31 13:14:38,322 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 13:14:38,323 - sqlalchemy.engine.Engine - INFO - [cached since 1128s ago] {'refresh_token': 'Yx2TpwGPDk0YWQ9iXTmJSI3hMQes-A6D-H_AuZmp5m4', 'user_devices_id': 29}
2025-03-31 13:14:38,323 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:14:38,332 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.004}
2025-03-31 13:14:38,332 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.004}
2025-03-31 13:14:38,391 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 13:14:38,392 - app.services.connection_manager - INFO - User 2 connected to server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:14:38,392 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 13:14:38,392 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:14:38,393 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 13:14:38,393 - sqlalchemy.engine.Engine - INFO - [cached since 1587s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 13:14:38,394 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:14:38,394 - sqlalchemy.engine.Engine - INFO - [cached since 1587s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 14, 38, 393987), 'users_id': 2}
2025-03-31 13:14:38,394 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:14:38,395 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 13:14:39,312 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:14:41,591 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 13:14:41,592 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 13:14:41,593 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 13:14:41,593 - sqlalchemy.engine.Engine - INFO - [cached since 1184s ago] {'pk_1': 2}
2025-03-31 13:14:41,593 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 13:14:41,594 - sqlalchemy.engine.Engine - INFO - [cached since 1591s ago] {'last_seen': datetime.datetime(2025, 3, 31, 10, 14, 41, 592329), 'users_id': 2}
2025-03-31 13:14:41,594 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 13:14:41,595 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 13:14:44,888 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:15:05,135 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:15:08,384 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:15:09,317 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:15:14,860 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:15:35,158 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:15:38,387 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:15:39,218 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:15:44,857 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:16:05,204 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:16:08,385 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:16:09,220 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:16:14,859 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:16:35,199 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:16:38,383 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:16:39,228 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:16:44,857 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:17:05,097 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:17:08,385 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:17:09,224 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:17:14,856 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:17:35,096 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:17:38,384 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:17:39,229 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:17:44,856 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 13:18:05,099 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 13:18:06,925 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:18:06,925 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:18:06,926 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 13:18:06,926 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:18:06,926 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 13:18:06,928 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:18:06,929 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:18:06,929 - app.services.connection_manager - INFO - User 2 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:18:06,929 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:18:06,930 - app.services.connection_manager - INFO - User 3 disconnected from server 5dd58777-625a-4f0f-9fae-636f9de0caa1
2025-03-31 13:18:07,017 - app.main - INFO - Shutting down server...
2025-03-31 13:18:07,019 - app.main - INFO - Redis connections closed
2025-03-31 13:18:07,019 - app.main - INFO - Server shutdown completed
2025-03-31 14:28:52,532 - app.main - INFO - Starting up server...
2025-03-31 14:28:52,534 - app.main - INFO - Redis initialized
2025-03-31 14:28:52,628 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-31 14:28:52,629 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 14:28:52,632 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-31 14:28:52,632 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 14:28:52,634 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-31 14:28:52,635 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 14:28:52,642 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:28:52,643 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 14:28:52,643 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-31 14:28:52,650 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:28:52,651 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:28:52,653 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 14:28:52,654 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-31 14:28:52,656 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 14:28:52,656 - sqlalchemy.engine.Engine - INFO - [cached since 0.002859s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-31 14:28:52,658 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:28:52,660 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:28:52,660 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 14:28:52,661 - sqlalchemy.engine.Engine - INFO - [cached since 0.01846s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-31 14:28:52,663 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:28:52,664 - app.main - INFO - Database initialized
2025-03-31 14:28:52,703 - app.main - INFO - Server key pair generated
2025-03-31 14:28:52,704 - app.main - INFO - Server startup completed successfully
2025-03-31 14:29:00,015 - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:00.015988", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:00,015 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:00.015988", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:00,017 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.5}
2025-03-31 14:29:00,017 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.5}
2025-03-31 14:29:00,342 - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:00.342045", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:00,342 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:00.342045", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:00,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:29:00,368 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:29:00,369 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': '2Dok502Tom2uaQXg3fouZyN-iRbZD4QqnhSaV9S7Obk', 'param_1': 1}
2025-03-31 14:29:00,381 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:29:00,382 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] {'refresh_token': 'nVS8lmxMy5VKXaPqiZg-oTkqrhlqF8-kYPFpSa-LhVA', 'user_devices_id': 30}
2025-03-31 14:29:00,388 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:29:00,394 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 52.009}
2025-03-31 14:29:00,394 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 52.009}
2025-03-31 14:29:00,494 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:29:00,513 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:29:00,513 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:29:00,514 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:29:00,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:29:00,518 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] {'id_1': '3', 'param_1': 1}
2025-03-31 14:29:00,523 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:29:00,523 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] {'last_seen': datetime.datetime(2025, 3, 31, 11, 29, 0, 521577), 'users_id': 3}
2025-03-31 14:29:00,526 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:29:00,527 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:29:01,460 - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:01.460742", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:01,460 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:01.460742", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:01,463 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 6c6ff8a5-574b-497e-9182-c5a30c685ce7
2025-03-31 14:29:01,463 - app.services.secure_channel_service - INFO - Creating channel with ID: 6c6ff8a5-574b-497e-9182-c5a30c685ce7
2025-03-31 14:29:01,466 - app.services.secure_channel_service - INFO - Channel 6c6ff8a5-574b-497e-9182-c5a30c685ce7 saved to Redis with TTL 1800 seconds
2025-03-31 14:29:01,473 - app.api.v1.endpoints.auth - INFO - Channel 6c6ff8a5-574b-497e-9182-c5a30c685ce7 initialized successfully
2025-03-31 14:29:01,474 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.002}
2025-03-31 14:29:01,474 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.002}
2025-03-31 14:29:01,876 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:29:01,878 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:29:01,878 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:29:01,879 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:29:01,880 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:29:01,880 - sqlalchemy.engine.Engine - INFO - [cached since 1.363s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:29:01,882 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:29:01,882 - sqlalchemy.engine.Engine - INFO - [cached since 1.36s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 29, 1, 881316), 'users_id': 3}
2025-03-31 14:29:01,883 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:29:01,884 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:29:30,554 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:29:31,781 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:29:45,378 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:29:45,379 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:29:45,381 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:29:45,382 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:29:48,653 - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:48.653240", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:48,653 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:48.653240", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:48,653 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.5}
2025-03-31 14:29:48,653 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.5}
2025-03-31 14:29:48,760 - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:48.760252", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:48,760 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:48.760252", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:48,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:29:48,762 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:29:48,762 - sqlalchemy.engine.Engine - INFO - [cached since 48.39s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'nVS8lmxMy5VKXaPqiZg-oTkqrhlqF8-kYPFpSa-LhVA', 'param_1': 1}
2025-03-31 14:29:48,764 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:29:48,764 - sqlalchemy.engine.Engine - INFO - [cached since 48.38s ago] {'refresh_token': 'qo5ITwgk4WS0OfYrEZ5fTnbNb79hGwEp-HfdJ22cVAk', 'user_devices_id': 30}
2025-03-31 14:29:48,764 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:29:48,765 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 14:29:48,765 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 14:29:48,832 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:29:48,833 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:29:48,833 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:29:48,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:29:48,834 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:29:48,834 - sqlalchemy.engine.Engine - INFO - [cached since 48.32s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:29:48,835 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:29:48,835 - sqlalchemy.engine.Engine - INFO - [cached since 48.31s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 29, 48, 835369), 'users_id': 3}
2025-03-31 14:29:48,835 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:29:48,836 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:29:49,661 - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:49.661609", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:49,661 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:29:49.661609", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:29:49,663 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: edb048bd-3441-41a1-bda8-3e2e92bab4ff
2025-03-31 14:29:49,663 - app.services.secure_channel_service - INFO - Creating channel with ID: edb048bd-3441-41a1-bda8-3e2e92bab4ff
2025-03-31 14:29:49,663 - app.services.secure_channel_service - INFO - Channel edb048bd-3441-41a1-bda8-3e2e92bab4ff saved to Redis with TTL 1800 seconds
2025-03-31 14:29:49,664 - app.api.v1.endpoints.auth - INFO - Channel edb048bd-3441-41a1-bda8-3e2e92bab4ff initialized successfully
2025-03-31 14:29:49,664 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.5010000000000003}
2025-03-31 14:29:49,664 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.5010000000000003}
2025-03-31 14:29:50,040 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:29:50,041 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:29:50,041 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:29:50,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:29:50,042 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:29:50,042 - sqlalchemy.engine.Engine - INFO - [cached since 49.53s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:29:50,043 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:29:50,043 - sqlalchemy.engine.Engine - INFO - [cached since 49.52s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 29, 50, 43486), 'users_id': 3}
2025-03-31 14:29:50,044 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:29:50,044 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:30:07,748 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:30:07,749 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:30:07,751 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:30:07,751 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:30:11,504 - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:11.504276", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:11,504 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:11.504276", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:11,505 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 14:30:11,505 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 14:30:11,561 - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:11.561287", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:11,561 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:11.561287", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:11,564 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:30:11,564 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:30:11,564 - sqlalchemy.engine.Engine - INFO - [cached since 71.2s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'qo5ITwgk4WS0OfYrEZ5fTnbNb79hGwEp-HfdJ22cVAk', 'param_1': 1}
2025-03-31 14:30:11,566 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:30:11,567 - sqlalchemy.engine.Engine - INFO - [cached since 71.19s ago] {'refresh_token': 'aep2pSlUecb7inHCjfKXehhS2FNC3KQm4qcZsbjYzI8', 'user_devices_id': 30}
2025-03-31 14:30:11,568 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:30:11,570 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-31 14:30:11,570 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-31 14:30:12,149 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:30:12,152 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:30:12,152 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:30:12,153 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:30:12,153 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:30:12,153 - sqlalchemy.engine.Engine - INFO - [cached since 71.64s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:30:12,155 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:30:12,155 - sqlalchemy.engine.Engine - INFO - [cached since 71.63s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 30, 12, 154890), 'users_id': 3}
2025-03-31 14:30:12,156 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:30:12,157 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:30:12,160 - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:12.160391", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:12,160 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:12.160391", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:12,162 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 8b879c03-fe14-4c02-8091-0a75d4c4a0e7
2025-03-31 14:30:12,162 - app.services.secure_channel_service - INFO - Creating channel with ID: 8b879c03-fe14-4c02-8091-0a75d4c4a0e7
2025-03-31 14:30:12,163 - app.services.secure_channel_service - INFO - Channel 8b879c03-fe14-4c02-8091-0a75d4c4a0e7 saved to Redis with TTL 1800 seconds
2025-03-31 14:30:12,164 - app.api.v1.endpoints.auth - INFO - Channel 8b879c03-fe14-4c02-8091-0a75d4c4a0e7 initialized successfully
2025-03-31 14:30:12,164 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.502}
2025-03-31 14:30:12,164 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.502}
2025-03-31 14:30:12,837 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:30:12,840 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:30:12,840 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:30:12,841 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:30:12,842 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:30:12,842 - sqlalchemy.engine.Engine - INFO - [cached since 72.32s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:30:12,844 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:30:12,844 - sqlalchemy.engine.Engine - INFO - [cached since 72.32s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 30, 12, 843512), 'users_id': 3}
2025-03-31 14:30:12,846 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:30:12,847 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:30:13,584 - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:13.584642", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:13,584 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:30:13.584642", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:30:13,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:30:13,588 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:30:13,588 - sqlalchemy.engine.Engine - INFO - [cached since 73.22s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'aep2pSlUecb7inHCjfKXehhS2FNC3KQm4qcZsbjYzI8', 'param_1': 1}
2025-03-31 14:30:13,590 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:30:13,591 - sqlalchemy.engine.Engine - INFO - [cached since 73.21s ago] {'refresh_token': 'CU5CvEBh2F5XBhvOWJUulKmPNKySYfWtG9C1sh_8mgk', 'user_devices_id': 30}
2025-03-31 14:30:13,592 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:30:13,594 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.503}
2025-03-31 14:30:13,594 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.503}
2025-03-31 14:30:13,633 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:30:13,636 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:30:13,636 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:30:13,637 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:30:13,638 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:30:13,638 - sqlalchemy.engine.Engine - INFO - [cached since 73.12s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:30:13,640 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:30:13,641 - sqlalchemy.engine.Engine - INFO - [cached since 73.12s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 30, 13, 640152), 'users_id': 3}
2025-03-31 14:30:13,642 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:30:13,643 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:30:42,754 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:30:43,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:31:12,832 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:31:13,630 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:31:25,199 - INFO - Incoming request: {"timestamp": "2025-03-31T11:31:25.199448", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:31:25,199 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:31:25.199448", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:31:25,200 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 14:31:25,200 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 14:31:25,828 - INFO - Incoming request: {"timestamp": "2025-03-31T11:31:25.828848", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:31:25,828 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:31:25.828848", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:31:25,830 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:31:25,830 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:31:25,830 - sqlalchemy.engine.Engine - INFO - [cached since 145.5s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'Yx2TpwGPDk0YWQ9iXTmJSI3hMQes-A6D-H_AuZmp5m4', 'param_1': 1}
2025-03-31 14:31:25,831 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:31:25,832 - sqlalchemy.engine.Engine - INFO - [cached since 145.5s ago] {'refresh_token': 'x6WZFmnwcmdyz7x9zYJve3qh1sBGRExHpOLPSZOxwbY', 'user_devices_id': 29}
2025-03-31 14:31:25,832 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:31:25,837 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:31:25,837 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:31:26,030 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:31:26,031 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:31:26,031 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:31:26,031 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:31:26,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:31:26,032 - sqlalchemy.engine.Engine - INFO - [cached since 145.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:31:26,033 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:31:26,033 - sqlalchemy.engine.Engine - INFO - [cached since 145.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 31, 26, 33159), 'users_id': 2}
2025-03-31 14:31:26,034 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:31:26,034 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:31:27,430 - INFO - Incoming request: {"timestamp": "2025-03-31T11:31:27.430318", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:31:27,430 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:31:27.430318", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:31:27,431 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: cf4a4b15-9ce8-42d3-8c1a-b7cf8b9077e3
2025-03-31 14:31:27,431 - app.services.secure_channel_service - INFO - Creating channel with ID: cf4a4b15-9ce8-42d3-8c1a-b7cf8b9077e3
2025-03-31 14:31:27,432 - app.services.secure_channel_service - INFO - Channel cf4a4b15-9ce8-42d3-8c1a-b7cf8b9077e3 saved to Redis with TTL 1800 seconds
2025-03-31 14:31:27,432 - app.api.v1.endpoints.auth - INFO - Channel cf4a4b15-9ce8-42d3-8c1a-b7cf8b9077e3 initialized successfully
2025-03-31 14:31:27,432 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.5}
2025-03-31 14:31:27,432 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.5}
2025-03-31 14:31:29,008 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:31:29,009 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:31:29,009 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:31:29,009 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:31:29,010 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:31:29,010 - sqlalchemy.engine.Engine - INFO - [cached since 148.5s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:31:29,011 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:31:29,011 - sqlalchemy.engine.Engine - INFO - [cached since 148.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 31, 29, 10934), 'users_id': 2}
2025-03-31 14:31:29,011 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:31:29,013 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:31:42,773 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:31:43,620 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:31:55,946 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:31:58,926 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:32:12,809 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:32:13,642 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:32:25,916 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:32:28,901 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:32:42,780 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:32:43,631 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:32:55,914 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:32:58,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:33:12,768 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:33:13,621 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:33:25,916 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:33:28,901 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:33:42,732 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:33:43,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:33:55,920 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:33:58,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:34:12,737 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:34:13,629 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:34:25,915 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:34:28,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:34:42,731 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:34:43,632 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:34:55,919 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:34:58,902 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:35:12,742 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:35:13,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:35:25,913 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:35:28,902 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:35:40,494 - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:40.494369", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:35:40,494 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:40.494369", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:35:40,496 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:40,497 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:35:40,497 - sqlalchemy.engine.Engine - INFO - [cached since 400.1s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'x6WZFmnwcmdyz7x9zYJve3qh1sBGRExHpOLPSZOxwbY', 'param_1': 1}
2025-03-31 14:35:40,498 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:35:40,498 - sqlalchemy.engine.Engine - INFO - [cached since 400.1s ago] {'refresh_token': 'KNMbrffYexB4fMH2TnyjpmvWp1V0hH4HNIF96n_icMY', 'user_devices_id': 29}
2025-03-31 14:35:40,499 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:40,500 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 14:35:40,500 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 14:35:40,581 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:35:40,582 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:35:40,582 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:35:40,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:40,583 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:35:40,583 - sqlalchemy.engine.Engine - INFO - [cached since 400.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:35:40,584 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:40,584 - sqlalchemy.engine.Engine - INFO - [cached since 400.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 40, 583863), 'users_id': 2}
2025-03-31 14:35:40,584 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:40,585 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:35:42,835 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:35:43,621 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:35:45,961 - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:45.960960", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:35:45,961 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:45.960960", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:35:45,962 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: a891220c-1385-40ed-847e-4f7ebbbde1a3
2025-03-31 14:35:45,963 - app.services.secure_channel_service - INFO - Creating channel with ID: a891220c-1385-40ed-847e-4f7ebbbde1a3
2025-03-31 14:35:45,963 - app.services.secure_channel_service - INFO - Channel a891220c-1385-40ed-847e-4f7ebbbde1a3 saved to Redis with TTL 1800 seconds
2025-03-31 14:35:45,964 - app.api.v1.endpoints.auth - INFO - Channel a891220c-1385-40ed-847e-4f7ebbbde1a3 initialized successfully
2025-03-31 14:35:45,964 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.5}
2025-03-31 14:35:45,964 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.5}
2025-03-31 14:35:46,112 - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:46.112420", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:35:46,112 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:46.112420", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:35:46,113 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:46,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:35:46,114 - sqlalchemy.engine.Engine - INFO - [cached since 405.6s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:35:46,116 - app.api.v1.endpoints.users - INFO - Search request received, channel: a891220c-1385-40ed-847e-4f7ebbbde1a3
2025-03-31 14:35:46,116 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743422413}
2025-03-31 14:35:46,134 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"y","limit":10}
2025-03-31 14:35:46,135 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'y', 'limit': 10}
2025-03-31 14:35:46,135 - app.api.v1.endpoints.users - INFO - Searching users with query 'y', excluding user 3
2025-03-31 14:35:46,136 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:35:46,136 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] {'id_1': '3', 'username_1': '%y%', 'email_1': '%y%', 'param_1': 10}
2025-03-31 14:35:46,139 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 14:35:46,139 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 14:35:46,140 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:35:46,140 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 28.505}
2025-03-31 14:35:46,140 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 28.505}
2025-03-31 14:35:46,296 - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:46.296452", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:35:46,296 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:35:46.296452", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:35:46,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:46,298 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:35:46,298 - sqlalchemy.engine.Engine - INFO - [cached since 405.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:35:46,299 - app.api.v1.endpoints.users - INFO - Search request received, channel: a891220c-1385-40ed-847e-4f7ebbbde1a3
2025-03-31 14:35:46,300 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743422413}
2025-03-31 14:35:46,301 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-31 14:35:46,301 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-31 14:35:46,301 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-31 14:35:46,302 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:35:46,302 - sqlalchemy.engine.Engine - INFO - [cached since 0.166s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-31 14:35:46,303 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 14:35:46,303 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 14:35:46,304 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:35:46,305 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-31 14:35:46,305 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-03-31 14:35:48,154 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-31 14:35:48,155 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:48,156 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:48,156 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'pk_1': 3}
2025-03-31 14:35:48,157 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:48,157 - sqlalchemy.engine.Engine - INFO - [cached since 407.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 48, 155233), 'users_id': 3}
2025-03-31 14:35:48,158 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:48,158 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-31 14:35:49,873 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 14:35:49,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:49,874 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:49,875 - sqlalchemy.engine.Engine - INFO - [cached since 1.718s ago] {'pk_1': 2}
2025-03-31 14:35:49,875 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:49,875 - sqlalchemy.engine.Engine - INFO - [cached since 409.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 49, 874039), 'users_id': 2}
2025-03-31 14:35:49,876 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:49,881 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 14:35:49,896 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 14:35:49,897 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:49,897 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:49,897 - sqlalchemy.engine.Engine - INFO - [cached since 1.741s ago] {'pk_1': 2}
2025-03-31 14:35:49,898 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:49,898 - sqlalchemy.engine.Engine - INFO - [cached since 409.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 49, 896880), 'users_id': 2}
2025-03-31 14:35:49,899 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:49,899 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 14:35:50,052 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:35:50,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:50,054 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:50,054 - sqlalchemy.engine.Engine - INFO - [cached since 1.898s ago] {'pk_1': 3}
2025-03-31 14:35:50,055 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:50,055 - sqlalchemy.engine.Engine - INFO - [cached since 409.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 50, 53040), 'users_id': 3}
2025-03-31 14:35:50,056 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:50,056 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:35:50,057 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:35:50,057 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:50,058 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:50,058 - sqlalchemy.engine.Engine - INFO - [cached since 1.902s ago] {'pk_1': 3}
2025-03-31 14:35:50,058 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:50,059 - sqlalchemy.engine.Engine - INFO - [cached since 409.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 50, 57541), 'users_id': 3}
2025-03-31 14:35:50,059 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:50,059 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:35:50,096 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:35:50,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:50,098 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:50,098 - sqlalchemy.engine.Engine - INFO - [cached since 1.942s ago] {'pk_1': 3}
2025-03-31 14:35:50,099 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:50,099 - sqlalchemy.engine.Engine - INFO - [cached since 409.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 50, 97232), 'users_id': 3}
2025-03-31 14:35:50,100 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:50,101 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:35:50,101 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:35:50,102 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:50,102 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:50,103 - sqlalchemy.engine.Engine - INFO - [cached since 1.946s ago] {'pk_1': 3}
2025-03-31 14:35:50,104 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:50,104 - sqlalchemy.engine.Engine - INFO - [cached since 409.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 50, 102232), 'users_id': 3}
2025-03-31 14:35:50,104 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:50,105 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:35:58,156 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 2 to 3
2025-03-31 14:35:58,158 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:58,158 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:58,158 - sqlalchemy.engine.Engine - INFO - [cached since 10s ago] {'pk_1': 2}
2025-03-31 14:35:58,159 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:58,159 - sqlalchemy.engine.Engine - INFO - [cached since 417.6s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 58, 157557), 'users_id': 2}
2025-03-31 14:35:58,160 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:58,161 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 2 to 3
2025-03-31 14:35:58,210 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 14:35:58,211 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:58,212 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:58,212 - sqlalchemy.engine.Engine - INFO - [cached since 10.06s ago] {'pk_1': 3}
2025-03-31 14:35:58,213 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:58,213 - sqlalchemy.engine.Engine - INFO - [cached since 417.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 58, 211065), 'users_id': 3}
2025-03-31 14:35:58,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:58,214 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 14:35:58,225 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 14:35:58,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:58,226 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:58,226 - sqlalchemy.engine.Engine - INFO - [cached since 10.07s ago] {'pk_1': 3}
2025-03-31 14:35:58,227 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:58,227 - sqlalchemy.engine.Engine - INFO - [cached since 417.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 58, 225568), 'users_id': 3}
2025-03-31 14:35:58,228 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:58,229 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 14:35:58,256 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 14:35:58,257 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:35:58,258 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:35:58,258 - sqlalchemy.engine.Engine - INFO - [cached since 10.1s ago] {'pk_1': 3}
2025-03-31 14:35:58,259 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:35:58,259 - sqlalchemy.engine.Engine - INFO - [cached since 417.7s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 35, 58, 257079), 'users_id': 3}
2025-03-31 14:35:58,259 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:35:58,260 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 14:35:58,927 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:36:10,570 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:36:12,733 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:36:13,620 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:36:28,897 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:36:40,623 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:36:42,759 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:36:43,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:36:58,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:37:10,566 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:37:12,738 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:37:13,642 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:37:28,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:37:40,568 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:37:42,748 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:37:43,635 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:37:58,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:38:04,536 - INFO - Incoming request: {"timestamp": "2025-03-31T11:38:04.536092", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:38:04,536 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:38:04.536092", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:38:04,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:38:04,538 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:38:04,538 - sqlalchemy.engine.Engine - INFO - [cached since 544.2s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'KNMbrffYexB4fMH2TnyjpmvWp1V0hH4HNIF96n_icMY', 'param_1': 1}
2025-03-31 14:38:04,539 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:38:04,539 - sqlalchemy.engine.Engine - INFO - [cached since 544.2s ago] {'refresh_token': 'cSfKfY8biTJdoAr29cUWhWuNsEGG-mJ_aIoD9GMaDYU', 'user_devices_id': 29}
2025-03-31 14:38:04,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:38:04,541 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:38:04,541 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:38:04,611 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:38:04,612 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:38:04,612 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:38:04,613 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:38:04,613 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:38:04,613 - sqlalchemy.engine.Engine - INFO - [cached since 544.1s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:38:04,614 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:38:04,615 - sqlalchemy.engine.Engine - INFO - [cached since 544.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 38, 4, 614607), 'users_id': 2}
2025-03-31 14:38:04,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:38:04,615 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:38:12,728 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:38:13,267 - INFO - Incoming request: {"timestamp": "2025-03-31T11:38:13.267203", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:38:13,267 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:38:13.267203", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:38:13,269 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:38:13,269 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:38:13,269 - sqlalchemy.engine.Engine - INFO - [cached since 552.9s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'CU5CvEBh2F5XBhvOWJUulKmPNKySYfWtG9C1sh_8mgk', 'param_1': 1}
2025-03-31 14:38:13,271 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:38:13,271 - sqlalchemy.engine.Engine - INFO - [cached since 552.9s ago] {'refresh_token': '_hHh60fSJd5LNYDORu1Qg9-ZZls37ISIazAXPfxMYxY', 'user_devices_id': 30}
2025-03-31 14:38:13,272 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:38:13,272 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:38:13,272 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:38:13,306 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:38:13,307 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:38:13,307 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:38:13,308 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:38:13,308 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:38:13,308 - sqlalchemy.engine.Engine - INFO - [cached since 552.8s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:38:13,309 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:38:13,309 - sqlalchemy.engine.Engine - INFO - [cached since 552.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 38, 13, 309212), 'users_id': 3}
2025-03-31 14:38:13,310 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:38:13,310 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:38:14,018 - INFO - Incoming request: {"timestamp": "2025-03-31T11:38:14.018781", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:38:14,018 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:38:14.018781", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:38:14,020 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:38:14,020 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:38:14,020 - sqlalchemy.engine.Engine - INFO - [cached since 553.7s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': '_hHh60fSJd5LNYDORu1Qg9-ZZls37ISIazAXPfxMYxY', 'param_1': 1}
2025-03-31 14:38:14,021 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:38:14,021 - sqlalchemy.engine.Engine - INFO - [cached since 553.6s ago] {'refresh_token': '3CQ0Dz9JbSVjV1jj4iovt_AUYgSLC30CQgzkffBuxNI', 'user_devices_id': 30}
2025-03-31 14:38:14,022 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:38:14,023 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-31 14:38:14,023 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-03-31 14:38:14,045 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:38:14,045 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:38:14,046 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:38:14,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:38:14,046 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:38:14,046 - sqlalchemy.engine.Engine - INFO - [cached since 553.5s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:38:14,047 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:38:14,047 - sqlalchemy.engine.Engine - INFO - [cached since 553.5s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 38, 14, 47788), 'users_id': 3}
2025-03-31 14:38:14,048 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:38:14,048 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:38:28,904 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:38:34,592 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:38:42,745 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:38:44,061 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:38:58,909 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:39:04,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:39:12,736 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:39:14,044 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:39:28,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:39:34,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:39:42,826 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:39:44,044 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:39:58,910 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:40:04,590 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:40:12,848 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:40:14,044 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:40:28,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:40:34,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:40:42,739 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:40:44,054 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:40:58,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:41:04,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:41:12,766 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:41:14,043 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:41:28,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:41:34,620 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:41:42,746 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:41:44,057 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:41:44,399 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:41:44,400 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:41:44,401 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:41:44,401 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:41:44,402 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:41:44,405 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:44,405 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:44,406 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:44,406 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:44,406 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:47,193 - INFO - Incoming request: {"timestamp": "2025-03-31T11:41:47.193509", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:41:47,193 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:41:47.193509", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:41:47,193 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 14:41:47,193 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 14:41:47,471 - INFO - Incoming request: {"timestamp": "2025-03-31T11:41:47.471608", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:41:47,471 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:41:47.471608", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:41:47,472 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:41:47,473 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:41:47,473 - sqlalchemy.engine.Engine - INFO - [cached since 767.1s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': '3CQ0Dz9JbSVjV1jj4iovt_AUYgSLC30CQgzkffBuxNI', 'param_1': 1}
2025-03-31 14:41:47,474 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:41:47,474 - sqlalchemy.engine.Engine - INFO - [cached since 767.1s ago] {'refresh_token': 'FcnKmPUhrxrkzBkRm-VuTHj2CJ8p9kLaUpStDLsYvuQ', 'user_devices_id': 30}
2025-03-31 14:41:47,474 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:41:47,475 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9690000000000003}
2025-03-31 14:41:47,475 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.9690000000000003}
2025-03-31 14:41:47,559 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:41:47,560 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:47,560 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:41:47,560 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:41:47,561 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:41:47,561 - sqlalchemy.engine.Engine - INFO - [cached since 767s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:41:47,562 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:41:47,562 - sqlalchemy.engine.Engine - INFO - [cached since 767s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 41, 47, 561596), 'users_id': 3}
2025-03-31 14:41:47,562 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:41:47,563 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:41:48,037 - INFO - Incoming request: {"timestamp": "2025-03-31T11:41:48.037721", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:41:48,037 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:41:48.037721", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:41:48,038 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c70926a0-ce23-46b2-9ecc-22928092dea3
2025-03-31 14:41:48,038 - app.services.secure_channel_service - INFO - Creating channel with ID: c70926a0-ce23-46b2-9ecc-22928092dea3
2025-03-31 14:41:48,039 - app.services.secure_channel_service - INFO - Channel c70926a0-ce23-46b2-9ecc-22928092dea3 saved to Redis with TTL 1800 seconds
2025-03-31 14:41:48,039 - app.api.v1.endpoints.auth - INFO - Channel c70926a0-ce23-46b2-9ecc-22928092dea3 initialized successfully
2025-03-31 14:41:48,040 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.9829999999999999}
2025-03-31 14:41:48,040 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.9829999999999999}
2025-03-31 14:41:48,684 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:41:48,684 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:41:48,685 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:41:48,685 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:41:48,685 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:41:48,685 - sqlalchemy.engine.Engine - INFO - [cached since 768.2s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:41:48,686 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:41:48,686 - sqlalchemy.engine.Engine - INFO - [cached since 768.2s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 41, 48, 686973), 'users_id': 3}
2025-03-31 14:41:48,687 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:41:48,692 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:41:58,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:42:04,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:42:09,894 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 14:42:09,895 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:42:09,895 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:42:09,895 - sqlalchemy.engine.Engine - INFO - [cached since 381.7s ago] {'pk_1': 2}
2025-03-31 14:42:09,896 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:42:09,897 - sqlalchemy.engine.Engine - INFO - [cached since 789.4s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 42, 9, 894966), 'users_id': 2}
2025-03-31 14:42:09,897 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:42:09,902 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 14:42:17,586 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:42:18,641 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:42:24,608 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 14:42:24,609 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:42:24,610 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:42:24,610 - sqlalchemy.engine.Engine - INFO - [cached since 396.5s ago] {'pk_1': 3}
2025-03-31 14:42:24,610 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:42:24,610 - sqlalchemy.engine.Engine - INFO - [cached since 804.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 42, 24, 609297), 'users_id': 3}
2025-03-31 14:42:24,611 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:42:24,611 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 14:42:28,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:42:34,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:42:47,552 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:42:48,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:42:58,906 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:43:04,597 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:43:17,551 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:43:18,633 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:43:28,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:43:34,592 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:43:47,648 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:43:48,654 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:43:58,901 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:44:04,598 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:44:17,555 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:44:18,627 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:44:28,902 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:44:34,595 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:44:47,545 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:44:48,612 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:44:58,899 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:45:04,591 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:45:17,555 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:45:18,632 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:45:28,904 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:45:34,595 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:45:47,546 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:45:48,617 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:45:58,899 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:46:04,595 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:46:05,480 - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:05.480604", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:05,480 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:05.480604", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:05,483 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 332f91b7-d753-472e-b066-4e8bb632e2a1
2025-03-31 14:46:05,483 - app.services.secure_channel_service - INFO - Creating channel with ID: 332f91b7-d753-472e-b066-4e8bb632e2a1
2025-03-31 14:46:05,484 - app.services.secure_channel_service - INFO - Channel 332f91b7-d753-472e-b066-4e8bb632e2a1 saved to Redis with TTL 1800 seconds
2025-03-31 14:46:05,484 - app.api.v1.endpoints.auth - INFO - Channel 332f91b7-d753-472e-b066-4e8bb632e2a1 initialized successfully
2025-03-31 14:46:05,484 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.002000000000001}
2025-03-31 14:46:05,484 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.002000000000001}
2025-03-31 14:46:05,579 - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:05.579627", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:05,579 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:05.579627", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:05,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:05,581 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:46:05,581 - sqlalchemy.engine.Engine - INFO - [cached since 1025s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:46:05,582 - app.api.v1.endpoints.users - INFO - Search request received, channel: 332f91b7-d753-472e-b066-4e8bb632e2a1
2025-03-31 14:46:05,582 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743422884}
2025-03-31 14:46:05,583 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"k","limit":10}
2025-03-31 14:46:05,583 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'k', 'limit': 10}
2025-03-31 14:46:05,583 - app.api.v1.endpoints.users - INFO - Searching users with query 'k', excluding user 2
2025-03-31 14:46:05,583 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:46:05,583 - sqlalchemy.engine.Engine - INFO - [cached since 619.4s ago] {'id_1': '2', 'username_1': '%k%', 'email_1': '%k%', 'param_1': 10}
2025-03-31 14:46:05,584 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-03-31 14:46:05,584 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-03-31 14:46:05,585 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:46:05,585 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 14:46:05,585 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 14:46:05,888 - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:05.888744", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:05,888 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:05.888744", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:05,890 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:05,890 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:46:05,890 - sqlalchemy.engine.Engine - INFO - [cached since 1025s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:46:05,891 - app.api.v1.endpoints.users - INFO - Search request received, channel: 332f91b7-d753-472e-b066-4e8bb632e2a1
2025-03-31 14:46:05,891 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743422884}
2025-03-31 14:46:05,892 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-03-31 14:46:05,892 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-03-31 14:46:05,892 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-03-31 14:46:05,892 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:46:05,892 - sqlalchemy.engine.Engine - INFO - [cached since 619.8s ago] {'id_1': '2', 'username_1': '%mir%', 'email_1': '%mir%', 'param_1': 10}
2025-03-31 14:46:05,893 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 14:46:05,893 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 14:46:05,894 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:46:05,894 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 14:46:05,894 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 14:46:07,234 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 14:46:07,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:07,236 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:46:07,236 - sqlalchemy.engine.Engine - INFO - [cached since 619.1s ago] {'pk_1': 2}
2025-03-31 14:46:07,237 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:46:07,237 - sqlalchemy.engine.Engine - INFO - [cached since 1027s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 46, 7, 235221), 'users_id': 2}
2025-03-31 14:46:07,237 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:46:07,242 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 14:46:08,070 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 14:46:08,071 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:08,072 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:46:08,072 - sqlalchemy.engine.Engine - INFO - [cached since 619.9s ago] {'pk_1': 3}
2025-03-31 14:46:08,073 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:46:08,073 - sqlalchemy.engine.Engine - INFO - [cached since 1028s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 46, 8, 71449), 'users_id': 3}
2025-03-31 14:46:08,073 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:46:08,078 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 14:46:09,140 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 14:46:09,141 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:09,141 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:46:09,141 - sqlalchemy.engine.Engine - INFO - [cached since 621s ago] {'pk_1': 3}
2025-03-31 14:46:09,142 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:46:09,142 - sqlalchemy.engine.Engine - INFO - [cached since 1029s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 46, 9, 140978), 'users_id': 3}
2025-03-31 14:46:09,143 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:46:09,144 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 14:46:09,144 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 14:46:09,145 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:09,145 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:46:09,145 - sqlalchemy.engine.Engine - INFO - [cached since 621s ago] {'pk_1': 3}
2025-03-31 14:46:09,146 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:46:09,146 - sqlalchemy.engine.Engine - INFO - [cached since 1029s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 46, 9, 144980), 'users_id': 3}
2025-03-31 14:46:09,146 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:46:09,147 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 14:46:17,549 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:46:18,635 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:46:25,925 - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:25.925342", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:25,925 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:46:25.925342", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:46:25,926 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:25,927 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:46:25,927 - sqlalchemy.engine.Engine - INFO - [cached since 1046s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'cSfKfY8biTJdoAr29cUWhWuNsEGG-mJ_aIoD9GMaDYU', 'param_1': 1}
2025-03-31 14:46:25,928 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:46:25,928 - sqlalchemy.engine.Engine - INFO - [cached since 1046s ago] {'refresh_token': 'V7VPChnj8MEGcoJGOooVFZTwMKDsXvxs1rPiooDinws', 'user_devices_id': 29}
2025-03-31 14:46:25,928 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:46:25,934 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:46:25,934 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:46:25,965 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:46:25,966 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:46:25,966 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:46:25,966 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:46:25,966 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:46:25,966 - sqlalchemy.engine.Engine - INFO - [cached since 1045s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:46:25,967 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:46:25,968 - sqlalchemy.engine.Engine - INFO - [cached since 1045s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 46, 25, 967352), 'users_id': 2}
2025-03-31 14:46:25,968 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:46:25,968 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:46:28,903 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:46:47,537 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:46:48,659 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:46:55,961 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:46:58,899 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:47:17,544 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:47:18,674 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:47:25,959 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:47:28,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:47:47,569 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:47:48,695 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:47:55,963 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:47:58,905 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:48:09,727 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 14:48:09,729 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:09,729 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:09,729 - sqlalchemy.engine.Engine - INFO - [cached since 741.6s ago] {'pk_1': 2}
2025-03-31 14:48:09,730 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:09,730 - sqlalchemy.engine.Engine - INFO - [cached since 1149s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 9, 728962), 'users_id': 2}
2025-03-31 14:48:09,731 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:09,736 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 14:48:15,405 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 14:48:15,407 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:15,407 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:15,407 - sqlalchemy.engine.Engine - INFO - [cached since 747.3s ago] {'pk_1': 3}
2025-03-31 14:48:15,408 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:15,408 - sqlalchemy.engine.Engine - INFO - [cached since 1155s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 15, 406985), 'users_id': 3}
2025-03-31 14:48:15,408 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:15,414 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 14:48:17,578 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:48:18,734 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:48:22,953 - INFO - Incoming request: {"timestamp": "2025-03-31T11:48:22.952032", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:48:22,953 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:48:22.952032", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:48:22,954 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 06810b7e-d6ca-4b1c-b390-a742e8f6e5a2
2025-03-31 14:48:22,954 - app.services.secure_channel_service - INFO - Creating channel with ID: 06810b7e-d6ca-4b1c-b390-a742e8f6e5a2
2025-03-31 14:48:22,955 - app.services.secure_channel_service - INFO - Channel 06810b7e-d6ca-4b1c-b390-a742e8f6e5a2 saved to Redis with TTL 1800 seconds
2025-03-31 14:48:22,955 - app.api.v1.endpoints.auth - INFO - Channel 06810b7e-d6ca-4b1c-b390-a742e8f6e5a2 initialized successfully
2025-03-31 14:48:22,955 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 14:48:22,955 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-03-31 14:48:23,101 - INFO - Incoming request: {"timestamp": "2025-03-31T11:48:23.101065", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:48:23,101 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:48:23.101065", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:48:23,103 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:23,104 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:48:23,104 - sqlalchemy.engine.Engine - INFO - [cached since 1163s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:48:23,105 - app.api.v1.endpoints.users - INFO - Search request received, channel: 06810b7e-d6ca-4b1c-b390-a742e8f6e5a2
2025-03-31 14:48:23,105 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743423107}
2025-03-31 14:48:23,106 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"y","limit":10}
2025-03-31 14:48:23,106 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'y', 'limit': 10}
2025-03-31 14:48:23,106 - app.api.v1.endpoints.users - INFO - Searching users with query 'y', excluding user 3
2025-03-31 14:48:23,107 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:48:23,107 - sqlalchemy.engine.Engine - INFO - [cached since 757s ago] {'id_1': '3', 'username_1': '%y%', 'email_1': '%y%', 'param_1': 10}
2025-03-31 14:48:23,108 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 14:48:23,108 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 14:48:23,109 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:48:23,109 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 14:48:23,109 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 14:48:24,414 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-31 14:48:24,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:24,416 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:24,416 - sqlalchemy.engine.Engine - INFO - [cached since 756.3s ago] {'pk_1': 3}
2025-03-31 14:48:24,416 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:24,416 - sqlalchemy.engine.Engine - INFO - [cached since 1164s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 24, 415837), 'users_id': 3}
2025-03-31 14:48:24,417 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:24,425 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-31 14:48:27,938 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 14:48:27,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:27,940 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:27,940 - sqlalchemy.engine.Engine - INFO - [cached since 759.8s ago] {'pk_1': 2}
2025-03-31 14:48:27,940 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:27,940 - sqlalchemy.engine.Engine - INFO - [cached since 1167s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 27, 939120), 'users_id': 2}
2025-03-31 14:48:27,941 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:27,942 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 14:48:27,942 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:48:27,954 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 14:48:27,955 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:27,956 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:27,956 - sqlalchemy.engine.Engine - INFO - [cached since 759.8s ago] {'pk_1': 2}
2025-03-31 14:48:27,956 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:27,957 - sqlalchemy.engine.Engine - INFO - [cached since 1167s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 27, 955124), 'users_id': 2}
2025-03-31 14:48:27,957 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:27,957 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 14:48:28,277 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:48:28,278 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:28,278 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:28,279 - sqlalchemy.engine.Engine - INFO - [cached since 760.1s ago] {'pk_1': 3}
2025-03-31 14:48:28,279 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:28,279 - sqlalchemy.engine.Engine - INFO - [cached since 1168s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 28, 278137), 'users_id': 3}
2025-03-31 14:48:28,280 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:28,285 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:48:28,381 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:48:28,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:48:28,382 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:48:28,382 - sqlalchemy.engine.Engine - INFO - [cached since 760.2s ago] {'pk_1': 3}
2025-03-31 14:48:28,383 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:48:28,383 - sqlalchemy.engine.Engine - INFO - [cached since 1168s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 48, 28, 381162), 'users_id': 3}
2025-03-31 14:48:28,384 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:48:28,384 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:48:28,903 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:48:47,596 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:48:48,618 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:48:55,960 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:48:58,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:49:17,613 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:49:18,622 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:49:25,961 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:49:28,899 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:49:47,634 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:49:48,648 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:49:55,960 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:49:58,901 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:50:17,545 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:50:18,618 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:50:25,961 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:50:28,901 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:50:47,544 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:50:48,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:50:55,961 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:50:58,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:51:08,462 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 14:51:08,463 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:51:08,463 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:51:08,464 - sqlalchemy.engine.Engine - INFO - [cached since 920.3s ago] {'pk_1': 2}
2025-03-31 14:51:08,464 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:51:08,464 - sqlalchemy.engine.Engine - INFO - [cached since 1328s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 51, 8, 463930), 'users_id': 2}
2025-03-31 14:51:08,465 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:51:08,471 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 14:51:11,326 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 14:51:11,328 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:51:11,328 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:51:11,328 - sqlalchemy.engine.Engine - INFO - [cached since 923.2s ago] {'pk_1': 3}
2025-03-31 14:51:11,329 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:51:11,329 - sqlalchemy.engine.Engine - INFO - [cached since 1331s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 51, 11, 327456), 'users_id': 3}
2025-03-31 14:51:11,330 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:51:11,335 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 14:51:17,546 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:51:18,620 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:51:25,960 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:51:28,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:51:47,545 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:51:48,616 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:51:55,962 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:51:58,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:52:17,544 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:52:18,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:52:25,960 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:52:28,900 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:52:47,542 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:52:48,621 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:52:53,907 - INFO - Incoming request: {"timestamp": "2025-03-31T11:52:53.907219", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:52:53,907 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:52:53.907219", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:52:53,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:52:53,909 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:52:53,909 - sqlalchemy.engine.Engine - INFO - [cached since 1434s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'V7VPChnj8MEGcoJGOooVFZTwMKDsXvxs1rPiooDinws', 'param_1': 1}
2025-03-31 14:52:53,910 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:52:53,910 - sqlalchemy.engine.Engine - INFO - [cached since 1434s ago] {'refresh_token': 'so5cfyiSxwKMtz2LYrYyCCVnBW7WWsEnCBHQQI1Ve4c', 'user_devices_id': 29}
2025-03-31 14:52:53,911 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:52:53,916 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:52:53,916 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:52:54,002 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:52:54,004 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:52:54,004 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:52:54,004 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:52:54,004 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:52:54,004 - sqlalchemy.engine.Engine - INFO - [cached since 1433s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:52:54,005 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:52:54,006 - sqlalchemy.engine.Engine - INFO - [cached since 1433s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 52, 54, 5242), 'users_id': 2}
2025-03-31 14:52:54,006 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:52:54,006 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:52:58,903 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:52:59,256 - INFO - Incoming request: {"timestamp": "2025-03-31T11:52:59.256065", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:52:59,256 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:52:59.256065", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:52:59,258 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: cb7ef3f8-6c4c-44f4-8aa6-fd3634a4cef0
2025-03-31 14:52:59,258 - app.services.secure_channel_service - INFO - Creating channel with ID: cb7ef3f8-6c4c-44f4-8aa6-fd3634a4cef0
2025-03-31 14:52:59,259 - app.services.secure_channel_service - INFO - Channel cb7ef3f8-6c4c-44f4-8aa6-fd3634a4cef0 saved to Redis with TTL 1800 seconds
2025-03-31 14:52:59,259 - app.api.v1.endpoints.auth - INFO - Channel cb7ef3f8-6c4c-44f4-8aa6-fd3634a4cef0 initialized successfully
2025-03-31 14:52:59,259 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 14:52:59,259 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 14:52:59,333 - INFO - Incoming request: {"timestamp": "2025-03-31T11:52:59.333083", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:52:59,333 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:52:59.333083", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:52:59,334 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:52:59,335 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:52:59,335 - sqlalchemy.engine.Engine - INFO - [cached since 1439s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:52:59,336 - app.api.v1.endpoints.users - INFO - Search request received, channel: cb7ef3f8-6c4c-44f4-8aa6-fd3634a4cef0
2025-03-31 14:52:59,336 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743423773}
2025-03-31 14:52:59,337 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 14:52:59,337 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 14:52:59,337 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 14:52:59,337 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:52:59,338 - sqlalchemy.engine.Engine - INFO - [cached since 1033s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 14:52:59,338 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 14:52:59,339 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 14:52:59,339 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:52:59,340 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-31 14:52:59,340 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-31 14:53:01,890 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 14:53:01,891 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:01,892 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:01,892 - sqlalchemy.engine.Engine - INFO - [cached since 1034s ago] {'pk_1': 2}
2025-03-31 14:53:01,892 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:01,892 - sqlalchemy.engine.Engine - INFO - [cached since 1441s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 1, 891969), 'users_id': 2}
2025-03-31 14:53:01,893 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:01,894 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 14:53:02,989 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 14:53:02,990 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:02,990 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:02,991 - sqlalchemy.engine.Engine - INFO - [cached since 1035s ago] {'pk_1': 3}
2025-03-31 14:53:02,991 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:02,991 - sqlalchemy.engine.Engine - INFO - [cached since 1442s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 2, 990730), 'users_id': 3}
2025-03-31 14:53:02,992 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:02,997 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 14:53:03,070 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 14:53:03,071 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:03,072 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:03,072 - sqlalchemy.engine.Engine - INFO - [cached since 1035s ago] {'pk_1': 2}
2025-03-31 14:53:03,073 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:03,073 - sqlalchemy.engine.Engine - INFO - [cached since 1443s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 3, 71751), 'users_id': 2}
2025-03-31 14:53:03,073 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:03,074 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 14:53:03,074 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 14:53:03,075 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:03,075 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:03,075 - sqlalchemy.engine.Engine - INFO - [cached since 1035s ago] {'pk_1': 2}
2025-03-31 14:53:03,076 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:03,076 - sqlalchemy.engine.Engine - INFO - [cached since 1443s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 3, 75751), 'users_id': 2}
2025-03-31 14:53:03,077 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:03,077 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 14:53:04,091 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 14:53:04,092 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:04,093 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:04,093 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'pk_1': 3}
2025-03-31 14:53:04,093 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:04,094 - sqlalchemy.engine.Engine - INFO - [cached since 1444s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 4, 92007), 'users_id': 3}
2025-03-31 14:53:04,094 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:04,095 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 14:53:04,095 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 14:53:04,096 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:04,096 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:04,096 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'pk_1': 3}
2025-03-31 14:53:04,097 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:04,097 - sqlalchemy.engine.Engine - INFO - [cached since 1444s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 4, 95008), 'users_id': 3}
2025-03-31 14:53:04,097 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:04,097 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 14:53:04,158 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 14:53:04,159 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:04,159 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:04,159 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'pk_1': 2}
2025-03-31 14:53:04,160 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:04,160 - sqlalchemy.engine.Engine - INFO - [cached since 1444s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 4, 159022), 'users_id': 2}
2025-03-31 14:53:04,161 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:04,161 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 14:53:04,162 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 14:53:04,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:04,163 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:04,163 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'pk_1': 2}
2025-03-31 14:53:04,163 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:04,163 - sqlalchemy.engine.Engine - INFO - [cached since 1444s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 4, 162023), 'users_id': 2}
2025-03-31 14:53:04,164 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:04,164 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 14:53:04,172 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 14:53:04,173 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:04,174 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:04,174 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'pk_1': 2}
2025-03-31 14:53:04,174 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:04,175 - sqlalchemy.engine.Engine - INFO - [cached since 1444s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 4, 173025), 'users_id': 2}
2025-03-31 14:53:04,175 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:04,175 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 14:53:04,176 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 14:53:04,176 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:53:04,177 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:53:04,177 - sqlalchemy.engine.Engine - INFO - [cached since 1036s ago] {'pk_1': 2}
2025-03-31 14:53:04,177 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:53:04,177 - sqlalchemy.engine.Engine - INFO - [cached since 1444s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 53, 4, 176026), 'users_id': 2}
2025-03-31 14:53:04,178 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:53:04,178 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 14:53:17,548 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:53:18,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:53:23,998 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:53:28,903 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:53:47,539 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:53:48,620 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:53:53,997 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:53:58,924 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:54:17,539 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:54:18,617 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:54:23,997 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:54:28,912 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:54:47,543 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:54:48,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:54:53,997 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:54:58,907 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:55:03,184 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:03.184693", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:03,184 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:03.184693", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:03,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:03,186 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:03,187 - sqlalchemy.engine.Engine - INFO - [cached since 1563s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'so5cfyiSxwKMtz2LYrYyCCVnBW7WWsEnCBHQQI1Ve4c', 'param_1': 1}
2025-03-31 14:55:03,187 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:55:03,188 - sqlalchemy.engine.Engine - INFO - [cached since 1563s ago] {'refresh_token': 'Q9wBvrofwt05ORUl-L-OFqH3kgrpzsZQ1Tg8yj35PLc', 'user_devices_id': 29}
2025-03-31 14:55:03,188 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:03,189 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 14:55:03,189 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 14:55:03,222 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:55:03,223 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:03,223 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:55:03,224 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:03,224 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:03,224 - sqlalchemy.engine.Engine - INFO - [cached since 1563s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:55:03,225 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:03,225 - sqlalchemy.engine.Engine - INFO - [cached since 1563s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 3, 225703), 'users_id': 2}
2025-03-31 14:55:03,226 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:03,226 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:55:17,544 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:55:18,617 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:55:23,085 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:55:23,086 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:23,336 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:55:23,337 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:24,883 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:55:24,884 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:24,884 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:55:24,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:24,885 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:24,885 - sqlalchemy.engine.Engine - INFO - [cached since 1584s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:55:24,886 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:24,886 - sqlalchemy.engine.Engine - INFO - [cached since 1584s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 24, 886039), 'users_id': 3}
2025-03-31 14:55:24,887 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:24,887 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:55:25,744 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:25.744957", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:55:25,744 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:25.744957", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:55:25,744 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 14:55:25,744 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 14:55:26,019 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:26.019387", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:55:26,019 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:26.019387", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:55:26,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:26,021 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:26,021 - sqlalchemy.engine.Engine - INFO - [cached since 1586s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'FcnKmPUhrxrkzBkRm-VuTHj2CJ8p9kLaUpStDLsYvuQ', 'param_1': 1}
2025-03-31 14:55:26,022 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:55:26,022 - sqlalchemy.engine.Engine - INFO - [cached since 1586s ago] {'refresh_token': '54-XW5YyuQzbMhtQGHHrhj5B5dWU8GFMIQTzemZVuTI', 'user_devices_id': 30}
2025-03-31 14:55:26,023 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:26,028 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:55:26,028 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 14:55:26,177 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:55:26,178 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:26,178 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:55:26,179 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:26,179 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:26,179 - sqlalchemy.engine.Engine - INFO - [cached since 1586s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:55:26,180 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:26,180 - sqlalchemy.engine.Engine - INFO - [cached since 1586s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 26, 180424), 'users_id': 3}
2025-03-31 14:55:26,181 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:26,181 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:55:26,701 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:26.701680", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:55:26,701 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:26.701680", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:55:26,702 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 164c8fc3-ff21-463d-bf8c-8c1fc0d3f8f9
2025-03-31 14:55:26,702 - app.services.secure_channel_service - INFO - Creating channel with ID: 164c8fc3-ff21-463d-bf8c-8c1fc0d3f8f9
2025-03-31 14:55:26,703 - app.services.secure_channel_service - INFO - Channel 164c8fc3-ff21-463d-bf8c-8c1fc0d3f8f9 saved to Redis with TTL 1800 seconds
2025-03-31 14:55:26,703 - app.api.v1.endpoints.auth - INFO - Channel 164c8fc3-ff21-463d-bf8c-8c1fc0d3f8f9 initialized successfully
2025-03-31 14:55:26,704 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 14:55:26,704 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 14:55:28,906 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:55:33,214 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:55:35,725 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,726 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:35,995 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,995 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,996 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,996 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,997 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,997 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:55:35,999 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:36,000 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:36,000 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:36,000 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:36,000 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:36,001 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:37,281 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:55:37,282 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:37,282 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:55:37,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:37,283 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:37,283 - sqlalchemy.engine.Engine - INFO - [cached since 1597s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:55:37,284 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:37,284 - sqlalchemy.engine.Engine - INFO - [cached since 1597s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 37, 284728), 'users_id': 2}
2025-03-31 14:55:37,285 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:37,285 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:55:38,565 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:38.565787", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:38,565 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:38.565787", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:38,565 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 14:55:38,565 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 14:55:39,018 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:39.018583", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:39,018 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:39.018583", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:39,020 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:39,020 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:39,020 - sqlalchemy.engine.Engine - INFO - [cached since 1599s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'Q9wBvrofwt05ORUl-L-OFqH3kgrpzsZQ1Tg8yj35PLc', 'param_1': 1}
2025-03-31 14:55:39,021 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:55:39,021 - sqlalchemy.engine.Engine - INFO - [cached since 1599s ago] {'refresh_token': 'wiLBBsjyMU2r8zmZ5UNz3UKnXNBz0M75p7EEByR6r_Q', 'user_devices_id': 29}
2025-03-31 14:55:39,022 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:39,023 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:55:39,023 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:55:39,035 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:39.035586", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:39,035 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:39.035586", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:39,037 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:39,037 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:39,037 - sqlalchemy.engine.Engine - INFO - [cached since 1599s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'Q9wBvrofwt05ORUl-L-OFqH3kgrpzsZQ1Tg8yj35PLc', 'param_1': 1}
2025-03-31 14:55:39,038 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:55:39,038 - INFO - Response sent: {"status_code": 401, "processing_time_ms": 3.0010000000000003}
2025-03-31 14:55:39,038 - chat_server - INFO - Response sent: {"status_code": 401, "processing_time_ms": 3.0010000000000003}
2025-03-31 14:55:39,094 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:55:39,095 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:55:39,095 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:55:39,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:39,096 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:55:39,096 - sqlalchemy.engine.Engine - INFO - [cached since 1599s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:55:39,097 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:39,097 - sqlalchemy.engine.Engine - INFO - [cached since 1599s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 39, 97600), 'users_id': 2}
2025-03-31 14:55:39,098 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:39,098 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:55:39,576 - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:39.575671", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:39,576 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:55:39.575671", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:55:39,582 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 2b666a2b-4bca-4abc-ba9b-718a50e36d23
2025-03-31 14:55:39,582 - app.services.secure_channel_service - INFO - Creating channel with ID: 2b666a2b-4bca-4abc-ba9b-718a50e36d23
2025-03-31 14:55:39,583 - app.services.secure_channel_service - INFO - Channel 2b666a2b-4bca-4abc-ba9b-718a50e36d23 saved to Redis with TTL 1800 seconds
2025-03-31 14:55:39,583 - app.api.v1.endpoints.auth - INFO - Channel 2b666a2b-4bca-4abc-ba9b-718a50e36d23 initialized successfully
2025-03-31 14:55:39,583 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 14:55:39,583 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 14:55:43,442 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 14:55:43,443 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:43,443 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:55:43,443 - sqlalchemy.engine.Engine - INFO - [cached since 1195s ago] {'pk_1': 3}
2025-03-31 14:55:43,444 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:43,444 - sqlalchemy.engine.Engine - INFO - [cached since 1603s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 43, 443089), 'users_id': 3}
2025-03-31 14:55:43,445 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:43,445 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 14:55:46,380 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 14:55:46,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:55:46,382 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:55:46,382 - sqlalchemy.engine.Engine - INFO - [cached since 1198s ago] {'pk_1': 2}
2025-03-31 14:55:46,382 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:55:46,382 - sqlalchemy.engine.Engine - INFO - [cached since 1606s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 55, 46, 381039), 'users_id': 2}
2025-03-31 14:55:46,383 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:55:46,388 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 14:55:54,646 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:55:56,166 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:56:07,221 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:56:09,079 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:56:24,644 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:56:26,174 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:56:37,211 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:56:39,078 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:56:54,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:56:56,184 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:57:07,208 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:57:09,080 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:57:24,683 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:57:26,235 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:57:37,218 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:57:39,079 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:57:49,490 - INFO - Incoming request: {"timestamp": "2025-03-31T11:57:49.490544", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:57:49,490 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:57:49.490544", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:57:49,492 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:57:49,492 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:57:49,492 - sqlalchemy.engine.Engine - INFO - [cached since 1729s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'wiLBBsjyMU2r8zmZ5UNz3UKnXNBz0M75p7EEByR6r_Q', 'param_1': 1}
2025-03-31 14:57:49,493 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:57:49,493 - sqlalchemy.engine.Engine - INFO - [cached since 1729s ago] {'refresh_token': 'edUzMBeixuHCw9uacFDEMXHEejvhNHk4WKhuqppqHXw', 'user_devices_id': 29}
2025-03-31 14:57:49,493 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:57:49,494 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.002000000000001}
2025-03-31 14:57:49,494 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.002000000000001}
2025-03-31 14:57:49,535 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:57:49,536 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:57:49,536 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:57:49,536 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:57:49,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:57:49,537 - sqlalchemy.engine.Engine - INFO - [cached since 1729s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:57:49,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:57:49,538 - sqlalchemy.engine.Engine - INFO - [cached since 1729s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 57, 49, 537555), 'users_id': 2}
2025-03-31 14:57:49,538 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:57:49,538 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:57:54,703 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:57:56,223 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:58:07,208 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:58:19,521 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:58:24,620 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:58:26,243 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:58:37,208 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:58:49,521 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:58:54,619 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:58:56,262 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:59:07,208 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:59:18,196 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:59:18,198 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:18,466 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:59:18,466 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 14:59:18,467 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:18,468 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:19,730 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:59:19,731 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:19,731 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:59:19,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:19,731 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:19,731 - sqlalchemy.engine.Engine - INFO - [cached since 1819s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:59:19,732 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:19,733 - sqlalchemy.engine.Engine - INFO - [cached since 1819s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 19, 732679), 'users_id': 2}
2025-03-31 14:59:19,733 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:19,738 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:59:20,945 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:20.945843", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:59:20,945 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:20.945843", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:59:20,946 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 14:59:20,946 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-03-31 14:59:21,342 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:21.342426", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:59:21,342 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:21.342426", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:59:21,344 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:21,344 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:21,344 - sqlalchemy.engine.Engine - INFO - [cached since 1821s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'edUzMBeixuHCw9uacFDEMXHEejvhNHk4WKhuqppqHXw', 'param_1': 1}
2025-03-31 14:59:21,345 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:59:21,345 - sqlalchemy.engine.Engine - INFO - [cached since 1821s ago] {'refresh_token': 'sILRYKztoBjdVAOPcLcgC9lawCCuHu4_Wyb2D--SDGA', 'user_devices_id': 29}
2025-03-31 14:59:21,346 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:21,351 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.998000000000001}
2025-03-31 14:59:21,351 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.998000000000001}
2025-03-31 14:59:21,418 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 14:59:21,419 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:21,419 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 14:59:21,420 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:21,420 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:21,420 - sqlalchemy.engine.Engine - INFO - [cached since 1821s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 14:59:21,421 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:21,421 - sqlalchemy.engine.Engine - INFO - [cached since 1821s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 21, 421685), 'users_id': 2}
2025-03-31 14:59:21,422 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:21,422 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 14:59:21,990 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:21.989519", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:59:21,990 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:21.989519", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 14:59:21,991 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 0c09ba03-b639-4e27-b249-a13dfd08e378
2025-03-31 14:59:21,991 - app.services.secure_channel_service - INFO - Creating channel with ID: 0c09ba03-b639-4e27-b249-a13dfd08e378
2025-03-31 14:59:21,992 - app.services.secure_channel_service - INFO - Channel 0c09ba03-b639-4e27-b249-a13dfd08e378 saved to Redis with TTL 1800 seconds
2025-03-31 14:59:21,992 - app.api.v1.endpoints.auth - INFO - Channel 0c09ba03-b639-4e27-b249-a13dfd08e378 initialized successfully
2025-03-31 14:59:21,992 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 14:59:21,992 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 14:59:24,621 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:59:26,283 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 14:59:27,424 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:59:27,426 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:27,663 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 14:59:27,665 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:28,943 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:59:28,944 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:28,944 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:59:28,945 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:28,945 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:28,945 - sqlalchemy.engine.Engine - INFO - [cached since 1828s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:59:28,946 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:28,946 - sqlalchemy.engine.Engine - INFO - [cached since 1828s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 28, 946988), 'users_id': 3}
2025-03-31 14:59:28,947 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:28,947 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:59:30,183 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:30.183700", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:30,183 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:30.183700", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:30,184 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-31 14:59:30,184 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.9990000000000001}
2025-03-31 14:59:30,251 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:30.251714", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:30,251 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:30.251714", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:30,253 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:30,253 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:30,253 - sqlalchemy.engine.Engine - INFO - [cached since 1830s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': '54-XW5YyuQzbMhtQGHHrhj5B5dWU8GFMIQTzemZVuTI', 'param_1': 1}
2025-03-31 14:59:30,254 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:59:30,254 - sqlalchemy.engine.Engine - INFO - [cached since 1830s ago] {'refresh_token': 'FOFS1ZWKLUk_U8DUXtXJ8kAeCiNe9iMi28h4PJeyOpU', 'user_devices_id': 30}
2025-03-31 14:59:30,255 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:30,255 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.056}
2025-03-31 14:59:30,255 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.056}
2025-03-31 14:59:30,336 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:59:30,337 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:30,337 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:59:30,337 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:30,337 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:30,337 - sqlalchemy.engine.Engine - INFO - [cached since 1830s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:59:30,338 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:30,338 - sqlalchemy.engine.Engine - INFO - [cached since 1830s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 30, 338806), 'users_id': 3}
2025-03-31 14:59:30,339 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:30,339 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:59:31,035 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:31.035810", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:31,035 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:31.035810", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:31,036 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c62e54e8-bd0a-4c3b-a8ca-58595f5cabb0
2025-03-31 14:59:31,036 - app.services.secure_channel_service - INFO - Creating channel with ID: c62e54e8-bd0a-4c3b-a8ca-58595f5cabb0
2025-03-31 14:59:31,037 - app.services.secure_channel_service - INFO - Channel c62e54e8-bd0a-4c3b-a8ca-58595f5cabb0 saved to Redis with TTL 1800 seconds
2025-03-31 14:59:31,037 - app.api.v1.endpoints.auth - INFO - Channel c62e54e8-bd0a-4c3b-a8ca-58595f5cabb0 initialized successfully
2025-03-31 14:59:31,037 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 14:59:31,037 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 14:59:32,581 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:32.580030", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:32,581 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:32.580030", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:32,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:32,582 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:32,583 - sqlalchemy.engine.Engine - INFO - [cached since 1832s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'FOFS1ZWKLUk_U8DUXtXJ8kAeCiNe9iMi28h4PJeyOpU', 'param_1': 1}
2025-03-31 14:59:32,584 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 14:59:32,584 - sqlalchemy.engine.Engine - INFO - [cached since 1832s ago] {'refresh_token': 'aC8mUb88-muaP7yKFAQN6pYCrA8rlWstnsAabcRbCT0', 'user_devices_id': 30}
2025-03-31 14:59:32,584 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:32,585 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:59:32,585 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-03-31 14:59:32,631 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 14:59:32,632 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 14:59:32,632 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 14:59:32,632 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:32,632 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:32,633 - sqlalchemy.engine.Engine - INFO - [cached since 1832s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:59:32,633 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:32,634 - sqlalchemy.engine.Engine - INFO - [cached since 1832s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 32, 633042), 'users_id': 3}
2025-03-31 14:59:32,634 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:32,634 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 14:59:34,859 - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:34.859286", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:34,859 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T11:59:34.859286", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 14:59:34,861 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:34,861 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 14:59:34,861 - sqlalchemy.engine.Engine - INFO - [cached since 1834s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 14:59:34,862 - app.api.v1.endpoints.users - INFO - Search request received, channel: c62e54e8-bd0a-4c3b-a8ca-58595f5cabb0
2025-03-31 14:59:34,862 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743424172}
2025-03-31 14:59:34,863 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-03-31 14:59:34,863 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-03-31 14:59:34,863 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-03-31 14:59:34,864 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 14:59:34,864 - sqlalchemy.engine.Engine - INFO - [cached since 1429s ago] {'id_1': '3', 'username_1': '%yu%', 'email_1': '%yu%', 'param_1': 10}
2025-03-31 14:59:34,864 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 14:59:34,865 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 14:59:34,866 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 14:59:34,866 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-31 14:59:34,866 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-31 14:59:36,246 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-31 14:59:36,247 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:36,247 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:36,248 - sqlalchemy.engine.Engine - INFO - [cached since 1428s ago] {'pk_1': 3}
2025-03-31 14:59:36,248 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:36,248 - sqlalchemy.engine.Engine - INFO - [cached since 1836s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 36, 247698), 'users_id': 3}
2025-03-31 14:59:36,249 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:36,254 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-31 14:59:37,621 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 14:59:37,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:37,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:37,622 - sqlalchemy.engine.Engine - INFO - [cached since 1429s ago] {'pk_1': 2}
2025-03-31 14:59:37,623 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:37,623 - sqlalchemy.engine.Engine - INFO - [cached since 1837s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 37, 621175), 'users_id': 2}
2025-03-31 14:59:37,624 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:37,629 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 14:59:37,646 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 14:59:37,647 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:37,648 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:37,648 - sqlalchemy.engine.Engine - INFO - [cached since 1429s ago] {'pk_1': 2}
2025-03-31 14:59:37,648 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:37,649 - sqlalchemy.engine.Engine - INFO - [cached since 1837s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 37, 647069), 'users_id': 2}
2025-03-31 14:59:37,649 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:37,650 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 14:59:37,897 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:59:37,898 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:37,899 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:37,899 - sqlalchemy.engine.Engine - INFO - [cached since 1430s ago] {'pk_1': 3}
2025-03-31 14:59:37,900 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:37,900 - sqlalchemy.engine.Engine - INFO - [cached since 1837s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 37, 898255), 'users_id': 3}
2025-03-31 14:59:37,900 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:37,905 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:59:37,932 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:59:37,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:37,934 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:37,934 - sqlalchemy.engine.Engine - INFO - [cached since 1430s ago] {'pk_1': 3}
2025-03-31 14:59:37,935 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:37,935 - sqlalchemy.engine.Engine - INFO - [cached since 1837s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 37, 933347), 'users_id': 3}
2025-03-31 14:59:37,936 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:37,936 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:59:37,957 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:59:37,958 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:37,959 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:37,959 - sqlalchemy.engine.Engine - INFO - [cached since 1430s ago] {'pk_1': 3}
2025-03-31 14:59:37,959 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:37,959 - sqlalchemy.engine.Engine - INFO - [cached since 1837s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 37, 958352), 'users_id': 3}
2025-03-31 14:59:37,960 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:37,960 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:59:38,065 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 14:59:38,066 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 14:59:38,067 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 14:59:38,067 - sqlalchemy.engine.Engine - INFO - [cached since 1430s ago] {'pk_1': 3}
2025-03-31 14:59:38,068 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 14:59:38,068 - sqlalchemy.engine.Engine - INFO - [cached since 1838s ago] {'last_seen': datetime.datetime(2025, 3, 31, 11, 59, 38, 66376), 'users_id': 3}
2025-03-31 14:59:38,068 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 14:59:38,069 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 14:59:49,672 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:59:51,410 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 14:59:58,839 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:00:02,627 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:00:19,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:00:21,408 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:00:28,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:00:32,631 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:00:49,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:00:51,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:00:58,827 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:01:02,632 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:01:19,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:01:21,408 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:01:28,814 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:01:32,635 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:01:49,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:01:51,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:01:58,833 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:02:02,639 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:02:19,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:02:21,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:02:28,814 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:02:32,633 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:02:49,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:02:51,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:02:58,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:03:02,633 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:03:19,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:03:21,408 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:03:28,837 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:03:32,634 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:03:49,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:03:51,408 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:03:58,836 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:04:02,631 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:04:19,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:04:21,408 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:04:28,847 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:04:32,648 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:04:49,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:04:51,408 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:04:58,871 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:05:02,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:05:19,660 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:05:21,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:05:28,887 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:05:32,689 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:05:49,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:05:51,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:05:58,908 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:06:02,706 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:06:19,663 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:06:21,409 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:06:28,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:06:32,626 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:06:49,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:06:51,410 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:06:58,814 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:07:02,641 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:07:19,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:07:21,411 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:07:28,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:07:32,635 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:07:49,663 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:07:51,414 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:07:58,805 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:08:02,634 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:08:19,663 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:08:21,412 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:08:28,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:08:32,631 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:08:41,530 - INFO - Incoming request: {"timestamp": "2025-03-31T12:08:41.530142", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:08:41,530 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:08:41.530142", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:08:41,532 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:08:41,532 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:08:41,532 - sqlalchemy.engine.Engine - INFO - [cached since 2381s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'sILRYKztoBjdVAOPcLcgC9lawCCuHu4_Wyb2D--SDGA', 'param_1': 1}
2025-03-31 15:08:41,534 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:08:41,534 - sqlalchemy.engine.Engine - INFO - [cached since 2381s ago] {'refresh_token': 'GtOHUpZc9wG8ESZ_N122Azs1FE9moU3KfMSj_wg7aqo', 'user_devices_id': 29}
2025-03-31 15:08:41,534 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:08:41,544 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.004000000000001}
2025-03-31 15:08:41,544 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 14.004000000000001}
2025-03-31 15:08:41,611 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:08:41,613 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:08:41,613 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:08:41,613 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:08:41,613 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:08:41,613 - sqlalchemy.engine.Engine - INFO - [cached since 2381s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:08:41,614 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:08:41,614 - sqlalchemy.engine.Engine - INFO - [cached since 2381s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 8, 41, 614161), 'users_id': 2}
2025-03-31 15:08:41,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:08:41,615 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:08:42,081 - INFO - Incoming request: {"timestamp": "2025-03-31T12:08:42.081339", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:08:42,081 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:08:42.081339", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:08:42,083 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:08:42,083 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:08:42,083 - sqlalchemy.engine.Engine - INFO - [cached since 2382s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'GtOHUpZc9wG8ESZ_N122Azs1FE9moU3KfMSj_wg7aqo', 'param_1': 1}
2025-03-31 15:08:42,084 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:08:42,085 - sqlalchemy.engine.Engine - INFO - [cached since 2382s ago] {'refresh_token': 'UZeuhSurnBycULF-u5-vqZfGVG_kG16Y6pGrjiMapME', 'user_devices_id': 29}
2025-03-31 15:08:42,085 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:08:42,090 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 15:08:42,090 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 15:08:42,123 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:08:42,123 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:08:42,124 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:08:42,124 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:08:42,124 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:08:42,124 - sqlalchemy.engine.Engine - INFO - [cached since 2382s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:08:42,125 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:08:42,125 - sqlalchemy.engine.Engine - INFO - [cached since 2382s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 8, 42, 125364), 'users_id': 2}
2025-03-31 15:08:42,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:08:42,126 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:08:49,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:08:51,113 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 15:08:51,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:08:51,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:08:51,114 - sqlalchemy.engine.Engine - INFO - [cached since 1983s ago] {'pk_1': 2}
2025-03-31 15:08:51,115 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:08:51,115 - sqlalchemy.engine.Engine - INFO - [cached since 2391s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 8, 51, 114633), 'users_id': 2}
2025-03-31 15:08:51,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:08:51,121 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 15:08:53,735 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 15:08:53,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:08:53,737 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:08:53,737 - sqlalchemy.engine.Engine - INFO - [cached since 1986s ago] {'pk_1': 3}
2025-03-31 15:08:53,737 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:08:53,737 - sqlalchemy.engine.Engine - INFO - [cached since 2393s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 8, 53, 736869), 'users_id': 3}
2025-03-31 15:08:53,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:08:53,743 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 15:08:58,810 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:09:02,634 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:09:12,118 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:09:14,238 - INFO - Incoming request: {"timestamp": "2025-03-31T12:09:14.238837", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:09:14,238 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:09:14.238837", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:09:14,239 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: fc4f235d-5941-4c8f-9533-c165552c555b
2025-03-31 15:09:14,239 - app.services.secure_channel_service - INFO - Creating channel with ID: fc4f235d-5941-4c8f-9533-c165552c555b
2025-03-31 15:09:14,240 - app.services.secure_channel_service - INFO - Channel fc4f235d-5941-4c8f-9533-c165552c555b saved to Redis with TTL 1800 seconds
2025-03-31 15:09:14,240 - app.api.v1.endpoints.auth - INFO - Channel fc4f235d-5941-4c8f-9533-c165552c555b initialized successfully
2025-03-31 15:09:14,240 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 15:09:14,240 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-03-31 15:09:14,290 - INFO - Incoming request: {"timestamp": "2025-03-31T12:09:14.290849", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:09:14,290 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:09:14.290849", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:09:14,292 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:14,292 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:09:14,292 - sqlalchemy.engine.Engine - INFO - [cached since 2414s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 15:09:14,293 - app.api.v1.endpoints.users - INFO - Search request received, channel: fc4f235d-5941-4c8f-9533-c165552c555b
2025-03-31 15:09:14,294 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743424172}
2025-03-31 15:09:14,295 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"y","limit":10}
2025-03-31 15:09:14,295 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'y', 'limit': 10}
2025-03-31 15:09:14,295 - app.api.v1.endpoints.users - INFO - Searching users with query 'y', excluding user 3
2025-03-31 15:09:14,295 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 15:09:14,295 - sqlalchemy.engine.Engine - INFO - [cached since 2008s ago] {'id_1': '3', 'username_1': '%y%', 'email_1': '%y%', 'param_1': 10}
2025-03-31 15:09:14,296 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 15:09:14,296 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 15:09:14,297 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:09:14,297 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-31 15:09:14,297 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-03-31 15:09:16,374 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-03-31 15:09:16,375 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:16,376 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:16,376 - sqlalchemy.engine.Engine - INFO - [cached since 2008s ago] {'pk_1': 3}
2025-03-31 15:09:16,377 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:16,377 - sqlalchemy.engine.Engine - INFO - [cached since 2416s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 16, 375672), 'users_id': 3}
2025-03-31 15:09:16,377 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:16,382 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-03-31 15:09:18,046 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 15:09:18,047 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:18,048 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:18,048 - sqlalchemy.engine.Engine - INFO - [cached since 2010s ago] {'pk_1': 2}
2025-03-31 15:09:18,049 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:18,049 - sqlalchemy.engine.Engine - INFO - [cached since 2418s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 18, 47136), 'users_id': 2}
2025-03-31 15:09:18,049 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:18,054 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 15:09:18,054 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-03-31 15:09:18,055 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:18,056 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:18,056 - sqlalchemy.engine.Engine - INFO - [cached since 2010s ago] {'pk_1': 2}
2025-03-31 15:09:18,056 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:18,057 - sqlalchemy.engine.Engine - INFO - [cached since 2418s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 18, 55138), 'users_id': 2}
2025-03-31 15:09:18,057 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:18,057 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-03-31 15:09:18,204 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 15:09:18,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:18,205 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:18,206 - sqlalchemy.engine.Engine - INFO - [cached since 2010s ago] {'pk_1': 3}
2025-03-31 15:09:18,206 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:18,206 - sqlalchemy.engine.Engine - INFO - [cached since 2418s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 18, 205321), 'users_id': 3}
2025-03-31 15:09:18,207 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:18,207 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 15:09:18,239 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 15:09:18,240 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:18,240 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:18,240 - sqlalchemy.engine.Engine - INFO - [cached since 2010s ago] {'pk_1': 3}
2025-03-31 15:09:18,241 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:18,241 - sqlalchemy.engine.Engine - INFO - [cached since 2418s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 18, 239329), 'users_id': 3}
2025-03-31 15:09:18,242 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:18,242 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 15:09:18,280 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 15:09:18,281 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:18,281 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:18,281 - sqlalchemy.engine.Engine - INFO - [cached since 2010s ago] {'pk_1': 3}
2025-03-31 15:09:18,282 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:18,282 - sqlalchemy.engine.Engine - INFO - [cached since 2418s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 18, 280338), 'users_id': 3}
2025-03-31 15:09:18,283 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:18,283 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 15:09:18,300 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-03-31 15:09:18,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:09:18,301 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:09:18,302 - sqlalchemy.engine.Engine - INFO - [cached since 2010s ago] {'pk_1': 3}
2025-03-31 15:09:18,302 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:09:18,302 - sqlalchemy.engine.Engine - INFO - [cached since 2418s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 9, 18, 301343), 'users_id': 3}
2025-03-31 15:09:18,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:09:18,304 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-03-31 15:09:19,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:09:28,807 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:09:32,633 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:09:42,119 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:09:49,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:09:58,804 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:10:02,634 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:10:12,119 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:10:19,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:10:28,805 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:10:32,633 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:10:42,119 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:10:49,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:10:58,809 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:11:02,634 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:11:12,119 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:11:19,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:11:28,812 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:11:32,633 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:11:42,122 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:11:49,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:11:58,818 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:12:02,635 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:12:12,119 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:12:19,661 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:12:28,817 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:12:32,626 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:12:42,121 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:12:49,676 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:12:58,822 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:13:02,639 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:13:12,131 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:13:19,664 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:13:28,842 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:13:32,644 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:13:42,130 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:13:49,671 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:13:58,864 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:14:02,664 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:14:12,124 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:14:19,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:14:21,456 - INFO - Incoming request: {"timestamp": "2025-03-31T12:14:21.456564", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:14:21,456 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:14:21.456564", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:14:21,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:14:21,459 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:14:21,459 - sqlalchemy.engine.Engine - INFO - [cached since 2721s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'UZeuhSurnBycULF-u5-vqZfGVG_kG16Y6pGrjiMapME', 'param_1': 1}
2025-03-31 15:14:21,460 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:14:21,460 - sqlalchemy.engine.Engine - INFO - [cached since 2721s ago] {'refresh_token': 'xULAKeRXuOM2zjvC1PyPoFSKvoMtHTS2OPWXZ79ikIc', 'user_devices_id': 29}
2025-03-31 15:14:21,461 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:14:21,462 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-31 15:14:21,462 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.002000000000001}
2025-03-31 15:14:21,522 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:14:21,523 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:14:21,523 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:14:21,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:14:21,523 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:14:21,524 - sqlalchemy.engine.Engine - INFO - [cached since 2721s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:14:21,524 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:14:21,524 - sqlalchemy.engine.Engine - INFO - [cached since 2721s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 14, 21, 524579), 'users_id': 2}
2025-03-31 15:14:21,525 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:14:21,526 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:14:28,885 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:14:30,422 - INFO - Incoming request: {"timestamp": "2025-03-31T12:14:30.422911", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:14:30,422 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:14:30.422911", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:14:30,424 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:14:30,424 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:14:30,424 - sqlalchemy.engine.Engine - INFO - [cached since 2730s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'aC8mUb88-muaP7yKFAQN6pYCrA8rlWstnsAabcRbCT0', 'param_1': 1}
2025-03-31 15:14:30,425 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:14:30,425 - sqlalchemy.engine.Engine - INFO - [cached since 2730s ago] {'refresh_token': 'O6oBN57GrK0A10Pd_6YT78zfefWWcN-W90thNv7isG0', 'user_devices_id': 30}
2025-03-31 15:14:30,426 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:14:30,431 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.003}
2025-03-31 15:14:30,431 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.003}
2025-03-31 15:14:30,494 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 15:14:30,495 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:14:30,495 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 15:14:30,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:14:30,496 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:14:30,496 - sqlalchemy.engine.Engine - INFO - [cached since 2730s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 15:14:30,497 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:14:30,497 - sqlalchemy.engine.Engine - INFO - [cached since 2730s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 14, 30, 496928), 'users_id': 3}
2025-03-31 15:14:30,497 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:14:30,498 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 15:14:49,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:14:51,522 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:14:58,902 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:15:00,501 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:15:19,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:15:21,519 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:15:28,819 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:15:30,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:15:36,357 - INFO - Incoming request: {"timestamp": "2025-03-31T12:15:36.356435", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:15:36,357 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:15:36.356435", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:15:36,368 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:15:36,369 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:15:36,369 - sqlalchemy.engine.Engine - INFO - [cached since 2796s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'xULAKeRXuOM2zjvC1PyPoFSKvoMtHTS2OPWXZ79ikIc', 'param_1': 1}
2025-03-31 15:15:36,370 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:15:36,370 - sqlalchemy.engine.Engine - INFO - [cached since 2796s ago] {'refresh_token': 'qGMWtgU_cnWhb7zP_mbHNCpnOKP1uejadNO9kj5i9i4', 'user_devices_id': 29}
2025-03-31 15:15:36,370 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:15:36,375 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 19.005000000000003}
2025-03-31 15:15:36,375 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 19.005000000000003}
2025-03-31 15:15:36,408 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:15:36,409 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:15:36,409 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:15:36,410 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:15:36,410 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:15:36,410 - sqlalchemy.engine.Engine - INFO - [cached since 2796s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:15:36,411 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:15:36,411 - sqlalchemy.engine.Engine - INFO - [cached since 2796s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 15, 36, 411450), 'users_id': 2}
2025-03-31 15:15:36,412 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:15:36,412 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:15:39,282 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 15:15:39,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:15:39,284 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:15:39,285 - sqlalchemy.engine.Engine - INFO - [cached since 2391s ago] {'pk_1': 2}
2025-03-31 15:15:39,285 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:15:39,285 - sqlalchemy.engine.Engine - INFO - [cached since 2799s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 15, 39, 282812), 'users_id': 2}
2025-03-31 15:15:39,286 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:15:39,287 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 15:15:43,129 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 15:15:43,130 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:15:43,131 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:15:43,131 - sqlalchemy.engine.Engine - INFO - [cached since 2395s ago] {'pk_1': 3}
2025-03-31 15:15:43,132 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:15:43,132 - sqlalchemy.engine.Engine - INFO - [cached since 2803s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 15, 43, 130244), 'users_id': 3}
2025-03-31 15:15:43,132 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:15:43,137 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 15:15:49,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:15:58,807 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:16:00,493 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:16:06,402 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:16:19,663 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:16:28,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:16:30,486 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:16:36,401 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:16:49,662 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:16:58,814 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:17:00,502 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:17:06,402 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:17:19,663 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:17:28,814 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:17:30,525 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:17:36,402 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:17:49,669 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:17:58,805 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:18:00,545 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:18:06,403 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:18:19,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:18:28,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:18:30,561 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:18:36,405 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:18:49,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:18:58,805 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:19:00,581 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:19:06,405 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:19:19,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:19:28,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:19:30,500 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:19:36,406 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:19:49,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:19:58,804 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:20:00,494 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:20:06,404 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:20:19,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:20:28,840 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:20:30,500 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:20:36,405 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:20:49,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:20:58,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:21:00,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:21:06,405 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:21:19,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:21:28,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:21:30,494 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:21:36,405 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:21:49,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:21:58,804 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:22:00,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:22:06,406 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:22:19,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:22:28,847 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:22:30,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:22:36,404 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:22:49,669 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:22:58,840 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:23:00,505 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:23:06,412 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:23:19,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:23:28,862 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:23:30,505 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:23:36,410 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:23:49,675 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:23:58,881 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:24:00,511 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:24:06,413 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:24:19,674 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:24:24,722 - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:24.721944", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:24,722 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:24.721944", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:24,723 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:24,724 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:24:24,724 - sqlalchemy.engine.Engine - INFO - [cached since 3324s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'qGMWtgU_cnWhb7zP_mbHNCpnOKP1uejadNO9kj5i9i4', 'param_1': 1}
2025-03-31 15:24:24,725 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:24:24,725 - sqlalchemy.engine.Engine - INFO - [cached since 3324s ago] {'refresh_token': 'u9mW8nVdSZsLhmor9zglkBl9owonv7EoyGPfJQFD0Kk', 'user_devices_id': 29}
2025-03-31 15:24:24,726 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:24,731 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-31 15:24:24,731 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-03-31 15:24:24,770 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:24:24,772 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:24:24,772 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:24:24,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:24,772 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:24:24,772 - sqlalchemy.engine.Engine - INFO - [cached since 3324s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:24:24,773 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:24,773 - sqlalchemy.engine.Engine - INFO - [cached since 3324s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 24, 773955), 'users_id': 2}
2025-03-31 15:24:24,774 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:24,775 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:24:28,897 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:24:30,495 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:24:31,860 - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:31.860238", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:31,860 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:31.860238", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:31,861 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: b62f8d5b-c1b2-47bd-8d74-2367d5dd5cc5
2025-03-31 15:24:31,861 - app.services.secure_channel_service - INFO - Creating channel with ID: b62f8d5b-c1b2-47bd-8d74-2367d5dd5cc5
2025-03-31 15:24:31,862 - app.services.secure_channel_service - INFO - Channel b62f8d5b-c1b2-47bd-8d74-2367d5dd5cc5 saved to Redis with TTL 1800 seconds
2025-03-31 15:24:31,862 - app.api.v1.endpoints.auth - INFO - Channel b62f8d5b-c1b2-47bd-8d74-2367d5dd5cc5 initialized successfully
2025-03-31 15:24:31,862 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 15:24:31,862 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-03-31 15:24:32,037 - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:32.037034", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:32,037 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:32.037034", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:32,039 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:32,040 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:24:32,040 - sqlalchemy.engine.Engine - INFO - [cached since 3332s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:24:32,041 - app.api.v1.endpoints.users - INFO - Search request received, channel: b62f8d5b-c1b2-47bd-8d74-2367d5dd5cc5
2025-03-31 15:24:32,041 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743425664}
2025-03-31 15:24:32,042 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 15:24:32,042 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 15:24:32,042 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 15:24:32,043 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 15:24:32,043 - sqlalchemy.engine.Engine - INFO - [cached since 2926s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 15:24:32,043 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 15:24:32,044 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': False}]
2025-03-31 15:24:32,045 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:24:32,045 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 15:24:32,045 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-03-31 15:24:39,947 - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:39.947272", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:24:39,947 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:39.947272", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:24:39,949 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 484ff779-f475-4766-9216-e9b84e9318a1
2025-03-31 15:24:39,949 - app.services.secure_channel_service - INFO - Creating channel with ID: 484ff779-f475-4766-9216-e9b84e9318a1
2025-03-31 15:24:39,950 - app.services.secure_channel_service - INFO - Channel 484ff779-f475-4766-9216-e9b84e9318a1 saved to Redis with TTL 1800 seconds
2025-03-31 15:24:39,950 - app.api.v1.endpoints.auth - INFO - Channel 484ff779-f475-4766-9216-e9b84e9318a1 initialized successfully
2025-03-31 15:24:39,950 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 15:24:39,950 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 15:24:40,049 - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:40.049308", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:24:40,049 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:40.049308", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:24:40,051 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:40,051 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:24:40,051 - sqlalchemy.engine.Engine - INFO - [cached since 3340s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 15:24:40,052 - app.api.v1.endpoints.users - INFO - Search request received, channel: 484ff779-f475-4766-9216-e9b84e9318a1
2025-03-31 15:24:40,052 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743425070}
2025-03-31 15:24:40,053 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"y","limit":10}
2025-03-31 15:24:40,053 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'y', 'limit': 10}
2025-03-31 15:24:40,053 - app.api.v1.endpoints.users - INFO - Searching users with query 'y', excluding user 3
2025-03-31 15:24:40,053 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 15:24:40,054 - sqlalchemy.engine.Engine - INFO - [cached since 2934s ago] {'id_1': '3', 'username_1': '%y%', 'email_1': '%y%', 'param_1': 10}
2025-03-31 15:24:40,054 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 15:24:40,054 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 15:24:40,055 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:24:40,055 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 15:24:40,055 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-03-31 15:24:45,047 - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:45.047634", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:45,047 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:24:45.047634", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:24:45,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:45,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:24:45,050 - sqlalchemy.engine.Engine - INFO - [cached since 3345s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:24:45,051 - app.api.v1.endpoints.users - INFO - Search request received, channel: b62f8d5b-c1b2-47bd-8d74-2367d5dd5cc5
2025-03-31 15:24:45,051 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743425664}
2025-03-31 15:24:45,052 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 15:24:45,052 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 15:24:45,052 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 15:24:45,052 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 15:24:45,052 - sqlalchemy.engine.Engine - INFO - [cached since 2939s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 15:24:45,053 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 15:24:45,053 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': False}]
2025-03-31 15:24:45,054 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:24:45,054 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-31 15:24:45,054 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-03-31 15:24:46,908 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 15:24:46,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:46,910 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:46,910 - sqlalchemy.engine.Engine - INFO - [cached since 2939s ago] {'pk_1': 2}
2025-03-31 15:24:46,910 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:46,910 - sqlalchemy.engine.Engine - INFO - [cached since 3346s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 46, 909823), 'users_id': 2}
2025-03-31 15:24:46,911 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:46,912 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 15:24:48,280 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 15:24:48,281 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:48,281 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:48,281 - sqlalchemy.engine.Engine - INFO - [cached since 2940s ago] {'pk_1': 3}
2025-03-31 15:24:48,282 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:48,282 - sqlalchemy.engine.Engine - INFO - [cached since 3348s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 48, 281058), 'users_id': 3}
2025-03-31 15:24:48,283 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:48,288 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 15:24:48,288 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 15:24:48,289 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:48,289 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:48,289 - sqlalchemy.engine.Engine - INFO - [cached since 2940s ago] {'pk_1': 3}
2025-03-31 15:24:48,290 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:48,290 - sqlalchemy.engine.Engine - INFO - [cached since 3348s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 48, 289441), 'users_id': 3}
2025-03-31 15:24:48,290 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:48,291 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 15:24:48,365 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:24:48,366 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:48,366 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:48,366 - sqlalchemy.engine.Engine - INFO - [cached since 2940s ago] {'pk_1': 2}
2025-03-31 15:24:48,367 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:48,367 - sqlalchemy.engine.Engine - INFO - [cached since 3348s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 48, 366458), 'users_id': 2}
2025-03-31 15:24:48,368 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:48,368 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:24:48,368 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:24:48,369 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:48,369 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:48,369 - sqlalchemy.engine.Engine - INFO - [cached since 2940s ago] {'pk_1': 2}
2025-03-31 15:24:48,370 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:48,370 - sqlalchemy.engine.Engine - INFO - [cached since 3348s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 48, 369459), 'users_id': 2}
2025-03-31 15:24:48,370 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:48,371 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:24:48,428 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:24:48,436 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:48,437 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:48,437 - sqlalchemy.engine.Engine - INFO - [cached since 2940s ago] {'pk_1': 2}
2025-03-31 15:24:48,438 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:48,438 - sqlalchemy.engine.Engine - INFO - [cached since 3348s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 48, 436473), 'users_id': 2}
2025-03-31 15:24:48,438 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:48,439 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:24:48,439 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:24:48,440 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:24:48,440 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:24:48,440 - sqlalchemy.engine.Engine - INFO - [cached since 2940s ago] {'pk_1': 2}
2025-03-31 15:24:48,441 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:24:48,441 - sqlalchemy.engine.Engine - INFO - [cached since 3348s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 24, 48, 440475), 'users_id': 2}
2025-03-31 15:24:48,442 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:24:48,442 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:24:49,663 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:24:54,766 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:24:58,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:25:00,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:25:19,664 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:25:24,766 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:25:28,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:25:30,498 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:25:37,535 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-03-31 15:25:37,536 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:25:37,537 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:25:37,537 - sqlalchemy.engine.Engine - INFO - [cached since 2989s ago] {'pk_1': 2}
2025-03-31 15:25:37,538 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:25:37,538 - sqlalchemy.engine.Engine - INFO - [cached since 3397s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 25, 37, 536442), 'users_id': 2}
2025-03-31 15:25:37,538 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:25:37,543 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-03-31 15:25:40,063 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-03-31 15:25:40,064 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:25:40,065 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:25:40,065 - sqlalchemy.engine.Engine - INFO - [cached since 2992s ago] {'pk_1': 3}
2025-03-31 15:25:40,065 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:25:40,066 - sqlalchemy.engine.Engine - INFO - [cached since 3400s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 25, 40, 64200), 'users_id': 3}
2025-03-31 15:25:40,066 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:25:40,071 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-03-31 15:25:49,664 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:25:54,766 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:25:58,806 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:26:00,498 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:26:19,664 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:26:24,767 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:26:28,828 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:26:30,498 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:26:49,691 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:26:54,795 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:26:58,809 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:27:00,518 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:27:19,674 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:27:24,774 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:27:28,812 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:27:30,494 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:27:49,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:27:54,769 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:27:58,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:28:00,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:28:19,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:28:24,769 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:28:28,821 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:28:30,496 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:28:49,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:28:54,769 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:28:58,825 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:29:00,514 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:29:19,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:29:21,428 - INFO - Incoming request: {"timestamp": "2025-03-31T12:29:21.428137", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:29:21,428 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:29:21.428137", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:29:21,430 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:29:21,430 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:29:21,430 - sqlalchemy.engine.Engine - INFO - [cached since 3621s ago] {'device_id_1': '4b1ebe23-0e49-430f-bc00-e008679b4756', 'refresh_token_1': 'u9mW8nVdSZsLhmor9zglkBl9owonv7EoyGPfJQFD0Kk', 'param_1': 1}
2025-03-31 15:29:21,431 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:29:21,431 - sqlalchemy.engine.Engine - INFO - [cached since 3621s ago] {'refresh_token': 'DtTnaCz7vJr_XBx5rczTSMsz0UjhPiHdL92oPWN_VSQ', 'user_devices_id': 29}
2025-03-31 15:29:21,432 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:29:21,432 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-31 15:29:21,432 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-03-31 15:29:21,481 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:29:21,482 - app.services.connection_manager - INFO - User 2 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:29:21,482 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:29:21,483 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:29:21,483 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:29:21,483 - sqlalchemy.engine.Engine - INFO - [cached since 3621s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:29:21,484 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:29:21,484 - sqlalchemy.engine.Engine - INFO - [cached since 3621s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 29, 21, 484177), 'users_id': 2}
2025-03-31 15:29:21,485 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:29:21,485 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:29:28,846 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:29:30,373 - INFO - Incoming request: {"timestamp": "2025-03-31T12:29:30.373770", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:29:30,373 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:29:30.373770", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:29:30,375 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:29:30,375 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-03-31 15:29:30,375 - sqlalchemy.engine.Engine - INFO - [cached since 3630s ago] {'device_id_1': '5324195c-08e4-40cb-bd7b-4de2004fff85', 'refresh_token_1': 'O6oBN57GrK0A10Pd_6YT78zfefWWcN-W90thNv7isG0', 'param_1': 1}
2025-03-31 15:29:30,376 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:29:30,376 - sqlalchemy.engine.Engine - INFO - [cached since 3630s ago] {'refresh_token': '9PSkWW7RR2Cw8ohduWFj2AJZ31G95hptVNhiinc-6k4', 'user_devices_id': 30}
2025-03-31 15:29:30,377 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:29:30,378 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 15:29:30,378 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.0}
2025-03-31 15:29:30,422 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 15:29:30,423 - app.services.connection_manager - INFO - User 3 connected to server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:29:30,423 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 15:29:30,423 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:29:30,424 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:29:30,424 - sqlalchemy.engine.Engine - INFO - [cached since 3630s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 15:29:30,425 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:29:30,425 - sqlalchemy.engine.Engine - INFO - [cached since 3630s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 29, 30, 424781), 'users_id': 3}
2025-03-31 15:29:30,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:29:30,425 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 15:29:49,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:29:51,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:29:58,866 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:30:00,430 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:30:19,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:30:21,475 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:30:28,885 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:30:30,428 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:30:49,668 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:30:51,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:30:58,903 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:31:00,426 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:31:19,667 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:31:21,475 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:31:28,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:31:30,444 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:31:49,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:31:51,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:31:58,814 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:32:00,463 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:32:19,670 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:32:21,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:32:28,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:32:30,485 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:32:49,668 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:32:51,475 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:32:58,812 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:33:00,466 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:33:19,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:33:21,478 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:33:28,816 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:33:30,523 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:33:49,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:33:51,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:33:58,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:34:00,429 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:34:19,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:34:21,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:34:28,818 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:34:30,427 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:34:49,666 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:34:51,477 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:34:58,815 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:35:00,414 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:35:15,782 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:35:15,782 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:35:15,783 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:35:15,784 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:35:15,784 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:35:15,785 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:35:15,785 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:35:15,785 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:35:19,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:35:21,475 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:35:28,812 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:35:49,665 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:35:51,475 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:35:58,808 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-03-31 15:36:16,099 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:36:16,099 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,100 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,100 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,100 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,101 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,101 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,101 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,102 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:36:16,104 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,104 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,104 - app.services.connection_manager - INFO - User 3 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,104 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,105 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,105 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,106 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,106 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,106 - app.services.connection_manager - INFO - User 2 disconnected from server 30159ca2-4858-4532-9b83-413f2bc02311
2025-03-31 15:36:16,210 - app.main - INFO - Shutting down server...
2025-03-31 15:36:16,212 - app.main - INFO - Redis connections closed
2025-03-31 15:36:16,212 - app.main - INFO - Server shutdown completed
2025-03-31 15:39:32,853 - app.main - INFO - Starting up server...
2025-03-31 15:39:32,853 - app.main - INFO - Redis initialized
2025-03-31 15:39:32,892 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-31 15:39:32,892 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 15:39:32,893 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-31 15:39:32,893 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 15:39:32,894 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-31 15:39:32,894 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-31 15:39:32,897 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:39:32,897 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 15:39:32,897 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-31 15:39:32,900 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:39:32,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:39:32,901 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 15:39:32,901 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-31 15:39:32,901 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 15:39:32,901 - sqlalchemy.engine.Engine - INFO - [cached since 0.0006956s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-03-31 15:39:32,902 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:39:32,902 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:39:32,903 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-03-31 15:39:32,903 - sqlalchemy.engine.Engine - INFO - [cached since 0.006099s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-03-31 15:39:32,903 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:39:32,903 - app.main - INFO - Database initialized
2025-03-31 15:39:32,966 - app.main - INFO - Server key pair generated
2025-03-31 15:39:32,966 - app.main - INFO - Server startup completed successfully
2025-03-31 15:39:35,793 - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:35.793193", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:35,793 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:35.793193", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:35,793 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 15:39:35,793 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-03-31 15:39:42,256 - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:42.255826", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:42,256 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:42.255826", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:42,256 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.714}
2025-03-31 15:39:42,256 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.714}
2025-03-31 15:39:50,013 - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:50.013151", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:39:50,013 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:50.013151", "method": "GET", "path": "/", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:39:50,014 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 15:39:50,014 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-03-31 15:39:56,172 - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:56.172077", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:56,172 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:56.172077", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:56,175 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c4c091e6-07dc-40d7-b965-68b2715e8e34
2025-03-31 15:39:56,175 - app.services.secure_channel_service - INFO - Creating channel with ID: c4c091e6-07dc-40d7-b965-68b2715e8e34
2025-03-31 15:39:56,180 - app.services.secure_channel_service - INFO - Channel c4c091e6-07dc-40d7-b965-68b2715e8e34 saved to Redis with TTL 1800 seconds
2025-03-31 15:39:56,180 - app.api.v1.endpoints.auth - INFO - Channel c4c091e6-07dc-40d7-b965-68b2715e8e34 initialized successfully
2025-03-31 15:39:56,181 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 15:39:56,181 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 15:39:56,427 - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:56.426624", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:56,427 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:56.426624", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:56,429 - app.api.v1.endpoints.auth - INFO - Login request using channel: c4c091e6-07dc-40d7-b965-68b2715e8e34
2025-03-31 15:39:56,430 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"18256ac0-7a95-48d2-9e05-3434f71f55d4"}
2025-03-31 15:39:56,430 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '18256ac0-7a95-48d2-9e05-3434f71f55d4'}
2025-03-31 15:39:56,434 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:39:56,435 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 15:39:56,435 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-03-31 15:39:56,664 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:39:56,664 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] {'user_id_1': 2, 'device_id_1': '18256ac0-7a95-48d2-9e05-3434f71f55d4', 'param_1': 1}
2025-03-31 15:39:56,667 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 15:39:56,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'users_id': 2}
2025-03-31 15:39:56,669 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 15:39:56,669 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'user_id': 2, 'device_id': '18256ac0-7a95-48d2-9e05-3434f71f55d4', 'refresh_token': None, 'last_login': None}
2025-03-31 15:39:56,673 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-03-31 15:39:56,674 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:39:56,675 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'refresh_token': 'eShHnW1AnD1loj5OrpM6dNQlFp-Ig9ZGm2GdoM-pjRI', 'user_devices_id': 31}
2025-03-31 15:39:56,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:39:56,676 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 15:39:56,676 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 15:39:56,677 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 15:39:56,678 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 252.057}
2025-03-31 15:39:56,678 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 252.057}
2025-03-31 15:39:57,489 - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:57.489743", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:57,489 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:39:57.489743", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:39:57,491 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 44814f62-2449-45a7-9f2b-030acb205603
2025-03-31 15:39:57,491 - app.services.secure_channel_service - INFO - Creating channel with ID: 44814f62-2449-45a7-9f2b-030acb205603
2025-03-31 15:39:57,491 - app.services.secure_channel_service - INFO - Channel 44814f62-2449-45a7-9f2b-030acb205603 saved to Redis with TTL 1800 seconds
2025-03-31 15:39:57,491 - app.api.v1.endpoints.auth - INFO - Channel 44814f62-2449-45a7-9f2b-030acb205603 initialized successfully
2025-03-31 15:39:57,492 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.009}
2025-03-31 15:39:57,492 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.009}
2025-03-31 15:39:57,494 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:39:57,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:39:57,496 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:39:57,496 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'id_1': '2', 'param_1': 1}
2025-03-31 15:39:57,498 - app.services.connection_manager - INFO - User 2 connected to server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:39:57,499 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:39:57,499 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:39:57,499 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'last_seen': datetime.datetime(2025, 3, 31, 12, 39, 57, 499747), 'users_id': 2}
2025-03-31 15:39:57,500 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:39:57,505 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:39:58,765 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-03-31 15:39:58,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:39:58,766 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:39:58,766 - sqlalchemy.engine.Engine - INFO - [cached since 1.27s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:39:58,767 - app.services.connection_manager - INFO - User 2 connected to server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:39:58,767 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-03-31 15:39:58,768 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:39:58,768 - sqlalchemy.engine.Engine - INFO - [cached since 1.268s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 39, 58, 767294), 'users_id': 2}
2025-03-31 15:39:58,768 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:39:58,774 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-03-31 15:40:00,572 - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:00.572820", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:40:00,572 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:00.572820", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:40:00,574 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e797add6-c79b-4bab-bddf-a4bc49341f83
2025-03-31 15:40:00,574 - app.services.secure_channel_service - INFO - Creating channel with ID: e797add6-c79b-4bab-bddf-a4bc49341f83
2025-03-31 15:40:00,574 - app.services.secure_channel_service - INFO - Channel e797add6-c79b-4bab-bddf-a4bc49341f83 saved to Redis with TTL 1800 seconds
2025-03-31 15:40:00,575 - app.api.v1.endpoints.auth - INFO - Channel e797add6-c79b-4bab-bddf-a4bc49341f83 initialized successfully
2025-03-31 15:40:00,575 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 15:40:00,575 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 15:40:00,754 - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:00.754862", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:40:00,754 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:00.754862", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:40:00,755 - app.api.v1.endpoints.auth - INFO - Login request using channel: e797add6-c79b-4bab-bddf-a4bc49341f83
2025-03-31 15:40:00,756 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"422936d5-b975-41de-87cd-b8772c2edc31"}
2025-03-31 15:40:00,756 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '422936d5-b975-41de-87cd-b8772c2edc31'}
2025-03-31 15:40:00,757 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:00,757 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-03-31 15:40:00,757 - sqlalchemy.engine.Engine - INFO - [cached since 4.322s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-03-31 15:40:00,959 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:40:00,959 - sqlalchemy.engine.Engine - INFO - [cached since 4.295s ago] {'user_id_1': 3, 'device_id_1': '422936d5-b975-41de-87cd-b8772c2edc31', 'param_1': 1}
2025-03-31 15:40:00,960 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-03-31 15:40:00,960 - sqlalchemy.engine.Engine - INFO - [cached since 4.293s ago] {'users_id': 3}
2025-03-31 15:40:00,960 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-03-31 15:40:00,960 - sqlalchemy.engine.Engine - INFO - [cached since 4.292s ago] {'user_id': 3, 'device_id': '422936d5-b975-41de-87cd-b8772c2edc31', 'refresh_token': None, 'last_login': None}
2025-03-31 15:40:00,961 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-03-31 15:40:00,961 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-03-31 15:40:00,961 - sqlalchemy.engine.Engine - INFO - [cached since 4.287s ago] {'refresh_token': 'qfuC5KNav_HMDRnsyHfTOCuIAYU_ohuiJoVxCUdGv98', 'user_devices_id': 32}
2025-03-31 15:40:00,962 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:00,967 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-03-31 15:40:00,967 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-03-31 15:40:00,968 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-03-31 15:40:00,968 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 214.048}
2025-03-31 15:40:00,968 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 214.048}
2025-03-31 15:40:01,755 - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:01.754898", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:40:01,755 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:01.754898", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.53.186"}
2025-03-31 15:40:01,756 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 22e42c77-5051-4f03-b528-cfbc0ce4d990
2025-03-31 15:40:01,756 - app.services.secure_channel_service - INFO - Creating channel with ID: 22e42c77-5051-4f03-b528-cfbc0ce4d990
2025-03-31 15:40:01,756 - app.services.secure_channel_service - INFO - Channel 22e42c77-5051-4f03-b528-cfbc0ce4d990 saved to Redis with TTL 1800 seconds
2025-03-31 15:40:01,757 - app.api.v1.endpoints.auth - INFO - Channel 22e42c77-5051-4f03-b528-cfbc0ce4d990 initialized successfully
2025-03-31 15:40:01,757 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 15:40:01,757 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-03-31 15:40:01,761 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 15:40:01,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:01,762 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:40:01,762 - sqlalchemy.engine.Engine - INFO - [cached since 4.267s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 15:40:01,764 - app.services.connection_manager - INFO - User 3 connected to server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:40:01,764 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 15:40:01,764 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:01,764 - sqlalchemy.engine.Engine - INFO - [cached since 4.265s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 1, 764901), 'users_id': 3}
2025-03-31 15:40:01,764 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:01,765 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 15:40:02,846 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-03-31 15:40:02,846 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:02,846 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:40:02,847 - sqlalchemy.engine.Engine - INFO - [cached since 5.35s ago] {'id_1': '3', 'param_1': 1}
2025-03-31 15:40:02,848 - app.services.connection_manager - INFO - User 3 connected to server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:40:02,848 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-03-31 15:40:02,848 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:02,849 - sqlalchemy.engine.Engine - INFO - [cached since 5.349s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 2, 848207), 'users_id': 3}
2025-03-31 15:40:02,849 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:02,854 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-03-31 15:40:04,770 - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:04.770645", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:40:04,770 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:04.770645", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:40:04,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:04,773 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:40:04,773 - sqlalchemy.engine.Engine - INFO - [cached since 7.277s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:40:04,774 - app.api.v1.endpoints.users - INFO - Search request received, channel: 44814f62-2449-45a7-9f2b-030acb205603
2025-03-31 15:40:04,774 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743426596}
2025-03-31 15:40:04,775 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"m","limit":10}
2025-03-31 15:40:04,775 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'm', 'limit': 10}
2025-03-31 15:40:04,775 - app.api.v1.endpoints.users - INFO - Searching users with query 'm', excluding user 2
2025-03-31 15:40:04,776 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 15:40:04,777 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'id_1': '2', 'username_1': '%m%', 'email_1': '%m%', 'param_1': 10}
2025-03-31 15:40:04,777 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 15:40:04,778 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 15:40:04,778 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:40:04,779 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 15:40:04,779 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-03-31 15:40:05,245 - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:05.245721", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:40:05,245 - chat_server - INFO - Incoming request: {"timestamp": "2025-03-31T12:40:05.245721", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.53.245"}
2025-03-31 15:40:05,247 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:05,247 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-03-31 15:40:05,247 - sqlalchemy.engine.Engine - INFO - [cached since 7.752s ago] {'id_1': '2', 'param_1': 1}
2025-03-31 15:40:05,248 - app.api.v1.endpoints.users - INFO - Search request received, channel: 44814f62-2449-45a7-9f2b-030acb205603
2025-03-31 15:40:05,248 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743426596}
2025-03-31 15:40:05,249 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-03-31 15:40:05,249 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-03-31 15:40:05,249 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-03-31 15:40:05,250 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-03-31 15:40:05,250 - sqlalchemy.engine.Engine - INFO - [cached since 0.4734s ago] {'id_1': '2', 'username_1': '%mi%', 'email_1': '%mi%', 'param_1': 10}
2025-03-31 15:40:05,250 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-03-31 15:40:05,250 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-03-31 15:40:05,251 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-31 15:40:05,251 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.0089999999999995}
2025-03-31 15:40:05,251 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.0089999999999995}
2025-03-31 15:40:06,884 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-03-31 15:40:06,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:06,886 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:06,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] {'pk_1': 2}
2025-03-31 15:40:06,887 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'YuDev' to chat.init message
2025-03-31 15:40:06,888 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:06,888 - sqlalchemy.engine.Engine - INFO - [cached since 9.389s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 6, 888667), 'users_id': 2}
2025-03-31 15:40:06,889 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:06,894 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-03-31 15:40:07,598 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 15:40:07,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:07,599 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:07,599 - sqlalchemy.engine.Engine - INFO - [cached since 0.713s ago] {'pk_1': 3}
2025-03-31 15:40:07,600 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-03-31 15:40:07,601 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:07,601 - sqlalchemy.engine.Engine - INFO - [cached since 10.1s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 7, 600584), 'users_id': 3}
2025-03-31 15:40:07,601 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:07,602 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 15:40:07,696 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:40:07,697 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:07,698 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:07,698 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'pk_1': 2}
2025-03-31 15:40:07,699 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:07,699 - sqlalchemy.engine.Engine - INFO - [cached since 10.2s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 7, 697620), 'users_id': 2}
2025-03-31 15:40:07,700 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:07,700 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:40:08,296 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 15:40:08,296 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:08,296 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:08,296 - sqlalchemy.engine.Engine - INFO - [cached since 1.41s ago] {'pk_1': 3}
2025-03-31 15:40:08,297 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-03-31 15:40:08,298 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:08,298 - sqlalchemy.engine.Engine - INFO - [cached since 10.8s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 8, 298223), 'users_id': 3}
2025-03-31 15:40:08,298 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:08,299 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 15:40:08,333 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:40:08,335 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:08,335 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:08,335 - sqlalchemy.engine.Engine - INFO - [cached since 0.6369s ago] {'pk_1': 2}
2025-03-31 15:40:08,336 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:08,337 - sqlalchemy.engine.Engine - INFO - [cached since 10.84s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 8, 334231), 'users_id': 2}
2025-03-31 15:40:08,337 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:08,338 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:40:08,545 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-03-31 15:40:08,545 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:08,546 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:08,546 - sqlalchemy.engine.Engine - INFO - [cached since 1.66s ago] {'pk_1': 3}
2025-03-31 15:40:08,546 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-03-31 15:40:08,547 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:08,547 - sqlalchemy.engine.Engine - INFO - [cached since 11.05s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 8, 547422), 'users_id': 3}
2025-03-31 15:40:08,548 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:08,549 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-03-31 15:40:08,579 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-03-31 15:40:08,580 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:08,581 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:08,581 - sqlalchemy.engine.Engine - INFO - [cached since 0.8823s ago] {'pk_1': 2}
2025-03-31 15:40:08,581 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:08,582 - sqlalchemy.engine.Engine - INFO - [cached since 11.08s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 8, 580429), 'users_id': 2}
2025-03-31 15:40:08,582 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:08,583 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-03-31 15:40:20,415 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 2 to 3
2025-03-31 15:40:20,416 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:20,416 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:20,416 - sqlalchemy.engine.Engine - INFO - [cached since 12.72s ago] {'pk_1': 2}
2025-03-31 15:40:20,417 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:20,417 - sqlalchemy.engine.Engine - INFO - [cached since 22.92s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 20, 415635), 'users_id': 2}
2025-03-31 15:40:20,417 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:20,422 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 2 to 3
2025-03-31 15:40:20,523 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 15:40:20,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:20,525 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:20,525 - sqlalchemy.engine.Engine - INFO - [cached since 12.83s ago] {'pk_1': 3}
2025-03-31 15:40:20,526 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:20,526 - sqlalchemy.engine.Engine - INFO - [cached since 23.03s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 20, 524685), 'users_id': 3}
2025-03-31 15:40:20,526 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:20,527 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 15:40:20,579 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 15:40:20,580 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:20,581 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:20,581 - sqlalchemy.engine.Engine - INFO - [cached since 12.88s ago] {'pk_1': 3}
2025-03-31 15:40:20,581 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:20,581 - sqlalchemy.engine.Engine - INFO - [cached since 23.08s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 20, 580698), 'users_id': 3}
2025-03-31 15:40:20,582 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:20,582 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 15:40:20,708 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 15:40:20,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:20,710 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:20,710 - sqlalchemy.engine.Engine - INFO - [cached since 13.01s ago] {'pk_1': 3}
2025-03-31 15:40:20,711 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:20,711 - sqlalchemy.engine.Engine - INFO - [cached since 23.21s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 20, 709727), 'users_id': 3}
2025-03-31 15:40:20,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:20,712 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 15:40:20,713 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 15:40:20,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:20,714 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:20,714 - sqlalchemy.engine.Engine - INFO - [cached since 13.02s ago] {'pk_1': 3}
2025-03-31 15:40:20,715 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:20,715 - sqlalchemy.engine.Engine - INFO - [cached since 23.22s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 20, 713727), 'users_id': 3}
2025-03-31 15:40:20,715 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:20,716 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 15:40:21,730 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-03-31 15:40:21,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-31 15:40:21,732 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-03-31 15:40:21,732 - sqlalchemy.engine.Engine - INFO - [cached since 14.03s ago] {'pk_1': 3}
2025-03-31 15:40:21,733 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-03-31 15:40:21,733 - sqlalchemy.engine.Engine - INFO - [cached since 24.23s ago] {'last_seen': datetime.datetime(2025, 3, 31, 12, 40, 21, 731745), 'users_id': 3}
2025-03-31 15:40:21,733 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-31 15:40:21,738 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-03-31 15:40:26,986 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:40:26,987 - app.services.connection_manager - INFO - User 3 disconnected from server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:40:27,002 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-03-31 15:40:27,003 - app.services.connection_manager - INFO - User 3 disconnected from server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:40:27,484 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-03-31 15:40:28,683 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:40:28,683 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-03-31 15:40:28,685 - app.services.connection_manager - INFO - User 2 disconnected from server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:40:28,686 - app.services.connection_manager - INFO - User 2 disconnected from server 19cdcc42-240f-4123-bb4d-28ee0ed18414
2025-03-31 15:40:33,972 - app.main - INFO - Shutting down server...
2025-03-31 15:40:33,973 - app.main - INFO - Redis connections closed
2025-03-31 15:40:33,973 - app.main - INFO - Server shutdown completed
2025-04-01 10:07:40,838 - app.main - INFO - Starting up server...
2025-04-01 10:07:40,839 - app.main - INFO - Redis initialized
2025-04-01 10:07:40,896 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-01 10:07:40,896 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:07:40,897 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-01 10:07:40,898 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:07:40,899 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-01 10:07:40,899 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:07:40,902 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:07:40,903 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:07:40,903 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-04-01 10:07:40,907 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:07:40,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:07:40,909 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:07:40,909 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-04-01 10:07:40,910 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:07:40,910 - sqlalchemy.engine.Engine - INFO - [cached since 0.001262s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-04-01 10:07:40,911 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:07:40,911 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:07:40,912 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:07:40,912 - sqlalchemy.engine.Engine - INFO - [cached since 0.009297s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-04-01 10:07:40,913 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:07:40,913 - app.main - INFO - Database initialized
2025-04-01 10:07:40,976 - app.main - INFO - Server key pair generated
2025-04-01 10:07:40,976 - app.main - INFO - Server startup completed successfully
2025-04-01 10:08:26,240 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:26.240893", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:26,240 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:26.240893", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:26,241 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-01 10:08:26,241 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-01 10:08:37,871 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:37.871491", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:37,871 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:37.871491", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:37,872 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 10:08:37,872 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 10:08:43,045 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:43.045659", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:43,045 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:43.045659", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:43,049 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 2ae441dd-033b-4894-bb72-96ee274dced1
2025-04-01 10:08:43,049 - app.services.secure_channel_service - INFO - Creating channel with ID: 2ae441dd-033b-4894-bb72-96ee274dced1
2025-04-01 10:08:43,059 - app.services.secure_channel_service - INFO - Channel 2ae441dd-033b-4894-bb72-96ee274dced1 saved to Redis with TTL 1800 seconds
2025-04-01 10:08:43,060 - app.api.v1.endpoints.auth - INFO - Channel 2ae441dd-033b-4894-bb72-96ee274dced1 initialized successfully
2025-04-01 10:08:43,060 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 15.003}
2025-04-01 10:08:43,060 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 15.003}
2025-04-01 10:08:43,349 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:43.349728", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:43,349 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:43.349728", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:43,351 - app.api.v1.endpoints.auth - INFO - Login request using channel: 2ae441dd-033b-4894-bb72-96ee274dced1
2025-04-01 10:08:43,353 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"d19517a1-514a-4f6f-b263-92fd3a332c27"}
2025-04-01 10:08:43,353 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': 'd19517a1-514a-4f6f-b263-92fd3a332c27'}
2025-04-01 10:08:43,357 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:43,358 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:43,358 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] {'email_1': 'yu@gmail.com', 'param_1': 1}
2025-04-01 10:08:43,589 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:43,589 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] {'user_id_1': 2, 'device_id_1': 'd19517a1-514a-4f6f-b263-92fd3a332c27', 'param_1': 1}
2025-04-01 10:08:43,592 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-04-01 10:08:43,592 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'users_id': 2}
2025-04-01 10:08:43,596 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-04-01 10:08:43,596 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] {'user_id': 2, 'device_id': 'd19517a1-514a-4f6f-b263-92fd3a332c27', 'refresh_token': None, 'last_login': None}
2025-04-01 10:08:43,600 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-04-01 10:08:43,601 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-04-01 10:08:43,601 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'refresh_token': 'GoNlMtLUWLUrErXl6yLnN5IMM1TIywJcEo3_DtlgF-Q', 'user_devices_id': 33}
2025-04-01 10:08:43,602 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:43,604 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 10:08:43,604 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 10:08:43,605 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 10:08:43,605 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 256.05699999999996}
2025-04-01 10:08:43,605 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 256.05699999999996}
2025-04-01 10:08:47,108 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:47.108577", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:47,108 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:47.108577", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:08:47,109 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 620a0387-48d2-42ae-9e3b-c72c64d20bb7
2025-04-01 10:08:47,109 - app.services.secure_channel_service - INFO - Creating channel with ID: 620a0387-48d2-42ae-9e3b-c72c64d20bb7
2025-04-01 10:08:47,110 - app.services.secure_channel_service - INFO - Channel 620a0387-48d2-42ae-9e3b-c72c64d20bb7 saved to Redis with TTL 1800 seconds
2025-04-01 10:08:47,110 - app.api.v1.endpoints.auth - INFO - Channel 620a0387-48d2-42ae-9e3b-c72c64d20bb7 initialized successfully
2025-04-01 10:08:47,110 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 10:08:47,110 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 10:08:47,665 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 10:08:47,666 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:47,667 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:47,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'id_1': '2', 'param_1': 1}
2025-04-01 10:08:47,670 - app.services.connection_manager - INFO - User 2 connected to server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:08:47,670 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 10:08:47,671 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:08:47,671 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'last_seen': datetime.datetime(2025, 4, 1, 7, 8, 47, 670703), 'users_id': 2}
2025-04-01 10:08:47,672 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:47,672 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 10:08:49,544 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 10:08:49,545 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:49,545 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:49,545 - sqlalchemy.engine.Engine - INFO - [cached since 1.878s ago] {'id_1': '2', 'param_1': 1}
2025-04-01 10:08:49,547 - app.services.connection_manager - INFO - User 2 connected to server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:08:49,547 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 10:08:49,548 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:08:49,548 - sqlalchemy.engine.Engine - INFO - [cached since 1.877s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 8, 49, 547143), 'users_id': 2}
2025-04-01 10:08:49,548 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:49,549 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 10:08:51,666 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:51.665621", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:51,666 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:51.665621", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:51,667 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 30e3f43c-8c25-407c-b013-3d58d9d66aef
2025-04-01 10:08:51,667 - app.services.secure_channel_service - INFO - Creating channel with ID: 30e3f43c-8c25-407c-b013-3d58d9d66aef
2025-04-01 10:08:51,667 - app.services.secure_channel_service - INFO - Channel 30e3f43c-8c25-407c-b013-3d58d9d66aef saved to Redis with TTL 1800 seconds
2025-04-01 10:08:51,668 - app.api.v1.endpoints.auth - INFO - Channel 30e3f43c-8c25-407c-b013-3d58d9d66aef initialized successfully
2025-04-01 10:08:51,668 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-04-01 10:08:51,668 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-04-01 10:08:51,798 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:51.798651", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:51,798 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:51.798651", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:51,799 - app.api.v1.endpoints.auth - INFO - Login request using channel: 30e3f43c-8c25-407c-b013-3d58d9d66aef
2025-04-01 10:08:51,801 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"28f13ff7-8193-426d-9835-722802ab776b"}
2025-04-01 10:08:51,801 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '28f13ff7-8193-426d-9835-722802ab776b'}
2025-04-01 10:08:51,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:51,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:51,802 - sqlalchemy.engine.Engine - INFO - [cached since 8.443s ago] {'email_1': 'mirai@gmail.com', 'param_1': 1}
2025-04-01 10:08:52,026 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.user_id = %(user_id_1)s AND user_devices.device_id = %(device_id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:52,026 - sqlalchemy.engine.Engine - INFO - [cached since 8.438s ago] {'user_id_1': 3, 'device_id_1': '28f13ff7-8193-426d-9835-722802ab776b', 'param_1': 1}
2025-04-01 10:08:52,027 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=now() WHERE users.id = %(users_id)s
2025-04-01 10:08:52,027 - sqlalchemy.engine.Engine - INFO - [cached since 8.436s ago] {'users_id': 3}
2025-04-01 10:08:52,028 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_devices (user_id, device_id, refresh_token, last_login) VALUES (%(user_id)s, %(device_id)s, %(refresh_token)s, %(last_login)s) RETURNING user_devices.id, user_devices.created_at
2025-04-01 10:08:52,028 - sqlalchemy.engine.Engine - INFO - [cached since 8.432s ago] {'user_id': 3, 'device_id': '28f13ff7-8193-426d-9835-722802ab776b', 'refresh_token': None, 'last_login': None}
2025-04-01 10:08:52,029 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-04-01 10:08:52,029 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s, last_login=now() WHERE user_devices.id = %(user_devices_id)s
2025-04-01 10:08:52,029 - sqlalchemy.engine.Engine - INFO - [cached since 8.428s ago] {'refresh_token': 'qPg3TYGXbN7ekrZ0YIdcnuFlSRh3bDXwFGRUxp-rLg8', 'user_devices_id': 34}
2025-04-01 10:08:52,030 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:52,030 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 10:08:52,030 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 10:08:52,031 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 10:08:52,032 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 234.05200000000002}
2025-04-01 10:08:52,032 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 234.05200000000002}
2025-04-01 10:08:53,173 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:08:53,174 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:53,174 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:53,174 - sqlalchemy.engine.Engine - INFO - [cached since 5.508s ago] {'id_1': '3', 'param_1': 1}
2025-04-01 10:08:53,176 - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:53.176962", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:53,176 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:08:53.176962", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:08:53,177 - app.services.connection_manager - INFO - User 3 connected to server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:08:53,177 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:08:53,177 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:08:53,178 - sqlalchemy.engine.Engine - INFO - [cached since 5.507s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 8, 53, 177963), 'users_id': 3}
2025-04-01 10:08:53,178 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:53,178 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:08:53,180 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 88e557e8-3085-4e36-b5f7-8f555e3d0072
2025-04-01 10:08:53,180 - app.services.secure_channel_service - INFO - Creating channel with ID: 88e557e8-3085-4e36-b5f7-8f555e3d0072
2025-04-01 10:08:53,180 - app.services.secure_channel_service - INFO - Channel 88e557e8-3085-4e36-b5f7-8f555e3d0072 saved to Redis with TTL 1800 seconds
2025-04-01 10:08:53,180 - app.api.v1.endpoints.auth - INFO - Channel 88e557e8-3085-4e36-b5f7-8f555e3d0072 initialized successfully
2025-04-01 10:08:53,181 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 10:08:53,181 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 10:08:53,983 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:08:53,984 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:53,984 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:08:53,984 - sqlalchemy.engine.Engine - INFO - [cached since 6.317s ago] {'id_1': '3', 'param_1': 1}
2025-04-01 10:08:53,985 - app.services.connection_manager - INFO - User 3 connected to server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:08:53,985 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:08:53,986 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:08:53,986 - sqlalchemy.engine.Engine - INFO - [cached since 6.314s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 8, 53, 985145), 'users_id': 3}
2025-04-01 10:08:53,986 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:53,987 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:08:55,920 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 10:08:55,921 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:55,922 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:08:55,922 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'pk_1': 2}
2025-04-01 10:08:55,923 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:08:55,923 - sqlalchemy.engine.Engine - INFO - [cached since 8.252s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 8, 55, 920582), 'users_id': 2}
2025-04-01 10:08:55,923 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:55,924 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 10:08:59,130 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 10:08:59,131 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:08:59,131 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:08:59,131 - sqlalchemy.engine.Engine - INFO - [cached since 3.209s ago] {'pk_1': 3}
2025-04-01 10:08:59,132 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:08:59,132 - sqlalchemy.engine.Engine - INFO - [cached since 11.46s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 8, 59, 130307), 'users_id': 3}
2025-04-01 10:08:59,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:08:59,133 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 10:09:11,318 - INFO - Incoming request: {"timestamp": "2025-04-01T07:09:11.318356", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:09:11,318 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:09:11.318356", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 10:09:11,320 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:11,320 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:09:11,320 - sqlalchemy.engine.Engine - INFO - [cached since 23.65s ago] {'id_1': '2', 'param_1': 1}
2025-04-01 10:09:11,321 - app.api.v1.endpoints.users - INFO - Search request received, channel: 620a0387-48d2-42ae-9e3b-c72c64d20bb7
2025-04-01 10:09:11,321 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743493123}
2025-04-01 10:09:11,322 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mirai","limit":10}
2025-04-01 10:09:11,323 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mirai', 'limit': 10}
2025-04-01 10:09:11,323 - app.api.v1.endpoints.users - INFO - Searching users with query 'mirai', excluding user 2
2025-04-01 10:09:11,324 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id != %(id_1)s AND users.is_active = true AND (users.username ILIKE %(username_1)s OR users.email ILIKE %(email_1)s) 
 LIMIT %(param_1)s
2025-04-01 10:09:11,324 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] {'id_1': '2', 'username_1': '%mirai%', 'email_1': '%mirai%', 'param_1': 10}
2025-04-01 10:09:11,326 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 10:09:11,327 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 10:09:11,328 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:09:11,328 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.003}
2025-04-01 10:09:11,328 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.003}
2025-04-01 10:09:16,052 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 10:09:16,052 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:16,053 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:16,053 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'pk_1': 2}
2025-04-01 10:09:16,054 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'YuDev' to chat.init message
2025-04-01 10:09:16,055 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:16,055 - sqlalchemy.engine.Engine - INFO - [cached since 28.38s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 16, 54425), 'users_id': 2}
2025-04-01 10:09:16,055 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:16,056 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 10:09:17,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:09:17,184 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 10:09:17,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:17,185 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:17,185 - sqlalchemy.engine.Engine - INFO - [cached since 1.132s ago] {'pk_1': 3}
2025-04-01 10:09:17,186 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 10:09:17,187 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:17,187 - sqlalchemy.engine.Engine - INFO - [cached since 29.52s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 17, 186681), 'users_id': 3}
2025-04-01 10:09:17,187 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:17,188 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 10:09:17,380 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 10:09:17,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:17,381 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:17,381 - sqlalchemy.engine.Engine - INFO - [cached since 21.46s ago] {'pk_1': 2}
2025-04-01 10:09:17,382 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:17,382 - sqlalchemy.engine.Engine - INFO - [cached since 29.71s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 17, 380725), 'users_id': 2}
2025-04-01 10:09:17,383 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:17,383 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 10:09:17,598 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 10:09:17,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:17,599 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:17,599 - sqlalchemy.engine.Engine - INFO - [cached since 1.546s ago] {'pk_1': 3}
2025-04-01 10:09:17,599 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 10:09:17,600 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:17,600 - sqlalchemy.engine.Engine - INFO - [cached since 29.93s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 17, 600775), 'users_id': 3}
2025-04-01 10:09:17,601 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:17,601 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 10:09:17,702 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 10:09:17,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:17,703 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:17,704 - sqlalchemy.engine.Engine - INFO - [cached since 21.78s ago] {'pk_1': 2}
2025-04-01 10:09:17,704 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:17,705 - sqlalchemy.engine.Engine - INFO - [cached since 30.03s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 17, 702798), 'users_id': 2}
2025-04-01 10:09:17,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:17,706 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 10:09:17,908 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 10:09:17,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:17,909 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:17,909 - sqlalchemy.engine.Engine - INFO - [cached since 1.857s ago] {'pk_1': 3}
2025-04-01 10:09:17,910 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 10:09:17,911 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:17,911 - sqlalchemy.engine.Engine - INFO - [cached since 30.24s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 17, 910845), 'users_id': 3}
2025-04-01 10:09:17,911 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:17,912 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 10:09:17,998 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 10:09:17,999 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:09:18,000 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:09:18,000 - sqlalchemy.engine.Engine - INFO - [cached since 22.08s ago] {'pk_1': 2}
2025-04-01 10:09:18,000 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:09:18,001 - sqlalchemy.engine.Engine - INFO - [cached since 30.33s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 9, 17, 999866), 'users_id': 2}
2025-04-01 10:09:18,001 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:09:18,002 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 10:09:19,495 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:09:22,818 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:09:23,951 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:09:47,072 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:09:49,449 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:09:52,831 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:09:53,971 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:10:17,072 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:10:19,450 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:10:22,851 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:10:23,992 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:10:47,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:10:49,450 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:10:52,748 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:10:54,036 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:11:17,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:11:19,450 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:11:22,760 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:11:23,918 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:11:47,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:11:49,452 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:11:52,758 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:11:53,922 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:12:17,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:12:19,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:12:22,788 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:12:23,927 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:12:47,084 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:12:49,456 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:12:52,806 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:12:53,959 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:13:17,076 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:13:19,451 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:13:22,835 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:13:23,976 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:13:47,086 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:13:49,458 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:13:52,854 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:13:54,008 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:14:17,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:14:19,451 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:14:22,768 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:14:24,024 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:14:47,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:14:49,450 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:14:52,761 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:14:53,919 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:15:17,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:15:19,451 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:15:22,768 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:15:23,911 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:15:47,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:15:49,450 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:15:52,748 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:15:53,922 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:16:17,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:16:19,450 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:16:22,748 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:16:23,910 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:16:47,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:16:49,451 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:16:52,756 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:16:53,919 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:17:17,073 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:17:19,451 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:17:22,757 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:17:23,910 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:17:47,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:17:49,451 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:17:52,760 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:17:53,912 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:18:17,076 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:18:19,452 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:18:22,758 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:18:23,911 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:18:47,075 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:18:49,452 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:18:52,760 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:18:53,934 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:19:17,075 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:19:19,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:19:22,759 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:19:23,921 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:19:47,076 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:19:49,452 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:19:52,748 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:19:53,933 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:20:17,078 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:20:19,452 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:20:22,752 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:20:23,920 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:20:47,078 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:20:49,454 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:20:52,759 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:20:53,919 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:21:17,077 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:21:19,455 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:21:22,769 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:21:23,925 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:21:47,075 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:21:49,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:21:52,789 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:21:53,929 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:22:17,075 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:22:19,455 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:22:22,809 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:22:23,955 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:22:47,077 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:22:49,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:22:52,830 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:22:53,933 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:23:17,077 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:23:19,454 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:23:22,749 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:23:23,991 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:23:47,076 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:23:49,455 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:23:52,797 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:23:53,966 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:24:17,075 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:24:19,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:24:22,818 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:24:23,959 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:24:47,076 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:24:49,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:24:52,837 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:24:53,978 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:25:17,076 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:25:19,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:25:22,758 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:25:24,001 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:25:47,074 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:25:49,453 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 10:25:52,762 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:25:53,910 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 10:26:16,948 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 10:26:16,948 - app.services.online_status_service - ERROR - Error setting user 2 offline: Error 10054 while writing to socket.      .
2025-04-01 10:26:16,948 - app.services.connection_manager - INFO - User 2 disconnected from server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:26:16,949 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 10:26:16,951 - app.services.connection_manager - INFO - User 2 disconnected from server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:26:18,475 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:26:18,476 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:26:18,476 - app.services.connection_manager - INFO - User 3 disconnected from server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:26:18,478 - app.services.connection_manager - INFO - User 3 disconnected from server 1f69cc65-1853-4ada-b1d4-f2c18819b654
2025-04-01 10:37:01,883 - app.main - INFO - Shutting down server...
2025-04-01 10:37:01,884 - app.main - INFO - Redis connections closed
2025-04-01 10:37:01,884 - app.main - INFO - Server shutdown completed
2025-04-01 10:37:04,974 - app.main - INFO - Starting up server...
2025-04-01 10:37:04,974 - app.main - INFO - Redis initialized
2025-04-01 10:37:05,128 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-01 10:37:05,128 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:37:05,129 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-01 10:37:05,129 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:37:05,129 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-01 10:37:05,129 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:37:05,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:05,132 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:37:05,132 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-04-01 10:37:05,135 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:37:05,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:05,136 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:37:05,137 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-04-01 10:37:05,137 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:37:05,137 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007747s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-04-01 10:37:05,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:37:05,138 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:05,138 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:37:05,138 - sqlalchemy.engine.Engine - INFO - [cached since 0.006673s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-04-01 10:37:05,139 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:37:05,139 - app.main - INFO - Database initialized
2025-04-01 10:37:05,152 - app.main - INFO - Server key pair generated
2025-04-01 10:37:05,152 - app.main - INFO - Server startup completed successfully
2025-04-01 10:37:24,777 - INFO - Incoming request: {"timestamp": "2025-04-01T07:37:24.777583", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:37:24,777 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:37:24.777583", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:37:24,778 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 10:37:24,778 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 10:37:25,066 - INFO - Incoming request: {"timestamp": "2025-04-01T07:37:25.066786", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:37:25,066 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:37:25.066786", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:37:25,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:25,074 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-04-01 10:37:25,074 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] {'device_id_1': '28f13ff7-8193-426d-9835-722802ab776b', 'refresh_token_1': 'qPg3TYGXbN7ekrZ0YIdcnuFlSRh3bDXwFGRUxp-rLg8', 'param_1': 1}
2025-04-01 10:37:25,078 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-04-01 10:37:25,078 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] {'refresh_token': '2Stbzk2I0G1i6J8uidn_D8X8BM9WoKPw2VKA1IEoA_g', 'user_devices_id': 34}
2025-04-01 10:37:25,079 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:37:25,087 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 21.008}
2025-04-01 10:37:25,087 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 21.008}
2025-04-01 10:37:25,285 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:37:25,294 - app.services.connection_manager - INFO - User 3 connected to server 795cfcaa-9bf7-4d3e-864c-cd26d2025aba
2025-04-01 10:37:25,294 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:37:25,294 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:25,296 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:37:25,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'id_1': '3', 'param_1': 1}
2025-04-01 10:37:25,301 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:37:25,301 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] {'last_seen': datetime.datetime(2025, 4, 1, 7, 37, 25, 300841), 'users_id': 3}
2025-04-01 10:37:25,302 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:37:25,305 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:37:26,425 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:37:26,425 - INFO - Incoming request: {"timestamp": "2025-04-01T07:37:26.425628", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:37:26,425 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:37:26.425628", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:37:26,426 - app.services.connection_manager - INFO - User 3 connected to server 795cfcaa-9bf7-4d3e-864c-cd26d2025aba
2025-04-01 10:37:26,426 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:37:26,427 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:26,427 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:37:26,427 - sqlalchemy.engine.Engine - INFO - [cached since 1.131s ago] {'id_1': '3', 'param_1': 1}
2025-04-01 10:37:26,429 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:37:26,429 - sqlalchemy.engine.Engine - INFO - [cached since 1.128s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 37, 26, 428629), 'users_id': 3}
2025-04-01 10:37:26,429 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:37:26,430 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:37:26,431 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 4a5e94b8-62cb-4d81-ac64-d18584b2dc14
2025-04-01 10:37:26,432 - app.services.secure_channel_service - INFO - Creating channel with ID: 4a5e94b8-62cb-4d81-ac64-d18584b2dc14
2025-04-01 10:37:26,434 - app.services.secure_channel_service - INFO - Channel 4a5e94b8-62cb-4d81-ac64-d18584b2dc14 saved to Redis with TTL 1800 seconds
2025-04-01 10:37:26,434 - app.api.v1.endpoints.auth - INFO - Channel 4a5e94b8-62cb-4d81-ac64-d18584b2dc14 initialized successfully
2025-04-01 10:37:26,434 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-04-01 10:37:26,434 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-04-01 10:37:38,348 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 10:37:38,349 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:38,350 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:37:38,350 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] {'pk_1': 3}
2025-04-01 10:37:38,351 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:37:38,351 - sqlalchemy.engine.Engine - INFO - [cached since 13.05s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 37, 38, 349286), 'users_id': 3}
2025-04-01 10:37:38,351 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:37:38,358 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 10:37:55,188 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:55,189 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:37:55,189 - sqlalchemy.engine.Engine - INFO - [cached since 16.84s ago] {'pk_1': 3}
2025-04-01 10:37:55,190 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:37:55,190 - sqlalchemy.engine.Engine - INFO - [cached since 29.89s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 37, 55, 188892), 'users_id': 3}
2025-04-01 10:37:55,190 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:37:56,309 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:37:56,309 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:37:56,309 - sqlalchemy.engine.Engine - INFO - [cached since 17.96s ago] {'pk_1': 3}
2025-04-01 10:37:56,310 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:37:56,310 - sqlalchemy.engine.Engine - INFO - [cached since 31.01s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 37, 56, 308206), 'users_id': 3}
2025-04-01 10:37:56,311 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:38:25,194 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:38:25,195 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:38:25,195 - sqlalchemy.engine.Engine - INFO - [cached since 46.84s ago] {'pk_1': 3}
2025-04-01 10:38:25,196 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:38:25,196 - sqlalchemy.engine.Engine - INFO - [cached since 59.89s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 38, 25, 194095), 'users_id': 3}
2025-04-01 10:38:25,196 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:38:26,334 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:38:26,335 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:38:26,335 - sqlalchemy.engine.Engine - INFO - [cached since 47.99s ago] {'pk_1': 3}
2025-04-01 10:38:26,336 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:38:26,336 - sqlalchemy.engine.Engine - INFO - [cached since 61.03s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 38, 26, 334456), 'users_id': 3}
2025-04-01 10:38:26,336 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:38:54,092 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:38:54,093 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:38:54,094 - app.services.connection_manager - INFO - User 3 disconnected from server 795cfcaa-9bf7-4d3e-864c-cd26d2025aba
2025-04-01 10:38:54,096 - app.services.connection_manager - INFO - User 3 disconnected from server 795cfcaa-9bf7-4d3e-864c-cd26d2025aba
2025-04-01 10:38:54,202 - app.main - INFO - Shutting down server...
2025-04-01 10:38:54,203 - app.main - INFO - Redis connections closed
2025-04-01 10:38:54,203 - app.main - INFO - Server shutdown completed
2025-04-01 10:44:07,653 - app.main - INFO - Starting up server...
2025-04-01 10:44:07,654 - app.main - INFO - Redis initialized
2025-04-01 10:44:07,698 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-01 10:44:07,698 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:44:07,699 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-01 10:44:07,699 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:44:07,699 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-01 10:44:07,700 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-04-01 10:44:07,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:07,703 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:44:07,703 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-04-01 10:44:07,705 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:44:07,706 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:07,707 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:44:07,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] {'table_name': 'users', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-04-01 10:44:07,708 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = %(table_name)s AND pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s, %(param_3)s, %(param_4)s, %(param_5)s]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:44:07,708 - sqlalchemy.engine.Engine - INFO - [cached since 0.001046s ago] {'table_name': 'user_devices', 'param_1': 'r', 'param_2': 'p', 'param_3': 'f', 'param_4': 'v', 'param_5': 'm', 'nspname_1': 'pg_catalog'}
2025-04-01 10:44:07,709 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:44:07,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:07,710 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relkind = ANY (ARRAY[%(param_1)s, %(param_2)s]) AND pg_catalog.pg_class.relpersistence != %(relpersistence_1)s AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != %(nspname_1)s
2025-04-01 10:44:07,710 - sqlalchemy.engine.Engine - INFO - [cached since 0.007186s ago] {'param_1': 'r', 'param_2': 'p', 'relpersistence_1': 't', 'nspname_1': 'pg_catalog'}
2025-04-01 10:44:07,711 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-01 10:44:07,711 - app.main - INFO - Database initialized
2025-04-01 10:44:07,781 - app.main - INFO - Server key pair generated
2025-04-01 10:44:07,781 - app.main - INFO - Server startup completed successfully
2025-04-01 10:44:26,693 - INFO - Incoming request: {"timestamp": "2025-04-01T07:44:26.693271", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:44:26,693 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:44:26.693271", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:44:26,694 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 10:44:26,694 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 10:44:26,982 - INFO - Incoming request: {"timestamp": "2025-04-01T07:44:26.982803", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:44:26,982 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:44:26.982803", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:44:26,989 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:26,990 - sqlalchemy.engine.Engine - INFO - SELECT user_devices.id AS user_devices_id, user_devices.user_id AS user_devices_user_id, user_devices.device_id AS user_devices_device_id, user_devices.refresh_token AS user_devices_refresh_token, user_devices.last_login AS user_devices_last_login, user_devices.created_at AS user_devices_created_at 
FROM user_devices 
WHERE user_devices.device_id = %(device_id_1)s AND user_devices.refresh_token = %(refresh_token_1)s 
 LIMIT %(param_1)s
2025-04-01 10:44:26,990 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] {'device_id_1': '28f13ff7-8193-426d-9835-722802ab776b', 'refresh_token_1': '2Stbzk2I0G1i6J8uidn_D8X8BM9WoKPw2VKA1IEoA_g', 'param_1': 1}
2025-04-01 10:44:26,992 - sqlalchemy.engine.Engine - INFO - UPDATE user_devices SET refresh_token=%(refresh_token)s WHERE user_devices.id = %(user_devices_id)s
2025-04-01 10:44:26,992 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] {'refresh_token': 'O_vNzal3Q_or3Bgql2mRuBGGqoTq7-kwLX1ZQuc9xLo', 'user_devices_id': 34}
2025-04-01 10:44:26,993 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:44:27,002 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 20.004}
2025-04-01 10:44:27,002 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 20.004}
2025-04-01 10:44:27,052 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:44:27,057 - app.services.connection_manager - INFO - User 3 connected to server 9331a9a0-0909-4c83-beef-1f4c3a5f6d0a
2025-04-01 10:44:27,057 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:44:27,058 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:27,059 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:44:27,059 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'id_1': '3', 'param_1': 1}
2025-04-01 10:44:27,062 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:44:27,062 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] {'last_seen': datetime.datetime(2025, 4, 1, 7, 44, 27, 61821), 'users_id': 3}
2025-04-01 10:44:27,062 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:44:27,063 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:44:28,098 - INFO - Incoming request: {"timestamp": "2025-04-01T07:44:28.098826", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:44:28,098 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T07:44:28.098826", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 10:44:28,099 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c449c6b6-5833-4b84-8c8d-15200f6c4571
2025-04-01 10:44:28,100 - app.services.secure_channel_service - INFO - Creating channel with ID: c449c6b6-5833-4b84-8c8d-15200f6c4571
2025-04-01 10:44:28,102 - app.services.secure_channel_service - INFO - Channel c449c6b6-5833-4b84-8c8d-15200f6c4571 saved to Redis with TTL 1800 seconds
2025-04-01 10:44:28,102 - app.api.v1.endpoints.auth - INFO - Channel c449c6b6-5833-4b84-8c8d-15200f6c4571 initialized successfully
2025-04-01 10:44:28,102 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-04-01 10:44:28,102 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.0}
2025-04-01 10:44:28,200 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:44:28,201 - app.services.connection_manager - INFO - User 3 connected to server 9331a9a0-0909-4c83-beef-1f4c3a5f6d0a
2025-04-01 10:44:28,201 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:44:28,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:28,202 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path, users.last_seen AS users_last_seen 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s
2025-04-01 10:44:28,202 - sqlalchemy.engine.Engine - INFO - [cached since 1.143s ago] {'id_1': '3', 'param_1': 1}
2025-04-01 10:44:28,202 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:44:28,203 - sqlalchemy.engine.Engine - INFO - [cached since 1.141s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 44, 28, 202849), 'users_id': 3}
2025-04-01 10:44:28,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:44:28,203 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:44:57,059 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:57,061 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:44:57,061 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] {'pk_1': 3}
2025-04-01 10:44:57,061 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:44:57,061 - sqlalchemy.engine.Engine - INFO - [cached since 30s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 44, 57, 59236), 'users_id': 3}
2025-04-01 10:44:57,062 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:44:58,140 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:44:58,141 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:44:58,141 - sqlalchemy.engine.Engine - INFO - [cached since 1.08s ago] {'pk_1': 3}
2025-04-01 10:44:58,141 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:44:58,142 - sqlalchemy.engine.Engine - INFO - [cached since 31.08s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 44, 58, 140306), 'users_id': 3}
2025-04-01 10:44:58,142 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:45:27,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:45:27,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:45:27,050 - sqlalchemy.engine.Engine - INFO - [cached since 29.99s ago] {'pk_1': 3}
2025-04-01 10:45:27,051 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:45:27,051 - sqlalchemy.engine.Engine - INFO - [cached since 59.99s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 45, 27, 49775), 'users_id': 3}
2025-04-01 10:45:27,051 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:45:28,157 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:45:28,157 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:45:28,157 - sqlalchemy.engine.Engine - INFO - [cached since 31.1s ago] {'pk_1': 3}
2025-04-01 10:45:28,158 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:45:28,158 - sqlalchemy.engine.Engine - INFO - [cached since 61.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 45, 28, 156469), 'users_id': 3}
2025-04-01 10:45:28,159 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:45:57,041 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:45:57,041 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:45:57,041 - sqlalchemy.engine.Engine - INFO - [cached since 59.98s ago] {'pk_1': 3}
2025-04-01 10:45:57,042 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:45:57,042 - sqlalchemy.engine.Engine - INFO - [cached since 89.98s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 45, 57, 40218), 'users_id': 3}
2025-04-01 10:45:57,042 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:45:58,159 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:45:58,160 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:45:58,160 - sqlalchemy.engine.Engine - INFO - [cached since 61.1s ago] {'pk_1': 3}
2025-04-01 10:45:58,161 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:45:58,161 - sqlalchemy.engine.Engine - INFO - [cached since 91.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 45, 58, 159520), 'users_id': 3}
2025-04-01 10:45:58,161 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:46:27,054 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:46:27,055 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:46:27,055 - sqlalchemy.engine.Engine - INFO - [cached since 89.99s ago] {'pk_1': 3}
2025-04-01 10:46:27,056 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:46:27,056 - sqlalchemy.engine.Engine - INFO - [cached since 120s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 46, 27, 54596), 'users_id': 3}
2025-04-01 10:46:27,056 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:46:28,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:46:28,175 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:46:28,176 - sqlalchemy.engine.Engine - INFO - [cached since 91.12s ago] {'pk_1': 3}
2025-04-01 10:46:28,176 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:46:28,176 - sqlalchemy.engine.Engine - INFO - [cached since 121.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 46, 28, 175739), 'users_id': 3}
2025-04-01 10:46:28,177 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:46:57,055 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:46:57,056 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:46:57,056 - sqlalchemy.engine.Engine - INFO - [cached since 120s ago] {'pk_1': 3}
2025-04-01 10:46:57,057 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:46:57,057 - sqlalchemy.engine.Engine - INFO - [cached since 150s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 46, 57, 55662), 'users_id': 3}
2025-04-01 10:46:57,057 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:46:58,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:46:58,199 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:46:58,199 - sqlalchemy.engine.Engine - INFO - [cached since 121.1s ago] {'pk_1': 3}
2025-04-01 10:46:58,199 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:46:58,199 - sqlalchemy.engine.Engine - INFO - [cached since 151.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 46, 58, 198274), 'users_id': 3}
2025-04-01 10:46:58,200 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:47:27,075 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:47:27,076 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:47:27,076 - sqlalchemy.engine.Engine - INFO - [cached since 150s ago] {'pk_1': 3}
2025-04-01 10:47:27,077 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:47:27,077 - sqlalchemy.engine.Engine - INFO - [cached since 180s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 47, 27, 75657), 'users_id': 3}
2025-04-01 10:47:27,077 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:47:28,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:47:28,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:47:28,114 - sqlalchemy.engine.Engine - INFO - [cached since 151.1s ago] {'pk_1': 3}
2025-04-01 10:47:28,115 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:47:28,115 - sqlalchemy.engine.Engine - INFO - [cached since 181.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 47, 28, 113962), 'users_id': 3}
2025-04-01 10:47:28,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:47:57,099 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:47:57,099 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:47:57,099 - sqlalchemy.engine.Engine - INFO - [cached since 180s ago] {'pk_1': 3}
2025-04-01 10:47:57,100 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:47:57,100 - sqlalchemy.engine.Engine - INFO - [cached since 210s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 47, 57, 98356), 'users_id': 3}
2025-04-01 10:47:57,101 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:47:58,130 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:47:58,131 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:47:58,131 - sqlalchemy.engine.Engine - INFO - [cached since 181.1s ago] {'pk_1': 3}
2025-04-01 10:47:58,132 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:47:58,132 - sqlalchemy.engine.Engine - INFO - [cached since 211.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 47, 58, 130256), 'users_id': 3}
2025-04-01 10:47:58,132 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:48:27,117 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:48:27,117 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:48:27,118 - sqlalchemy.engine.Engine - INFO - [cached since 210.1s ago] {'pk_1': 3}
2025-04-01 10:48:27,118 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:48:27,118 - sqlalchemy.engine.Engine - INFO - [cached since 240.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 48, 27, 117709), 'users_id': 3}
2025-04-01 10:48:27,119 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:48:28,116 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:48:28,117 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:48:28,117 - sqlalchemy.engine.Engine - INFO - [cached since 211.1s ago] {'pk_1': 3}
2025-04-01 10:48:28,117 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:48:28,117 - sqlalchemy.engine.Engine - INFO - [cached since 241.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 48, 28, 116442), 'users_id': 3}
2025-04-01 10:48:28,118 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:48:57,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:48:57,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:48:57,050 - sqlalchemy.engine.Engine - INFO - [cached since 240s ago] {'pk_1': 3}
2025-04-01 10:48:57,051 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:48:57,051 - sqlalchemy.engine.Engine - INFO - [cached since 270s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 48, 57, 49299), 'users_id': 3}
2025-04-01 10:48:57,051 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:48:58,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:48:58,133 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:48:58,133 - sqlalchemy.engine.Engine - INFO - [cached since 241.1s ago] {'pk_1': 3}
2025-04-01 10:48:58,134 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:48:58,134 - sqlalchemy.engine.Engine - INFO - [cached since 271.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 48, 58, 132021), 'users_id': 3}
2025-04-01 10:48:58,134 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:49:27,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:49:27,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:49:27,050 - sqlalchemy.engine.Engine - INFO - [cached since 270s ago] {'pk_1': 3}
2025-04-01 10:49:27,052 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:49:27,052 - sqlalchemy.engine.Engine - INFO - [cached since 300s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 49, 27, 49999), 'users_id': 3}
2025-04-01 10:49:27,052 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:49:28,154 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:49:28,154 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:49:28,154 - sqlalchemy.engine.Engine - INFO - [cached since 271.1s ago] {'pk_1': 3}
2025-04-01 10:49:28,155 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:49:28,155 - sqlalchemy.engine.Engine - INFO - [cached since 301.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 49, 28, 153872), 'users_id': 3}
2025-04-01 10:49:28,155 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:49:57,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:49:57,049 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:49:57,049 - sqlalchemy.engine.Engine - INFO - [cached since 300s ago] {'pk_1': 3}
2025-04-01 10:49:57,050 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:49:57,050 - sqlalchemy.engine.Engine - INFO - [cached since 330s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 49, 57, 48622), 'users_id': 3}
2025-04-01 10:49:57,050 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:49:58,173 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:49:58,174 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:49:58,174 - sqlalchemy.engine.Engine - INFO - [cached since 301.1s ago] {'pk_1': 3}
2025-04-01 10:49:58,175 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:49:58,175 - sqlalchemy.engine.Engine - INFO - [cached since 331.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 49, 58, 173877), 'users_id': 3}
2025-04-01 10:49:58,176 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:50:27,056 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:50:27,056 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:50:27,057 - sqlalchemy.engine.Engine - INFO - [cached since 330s ago] {'pk_1': 3}
2025-04-01 10:50:27,057 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:50:27,057 - sqlalchemy.engine.Engine - INFO - [cached since 360s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 50, 27, 56179), 'users_id': 3}
2025-04-01 10:50:27,058 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:50:28,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:50:28,193 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:50:28,193 - sqlalchemy.engine.Engine - INFO - [cached since 331.1s ago] {'pk_1': 3}
2025-04-01 10:50:28,194 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:50:28,194 - sqlalchemy.engine.Engine - INFO - [cached since 361.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 50, 28, 192910), 'users_id': 3}
2025-04-01 10:50:28,194 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:50:57,075 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:50:57,075 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:50:57,075 - sqlalchemy.engine.Engine - INFO - [cached since 360s ago] {'pk_1': 3}
2025-04-01 10:50:57,076 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:50:57,076 - sqlalchemy.engine.Engine - INFO - [cached since 390s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 50, 57, 74294), 'users_id': 3}
2025-04-01 10:50:57,077 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:50:58,213 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:50:58,214 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:50:58,214 - sqlalchemy.engine.Engine - INFO - [cached since 361.2s ago] {'pk_1': 3}
2025-04-01 10:50:58,215 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:50:58,215 - sqlalchemy.engine.Engine - INFO - [cached since 391.2s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 50, 58, 213297), 'users_id': 3}
2025-04-01 10:50:58,215 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:51:27,097 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:51:27,098 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:51:27,098 - sqlalchemy.engine.Engine - INFO - [cached since 390s ago] {'pk_1': 3}
2025-04-01 10:51:27,099 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:51:27,099 - sqlalchemy.engine.Engine - INFO - [cached since 420s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 51, 27, 97638), 'users_id': 3}
2025-04-01 10:51:27,099 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:51:28,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:51:28,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:51:28,114 - sqlalchemy.engine.Engine - INFO - [cached since 391.1s ago] {'pk_1': 3}
2025-04-01 10:51:28,115 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:51:28,115 - sqlalchemy.engine.Engine - INFO - [cached since 421.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 51, 28, 114874), 'users_id': 3}
2025-04-01 10:51:28,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:51:57,113 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:51:57,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:51:57,114 - sqlalchemy.engine.Engine - INFO - [cached since 420.1s ago] {'pk_1': 3}
2025-04-01 10:51:57,115 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:51:57,115 - sqlalchemy.engine.Engine - INFO - [cached since 450.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 51, 57, 113886), 'users_id': 3}
2025-04-01 10:51:57,115 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:51:58,125 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:51:58,125 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:51:58,125 - sqlalchemy.engine.Engine - INFO - [cached since 421.1s ago] {'pk_1': 3}
2025-04-01 10:51:58,126 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:51:58,126 - sqlalchemy.engine.Engine - INFO - [cached since 451.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 51, 58, 124985), 'users_id': 3}
2025-04-01 10:51:58,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:52:27,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:52:27,137 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:52:27,137 - sqlalchemy.engine.Engine - INFO - [cached since 450.1s ago] {'pk_1': 3}
2025-04-01 10:52:27,138 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:52:27,138 - sqlalchemy.engine.Engine - INFO - [cached since 480.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 52, 27, 136860), 'users_id': 3}
2025-04-01 10:52:27,138 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:52:28,124 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:52:28,125 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:52:28,125 - sqlalchemy.engine.Engine - INFO - [cached since 451.1s ago] {'pk_1': 3}
2025-04-01 10:52:28,125 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:52:28,125 - sqlalchemy.engine.Engine - INFO - [cached since 481.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 52, 28, 124898), 'users_id': 3}
2025-04-01 10:52:28,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:52:57,045 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:52:57,046 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:52:57,046 - sqlalchemy.engine.Engine - INFO - [cached since 480s ago] {'pk_1': 3}
2025-04-01 10:52:57,046 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:52:57,047 - sqlalchemy.engine.Engine - INFO - [cached since 510s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 52, 57, 45161), 'users_id': 3}
2025-04-01 10:52:57,047 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:52:58,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:52:58,126 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:52:58,126 - sqlalchemy.engine.Engine - INFO - [cached since 481.1s ago] {'pk_1': 3}
2025-04-01 10:52:58,127 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:52:58,127 - sqlalchemy.engine.Engine - INFO - [cached since 511.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 52, 58, 125407), 'users_id': 3}
2025-04-01 10:52:58,128 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:53:27,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:53:27,044 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:53:27,044 - sqlalchemy.engine.Engine - INFO - [cached since 510s ago] {'pk_1': 3}
2025-04-01 10:53:27,045 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:53:27,045 - sqlalchemy.engine.Engine - INFO - [cached since 540s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 53, 27, 43370), 'users_id': 3}
2025-04-01 10:53:27,045 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:53:28,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:53:28,127 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:53:28,127 - sqlalchemy.engine.Engine - INFO - [cached since 511.1s ago] {'pk_1': 3}
2025-04-01 10:53:28,127 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:53:28,128 - sqlalchemy.engine.Engine - INFO - [cached since 541.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 53, 28, 126606), 'users_id': 3}
2025-04-01 10:53:28,128 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:53:57,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:53:57,044 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:53:57,044 - sqlalchemy.engine.Engine - INFO - [cached since 540s ago] {'pk_1': 3}
2025-04-01 10:53:57,044 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:53:57,045 - sqlalchemy.engine.Engine - INFO - [cached since 570s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 53, 57, 43173), 'users_id': 3}
2025-04-01 10:53:57,045 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:53:58,124 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:53:58,125 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:53:58,125 - sqlalchemy.engine.Engine - INFO - [cached since 541.1s ago] {'pk_1': 3}
2025-04-01 10:53:58,126 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:53:58,126 - sqlalchemy.engine.Engine - INFO - [cached since 571.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 53, 58, 124833), 'users_id': 3}
2025-04-01 10:53:58,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:54:27,051 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:54:27,052 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:54:27,052 - sqlalchemy.engine.Engine - INFO - [cached since 570s ago] {'pk_1': 3}
2025-04-01 10:54:27,052 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:54:27,053 - sqlalchemy.engine.Engine - INFO - [cached since 600s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 54, 27, 51760), 'users_id': 3}
2025-04-01 10:54:27,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:54:28,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-01 10:54:28,147 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.username AS users_username, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.has_avatar AS users_has_avatar, users.avatar_path AS users_avatar_path 
FROM users 
WHERE users.id = %(pk_1)s
2025-04-01 10:54:28,147 - sqlalchemy.engine.Engine - INFO - [cached since 571.1s ago] {'pk_1': 3}
2025-04-01 10:54:28,148 - sqlalchemy.engine.Engine - INFO - UPDATE users SET updated_at=now(), last_seen=%(last_seen)s WHERE users.id = %(users_id)s
2025-04-01 10:54:28,148 - sqlalchemy.engine.Engine - INFO - [cached since 601.1s ago] {'last_seen': datetime.datetime(2025, 4, 1, 7, 54, 28, 146248), 'users_id': 3}
2025-04-01 10:54:28,149 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-01 10:54:29,738 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:54:29,739 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:54:29,740 - app.services.connection_manager - INFO - User 3 disconnected from server 9331a9a0-0909-4c83-beef-1f4c3a5f6d0a
2025-04-01 10:54:29,741 - app.services.connection_manager - INFO - User 3 disconnected from server 9331a9a0-0909-4c83-beef-1f4c3a5f6d0a
2025-04-01 10:54:29,849 - app.main - INFO - Shutting down server...
2025-04-01 10:54:29,850 - app.main - INFO - Redis connections closed
2025-04-01 10:54:29,850 - app.main - INFO - Server shutdown completed
2025-04-01 10:54:32,159 - app.main - INFO - Starting up server...
2025-04-01 10:54:32,159 - app.main - INFO - Redis initialized
2025-04-01 10:54:32,204 - app.main - INFO - Database initialized
2025-04-01 10:54:32,228 - app.main - INFO - Server key pair generated
2025-04-01 10:54:32,229 - app.main - INFO - Server startup completed successfully
2025-04-01 10:54:34,993 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:54:34,998 - app.services.connection_manager - INFO - User 3 connected to server 5b5b727f-d7df-4dfc-bc63-9212f01563ca
2025-04-01 10:54:34,998 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:54:35,013 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:54:35,016 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 10:54:35,017 - app.services.connection_manager - INFO - User 3 connected to server 5b5b727f-d7df-4dfc-bc63-9212f01563ca
2025-04-01 10:54:35,017 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 10:54:35,018 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 10:57:50,580 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:57:50,581 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 10:57:50,582 - app.services.connection_manager - INFO - User 3 disconnected from server 5b5b727f-d7df-4dfc-bc63-9212f01563ca
2025-04-01 10:57:50,583 - app.services.connection_manager - INFO - User 3 disconnected from server 5b5b727f-d7df-4dfc-bc63-9212f01563ca
2025-04-01 10:57:50,674 - app.main - INFO - Shutting down server...
2025-04-01 10:57:50,675 - app.main - INFO - Redis connections closed
2025-04-01 10:57:50,675 - app.main - INFO - Server shutdown completed
2025-04-01 11:08:51,628 - app.main - INFO - Starting up server...
2025-04-01 11:08:51,629 - app.main - INFO - Redis initialized
2025-04-01 11:08:51,673 - app.main - INFO - Database initialized
2025-04-01 11:08:51,709 - app.main - INFO - Server key pair generated
2025-04-01 11:08:51,709 - app.main - INFO - Server startup completed successfully
2025-04-01 11:08:52,528 - INFO - Incoming request: {"timestamp": "2025-04-01T08:08:52.528199", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:08:52,528 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:08:52.528199", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:08:52,529 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-01 11:08:52,529 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-01 11:09:01,853 - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:01.852446", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:01,853 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:01.852446", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:01,853 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 11:09:01,853 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 11:09:07,957 - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:07.957333", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:07,957 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:07.957333", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:07,961 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 133bebeb-c4df-4e94-bf66-3cbc2069b0fa
2025-04-01 11:09:07,961 - app.services.secure_channel_service - INFO - Creating channel with ID: 133bebeb-c4df-4e94-bf66-3cbc2069b0fa
2025-04-01 11:09:07,965 - app.services.secure_channel_service - INFO - Channel 133bebeb-c4df-4e94-bf66-3cbc2069b0fa saved to Redis with TTL 1800 seconds
2025-04-01 11:09:07,966 - app.api.v1.endpoints.auth - INFO - Channel 133bebeb-c4df-4e94-bf66-3cbc2069b0fa initialized successfully
2025-04-01 11:09:07,966 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-04-01 11:09:07,966 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001}
2025-04-01 11:09:08,210 - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:08.210834", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:08,210 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:08.210834", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:08,212 - app.api.v1.endpoints.auth - INFO - Login request using channel: 133bebeb-c4df-4e94-bf66-3cbc2069b0fa
2025-04-01 11:09:08,214 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"edbd1f5c-4058-4ffe-b3ea-0b2ed4c88b64"}
2025-04-01 11:09:08,214 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': 'edbd1f5c-4058-4ffe-b3ea-0b2ed4c88b64'}
2025-04-01 11:09:08,451 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-04-01 11:09:08,455 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 11:09:08,455 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 11:09:08,456 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 11:09:08,457 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 247.07899999999998}
2025-04-01 11:09:08,457 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 247.07899999999998}
2025-04-01 11:09:09,285 - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:09.285173", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:09,285 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:09:09.285173", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:09:09,287 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 6b102667-98ee-4c34-a76c-9b444b5043b3
2025-04-01 11:09:09,287 - app.services.secure_channel_service - INFO - Creating channel with ID: 6b102667-98ee-4c34-a76c-9b444b5043b3
2025-04-01 11:09:09,287 - app.services.secure_channel_service - INFO - Channel 6b102667-98ee-4c34-a76c-9b444b5043b3 saved to Redis with TTL 1800 seconds
2025-04-01 11:09:09,287 - app.api.v1.endpoints.auth - INFO - Channel 6b102667-98ee-4c34-a76c-9b444b5043b3 initialized successfully
2025-04-01 11:09:09,288 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-01 11:09:09,288 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-01 11:09:10,022 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:09:10,025 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:09:10,025 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:09:10,032 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:09:10,034 - app.services.message_buffer - INFO - Retrieved and cleared 1 messages for user 2
2025-04-01 11:09:10,034 - app.api.v1.endpoints.websocket - INFO - Delivering 1 buffered messages to user 2
2025-04-01 11:09:12,457 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:09:12,458 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:09:12,458 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:09:12,464 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:09:13,486 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 11:09:13,491 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 11:09:15,164 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:09:15,165 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:02,125 - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:02.125224", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:02,125 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:02.125224", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:02,125 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-04-01 11:10:02,125 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 0.0}
2025-04-01 11:10:02,299 - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:02.299279", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:02,299 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:02.299279", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:02,304 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 11:10:02,304 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 11:10:02,397 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:10:02,398 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:02,398 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:10:02,401 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:10:02,402 - app.services.message_buffer - INFO - Retrieved and cleared 1 messages for user 3
2025-04-01 11:10:02,402 - app.api.v1.endpoints.websocket - INFO - Delivering 1 buffered messages to user 3
2025-04-01 11:10:03,232 - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:03.231148", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:03,232 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:03.231148", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:03,233 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: c58abf39-6da5-4570-b2e9-159763b63c40
2025-04-01 11:10:03,233 - app.services.secure_channel_service - INFO - Creating channel with ID: c58abf39-6da5-4570-b2e9-159763b63c40
2025-04-01 11:10:03,233 - app.services.secure_channel_service - INFO - Channel c58abf39-6da5-4570-b2e9-159763b63c40 saved to Redis with TTL 1800 seconds
2025-04-01 11:10:03,234 - app.api.v1.endpoints.auth - INFO - Channel c58abf39-6da5-4570-b2e9-159763b63c40 initialized successfully
2025-04-01 11:10:03,234 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-01 11:10:03,234 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-01 11:10:03,517 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:10:03,518 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:03,518 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:10:03,521 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:10:08,422 - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:08.422658", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:08,422 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:08.422658", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:10:08,426 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 11:10:08,426 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 11:10:08,464 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:10:08,465 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:08,465 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:10:08,467 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:10:08,708 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:10:08,709 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:30,368 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:10:30,369 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:30,369 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:10:30,371 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:10:30,390 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:10:30,391 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:30,391 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:10:30,393 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:10:34,092 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:10:34,093 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:34,094 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:10:34,100 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:10:34,203 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:10:34,204 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:34,205 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:10:34,207 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:10:53,066 - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:53.066952", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:10:53,066 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:10:53.066952", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:10:53,074 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 11:10:53,074 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 11:10:53,123 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:10:53,124 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:53,124 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:10:53,126 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:10:53,146 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:10:53,147 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:53,147 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:10:53,149 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:10:53,161 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:10:53,162 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:10:53,163 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:10:53,164 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:22,335 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:12:22,336 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:12:22,336 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:12:22,337 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:22,338 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:22,339 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:23,299 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:12:23,300 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:23,300 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:12:23,307 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:12:25,132 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:12:25,133 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:29,451 - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:29.451911", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:12:29,451 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:29.451911", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 11:12:29,459 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.787999999999999}
2025-04-01 11:12:29,459 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.787999999999999}
2025-04-01 11:12:29,492 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:12:29,493 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:29,493 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:12:29,495 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:12:29,508 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 11:12:29,509 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:12:29,509 - app.services.connection_manager - INFO - User 3 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:29,509 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 11:12:29,511 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 11:12:29,512 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:12:29,512 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:29,513 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:41,546 - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:41.546826", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:41,546 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:41.546826", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:41,547 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 11:12:41,547 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 11:12:41,986 - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:41.986015", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:41,986 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:41.986015", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:41,996 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.004000000000001}
2025-04-01 11:12:41,996 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.004000000000001}
2025-04-01 11:12:42,080 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:12:42,081 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:42,081 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:12:42,083 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:12:42,904 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:12:42,905 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:42,905 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:12:42,912 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:12:43,667 - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:43.667097", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:43,667 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:43.667097", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:43,669 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 3112472f-e8d5-4362-b96b-2271641b1aa7
2025-04-01 11:12:43,669 - app.services.secure_channel_service - INFO - Creating channel with ID: 3112472f-e8d5-4362-b96b-2271641b1aa7
2025-04-01 11:12:43,670 - app.services.secure_channel_service - INFO - Channel 3112472f-e8d5-4362-b96b-2271641b1aa7 saved to Redis with TTL 1800 seconds
2025-04-01 11:12:43,670 - app.api.v1.endpoints.auth - INFO - Channel 3112472f-e8d5-4362-b96b-2271641b1aa7 initialized successfully
2025-04-01 11:12:43,670 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.002}
2025-04-01 11:12:43,670 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.002}
2025-04-01 11:12:46,487 - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:46.487996", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:46,487 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:12:46.487996", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:12:46,491 - app.api.v1.endpoints.users - INFO - Search request received, channel: 3112472f-e8d5-4362-b96b-2271641b1aa7
2025-04-01 11:12:46,491 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743496961}
2025-04-01 11:12:46,492 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-04-01 11:12:46,492 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-04-01 11:12:46,492 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-04-01 11:12:46,494 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 11:12:46,494 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': False}]
2025-04-01 11:12:46,495 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 11:12:46,495 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 11:12:49,423 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:12:49,425 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:12:49,431 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 11:12:49,439 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 11:13:06,025 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 11:13:06,034 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 11:13:08,851 - INFO - Incoming request: {"timestamp": "2025-04-01T08:13:08.851605", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:13:08,851 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T08:13:08.851605", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 11:13:08,854 - app.api.v1.endpoints.users - INFO - Search request received, channel: 3112472f-e8d5-4362-b96b-2271641b1aa7
2025-04-01 11:13:08,854 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743496961}
2025-04-01 11:13:08,855 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-04-01 11:13:08,855 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-04-01 11:13:08,855 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-04-01 11:13:08,856 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 11:13:08,857 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 11:13:08,858 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.988}
2025-04-01 11:13:08,858 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.988}
2025-04-01 11:13:10,329 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 11:13:10,339 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 11:13:20,856 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:13:20,857 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:13:20,857 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:13:20,858 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 11:13:20,859 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:13:20,860 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:13:20,860 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:13:20,861 - app.services.connection_manager - INFO - User 3 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:13:25,687 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:13:25,689 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:13:26,156 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 11:13:26,157 - app.services.connection_manager - INFO - User 2 connected to server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:13:26,157 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 11:13:26,160 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 11:13:32,108 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 11:13:32,109 - app.services.connection_manager - INFO - User 2 disconnected from server 1788e7d1-2b2e-4380-b100-87c9ba630c43
2025-04-01 11:41:41,544 - app.main - INFO - Shutting down server...
2025-04-01 11:41:41,545 - app.main - INFO - Redis connections closed
2025-04-01 11:41:41,545 - app.main - INFO - Server shutdown completed
2025-04-01 12:47:47,121 - app.main - INFO - Starting up server...
2025-04-01 12:47:47,122 - app.main - INFO - Redis initialized
2025-04-01 12:47:47,169 - app.main - INFO - Database initialized
2025-04-01 12:47:47,194 - app.main - INFO - Server key pair generated
2025-04-01 12:47:47,195 - app.main - INFO - Server startup completed successfully
2025-04-01 12:48:17,371 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:17.370224", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:17,371 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:17.370224", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:17,371 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 12:48:17,371 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 12:48:25,938 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:25.938192", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:25,938 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:25.938192", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:25,943 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 5589fa43-7c48-4e5b-904b-e4c4f4d9d497
2025-04-01 12:48:25,943 - app.services.secure_channel_service - INFO - Creating channel with ID: 5589fa43-7c48-4e5b-904b-e4c4f4d9d497
2025-04-01 12:48:25,947 - app.services.secure_channel_service - INFO - Channel 5589fa43-7c48-4e5b-904b-e4c4f4d9d497 saved to Redis with TTL 1800 seconds
2025-04-01 12:48:25,948 - app.api.v1.endpoints.auth - INFO - Channel 5589fa43-7c48-4e5b-904b-e4c4f4d9d497 initialized successfully
2025-04-01 12:48:25,948 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.001}
2025-04-01 12:48:25,948 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.001}
2025-04-01 12:48:26,450 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:26.450308", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:26,450 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:26.450308", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:26,452 - app.api.v1.endpoints.auth - INFO - Login request using channel: 5589fa43-7c48-4e5b-904b-e4c4f4d9d497
2025-04-01 12:48:26,453 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"4fc085e9-1083-49b7-9614-52f9ff976c95"}
2025-04-01 12:48:26,453 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '4fc085e9-1083-49b7-9614-52f9ff976c95'}
2025-04-01 12:48:26,692 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-04-01 12:48:26,701 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 12:48:26,701 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 12:48:26,702 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 12:48:26,703 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 253.057}
2025-04-01 12:48:26,703 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 253.057}
2025-04-01 12:48:27,202 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:27.201480", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:27,202 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:27.201480", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:27,203 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 68548ec0-70e9-4d70-8866-4ee68a00088a
2025-04-01 12:48:27,203 - app.services.secure_channel_service - INFO - Creating channel with ID: 68548ec0-70e9-4d70-8866-4ee68a00088a
2025-04-01 12:48:27,203 - app.services.secure_channel_service - INFO - Channel 68548ec0-70e9-4d70-8866-4ee68a00088a saved to Redis with TTL 1800 seconds
2025-04-01 12:48:27,204 - app.api.v1.endpoints.auth - INFO - Channel 68548ec0-70e9-4d70-8866-4ee68a00088a initialized successfully
2025-04-01 12:48:27,204 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-04-01 12:48:27,204 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-04-01 12:48:27,304 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 12:48:27,306 - app.services.connection_manager - INFO - User 3 connected to server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:48:27,306 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 12:48:27,310 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 12:48:27,312 - app.services.message_buffer - INFO - Retrieved and cleared 5 messages for user 3
2025-04-01 12:48:27,312 - app.api.v1.endpoints.websocket - INFO - Delivering 5 buffered messages to user 3
2025-04-01 12:48:29,403 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 12:48:29,404 - app.services.connection_manager - INFO - User 3 connected to server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:48:29,404 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 12:48:29,406 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 12:48:30,489 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 12:48:30,499 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 12:48:30,512 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 12:48:30,515 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 12:48:30,692 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 12:48:30,696 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 12:48:32,361 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 12:48:32,363 - app.services.connection_manager - INFO - User 3 disconnected from server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:48:32,369 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:32.369899", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:32,369 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:32.369899", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 12:48:32,375 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-04-01 12:48:32,375 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-04-01 12:48:32,406 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 12:48:32,408 - app.services.connection_manager - INFO - User 3 connected to server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:48:32,408 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 12:48:32,411 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 12:48:34,911 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 12:48:34,919 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 12:48:44,879 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:44.879926", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:44,879 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:44.879926", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:44,880 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 12:48:44,880 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 12:48:44,991 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:44.990951", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:44,991 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:44.990951", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:44,999 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.004}
2025-04-01 12:48:44,999 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.004}
2025-04-01 12:48:45,183 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 12:48:45,184 - app.services.connection_manager - INFO - User 2 connected to server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:48:45,184 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 12:48:45,186 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 12:48:45,187 - app.services.message_buffer - INFO - Retrieved and cleared 4 messages for user 2
2025-04-01 12:48:45,187 - app.api.v1.endpoints.websocket - INFO - Delivering 4 buffered messages to user 2
2025-04-01 12:48:46,056 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 12:48:46,063 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 12:48:46,088 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 12:48:46,091 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 12:48:47,172 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:47.172788", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:47,172 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:47.172788", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:47,173 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: adda70e7-d4e1-4abb-9027-cb2211a28fc2
2025-04-01 12:48:47,173 - app.services.secure_channel_service - INFO - Creating channel with ID: adda70e7-d4e1-4abb-9027-cb2211a28fc2
2025-04-01 12:48:47,174 - app.services.secure_channel_service - INFO - Channel adda70e7-d4e1-4abb-9027-cb2211a28fc2 saved to Redis with TTL 1800 seconds
2025-04-01 12:48:47,174 - app.api.v1.endpoints.auth - INFO - Channel adda70e7-d4e1-4abb-9027-cb2211a28fc2 initialized successfully
2025-04-01 12:48:47,174 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 12:48:47,174 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 12:48:47,323 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 12:48:47,324 - app.services.connection_manager - INFO - User 2 connected to server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:48:47,324 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 12:48:47,326 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 12:48:52,669 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 12:48:52,672 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 12:48:55,375 - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:55.375303", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:55,375 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:48:55.375303", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:48:55,378 - app.api.v1.endpoints.users - INFO - Search request received, channel: adda70e7-d4e1-4abb-9027-cb2211a28fc2
2025-04-01 12:48:55,378 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743502724}
2025-04-01 12:48:55,379 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-04-01 12:48:55,379 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-04-01 12:48:55,379 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-04-01 12:48:55,381 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 12:48:55,382 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 12:48:55,382 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 12:48:55,382 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 12:48:58,463 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 12:48:58,470 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 12:48:59,720 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 12:48:59,728 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 12:48:59,728 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 12:48:59,731 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 12:48:59,811 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 12:48:59,814 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 12:49:00,069 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 12:49:00,072 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 12:49:00,667 - INFO - Incoming request: {"timestamp": "2025-04-01T09:49:00.667723", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:49:00,667 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T09:49:00.667723", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 12:49:00,675 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 12:49:00,675 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 12:49:00,688 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 12:49:00,689 - app.services.connection_manager - INFO - User 2 disconnected from server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:49:00,730 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 12:49:00,731 - app.services.connection_manager - INFO - User 2 connected to server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:49:00,731 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 12:49:00,733 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 12:49:14,693 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 2 to 3
2025-04-01 12:49:14,695 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 2 to 3
2025-04-01 12:49:14,922 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-04-01 12:49:14,929 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-04-01 12:49:14,929 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-04-01 12:49:14,931 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-04-01 12:49:14,931 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-04-01 12:49:14,933 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-04-01 12:49:47,719 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 12:49:47,720 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 12:49:47,721 - app.services.connection_manager - INFO - User 3 disconnected from server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:49:47,722 - app.services.connection_manager - INFO - User 3 disconnected from server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:49:48,444 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 12:49:48,445 - app.services.connection_manager - INFO - User 2 disconnected from server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:49:48,446 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 12:49:48,447 - app.services.connection_manager - INFO - User 2 disconnected from server 7305c0b1-c6bb-4fbb-b19d-9700a3b1880a
2025-04-01 12:50:52,227 - app.main - INFO - Shutting down server...
2025-04-01 12:50:52,228 - app.main - INFO - Redis connections closed
2025-04-01 12:50:52,228 - app.main - INFO - Server shutdown completed
2025-04-01 16:34:10,062 - app.main - INFO - Starting up server...
2025-04-01 16:34:10,063 - app.main - INFO - Redis initialized
2025-04-01 16:34:10,186 - app.main - INFO - Database initialized
2025-04-01 16:34:10,244 - app.main - INFO - Server key pair generated
2025-04-01 16:34:10,245 - app.main - INFO - Server startup completed successfully
2025-04-01 16:36:41,448 - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:41.448310", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:41,448 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:41.448310", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:41,449 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 16:36:41,449 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 16:36:49,655 - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:49.655210", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:49,655 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:49.655210", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:49,660 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 600f3530-9d92-4076-abe0-2c8ea3496e88
2025-04-01 16:36:49,660 - app.services.secure_channel_service - INFO - Creating channel with ID: 600f3530-9d92-4076-abe0-2c8ea3496e88
2025-04-01 16:36:49,669 - app.services.secure_channel_service - INFO - Channel 600f3530-9d92-4076-abe0-2c8ea3496e88 saved to Redis with TTL 1800 seconds
2025-04-01 16:36:49,671 - app.api.v1.endpoints.auth - INFO - Channel 600f3530-9d92-4076-abe0-2c8ea3496e88 initialized successfully
2025-04-01 16:36:49,671 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 16.003}
2025-04-01 16:36:49,671 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 16.003}
2025-04-01 16:36:49,859 - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:49.859257", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:49,859 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:49.859257", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:49,861 - app.api.v1.endpoints.auth - INFO - Login request using channel: 600f3530-9d92-4076-abe0-2c8ea3496e88
2025-04-01 16:36:49,863 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"2825b65d-f494-4540-8ff8-f585a6bbd1ae"}
2025-04-01 16:36:49,864 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '2825b65d-f494-4540-8ff8-f585a6bbd1ae'}
2025-04-01 16:36:50,123 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-04-01 16:36:50,127 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 16:36:50,127 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 16:36:50,128 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 16:36:50,129 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 270.061}
2025-04-01 16:36:50,129 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 270.061}
2025-04-01 16:36:50,621 - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:50.621480", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:50,621 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:36:50.621480", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:36:50,622 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 564b5229-58f9-47cd-b47c-dc4dc056db6c
2025-04-01 16:36:50,622 - app.services.secure_channel_service - INFO - Creating channel with ID: 564b5229-58f9-47cd-b47c-dc4dc056db6c
2025-04-01 16:36:50,623 - app.services.secure_channel_service - INFO - Channel 564b5229-58f9-47cd-b47c-dc4dc056db6c saved to Redis with TTL 1800 seconds
2025-04-01 16:36:50,623 - app.api.v1.endpoints.auth - INFO - Channel 564b5229-58f9-47cd-b47c-dc4dc056db6c initialized successfully
2025-04-01 16:36:50,623 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 16:36:50,623 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 16:36:50,670 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:36:50,674 - app.services.connection_manager - INFO - User 2 connected to server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:36:50,674 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:36:50,678 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:36:52,021 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:36:52,022 - app.services.connection_manager - INFO - User 2 connected to server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:36:52,022 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:36:52,025 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:37:00,164 - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:00.164944", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:00,164 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:00.164944", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:00,165 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-01 16:37:00,165 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-01 16:37:07,851 - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:07.851280", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:07,851 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:07.851280", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:07,852 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: efb6bb69-9acc-4476-af14-77ee7fc5660f
2025-04-01 16:37:07,852 - app.services.secure_channel_service - INFO - Creating channel with ID: efb6bb69-9acc-4476-af14-77ee7fc5660f
2025-04-01 16:37:07,853 - app.services.secure_channel_service - INFO - Channel efb6bb69-9acc-4476-af14-77ee7fc5660f saved to Redis with TTL 1800 seconds
2025-04-01 16:37:07,853 - app.api.v1.endpoints.auth - INFO - Channel efb6bb69-9acc-4476-af14-77ee7fc5660f initialized successfully
2025-04-01 16:37:07,853 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 16:37:07,853 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0}
2025-04-01 16:37:08,094 - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:08.094356", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:08,094 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:08.094356", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:08,095 - app.api.v1.endpoints.auth - INFO - Login request using channel: efb6bb69-9acc-4476-af14-77ee7fc5660f
2025-04-01 16:37:08,096 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"3e1f356f-fe00-4d99-9321-1f477067bead"}
2025-04-01 16:37:08,096 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '3e1f356f-fe00-4d99-9321-1f477067bead'}
2025-04-01 16:37:08,304 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-04-01 16:37:08,306 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 16:37:08,306 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 16:37:08,306 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 16:37:08,307 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 213.047}
2025-04-01 16:37:08,307 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 213.047}
2025-04-01 16:37:09,018 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:37:09,019 - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:09.019603", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:09,019 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:09.019603", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:37:09,020 - app.services.connection_manager - INFO - User 3 connected to server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:37:09,020 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:37:09,022 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:37:09,023 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 619fb515-6915-4ad6-a864-999aef481341
2025-04-01 16:37:09,023 - app.services.secure_channel_service - INFO - Creating channel with ID: 619fb515-6915-4ad6-a864-999aef481341
2025-04-01 16:37:09,023 - app.services.secure_channel_service - INFO - Channel 619fb515-6915-4ad6-a864-999aef481341 saved to Redis with TTL 1800 seconds
2025-04-01 16:37:09,024 - app.api.v1.endpoints.auth - INFO - Channel 619fb515-6915-4ad6-a864-999aef481341 initialized successfully
2025-04-01 16:37:09,024 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 16:37:09,024 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 16:37:09,981 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:37:09,982 - app.services.connection_manager - INFO - User 3 connected to server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:37:09,982 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:37:09,984 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:37:27,521 - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:27.521159", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:37:27,521 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:37:27.521159", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:37:27,524 - app.api.v1.endpoints.users - INFO - Search request received, channel: 564b5229-58f9-47cd-b47c-dc4dc056db6c
2025-04-01 16:37:27,524 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '2', 'username': 'YuDev', 'sub': '2', 'exp': 1743516410}
2025-04-01 16:37:27,525 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mir","limit":10}
2025-04-01 16:37:27,525 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mir', 'limit': 10}
2025-04-01 16:37:27,525 - app.api.v1.endpoints.users - INFO - Searching users with query 'mir', excluding user 2
2025-04-01 16:37:27,528 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 16:37:27,528 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 16:37:27,529 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 16:37:27,529 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 16:37:29,515 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 16:37:29,518 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 16:37:30,179 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 16:37:30,182 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 16:37:30,291 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 16:37:30,294 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 16:37:30,907 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 16:37:30,910 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 16:37:30,970 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 16:37:30,972 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 16:39:10,087 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:39:10,088 - app.services.connection_manager - INFO - User 3 disconnected from server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:39:10,091 - INFO - Incoming request: {"timestamp": "2025-04-01T13:39:10.091827", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:39:10,091 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:39:10.091827", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:39:10,098 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 16:39:10,098 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 16:39:10,132 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:39:10,133 - app.services.connection_manager - INFO - User 3 connected to server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:39:10,133 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:39:10,134 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:41:19,093 - INFO - Incoming request: {"timestamp": "2025-04-01T13:41:19.092518", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:41:19,093 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:41:19.092518", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:41:19,097 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 16:41:19,097 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 16:41:19,098 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:41:19,100 - app.services.connection_manager - INFO - User 2 disconnected from server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:41:19,154 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:41:19,155 - app.services.connection_manager - INFO - User 2 connected to server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:41:19,155 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:41:19,157 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:46:30,448 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:46:30,448 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:46:30,449 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:46:30,449 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:46:30,451 - app.services.connection_manager - INFO - User 2 disconnected from server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:46:30,453 - app.services.connection_manager - INFO - User 3 disconnected from server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:46:30,453 - app.services.connection_manager - INFO - User 3 disconnected from server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:46:30,453 - app.services.connection_manager - INFO - User 2 disconnected from server 814d3a9f-0706-4f7f-ab3a-4d40b48a7a23
2025-04-01 16:46:30,557 - app.main - INFO - Shutting down server...
2025-04-01 16:46:30,558 - app.main - INFO - Redis connections closed
2025-04-01 16:46:30,558 - app.main - INFO - Server shutdown completed
2025-04-01 16:46:33,068 - app.main - INFO - Starting up server...
2025-04-01 16:46:33,069 - app.main - INFO - Redis initialized
2025-04-01 16:46:33,112 - app.main - INFO - Database initialized
2025-04-01 16:46:33,124 - app.main - INFO - Server key pair generated
2025-04-01 16:46:33,124 - app.main - INFO - Server startup completed successfully
2025-04-01 16:46:35,487 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:46:35,498 - app.services.connection_manager - INFO - User 2 connected to server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:46:35,498 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:46:35,503 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:46:35,668 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:46:35,670 - app.services.connection_manager - INFO - User 3 connected to server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:46:35,671 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:46:35,672 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:46:37,396 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 16:46:37,404 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 16:46:39,692 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 16:46:39,695 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 16:46:46,078 - INFO - Incoming request: {"timestamp": "2025-04-01T13:46:46.078370", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:46:46,078 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:46:46.078370", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:46:46,080 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 96d02267-5d8d-49b5-b379-be1cb6bd274f
2025-04-01 16:46:46,080 - app.services.secure_channel_service - INFO - Creating channel with ID: 96d02267-5d8d-49b5-b379-be1cb6bd274f
2025-04-01 16:46:46,083 - app.services.secure_channel_service - INFO - Channel 96d02267-5d8d-49b5-b379-be1cb6bd274f saved to Redis with TTL 1800 seconds
2025-04-01 16:46:46,083 - app.api.v1.endpoints.auth - INFO - Channel 96d02267-5d8d-49b5-b379-be1cb6bd274f initialized successfully
2025-04-01 16:46:46,083 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.991}
2025-04-01 16:46:46,083 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.991}
2025-04-01 16:46:46,135 - INFO - Incoming request: {"timestamp": "2025-04-01T13:46:46.135372", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:46:46,135 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:46:46.135372", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:46:46,138 - app.api.v1.endpoints.users - INFO - Search request received, channel: 96d02267-5d8d-49b5-b379-be1cb6bd274f
2025-04-01 16:46:46,138 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743516679}
2025-04-01 16:46:46,139 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"m","limit":10}
2025-04-01 16:46:46,139 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'm', 'limit': 10}
2025-04-01 16:46:46,140 - app.api.v1.endpoints.users - INFO - Searching users with query 'm', excluding user 2
2025-04-01 16:46:46,141 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 16:46:46,141 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 16:46:46,142 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 16:46:46,142 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 16:46:48,295 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 16:46:48,297 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'YuDev' to chat.init message
2025-04-01 16:46:48,303 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 16:46:49,247 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 16:46:49,248 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 16:46:49,250 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 16:46:49,372 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 16:46:49,372 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 16:46:49,373 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 16:46:49,412 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 16:46:49,412 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 16:46:49,414 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 16:46:49,416 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 16:46:49,480 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 16:46:49,485 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 16:46:49,485 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 16:46:49,489 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 16:47:05,479 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:47:05,567 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:47:35,499 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:47:35,565 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:48:05,478 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:48:05,567 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:48:35,478 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:48:35,566 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:48:55,476 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:48:55,479 - app.services.connection_manager - INFO - User 3 connected to server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:48:55,479 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:48:55,480 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:48:58,377 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:48:58,379 - app.services.connection_manager - INFO - User 2 connected to server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:48:58,379 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:48:58,385 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:49:05,476 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:49:05,568 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:49:25,429 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:49:28,337 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:49:35,479 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:49:35,560 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:49:55,419 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:49:58,312 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:50:05,479 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:50:05,566 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:50:25,415 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:50:28,312 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:50:35,480 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:50:35,566 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:50:55,418 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:50:58,314 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:51:05,478 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:51:05,564 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:51:25,418 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:51:28,313 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:51:31,018 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:51:31,018 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:51:31,019 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:51:31,019 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:51:31,022 - app.services.connection_manager - INFO - User 2 disconnected from server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:51:31,022 - app.services.connection_manager - INFO - User 2 disconnected from server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:51:31,023 - app.services.connection_manager - INFO - User 3 disconnected from server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:51:31,023 - app.services.connection_manager - INFO - User 3 disconnected from server 06eb4960-24dc-4cea-a86a-0ffd2c4a5147
2025-04-01 16:51:31,113 - app.main - INFO - Shutting down server...
2025-04-01 16:51:31,114 - app.main - INFO - Redis connections closed
2025-04-01 16:51:31,115 - app.main - INFO - Server shutdown completed
2025-04-01 16:51:32,162 - app.main - INFO - Starting up server...
2025-04-01 16:51:32,163 - app.main - INFO - Redis initialized
2025-04-01 16:51:32,209 - app.main - INFO - Database initialized
2025-04-01 16:51:32,242 - app.main - INFO - Server key pair generated
2025-04-01 16:51:32,242 - app.main - INFO - Server startup completed successfully
2025-04-01 16:51:36,041 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:51:36,054 - app.services.connection_manager - INFO - User 2 connected to server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:51:36,054 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:51:36,064 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:51:36,067 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:51:36,069 - app.services.connection_manager - INFO - User 2 connected to server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:51:36,069 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:51:36,070 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:51:36,473 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:51:36,475 - app.services.connection_manager - INFO - User 3 connected to server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:51:36,475 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:51:36,476 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:51:36,479 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:51:36,481 - app.services.connection_manager - INFO - User 3 connected to server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:51:36,481 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:51:36,482 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:51:50,662 - INFO - Incoming request: {"timestamp": "2025-04-01T13:51:50.662491", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:51:50,662 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:51:50.662491", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:51:50,675 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.003}
2025-04-01 16:51:50,675 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 13.003}
2025-04-01 16:51:50,727 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:51:50,729 - app.services.connection_manager - INFO - User 2 connected to server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:51:50,729 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:51:50,730 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:52:06,062 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:52:06,467 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:52:06,467 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:52:08,824 - INFO - Incoming request: {"timestamp": "2025-04-01T13:52:08.824300", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:52:08,824 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:52:08.824300", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:52:08,831 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 16:52:08,831 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 16:52:08,904 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:52:08,906 - app.services.connection_manager - INFO - User 3 connected to server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:52:08,906 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:52:08,908 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:52:20,719 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:52:36,062 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:52:36,470 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:52:38,902 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:52:50,719 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:53:06,065 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:53:06,468 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:53:08,898 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:53:09,823 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:53:09,824 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:53:09,824 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:53:09,825 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:53:09,825 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:53:09,826 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:53:09,830 - app.services.connection_manager - INFO - User 3 disconnected from server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:53:09,830 - app.services.connection_manager - INFO - User 2 disconnected from server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:53:09,831 - app.services.connection_manager - INFO - User 3 disconnected from server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:53:09,831 - app.services.connection_manager - INFO - User 2 disconnected from server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:53:09,831 - app.services.connection_manager - INFO - User 2 disconnected from server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:53:09,831 - app.services.connection_manager - INFO - User 3 disconnected from server 95a11d8b-1d7e-4d6c-890f-44b5e7accf86
2025-04-01 16:53:09,917 - app.main - INFO - Shutting down server...
2025-04-01 16:53:09,918 - app.main - INFO - Redis connections closed
2025-04-01 16:53:09,918 - app.main - INFO - Server shutdown completed
2025-04-01 16:53:12,285 - app.main - INFO - Starting up server...
2025-04-01 16:53:12,286 - app.main - INFO - Redis initialized
2025-04-01 16:53:12,331 - app.main - INFO - Database initialized
2025-04-01 16:53:12,367 - app.main - INFO - Server key pair generated
2025-04-01 16:53:12,367 - app.main - INFO - Server startup completed successfully
2025-04-01 16:53:14,849 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:53:14,859 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:53:15,007 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:53:15,044 - app.services.connection_manager - INFO - User 2 connected to server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:15,044 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:53:15,049 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:53:15,050 - app.services.connection_manager - INFO - User 2 connected to server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:15,050 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:53:15,055 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:53:15,056 - app.services.connection_manager - INFO - User 3 connected to server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:15,057 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:53:15,061 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:53:15,112 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:53:15,114 - app.services.connection_manager - INFO - User 3 connected to server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:15,114 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:53:15,115 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:53:15,478 - INFO - Incoming request: {"timestamp": "2025-04-01T13:53:15.478105", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:53:15,478 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:53:15.478105", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:53:15,481 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:53:15,495 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.003999999999998}
2025-04-01 16:53:15,495 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.003999999999998}
2025-04-01 16:53:15,496 - app.services.connection_manager - INFO - User 3 disconnected from server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:15,525 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:53:15,527 - app.services.connection_manager - INFO - User 3 connected to server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:15,528 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:53:15,528 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:53:19,729 - INFO - Incoming request: {"timestamp": "2025-04-01T13:53:19.729752", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:53:19,729 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:53:19.729752", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:53:19,733 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.994}
2025-04-01 16:53:19,733 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.994}
2025-04-01 16:53:19,741 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:53:19,743 - app.services.connection_manager - INFO - User 2 disconnected from server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:19,770 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:53:19,772 - app.services.connection_manager - INFO - User 2 connected to server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:53:19,772 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:53:19,773 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:53:45,536 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:53:49,770 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:54:15,521 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 3: missing required fields
2025-04-01 16:54:19,768 - app.api.v1.endpoints.websocket - WARNING - Received malformed message from user 2: missing required fields
2025-04-01 16:54:34,151 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:54:34,152 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:54:34,152 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:54:34,153 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:54:34,154 - app.services.connection_manager - INFO - User 2 disconnected from server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:54:34,155 - app.services.connection_manager - INFO - User 2 disconnected from server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:54:34,155 - app.services.connection_manager - INFO - User 3 disconnected from server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:54:34,156 - app.services.connection_manager - INFO - User 3 disconnected from server eeaab03c-7e4d-4665-9d00-df591ad29581
2025-04-01 16:54:34,262 - app.main - INFO - Shutting down server...
2025-04-01 16:54:34,263 - app.main - INFO - Redis connections closed
2025-04-01 16:54:34,263 - app.main - INFO - Server shutdown completed
2025-04-01 16:54:36,534 - app.main - INFO - Starting up server...
2025-04-01 16:54:36,534 - app.main - INFO - Redis initialized
2025-04-01 16:54:36,691 - app.main - INFO - Database initialized
2025-04-01 16:54:36,761 - app.main - INFO - Server key pair generated
2025-04-01 16:54:36,761 - app.main - INFO - Server startup completed successfully
2025-04-01 16:54:39,197 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:54:39,209 - app.services.connection_manager - INFO - User 2 connected to server 713a25d7-8fc3-4aac-85d5-3e05d1d88c43
2025-04-01 16:54:39,210 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:54:39,217 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:54:39,358 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:54:39,360 - app.services.connection_manager - INFO - User 3 connected to server 713a25d7-8fc3-4aac-85d5-3e05d1d88c43
2025-04-01 16:54:39,360 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:54:39,361 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:55:09,167 - app.api.v1.endpoints.websocket - INFO - Received ping message from user 2 to None
2025-04-01 16:55:09,168 - app.api.v1.endpoints.websocket - ERROR - WebSocket error for user 2: 'str' object has no attribute 'last_seen'
2025-04-01 16:55:09,169 - app.api.v1.endpoints.websocket - ERROR - Error traceback: Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\app\api\v1\endpoints\websocket.py", line 111, in websocket_endpoint
    user_id.last_seen = datetime.utcnow()
AttributeError: 'str' object has no attribute 'last_seen'

2025-04-01 16:55:09,170 - app.services.connection_manager - INFO - User 2 disconnected from server 713a25d7-8fc3-4aac-85d5-3e05d1d88c43
2025-04-01 16:55:09,338 - app.api.v1.endpoints.websocket - INFO - Received ping message from user 3 to None
2025-04-01 16:55:09,339 - app.api.v1.endpoints.websocket - ERROR - WebSocket error for user 3: 'str' object has no attribute 'last_seen'
2025-04-01 16:55:09,339 - app.api.v1.endpoints.websocket - ERROR - Error traceback: Traceback (most recent call last):
  File "C:\Users\yusen\PycharmProjects\YuMSGServer\app\api\v1\endpoints\websocket.py", line 111, in websocket_endpoint
    user_id.last_seen = datetime.utcnow()
AttributeError: 'str' object has no attribute 'last_seen'

2025-04-01 16:55:09,340 - app.services.connection_manager - INFO - User 3 disconnected from server 713a25d7-8fc3-4aac-85d5-3e05d1d88c43
2025-04-01 16:55:20,333 - app.main - INFO - Shutting down server...
2025-04-01 16:55:20,334 - app.main - INFO - Redis connections closed
2025-04-01 16:55:20,334 - app.main - INFO - Server shutdown completed
2025-04-01 16:58:29,618 - app.main - INFO - Starting up server...
2025-04-01 16:58:29,618 - app.main - INFO - Redis initialized
2025-04-01 16:58:29,662 - app.main - INFO - Database initialized
2025-04-01 16:58:29,693 - app.main - INFO - Server key pair generated
2025-04-01 16:58:29,693 - app.main - INFO - Server startup completed successfully
2025-04-01 16:58:30,818 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:58:30,830 - app.services.connection_manager - INFO - User 2 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:58:30,830 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:58:30,840 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:58:37,679 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 16:58:37,684 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 16:58:45,380 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:58:45,382 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:58:45,382 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:58:45,388 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:58:45,389 - app.services.message_buffer - INFO - Retrieved and cleared 1 messages for user 3
2025-04-01 16:58:45,389 - app.api.v1.endpoints.websocket - INFO - Delivering 1 buffered messages to user 3
2025-04-01 16:58:45,497 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 16:58:45,500 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 16:58:52,817 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:58:52,818 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:22,889 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 16:59:22,890 - app.services.connection_manager - INFO - User 2 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:27,727 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:27.727726", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:59:27,727 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:27.727726", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:59:27,728 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 16:59:27,728 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 16:59:28,159 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:28.159023", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:59:28,159 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:28.159023", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:59:28,170 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-04-01 16:59:28,170 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 11.003}
2025-04-01 16:59:28,360 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:59:28,362 - app.services.connection_manager - INFO - User 2 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:28,362 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:59:28,364 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:59:28,890 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:28.890326", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:59:28,890 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:28.890326", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 16:59:28,892 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: fa1ab939-14b7-4e9f-bdc7-7316a3e8460e
2025-04-01 16:59:28,892 - app.services.secure_channel_service - INFO - Creating channel with ID: fa1ab939-14b7-4e9f-bdc7-7316a3e8460e
2025-04-01 16:59:28,894 - app.services.secure_channel_service - INFO - Channel fa1ab939-14b7-4e9f-bdc7-7316a3e8460e saved to Redis with TTL 1800 seconds
2025-04-01 16:59:28,895 - app.api.v1.endpoints.auth - INFO - Channel fa1ab939-14b7-4e9f-bdc7-7316a3e8460e initialized successfully
2025-04-01 16:59:28,896 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 16:59:28,896 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 16:59:29,863 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 16:59:29,865 - app.services.connection_manager - INFO - User 2 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:29,865 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 16:59:29,867 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 16:59:50,233 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:50.233866", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:50,233 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:50.233866", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:50,234 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 16:59:50,234 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 16:59:50,501 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:50.500470", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:50,501 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:50.500470", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:50,508 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 16:59:50,508 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 16:59:50,579 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:59:50,581 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:50,581 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:59:50,582 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:59:51,395 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:51.395142", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:51,395 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:51.395142", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:51,396 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: feaaf85a-8e2e-4b10-a6b2-4020c188056a
2025-04-01 16:59:51,396 - app.services.secure_channel_service - INFO - Creating channel with ID: feaaf85a-8e2e-4b10-a6b2-4020c188056a
2025-04-01 16:59:51,397 - app.services.secure_channel_service - INFO - Channel feaaf85a-8e2e-4b10-a6b2-4020c188056a saved to Redis with TTL 1800 seconds
2025-04-01 16:59:51,397 - app.api.v1.endpoints.auth - INFO - Channel feaaf85a-8e2e-4b10-a6b2-4020c188056a initialized successfully
2025-04-01 16:59:51,397 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-01 16:59:51,397 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-01 16:59:51,645 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:59:51,647 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:51,647 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:59:51,648 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 16:59:52,834 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 16:59:52,835 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:52,841 - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:52.841737", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:52,841 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T13:59:52.841737", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 16:59:52,844 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.839}
2025-04-01 16:59:52,844 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.839}
2025-04-01 16:59:52,876 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 16:59:52,878 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 16:59:52,878 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 16:59:52,879 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 17:00:09,940 - INFO - Incoming request: {"timestamp": "2025-04-01T14:00:09.940034", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.186"}
2025-04-01 17:00:09,940 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T14:00:09.940034", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.186"}
2025-04-01 17:00:09,944 - app.api.v1.endpoints.users - INFO - Search request received, channel: feaaf85a-8e2e-4b10-a6b2-4020c188056a
2025-04-01 17:00:09,944 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743517792}
2025-04-01 17:00:09,945 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-04-01 17:00:09,945 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-04-01 17:00:09,945 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-04-01 17:00:09,947 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 17:00:09,948 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 17:00:09,949 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-04-01 17:00:09,949 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 9.001999999999999}
2025-04-01 17:00:11,745 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-04-01 17:00:11,747 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'MiraiX' to chat.init message
2025-04-01 17:00:11,753 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-04-01 17:00:12,295 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-04-01 17:00:12,296 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'YuDev' to chat.key_exchange message
2025-04-01 17:00:12,303 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-04-01 17:00:12,529 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 17:00:12,536 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 17:00:12,536 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 17:00:12,538 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 17:00:13,054 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-04-01 17:00:13,055 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'YuDev' to chat.key_exchange message
2025-04-01 17:00:13,058 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-04-01 17:00:13,259 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 17:00:13,262 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 17:00:13,262 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 17:00:13,264 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 17:04:04,767 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 17:04:04,769 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:04:04,769 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 17:04:04,775 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 17:14:28,259 - INFO - Incoming request: {"timestamp": "2025-04-01T14:14:28.259433", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 17:14:28,259 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T14:14:28.259433", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 17:14:28,263 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 17:14:28,263 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 17:14:28,302 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 17:14:28,303 - app.services.connection_manager - INFO - User 2 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:14:28,304 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 17:14:28,304 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 17:14:50,590 - INFO - Incoming request: {"timestamp": "2025-04-01T14:14:50.590820", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 17:14:50,590 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T14:14:50.590820", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 17:14:50,595 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 17:14:50,595 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 17:14:50,653 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 17:14:50,655 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:14:50,655 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 17:14:50,656 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 17:29:28,259 - INFO - Incoming request: {"timestamp": "2025-04-01T14:29:28.259883", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 17:29:28,259 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T14:29:28.259883", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 17:29:28,267 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 17:29:28,267 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 17:29:28,324 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 17:29:28,326 - app.services.connection_manager - INFO - User 2 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:29:28,326 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 17:29:28,327 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 17:29:50,588 - INFO - Incoming request: {"timestamp": "2025-04-01T14:29:50.588159", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 17:29:50,588 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T14:29:50.588159", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 17:29:50,596 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-04-01 17:29:50,596 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.001}
2025-04-01 17:29:50,674 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 17:29:50,676 - app.services.connection_manager - INFO - User 3 connected to server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:29:50,676 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 17:29:50,677 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 17:34:26,064 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 17:34:26,066 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 17:34:26,066 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 17:34:26,069 - app.services.connection_manager - INFO - User 2 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,070 - app.services.connection_manager - INFO - User 2 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,071 - app.services.connection_manager - INFO - User 2 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,079 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 17:34:26,080 - app.services.connection_manager - INFO - User 2 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,831 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 17:34:26,832 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 17:34:26,832 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 17:34:26,833 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 17:34:26,833 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 17:34:26,835 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,836 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,836 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,838 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 17:34:26,838 - app.services.connection_manager - INFO - User 3 disconnected from server 07d7d792-015a-4d21-baa6-f6806cd65beb
2025-04-01 18:58:42,573 - app.main - INFO - Shutting down server...
2025-04-01 18:58:42,575 - app.main - INFO - Redis connections closed
2025-04-01 18:58:42,575 - app.main - INFO - Server shutdown completed
2025-04-01 19:09:33,132 - app.main - INFO - Starting up server...
2025-04-01 19:09:33,133 - app.main - INFO - Redis initialized
2025-04-01 19:09:33,183 - app.main - INFO - Database initialized
2025-04-01 19:09:33,201 - app.main - INFO - Server key pair generated
2025-04-01 19:09:33,201 - app.main - INFO - Server startup completed successfully
2025-04-01 19:09:33,723 - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:33.723728", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:33,723 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:33.723728", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:33,724 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 19:09:33,724 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 19:09:34,060 - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:34.060803", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:34,060 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:34.060803", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:34,081 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 21.144}
2025-04-01 19:09:34,081 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 21.144}
2025-04-01 19:09:35,369 - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:35.369459", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:35,369 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:35.369459", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:35,371 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 05941c02-4fe6-48d3-b03f-b6eaf85c0a6b
2025-04-01 19:09:35,371 - app.services.secure_channel_service - INFO - Creating channel with ID: 05941c02-4fe6-48d3-b03f-b6eaf85c0a6b
2025-04-01 19:09:35,376 - app.services.secure_channel_service - INFO - Channel 05941c02-4fe6-48d3-b03f-b6eaf85c0a6b saved to Redis with TTL 1800 seconds
2025-04-01 19:09:35,377 - app.api.v1.endpoints.auth - INFO - Channel 05941c02-4fe6-48d3-b03f-b6eaf85c0a6b initialized successfully
2025-04-01 19:09:35,377 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 19:09:35,377 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 8.002}
2025-04-01 19:09:35,443 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 19:09:35,450 - app.services.connection_manager - INFO - User 3 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:09:35,451 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 19:09:35,457 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 19:09:36,893 - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:36.893924", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:36,893 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:09:36.893924", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:09:36,897 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 19:09:36,897 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 19:09:36,951 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 19:09:36,951 - app.services.connection_manager - INFO - User 3 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:09:36,967 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-01 19:09:36,969 - app.services.connection_manager - INFO - User 3 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:09:36,969 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-01 19:09:36,970 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-01 19:09:39,794 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 19:09:39,799 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 19:10:08,787 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:08.787859", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:08,787 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:08.787859", "method": "GET", "path": "/", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:08,788 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 19:10:08,788 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.0}
2025-04-01 19:10:16,248 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:16.248599", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:16,248 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:16.248599", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:16,249 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 8735758d-c41b-41ac-af01-966d8d236765
2025-04-01 19:10:16,249 - app.services.secure_channel_service - INFO - Creating channel with ID: 8735758d-c41b-41ac-af01-966d8d236765
2025-04-01 19:10:16,250 - app.services.secure_channel_service - INFO - Channel 8735758d-c41b-41ac-af01-966d8d236765 saved to Redis with TTL 1800 seconds
2025-04-01 19:10:16,250 - app.api.v1.endpoints.auth - INFO - Channel 8735758d-c41b-41ac-af01-966d8d236765 initialized successfully
2025-04-01 19:10:16,250 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-01 19:10:16,250 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-01 19:10:16,429 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:16.429814", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:16,429 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:16.429814", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:16,431 - app.api.v1.endpoints.auth - INFO - Login request using channel: 8735758d-c41b-41ac-af01-966d8d236765
2025-04-01 19:10:16,433 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"fec25222-497a-4568-85a3-2e1c2c24eed1"}
2025-04-01 19:10:16,433 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': 'fec25222-497a-4568-85a3-2e1c2c24eed1'}
2025-04-01 19:10:16,660 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-04-01 19:10:16,666 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-01 19:10:16,666 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-01 19:10:16,667 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-01 19:10:16,667 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 238.053}
2025-04-01 19:10:16,667 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 238.053}
2025-04-01 19:10:18,278 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:18.278633", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:18,278 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:18.278633", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:18,280 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: e45bacc1-1966-4ae2-8749-7713cee3803f
2025-04-01 19:10:18,280 - app.services.secure_channel_service - INFO - Creating channel with ID: e45bacc1-1966-4ae2-8749-7713cee3803f
2025-04-01 19:10:18,280 - app.services.secure_channel_service - INFO - Channel e45bacc1-1966-4ae2-8749-7713cee3803f saved to Redis with TTL 1800 seconds
2025-04-01 19:10:18,281 - app.api.v1.endpoints.auth - INFO - Channel e45bacc1-1966-4ae2-8749-7713cee3803f initialized successfully
2025-04-01 19:10:18,281 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-04-01 19:10:18,281 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0}
2025-04-01 19:10:19,571 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:10:19,573 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:10:19,574 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:10:19,580 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:10:19,581 - app.services.message_buffer - INFO - Retrieved and cleared 1 messages for user 2
2025-04-01 19:10:19,581 - app.api.v1.endpoints.websocket - INFO - Delivering 1 buffered messages to user 2
2025-04-01 19:10:29,904 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:29.904548", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:29,904 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:29.904548", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:29,909 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 19:10:29,909 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 19:10:29,956 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:10:29,958 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:10:29,958 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:10:29,959 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:10:29,961 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:10:29,962 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:10:29,962 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:10:29,963 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:10:29,968 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:10:29,970 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:10:29,970 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:10:29,971 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:10:42,474 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:42.473136", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:42,474 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:42.473136", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:42,476 - app.api.v1.endpoints.users - INFO - Search request received, channel: e45bacc1-1966-4ae2-8749-7713cee3803f
2025-04-01 19:10:42,476 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743525629}
2025-04-01 19:10:42,477 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"m","limit":10}
2025-04-01 19:10:42,477 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'm', 'limit': 10}
2025-04-01 19:10:42,477 - app.api.v1.endpoints.users - INFO - Searching users with query 'm', excluding user 2
2025-04-01 19:10:42,479 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 19:10:42,479 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 19:10:42,480 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-04-01 19:10:42,480 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-04-01 19:10:43,751 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:43.751199", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:43,751 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:43.751199", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:43,753 - app.api.v1.endpoints.users - INFO - Search request received, channel: e45bacc1-1966-4ae2-8749-7713cee3803f
2025-04-01 19:10:43,753 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743525629}
2025-04-01 19:10:43,755 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"ml","limit":10}
2025-04-01 19:10:43,755 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'ml', 'limit': 10}
2025-04-01 19:10:43,755 - app.api.v1.endpoints.users - INFO - Searching users with query 'ml', excluding user 2
2025-04-01 19:10:43,755 - app.api.v1.endpoints.users - INFO - Found 0 users
2025-04-01 19:10:43,756 - app.api.v1.endpoints.users - INFO - Encrypting search results: []
2025-04-01 19:10:43,756 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 19:10:43,756 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.001}
2025-04-01 19:10:44,757 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:44.757201", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:44,757 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:44.757201", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:10:44,760 - app.api.v1.endpoints.users - INFO - Search request received, channel: e45bacc1-1966-4ae2-8749-7713cee3803f
2025-04-01 19:10:44,760 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743525629}
2025-04-01 19:10:44,761 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"m","limit":10}
2025-04-01 19:10:44,761 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'm', 'limit': 10}
2025-04-01 19:10:44,761 - app.api.v1.endpoints.users - INFO - Searching users with query 'm', excluding user 2
2025-04-01 19:10:44,762 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 19:10:44,762 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 19:10:44,763 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-04-01 19:10:44,763 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.001}
2025-04-01 19:10:47,851 - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:47.851022", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:10:47,851 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:10:47.851022", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.186"}
2025-04-01 19:10:47,854 - app.api.v1.endpoints.users - INFO - Search request received, channel: 05941c02-4fe6-48d3-b03f-b6eaf85c0a6b
2025-04-01 19:10:47,854 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '3', 'exp': 1743525576}
2025-04-01 19:10:47,855 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-04-01 19:10:47,855 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-04-01 19:10:47,855 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-04-01 19:10:47,856 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 19:10:47,857 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 19:10:47,858 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 19:10:47,858 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-01 19:10:52,565 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 3 to 2
2025-04-01 19:10:52,566 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'MiraiX' to chat.init message
2025-04-01 19:10:52,568 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 3 to 2
2025-04-01 19:10:54,259 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-04-01 19:10:54,260 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'YuDev' to chat.key_exchange message
2025-04-01 19:10:54,267 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-04-01 19:10:54,283 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 2 to 3
2025-04-01 19:10:54,284 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'YuDev' to chat.key_exchange message
2025-04-01 19:10:54,286 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 2 to 3
2025-04-01 19:10:54,658 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 19:10:54,665 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 19:10:54,665 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 19:10:54,667 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 19:10:54,668 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 19:10:54,669 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 19:10:54,670 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 3 to 2
2025-04-01 19:10:54,671 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 3 to 2
2025-04-01 19:11:18,812 - app.api.v1.endpoints.websocket - INFO - Received chat.message message from user 2 to 3
2025-04-01 19:11:18,815 - app.api.v1.endpoints.websocket - INFO - Message of type chat.message routed from 2 to 3
2025-04-01 19:11:19,030 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-04-01 19:11:19,039 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-04-01 19:11:19,039 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-04-01 19:11:19,041 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-04-01 19:11:19,041 - app.api.v1.endpoints.websocket - INFO - Received chat.status message from user 3 to 2
2025-04-01 19:11:19,043 - app.api.v1.endpoints.websocket - INFO - Message of type chat.status routed from 3 to 2
2025-04-01 19:11:36,328 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:11:36,330 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:11:36,330 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:11:36,332 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:11:37,042 - INFO - Incoming request: {"timestamp": "2025-04-01T16:11:37.042360", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:11:37,042 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:11:37.042360", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:11:37,047 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 19:11:37,047 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 5.002000000000001}
2025-04-01 19:11:37,075 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:11:37,077 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:11:37,077 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:11:37,078 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:11:37,136 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:11:37,138 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:11:37,138 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:11:37,139 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:11:37,141 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:11:37,142 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:11:37,143 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:11:37,144 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:11:40,701 - INFO - Incoming request: {"timestamp": "2025-04-01T16:11:40.701704", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:11:40,701 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:11:40.701704", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:11:40,705 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 19:11:40,705 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 4.001}
2025-04-01 19:11:40,731 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:11:40,733 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:11:40,733 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:11:40,734 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:11:42,963 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 19:11:42,971 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 19:11:44,680 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 19:11:44,683 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 19:11:54,537 - INFO - Incoming request: {"timestamp": "2025-04-01T16:11:54.537660", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:11:54,537 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-01T16:11:54.537660", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.45.93"}
2025-04-01 19:11:54,540 - app.api.v1.endpoints.users - INFO - Search request received, channel: e45bacc1-1966-4ae2-8749-7713cee3803f
2025-04-01 19:11:54,540 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743525700}
2025-04-01 19:11:54,542 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-04-01 19:11:54,542 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-04-01 19:11:54,542 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-04-01 19:11:54,543 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-01 19:11:54,543 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-01 19:11:54,544 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-04-01 19:11:54,544 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.001}
2025-04-01 19:11:56,491 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-01 19:11:56,492 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'YuDev' to chat.init message
2025-04-01 19:11:56,494 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-01 19:11:58,117 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 19:11:58,118 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 19:11:58,124 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 19:11:58,124 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-01 19:11:58,125 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-01 19:11:58,126 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-01 19:11:58,163 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 19:11:58,166 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 19:11:58,166 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 19:11:58,168 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 19:11:58,196 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 19:11:58,199 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 19:11:58,199 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange_complete message from user 2 to 3
2025-04-01 19:11:58,202 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange_complete routed from 2 to 3
2025-04-01 19:13:32,399 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-01 19:13:32,402 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-01 19:13:35,339 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-01 19:13:35,348 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-01 19:14:30,353 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-01 19:14:30,355 - app.services.connection_manager - INFO - User 2 connected to server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:14:30,355 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-01 19:14:30,362 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-01 19:14:31,037 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-01 19:14:31,038 - app.services.connection_manager - INFO - User 3 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:14:34,125 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:14:34,126 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:14:34,126 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:14:34,127 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-01 19:14:34,129 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:14:34,130 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:14:34,130 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:14:34,131 - app.services.connection_manager - INFO - User 2 disconnected from server 9e2ab389-de10-4abe-b028-a7075d299563
2025-04-01 19:15:35,629 - app.main - INFO - Shutting down server...
2025-04-01 19:15:35,630 - app.main - INFO - Redis connections closed
2025-04-01 19:15:35,630 - app.main - INFO - Server shutdown completed
2025-04-02 13:00:16,805 - app.main - INFO - Starting up server...
2025-04-02 13:00:16,806 - app.main - INFO - Redis initialized
2025-04-02 13:00:16,900 - app.main - INFO - Database initialized
2025-04-02 13:00:17,007 - app.main - INFO - Server key pair generated
2025-04-02 13:00:17,007 - app.main - INFO - Server startup completed successfully
2025-04-02 13:00:28,922 - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:28.922064", "method": "GET", "path": "/", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:28,922 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:28.922064", "method": "GET", "path": "/", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:28,924 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-02 13:00:28,924 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-02 13:00:34,591 - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:34.591347", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:34,591 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:34.591347", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:34,595 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 2a2195a1-6db1-4962-a512-1287f1cc34f6
2025-04-02 13:00:34,595 - app.services.secure_channel_service - INFO - Creating channel with ID: 2a2195a1-6db1-4962-a512-1287f1cc34f6
2025-04-02 13:00:34,599 - app.services.secure_channel_service - INFO - Channel 2a2195a1-6db1-4962-a512-1287f1cc34f6 saved to Redis with TTL 1800 seconds
2025-04-02 13:00:34,601 - app.api.v1.endpoints.auth - INFO - Channel 2a2195a1-6db1-4962-a512-1287f1cc34f6 initialized successfully
2025-04-02 13:00:34,601 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-04-02 13:00:34,601 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 10.002}
2025-04-02 13:00:34,824 - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:34.824400", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:34,824 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:34.824400", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:34,827 - app.api.v1.endpoints.auth - INFO - Login request using channel: 2a2195a1-6db1-4962-a512-1287f1cc34f6
2025-04-02 13:00:34,830 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"yu@gmail.com","password":"123456","deviceId":"064138cc-f194-4b8d-afb1-f2950b35c0d2"}
2025-04-02 13:00:34,830 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'yu@gmail.com', 'password': '123456', 'deviceId': '064138cc-f194-4b8d-afb1-f2950b35c0d2'}
2025-04-02 13:00:35,089 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 2
2025-04-02 13:00:35,094 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-02 13:00:35,094 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-02 13:00:35,095 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-02 13:00:35,096 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 272.062}
2025-04-02 13:00:35,096 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 272.062}
2025-04-02 13:00:36,180 - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:36.180196", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:36,180 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:36.180196", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:36,182 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 30322ed9-da57-486d-b55a-1ed611efcf94
2025-04-02 13:00:36,182 - app.services.secure_channel_service - INFO - Creating channel with ID: 30322ed9-da57-486d-b55a-1ed611efcf94
2025-04-02 13:00:36,182 - app.services.secure_channel_service - INFO - Channel 30322ed9-da57-486d-b55a-1ed611efcf94 saved to Redis with TTL 1800 seconds
2025-04-02 13:00:36,183 - app.api.v1.endpoints.auth - INFO - Channel 30322ed9-da57-486d-b55a-1ed611efcf94 initialized successfully
2025-04-02 13:00:36,183 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-02 13:00:36,183 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-02 13:00:37,834 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-02 13:00:37,846 - app.services.connection_manager - INFO - User 2 connected to server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:00:37,846 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-02 13:00:37,850 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-02 13:00:45,201 - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:45.200080", "method": "GET", "path": "/", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:00:45,201 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:45.200080", "method": "GET", "path": "/", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:00:45,201 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-02 13:00:45,201 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 1.001}
2025-04-02 13:00:52,309 - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:52.309905", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:52,309 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:00:52.309905", "method": "POST", "path": "/auth/refresh", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:00:52,315 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.0}
2025-04-02 13:00:52,315 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 6.0}
2025-04-02 13:00:52,427 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-02 13:00:52,429 - app.services.connection_manager - INFO - User 2 connected to server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:00:52,429 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-02 13:00:52,431 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-02 13:00:52,439 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 2
2025-04-02 13:00:52,441 - app.services.connection_manager - INFO - User 2 connected to server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:00:52,441 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 2
2025-04-02 13:00:52,442 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 2
2025-04-02 13:00:52,451 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-02 13:00:52,452 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-02 13:00:52,453 - app.services.connection_manager - INFO - User 2 disconnected from server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:00:52,455 - app.services.connection_manager - INFO - User 2 disconnected from server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:01:25,927 - INFO - Incoming request: {"timestamp": "2025-04-02T10:01:25.927198", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:01:25,927 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:01:25.927198", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:01:25,928 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 7a78de9d-479b-4631-b8f7-7141b40b1dcc
2025-04-02 13:01:25,928 - app.services.secure_channel_service - INFO - Creating channel with ID: 7a78de9d-479b-4631-b8f7-7141b40b1dcc
2025-04-02 13:01:25,929 - app.services.secure_channel_service - INFO - Channel 7a78de9d-479b-4631-b8f7-7141b40b1dcc saved to Redis with TTL 1800 seconds
2025-04-02 13:01:25,929 - app.api.v1.endpoints.auth - INFO - Channel 7a78de9d-479b-4631-b8f7-7141b40b1dcc initialized successfully
2025-04-02 13:01:25,929 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-02 13:01:25,929 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 2.0010000000000003}
2025-04-02 13:01:26,127 - INFO - Incoming request: {"timestamp": "2025-04-02T10:01:26.127243", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:01:26,127 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:01:26.127243", "method": "POST", "path": "/auth/login", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:01:26,129 - app.api.v1.endpoints.auth - INFO - Login request using channel: 7a78de9d-479b-4631-b8f7-7141b40b1dcc
2025-04-02 13:01:26,130 - app.api.v1.endpoints.auth - INFO - Decrypted login data: {"email":"mirai@gmail.com","password":"123456","deviceId":"3bc1078f-1b84-4c9e-ad21-cd1f03320eea"}
2025-04-02 13:01:26,130 - app.api.v1.endpoints.auth - INFO - Parsed login data: {'email': 'mirai@gmail.com', 'password': '123456', 'deviceId': '3bc1078f-1b84-4c9e-ad21-cd1f03320eea'}
2025-04-02 13:01:26,340 - app.api.v1.endpoints.auth - INFO - Generating tokens for user ID: 3
2025-04-02 13:01:26,341 - app.api.v1.endpoints.auth - INFO - Login database commit successful
2025-04-02 13:01:26,341 - app.api.v1.endpoints.auth - INFO - Encrypting login response
2025-04-02 13:01:26,342 - app.api.v1.endpoints.auth - INFO - Login response encrypted successfully
2025-04-02 13:01:26,342 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.07000000000002}
2025-04-02 13:01:26,342 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 215.07000000000002}
2025-04-02 13:01:28,283 - INFO - Incoming request: {"timestamp": "2025-04-02T10:01:28.283774", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:01:28,283 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:01:28.283774", "method": "POST", "path": "/auth/secure-init", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:01:28,285 - app.api.v1.endpoints.auth - INFO - Initializing secure channel with ID: 9f56da51-1367-480b-89ae-f0e8e0a86e6c
2025-04-02 13:01:28,285 - app.services.secure_channel_service - INFO - Creating channel with ID: 9f56da51-1367-480b-89ae-f0e8e0a86e6c
2025-04-02 13:01:28,285 - app.services.secure_channel_service - INFO - Channel 9f56da51-1367-480b-89ae-f0e8e0a86e6c saved to Redis with TTL 1800 seconds
2025-04-02 13:01:28,285 - app.api.v1.endpoints.auth - INFO - Channel 9f56da51-1367-480b-89ae-f0e8e0a86e6c initialized successfully
2025-04-02 13:01:28,286 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-02 13:01:28,286 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 3.0010000000000003}
2025-04-02 13:01:29,667 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-02 13:01:29,669 - app.services.connection_manager - INFO - User 3 connected to server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:01:29,669 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-02 13:01:29,675 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-02 13:02:04,254 - INFO - Incoming request: {"timestamp": "2025-04-02T10:02:04.254891", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:02:04,254 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:02:04.254891", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:02:04,257 - app.api.v1.endpoints.users - INFO - Search request received, channel: 9f56da51-1367-480b-89ae-f0e8e0a86e6c
2025-04-02 13:02:04,257 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743589886}
2025-04-02 13:02:04,258 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-04-02 13:02:04,258 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-04-02 13:02:04,258 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-04-02 13:02:04,269 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-02 13:02:04,270 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-04-02 13:02:04,271 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.006}
2025-04-02 13:02:04,271 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 17.006}
2025-04-02 13:03:43,696 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-02 13:03:43,698 - app.services.connection_manager - INFO - User 3 disconnected from server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:03:43,713 - app.api.v1.endpoints.websocket - INFO - WebSocket token verified for user 3
2025-04-02 13:03:43,715 - app.services.connection_manager - INFO - User 3 connected to server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:03:43,715 - app.api.v1.endpoints.websocket - INFO - WebSocket connection established for user 3
2025-04-02 13:03:43,721 - app.api.v1.endpoints.websocket - INFO - Retrieving buffered messages for user 3
2025-04-02 13:03:59,484 - INFO - Incoming request: {"timestamp": "2025-04-02T10:03:59.484500", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:03:59,484 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:03:59.484500", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.8.186"}
2025-04-02 13:03:59,487 - app.api.v1.endpoints.users - INFO - Search request received, channel: 9f56da51-1367-480b-89ae-f0e8e0a86e6c
2025-04-02 13:03:59,487 - app.api.v1.endpoints.users - INFO - Current user from token: {'user_id': '3', 'username': 'MiraiX', 'sub': '3', 'exp': 1743589886}
2025-04-02 13:03:59,488 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"yu","limit":10}
2025-04-02 13:03:59,488 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'yu', 'limit': 10}
2025-04-02 13:03:59,489 - app.api.v1.endpoints.users - INFO - Searching users with query 'yu', excluding user 3
2025-04-02 13:03:59,489 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-02 13:03:59,490 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '2', 'username': 'YuDev', 'avatarUrl': None, 'isOnline': True}]
2025-04-02 13:03:59,491 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-02 13:03:59,491 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-02 13:04:16,150 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-02 13:04:16,154 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-02 13:04:19,204 - INFO - Incoming request: {"timestamp": "2025-04-02T10:04:19.204772", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:04:19,204 - chat_server - INFO - Incoming request: {"timestamp": "2025-04-02T10:04:19.204772", "method": "POST", "path": "/users/search", "query_params": "", "client": "192.168.8.81"}
2025-04-02 13:04:19,207 - app.api.v1.endpoints.users - INFO - Search request received, channel: 30322ed9-da57-486d-b55a-1ed611efcf94
2025-04-02 13:04:19,207 - app.api.v1.endpoints.users - INFO - Current user from token: {'sub': '2', 'exp': 1743589852}
2025-04-02 13:04:19,208 - app.api.v1.endpoints.users - INFO - Decrypted search data: {"query":"mi","limit":10}
2025-04-02 13:04:19,208 - app.api.v1.endpoints.users - INFO - Parsed search data: {'query': 'mi', 'limit': 10}
2025-04-02 13:04:19,209 - app.api.v1.endpoints.users - INFO - Searching users with query 'mi', excluding user 2
2025-04-02 13:04:19,209 - app.api.v1.endpoints.users - INFO - Found 1 users
2025-04-02 13:04:19,210 - app.api.v1.endpoints.users - INFO - Encrypting search results: [{'id': '3', 'username': 'MiraiX', 'avatarUrl': None, 'isOnline': True}]
2025-04-02 13:04:19,211 - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-02 13:04:19,211 - chat_server - INFO - Response sent: {"status_code": 200, "processing_time_ms": 7.002000000000001}
2025-04-02 13:04:20,644 - app.api.v1.endpoints.websocket - INFO - Received chat.init message from user 2 to 3
2025-04-02 13:04:20,645 - app.api.v1.endpoints.websocket - INFO - Added initiator_name 'YuDev' to chat.init message
2025-04-02 13:04:20,652 - app.api.v1.endpoints.websocket - INFO - Message of type chat.init routed from 2 to 3
2025-04-02 13:04:21,667 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-02 13:04:21,668 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-02 13:04:21,670 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-02 13:04:21,671 - app.api.v1.endpoints.websocket - INFO - Received chat.key_exchange message from user 3 to 2
2025-04-02 13:04:21,671 - app.api.v1.endpoints.websocket - INFO - Added responder_name 'MiraiX' to chat.key_exchange message
2025-04-02 13:04:21,673 - app.api.v1.endpoints.websocket - INFO - Message of type chat.key_exchange routed from 3 to 2
2025-04-02 13:04:57,840 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 3 to 2
2025-04-02 13:04:57,844 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 3 to 2
2025-04-02 13:05:01,013 - app.api.v1.endpoints.websocket - INFO - Received chat.delete message from user 2 to 3
2025-04-02 13:05:01,015 - app.api.v1.endpoints.websocket - INFO - Message of type chat.delete routed from 2 to 3
2025-04-02 13:05:06,474 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 2
2025-04-02 13:05:06,476 - app.services.connection_manager - INFO - User 2 disconnected from server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:05:07,294 - app.api.v1.endpoints.websocket - INFO - WebSocket disconnected for user 3
2025-04-02 13:05:07,295 - app.services.connection_manager - INFO - User 3 disconnected from server 971508ae-672e-41e8-bbc4-6c4f0744f71e
2025-04-02 13:08:42,821 - app.main - INFO - Shutting down server...
2025-04-02 13:08:42,822 - app.main - INFO - Redis connections closed
2025-04-02 13:08:42,822 - app.main - INFO - Server shutdown completed
